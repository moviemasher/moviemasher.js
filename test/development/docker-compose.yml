version: '2'
services:
  angular_moviemasher:
    image: moviemasher/angular-moviemasher:1.0.24
    container_name: angular_moviemasher
    build:
      context: ../../../
      dockerfile: ./Dockerfile
    ports:
      - "8080:80"
    volumes:
      - "../../../log:/tmp/moviemasher/log/"
      - "../../../src:/var/www/html/angular-moviemasher/src"
      - "../moviemasher.ini:/var/www/config/moviemasher.ini"
      - "../../../app:/var/www/html/angular-moviemasher/app"
      - "../../../dist:/var/www/html/angular-moviemasher/dist"
      - "../../../node_modules:/var/www/html/angular-moviemasher/node_modules"

      - "../../../../moviemasher.js:/var/www/html/angular-moviemasher/node_modules/@moviemasher/moviemasher.js"
      - "../../../tmp/user-media:/var/www/html/user-media"
      - "../../../tmp/user-data:/var/www/user-data"
      - "./dynamic/user-media:/var/www/html/user-media/test"
      - "./dynamic/user-data:/var/www/user-data/test"
  moviemasher_rb:
    image: moviemasher/moviemasher.rb:4.0.26
#    build:
#      context: ../../../../moviemasher.rb
#      dockerfile: ./Dockerfile
    container_name: angular_moviemasher_rb
    volumes_from:
      - angular_moviemasher
    volumes:
      - "../../../tmp/error:/tmp/moviemasher/error"
      - "../../../tmp/render:/tmp/moviemasher/render"
      - "../../../tmp/download:/tmp/moviemasher/download"
      - "../../../tmp/log:/tmp/moviemasher/log"
      - "../../../../moviemasher.rb/lib:/mnt/moviemasher.rb/lib"
    command: process_loop -v debug --render_save=1
    tty: true
