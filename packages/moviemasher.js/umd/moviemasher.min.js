!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).MovieMasher={})}(this,(function(e){"use strict";const t=e=>e instanceof CustomEvent,i=(e,t,i="value")=>{const n=typeof e,s="object"===n?e.constructor.name:n;throw console.error("throwError",e),new Error(`${i} is "${e}" (${s}) instead of ${t}`)},n=e=>"object"==typeof e;function s(e,t){n(e)||i(e,"Object",t)}const r=e=>"string"==typeof e;function o(e,t){r(e)||i(e,"String",t)}const a=e=>void 0===e,c=e=>"number"==typeof e;function l(e,t){c(e)||i(e,"Number",t)}const u=e=>"boolean"==typeof e;const h=e=>!a(e);const d=e=>c(e)&&Number.isNaN(e),p=e=>c(e)&&!Number.isNaN(e),m=e=>Number.isInteger(e),f=e=>p(e)&&e>=0;function g(e,t){f(e)||i(e,">= 0",t)}const y=e=>p(e)&&e<1,v=e=>p(e)&&e>0;function T(e,t){v(e)||i(e,"> zero",t)}const b=e=>h(Array.isArray)?Array.isArray(e):e instanceof Array;function w(e,t){b(e)||i(e,"Array",t)}const F=e=>!!e.length,S=e=>r(e)&&F(String(e));function I(e,t="value"){S(e)||i(e,"populated string",t)}const C=e=>b(e)&&F(e);function x(e,t="value"){C(e)||i(e,"populated array",t)}const D=e=>n(e)&&F(Object.keys(e));function P(e,t="value"){D(e)||i(e,"populated array",t)}const A=e=>(p(e)||S(e))&&!d(Number(e));function V(e,t="value"){e||i(e,"true",t)}const E=e=>n(e)&&"r"in e&&"g"in e&&"b"in e;const z=e=>n(e)&&"isRange"in e;function O(e,t){z(e)||i(e,"Time",t)}const k=e=>z(e)&&e.isRange;function R(e,t){k(e)||i(e,"TimeRange",t)}const M=e=>p(e)||r(e),_=e=>!!M(e)&&(A(e)?!!Number(e):S(e));const $=e=>n(e)&&Object.values(e).every((e=>M(e)));function N(e,t){$(e)||i(e,"ValueObject",t)}var j,L;e.DroppingPosition=void 0,(j=e.DroppingPosition||(e.DroppingPosition={})).At="at",j.After="after",j.Before="before",j.None="none",e.LayerType=void 0,(L=e.LayerType||(e.LayerType={})).Mash="mash",L.Folder="folder";const q=Object.values(e.LayerType),G=e=>q.includes(e);var B,U;e.ActionType=void 0,(B=e.ActionType||(e.ActionType={})).AddClipToTrack="addClipToTrack",B.AddEffect="addEffect",B.AddLayer="addLayer",B.AddTrack="addTrack",B.Change="change",B.ChangeMultiple="changeMultiple",B.ChangeFrame="changeFrame",B.ChangeGain="changeGain",B.MoveClip="moveClip",B.MoveEffect="moveEffect",B.MoveLayer="moveLayer",B.RemoveClip="removeClip",B.RemoveLayer="removeLayer",e.EditType=void 0,(U=e.EditType||(e.EditType={})).Mash="mash",U.Cast="cast";const W=Object.values(e.EditType),H=e=>W.includes(e);function J(e,t){H(e)||i(e,"EditType",t)}var K,Y;e.AVType=void 0,(K=e.AVType||(e.AVType={})).Audio="audio",K.Both="both",K.Video="video",e.SelectType=void 0,(Y=e.SelectType||(e.SelectType={})).Cast="cast",Y.Clip="clip",Y.Container="container",Y.Content="content",Y.Effect="effect",Y.Layer="layer",Y.Mash="mash",Y.None="none",Y.Track="track";const X=Object.values(e.SelectType),Z=e=>X.includes(e);const Q=[e.SelectType.Content,e.SelectType.Container],ee=e=>Z(e)&&Q.includes(e);var te,ie,ne;e.OutputFormat=void 0,(te=e.OutputFormat||(e.OutputFormat={})).AudioConcat="wav",te.Flv="flv",te.Hls="hls",te.Jpeg="jpeg",te.Mdash="mdash",te.Mp3="mp3",te.Mp4="mp4",te.Png="image2",te.Rtmp="rtmp",te.VideoConcat="yuv4mpegpipe",e.StreamingFormat=void 0,(ie=e.StreamingFormat||(e.StreamingFormat={})).Hls="hls",ie.Mdash="mdash",ie.Rtmp="rtmp",e.OutputType=void 0,(ne=e.OutputType||(e.OutputType={})).Audio="audio",ne.Image="image",ne.ImageSequence="imagesequence",ne.Video="video",ne.Waveform="waveform";const se=Object.values(e.OutputType);var re;e.FillType=void 0,(re=e.FillType||(e.FillType={})).Color="color",re.Fill="fill";const oe=Object.values(e.FillType);var ae;e.GraphFileType=void 0,(ae=e.GraphFileType||(e.GraphFileType={})).Svg="svg",ae.SvgSequence="svgsequence",ae.Txt="txt";const ce=Object.values(e.GraphFileType),le=e=>S(e)&&ce.includes(e);var ue;e.LoadType=void 0,(ue=e.LoadType||(e.LoadType={})).Audio="audio",ue.Font="font",ue.Image="image",ue.Video="video";const he=Object.values(e.LoadType),de=e=>S(e)&&he.includes(e);function pe(e,t){de(e)||i(e,"LoadType",t)}const me=he.filter((t=>t!==e.LoadType.Font)),fe=e=>de(e)&&me.includes(e);var ge;e.DefinitionType=void 0,(ge=e.DefinitionType||(e.DefinitionType={})).Audio="audio",ge.Clip="clip",ge.Container="container",ge.Content="content",ge.Effect="effect",ge.Filter="filter",ge.Font="font",ge.Image="image",ge.Video="video",ge.VideoSequence="videosequence";const ye=Object.values(e.DefinitionType),ve=e=>ye.includes(e);function Te(e,t=""){if(!ve(e))throw new Error(`expected '${e}' to be DefinitionType ${t}`)}const be=[e.DefinitionType.Container,e.DefinitionType.Image,e.DefinitionType.Video,e.DefinitionType.VideoSequence],we=e=>ve(e)&&be.includes(e),Fe=[e.DefinitionType.Audio,e.DefinitionType.Video,e.DefinitionType.VideoSequence],Se=e=>ve(e)&&Fe.includes(e),Ie=[e.DefinitionType.Image,e.DefinitionType.Container,e.DefinitionType.VideoSequence],Ce=e=>ve(e)&&Ie.includes(e);const xe=[e.DefinitionType.Content,e.DefinitionType.Image,e.DefinitionType.Video,e.DefinitionType.VideoSequence,e.DefinitionType.Audio],De=e=>ve(e)&&xe.includes(e);var Pe;e.DataType=void 0,(Pe=e.DataType||(e.DataType={})).Boolean="boolean",Pe.ContainerId="containerid",Pe.ContentId="contentid",Pe.DefinitionId="definitionid",Pe.FontId="fontid",Pe.Frame="frame",Pe.Number="number",Pe.Percent="percent",Pe.Rgb="rgb",Pe.String="string",Pe.Timing="timing",Pe.Sizing="sizing";const Ae=Object.values(e.DataType),Ve=e=>Ae.includes(e);function Ee(e,t){Ve(e)||i(e,"DataType",t)}var ze;e.Orientation=void 0,(ze=e.Orientation||(e.Orientation={})).H="H",ze.V="V";const Oe=Object.values(e.Orientation),ke=e=>S(e)&&Oe.includes(e);var Re;e.Direction=void 0,(Re=e.Direction||(e.Direction={})).E="E",Re.N="N",Re.S="S",Re.W="W";const Me=Object.values(e.Direction),_e=e=>Me.includes(e);function $e(e,t){_e(e)||i(e,"Direction",t)}var Ne;e.Anchor=void 0,(Ne=e.Anchor||(e.Anchor={})).E="E",Ne.N="N",Ne.NE="NE",Ne.NW="NW",Ne.S="S",Ne.SE="SE",Ne.SW="SW",Ne.W="W";const je=Object.values(e.Anchor);var Le;e.TriggerType=void 0,(Le=e.TriggerType||(e.TriggerType={})).Init="init",Le.Stop="stop",Le.Start="start";const qe=Object.values(e.TriggerType);var Ge,Be;e.TransformType=void 0,(Ge=e.TransformType||(e.TransformType={})).Scale="scale",Ge.Translate="translate",e.EventType=void 0,(Be=e.EventType||(e.EventType={})).Action="action",Be.Active="active",Be.Added="added",Be.Cast="cast",Be.Draw="draw",Be.Duration="durationchange",Be.Ended="ended",Be.Fps="ratechange",Be.Loaded="loadeddata",Be.Mash="mash",Be.Pause="pause",Be.Play="play",Be.Playing="playing",Be.Render="render",Be.Resize="resize",Be.Save="save",Be.Seeked="seeked",Be.Seeking="seeking",Be.Selection="selection",Be.Time="timeupdate",Be.Track="track",Be.Volume="volumechange",Be.Waiting="waiting";const Ue=Object.values(e.EventType);var We,He,Je,Ke;e.MoveType=void 0,(We=e.MoveType||(e.MoveType={})).Audio="audio",We.Effect="effect",We.Video="video",e.MasherAction=void 0,(He=e.MasherAction||(e.MasherAction={})).Redo="redo",He.Remove="remove",He.Render="render",He.Save="save",He.Undo="undo",e.GraphType=void 0,(Je=e.GraphType||(e.GraphType={})).Mash="mash",Je.Cast="cast",e.ServerType=void 0,(Ke=e.ServerType||(e.ServerType={})).Api="api",Ke.Data="data",Ke.File="file",Ke.Rendering="rendering",Ke.Streaming="streaming",Ke.Web="web";const Ye=Object.values(e.ServerType);var Xe,Ze;e.Duration=void 0,(Xe=e.Duration||(e.Duration={}))[Xe.Unknown=-1]="Unknown",Xe[Xe.Unlimited=-2]="Unlimited",Xe[Xe.None=0]="None",e.Timing=void 0,(Ze=e.Timing||(e.Timing={})).Custom="custom",Ze.Content="content",Ze.Container="container";const Qe=Object.values(e.Timing);var et;e.Sizing=void 0,(et=e.Sizing||(e.Sizing={})).Preview="preview",et.Content="content",et.Container="container";const tt=Object.values(e.Sizing),it={start:"",status:""},nt={...it,upload:""},st={delete:"",get:"",put:"",retrieve:""},rt={cast:{...st,default:""},mash:{...st,default:""},stream:{...st},definition:{...st}},ot={...it,...st,preload:"",cut:"",webrtc:"",rtmp:"",remote:"",local:""},at={[e.ServerType.Api]:{servers:"",callbacks:""},[e.ServerType.Data]:rt,[e.ServerType.File]:{store:""},[e.ServerType.Rendering]:nt,[e.ServerType.Streaming]:ot};Object.entries(at).forEach((([e,t])=>{n(t)&&Object.entries(t).forEach((([i,n])=>{r(n)?t[i]=`/${e}/${i}`:Object.entries(n).forEach((([t,s])=>{s||(n[t]=`/${e}/${i}/${t}`)}))}))}));const ct={},lt=ct,ut=()=>{},ht="http://www.w3.org/2000/svg",dt="com.moviemasher.",pt=".default",mt=e=>n(e)&&"id"in e&&(!e.type||ve(e.type)),ft=e=>n(e)&&ve(e.type)&&"instanceFromObject"in e;function gt(e,t){ft(e)||i(e,"Definition",t)}class yt{static byId=new Map;static byIdAdd(e){(Array.isArray(e)?e:[e]).forEach((e=>this.byId.set(e.id,e)))}static byType(e){const t=this.definitionsByType.get(e);if(t)return t;const i=lt[e].defaults||[];return this.definitionsByType.set(e,i),i}static define(...e){return e.map((e=>this.fromObject(e)))}static definitionDelete(e){const{type:t,id:i}=e,n=this.byType(t),s=n.findIndex((e=>i===e.id));s<0||n.splice(s,1)}static definitionsByType=new Map;static definitionsType(e){const t=e.split(".").slice(-2).shift();return ve(t)?t:void 0}static fromId(e){if(this.installed(e))return this.byId.get(e);const t=this.definitionsType(e);return Te(t,`in Defined.fromId('${e}')`),lt[t].definitionFromId(e)}static fromObject(e){const{id:t,type:i}=e;if(I(t),this.installed(t)||this.predefined(t))return this.fromId(t);const n=i||this.definitionsType(t);return Te(n),this.install(lt[n].definition(e))}static get ids(){return[...this.byId.keys()]}static install(e){const{type:t,id:i}=e;return this.installed(i)?(this.uninstall(e),this.updateDefinition(this.fromId(i),e)):(this.byIdAdd(e),this.byType(t).push(e),e)}static installed(e){return this.byId.has(e)}static predefined(e){if(e.startsWith(dt))return!0;const t=this.definitionsType(e);if(!t)return!1;return this.byType(t).some((t=>t.id===e))}static undefineAll(){this.byId=new Map,this.definitionsByType=new Map}static updateDefinition(e,t){return this.uninstall(e),this.install(t),t}static updateDefinitionId(e,t){const i=this.byId.get(e);gt(i),this.byId.delete(e),this.byId.set(t,i)}static uninstall(e){this.definitionDelete(e);const{id:t}=e;return this.byId.delete(t),e}}const vt="rgb".split(""),Tt=[...vt,"a"],bt="#00000000",wt="#000000",Ft="#FFFFFF",St="#FFFFFF00",It="#00000000",Ct="#000000FF",xt="#00FF00";var Dt;e.Color=void 0,(Dt=e.Color||(e.Color={})).Transparent="#00000000",Dt.Black="#000000",Dt.White="#FFFFFF",Dt.WhiteTransparent="#FFFFFF00",Dt.BlackTransparent="#00000000",Dt.WhiteOpaque="#FFFFFFFF",Dt.BlackOpaque="#000000FF",Dt.Green="#00FF00",Dt.Yellow="#FFFF00",Dt.Red="#FF0000",Dt.Blue="#0000FF";const Pt=Object.values(e.Color),At=t=>{for(const i of Object.entries(e.Color)){const[e,n]=i;if(n===t)return e}return""},Vt=e=>Math.min(255,Math.max(0,Math.floor(Number(e)))),Et=e=>({r:Vt(e.r),g:Vt(e.g),b:Vt(e.b)}),zt=e=>({y:Vt(e.y),u:Vt(e.u),v:Vt(e.v)}),Ot=e=>{let t=e.r.toString(16),i=e.g.toString(16),n=e.b.toString(16);return t.length<2&&(t=`0${t}`),i.length<2&&(i=`0${i}`),n.length<2&&(n=`0${n}`),`#${t}${i}${n}`},kt=e=>{let t=e.r.toString(16),i=e.g.toString(16),n=e.b.toString(16),s=Math.round(255*Number(e.a)).toString(16);return t.length<2&&(t=`0${t}`),i.length<2&&(i=`0${i}`),n.length<2&&(n=`0${n}`),s.length<2&&(s=`0${s}`),`#${t}${i}${n}${s}`},Rt=(e,t,i,n)=>{const s=e.u-t.u,r=e.v-t.v,o=Math.sqrt((s*s+r*r)/65025);return n>1e-4?255*Math.min(1,Math.max(0,(o-i)/n)):o>i?255:0},Mt=(e,t,i,n)=>{let s=0;const r=zt(t);return e.forEach((e=>{const t=zt(e),i=t.u-r.u,n=t.v-r.v;s+=Math.sqrt((i*i+n*n)/65025)})),s/=e.length,n>1e-4?255*Math.min(1,Math.max(0,(s-i)/n)):s>i?255:0},_t=e=>{const t=Et(e);return{y:.299*t.r+.587*t.g+.114*t.b,u:-.168736*t.r+-.331264*t.g+.5*t.b+128,v:.5*t.r+-.418688*t.g+-.081312*t.b+128}},$t=/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/,Nt=/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d*(?:\.\d+)?)\)$/,jt=/^#([A-Fa-f0-9]{3,4}){1,2}$/,Lt=e=>e.toLowerCase().replaceAll(/[\s]/g,""),qt=e=>{const t=Lt(e);if(Gt(t)||Bt(t)||Ut(t))return!0;const i=(new Option).style;i.color=e;const n=Lt(i.color);return!!n&&(!(!Bt(t)&&!Ut(t))||n===t)},Gt=e=>jt.test(e),Bt=e=>Nt.test(e),Ut=e=>$t.test(e),Wt=(e,t)=>e.match(new RegExp(`.{${t}}`,"g")),Ht=e=>parseInt(e.repeat(2/e.length),16),Jt=e=>f(e)?Math.max(0,Math.min(1,e/255)):1,Kt=e=>{if(!Gt(e))return ti;const t=Math.floor((e.length-1)/3),i=Wt(e.slice(1),t);if(!i)return ti;const[n,s,r,o]=i.map(Ht);return{r:n,g:s,b:r,a:Jt(o)}},Yt=e=>{if(!Gt(e))return ei;const t=Math.floor((e.length-1)/3),i=Wt(e.slice(1),t);if(!i)return ei;const[n,s,r]=i.map(Ht);return{r:n,g:s,b:r}},Xt=e=>{const t=Lt(e).match(Nt);return t?{r:Number(t[1]),g:Number(t[2]),b:Number(t[3]),a:Number(t[4])}:ti},Zt=e=>{const t=Lt(e);if(Gt(t))return Yt(t);const i=t.match($t);return i?{r:Number(i[1]),g:Number(i[2]),b:Number(i[3])}:ei},Qt=e=>{if(!qt(e))return ti;const t=Lt(e);return Gt(t)?Kt(t):Bt(t)?Xt(t):Ut(t)?{a:1,...Zt(t)}:ti},ei={r:0,g:0,b:0},ti={...ei,a:1},ii={...ei,a:0},ni=[e.DataType.Frame,e.DataType.Percent,e.DataType.Number],si=e=>Ve(e)&&ni.includes(e),ri=t=>{if(ve(t))return`${dt}${t}.default`;switch(t){case e.DataType.Boolean:return!1;case e.DataType.Rgb:return wt}return si(t)?0:""},oi=(t,i)=>{if(ve(i))return S(t);switch(i){case e.DataType.Boolean:return(e=>!!u(e)||(p(e)?0===e||1===e:["true","false",""].includes(e)))(t);case e.DataType.Rgb:return qt(String(t));case e.DataType.Frame:case e.DataType.Percent:case e.DataType.Number:return A(t);case e.DataType.String:return!0;case e.DataType.ContainerId:case e.DataType.ContentId:case e.DataType.FontId:case e.DataType.DefinitionId:default:return S(t)}return!1},ai=(t,i)=>i===e.DataType.Boolean?u(t)?t:A(t)?!!Number(t):"true"===t:si(i)?A(t)?Number(t):0:String(t),ci="End";class li{constructor(...e){}addProperties(e,...t){this.properties.push(...t),t.forEach((t=>{this.propertyTweenSetOrDefault(e,t)}))}properties=[];get propertiesCustom(){return this.properties.filter((e=>e.custom))}propertiesInitialize(e){s(e),this.properties.forEach((t=>this.propertyTweenSetOrDefault(e,t)))}propertyFind(e){return this.properties.find((t=>t.name===e))}propertyName(e){return e.endsWith(ci)?e.slice(0,-ci.length):e}propertySetOrDefault(e,t,i,n){const s=e[i],r=a(s)?n:s;this.setValue(r,i,t)}propertyTweenSetOrDefault(e,t){const{name:i,defaultValue:n,tweenable:s}=t;this.propertySetOrDefault(e,t,i,n),s&&this.propertySetOrDefault(e,t,`${i}${ci}`)}setValue(e,t,i){if(a(e))return void delete this[t];const n=this.propertyName(t),s=i||this.propertyFind(n);V(s,`${this.constructor.name}.${n} in ${this.properties.map((e=>e.name)).join(", ")}`);const r=s.type;if(!oi(e,r))return void(n!==t&&delete this[t]);const o=ai(e,r);this[t]=o}setValues(e){Object.entries(e).forEach((([e,t])=>{this.setValue(t,e)}))}toJSON(){return Object.fromEntries(this.properties.flatMap((e=>{const{name:t,tweenable:i}=e,n=[[t,this.value(t)]];if(i){const e=`${t}${ci}`;n.push([e,this.value(e)])}return n})))}value(e){return this[e]}}const ui=e=>n(e)&&("definitionId"in e||"definition"in e),hi=e=>n(e)&&"definitionIds"in e,di=e=>hi(e)&&ft(e.definition);function pi(e){if(!di(e))throw new Error("expected Tweenable")}const mi=e=>ft(e);const fi=`${dt}container.default`,gi=`${dt}container.text`,yi=e=>n(e)&&"opacity"in e;const vi=e=>di(e)&&Ce(e.type);function Ti(e){if(!vi(e))throw new Error("expected Container")}const bi=e=>n(e)&&p(e.x)&&p(e.y);function wi(e,t){bi(e)||i(e,"Point",t)}const Fi=(e,t)=>!!bi(t)&&(e.x===t.x&&e.y===t.y),Si={x:0,y:0},Ii=e=>{const{x:t,y:i}=e;return{x:t,y:i}},Ci=e=>{const{x:t,y:i}=e;return{x:Math.round(t),y:Math.round(i)}},xi=e=>{const{x:t,y:i}=e;return`x=${t};y=${i}`},Di=e=>n(e)&&p(e.width)&&p(e.height);function Pi(e,t){Di(e)||i(e,"Size",t)}const Ai=(e,t)=>!!Di(t)&&(e.width===t.width&&e.height===t.height),Vi={width:0,height:0},Ei=e=>2*Math.max(1,Math.ceil(e/2)),zi=e=>{const{width:t,height:i}=e;return{width:Ei(t),height:Ei(i)}},Oi=e=>{const{width:t,height:i}=e;return{width:Math.round(t),height:Math.round(i)}},ki=e=>{const{width:t,height:i}=e;return{width:Math.max(2,Math.ceil(t)),height:Math.max(2,Math.ceil(i))}},Ri=(e,t,i)=>{const{width:n,height:s}=e;return{width:n*t,height:s*i}},Mi=(e,t,i=!1)=>{$i(e,"sizeCover"),Pi(t);const{width:n,height:s}=e,{width:r,height:o}=t,a=r/n,c=o/s;return ki((i?a<c:a>c)?{...t,height:s*a}:{...t,width:n*c})},_i=e=>{if(!Di(e))return!1;const{width:t,height:i}=e;return v(t)&&v(i)};function $i(e,t){_i(e)||i(e,"SizeAboveZero",t)}const Ni={width:1920,height:1080},ji=Ri(Ni,.25,.25),Li=Ri(ji,.5,.5),qi=e=>{const{width:t,height:i}=e;return{width:t,height:i}},Gi=(t,i)=>{const n=qi(t);switch(i){case e.Orientation.H:n.width=n.height;break;case e.Orientation.V:n.height=n.width}return n},Bi=e=>{const{width:t,height:i}=e;return`width=${t};height=${i}`},Ui=(t,i)=>{$i(t,"sizeLockNegative");const n=qi(t);return i&&(i===e.Orientation.V?n.height=-1:n.width=-1),n},Wi=e=>Di(e)&&bi(e);function Hi(e,t){Wi(e)||i(e,"Rect",t)}const Ji=(e,t)=>!!Wi(t)&&(Fi(e,t)&&Ai(e,t)),Ki={...Si,...Vi},Yi=(e,t)=>{const i=t||Si,{width:n,height:s}=e;return{x:i.x,y:i.y,width:n,height:s}},Xi=(e,t)=>({x:Math.round((e.width-t.width)/2),y:Math.round((e.height-t.height)/2)}),Zi=e=>e[e.length-1],Qi=(e,t)=>(e.splice(0,e.length,...t),e),en=e=>[...e].reverse(),tn=e=>[...new Set(e)];var nn;e.DataGroup=void 0,(nn=e.DataGroup||(e.DataGroup={})).Point="point",nn.Size="size",nn.Opacity="opacity",nn.Color="color",nn.Effects="effects",nn.Timing="timing",nn.Sizing="sizing";const sn=Object.values(e.DataGroup),rn=e=>sn.includes(e);const on=e=>n(e)&&"type"in e&&Ve(e.type);function an(e,t){on(e)||i(e,"Property",t)}const cn=t=>{const{type:i,name:n,defaultValue:s,...r}=t,o=((t,i)=>a(t)?u(i)?e.DataType.Boolean:p(i)?e.DataType.Number:e.DataType.String:(Ee(t),t))(i,s),c=((e,t)=>a(t)?ri(e):t)(o,s),l={type:o,defaultValue:c,name:S(n)?n:o,...r};if(i===e.DataType.Percent)a(l.max)&&(l.max=1),a(l.min)&&(l.min=0),a(l.step)&&(l.step=.01);return l},ln="Invalid argument ",un="Invalid property ",hn="Internal Error ",dn={eval:{sourceRect:"Invalid evaluation of source rect ",outputSize:"Invalid evaluation of output size ",inputSize:"Invalid evaluation of input size ",conditionTruth:"Expected at least one condition to evaluate to true ",conditionValue:"Expected condition to have a value ",number:"Expected evaluated number for ",get:"Expected to get evaluated value ",string:"Invalid evaluation string "},composition:{mashUndefined:`${hn}composition.mash undefined`},audibleContext:"Expected AudioContext",mash:"Expected mash",action:"Expected Action",actions:"Expected Actions",internal:hn,argument:"Invalid argument ",invalid:{canvas:"Invalid property canvas ",context:"Invalid property context ",duration:"Invalid duration",definition:{audio:"Invalid definition property audio|url",url:"Invalid definition property url",source:"Invalid definition property source",id:"Invalid definition property id ",object:"Invalid property definition",type:"Invalid definition property type "},size:"Invalid size ",track:"Invalid track ",trackType:"Invalid property trackType ",action:"Invalid action ",name:"Invalid property name ",value:"Invalid property value ",type:"Invalid property type ",url:"Invalid property url ",user:"Unauthenticated",property:un,argument:ln,object:"Invalid argument object ",factory:"Invalid factory ",volume:"Invalid argument volume"},type:"Unknown type ",selection:"Invalid selection ",unknown:{type:"Unknown type ",merger:"Unknown merger ",effect:"Unknown effect ",filter:"Unknown filter ",font:"Unknown font ",scaler:"Unknown scalar ",definition:"Unknown definition "},uncached:"Uncached URL ",object:"Invalid argument object ",array:"Invalid argument array ",media:"Invalid argument media ",id:"Invalid argument id ",frame:"Invalid argument frame ",frames:"Invalid property frames ",fps:"Invalid argument fps ",seconds:"Invalid argument seconds ",url:"Invalid argument url ",time:"Invalid argument Time",timeRange:"Invalid argument TimeRange",mainTrackOverlap:`${hn}: main track clips overlap without transition`,unknownMash:"Unknown Mash property ",unimplemented:"Expected method to be overridden ",property:"Invalid argument property ",wrongClass:"Expected instance of "};class pn{constructor({name:t,value:i,dataType:n,values:s}){if(!t)throw dn.invalid.name;if(this.values=s,this.name=t,a(i)){if(!this.values?.length)throw dn.invalid.value;this.value=this.values[0]}else this.value=i;if(n&&Ae.map(String).includes(n))this.dataType=n;else{let t=!1;t=Array.isArray(this.value)?this.value.every((e=>A(e.value))):A(this.value),t&&(this.dataType=e.DataType.Number)}}dataType=e.DataType.String;name;toJSON(){return{name:this.name,value:this.value}}value;values}const mn={count:0,prefix:"",countsByPrefix:{}},fn=()=>{const e=[];return mn.prefix&&e.push(mn.prefix),e.push(Date.now().toString(36)),e.push(Math.random().toString(36).slice(2)),e.join("-")},gn=()=>{const{prefix:e}=mn,t=[];return e?(t.push(e),mn.countsByPrefix[e]||=0,t.push(String(mn.countsByPrefix[e]++))):t.push(String(mn.count++)),t.join("")},yn=(e=mn.prefix)=>{const t=[];return e?(t.push(e),mn.countsByPrefix[e]||=0,t.push(String(mn.countsByPrefix[e]++))):t.push(String(mn.count++)),t.join("")},vn=e=>!!S(mn.prefix)&&e.startsWith(mn.prefix);class Tn extends li{constructor(...e){super(...e);const[t]=e;P(t);const{definition:i}=t;gt(i),this.definition=i,this.properties.push(...this.definition.properties),this.propertiesInitialize(t)}copy(){return this.definition.instanceFromObject(this.toJSON())}definition;get definitionId(){return this.definition.id}definitionIds(){return[this.definitionId]}_id;get id(){return this._id||=fn()}_label="";get label(){return this._label}set label(e){this._label=e}get propertyNames(){return this.properties.map((e=>e.name))}toJSON(){const e=super.toJSON(),{definitionId:t,type:i,label:n}=this;return n&&(e.label=n),e.type=i,e.definitionId=t,e}get type(){return this.definition.type}}const bn=e=>`#${e}`,wn=e=>`url(${bn(e)})`,Fn=(e,t="")=>{const i=globalThis.document.createElementNS(ht,"g");return _n(i,t),Sn(i,e),i},Sn=(e,t)=>{if(Di(t)){const{width:i,height:n}=t;f(i)&&_n(e,String(i),"width"),f(n)&&_n(e,String(n),"height")}if(bi(t)){const{x:i,y:n}=t;_n(e,String(i),"x"),_n(e,String(n),"y")}},In=e=>{const{width:t,height:i,x:n=0,y:s=0}=e,r={x:n,y:s},o=[];return o.push(r),o.push({x:n+t,y:s}),o.push({x:n+t,y:s+i}),o.push({x:n,y:s+i}),o.push(r),o},Cn=(e,t,i="",n)=>{const s=globalThis.document.createElementNS(ht,"polygon"),r=In(e).map((e=>[e.x,e.y].join(","))).join(" ");return _n(s,r,"points"),_n(s,i,"fill"),$n(s,t),_n(s,n),s},xn=(e,t)=>{$i(t,"svgSetBox");const i=qi(t),{width:n,height:s}=i;Sn(e,i);_n(e,`0 0 ${n} ${s}`,"viewBox")},Dn=(e,t)=>{const i=globalThis.document.createElementNS(ht,"svg");return _n(i,"1.1","version"),_n(i,ht,"xmlns"),On(i,t),_i(e)?(xn(i,e),i):i},Pn=(e,t,i)=>{$i(t),i||_n(e,"none","preserveAspectRatio");const n={...Ui(t,i),...Ii(t)};Sn(e,n)},An=()=>{const e=globalThis.document.createElementNS(ht,"image");return _n(e,"none","preserveAspectRatio"),e},Vn=(e,t="currentColor")=>{const i=globalThis.document.createElementNS(ht,"path");return _n(i,e,"d"),_n(i,t,"fill"),i},En=(e,t,i)=>{const n=fn(),s=globalThis.document.createElementNS(ht,"mask");if(_n(s,n),_i(e)){On(s,Cn(e,"",i?"black":"none"))}return t&&(_n(t,wn(n),"mask"),i&&_n(t,"luminance","mask-mode")),s},zn=(e,t)=>{const{filter:i,...n}=e;I(i);const s=globalThis.document.createElementNS(ht,i);return Sn(s,t),Object.entries(n).forEach((([e,t])=>{_n(s,String(t),e)})),s},On=(e,t)=>{if(!t)return;(b(t)?t:[t]).forEach((t=>e.appendChild(t)))},kn=e=>{const t=globalThis.document.createElementNS(ht,"defs");return On(t,e),t},Rn=(e,t)=>{const i=globalThis.document.createElementNS(ht,"feImage");return S(e)&&_n(i,bn(e),"href"),_n(i,t,"result"),i},Mn=(e,t,i,n="userSpaceOnUse")=>{const s=globalThis.document.createElementNS(ht,"filter");if(n&&_n(s,n,"filterUnits"),_n(s,"sRGB","color-interpolation-filters"),On(s,e),t){const e=fn();if(_n(s,e),t){(b(t)?t:[t]).forEach((t=>{_n(t,wn(e),"filter"),$n(t,"filtered")}))}}return Sn(s,i),s},_n=(e,t,i="id")=>{S(t)&&e.setAttribute(i,t)},$n=(e,t)=>{if(!t)return;const i=b(t)?t:t.split(" ");e.classList.add(...i)},Nn=(e,t,i)=>{const n=globalThis.document.createElementNS(ht,"use");return S(e)&&_n(n,bn(e),"href"),_n(n,i),$n(n,t),n},jn=(e,t,i="top left")=>{_n(e,t,"transform"),_n(e,i,"transform-origin")},Ln=(e,t)=>{$i(e,"svgTransform.dimensions"),$i(t,"svgTransform.rect");const{width:i,height:n}=e,{width:s,height:r,x:o,y:a}=t,c=s/i,l=r/n,u=[];if(0===o&&0===a||u.push(`translate(${o},${a})`),1===c&&1===l||u.push(`scale(${c},${l})`),bi(e)){const{x:t,y:i}=e;0===t&&0===i||u.push(`translate(${t},${i})`)}return u.join(" ")},qn=(e,t,i)=>{jn(e,Ln(t,i))},Gn=(e,t)=>{if(!e.hasChildNodes())return On(e,t);const{childNodes:i}=e,n=[];i.forEach((e=>{t.includes(e)||n.push(e)})),n.forEach((t=>{e.removeChild(t)})),t.forEach((t=>e.appendChild(t)))},Bn=e=>e instanceof HTMLVideoElement,Un=e=>e instanceof HTMLImageElement,Wn=e=>e instanceof AudioBuffer,Hn=e=>de(e)||le(e);function Jn(e,t){Hn(e)||i(e,"LoaderType",t)}const Kn=e=>S(e)&&e.includes(":");const Yn=(e={})=>{const{baseURI:t}=globalThis.document,i=new URL(t),{protocol:n,host:s,pathname:r,port:o}=i,a=s.split(":").shift(),c={protocol:n.slice(0,-1),host:a,prefix:r,...e};return A(o)&&(c.port=Number(o)),c},Xn=e=>e.startsWith("object:/"),Zn=e=>e.startsWith("http"),Qn=e=>e.includes(":"),es=(e,t)=>(e.endsWith("/")?e.slice(0,-1):e)+"/"+(t.startsWith("/")?t.slice(1):t),ts=e=>{const t=Yn(e),{port:i,prefix:n,host:s,protocol:r}=t;I(s),I(r);const o=[];o.push(r,"://",s),A(i)&&o.push(":",String(i));const a=o.join("");return n?es(a,n):a},is=(e,t="")=>{if(t&&Qn(t))return t;const i=ts(e),n=i.endsWith("/")?i:i+"/";if(!Qn(n))return n+t;const s=new URL(t,n),{href:r}=s;return r},ns=e=>"object"===e||Zn(e)||!Hn(e),ss=e=>{const t=e.indexOf(":");return v(t)?e.slice(0,t):""},rs=e=>{const t=e.indexOf(":"),i=e.indexOf("/");if(!f(t)||!f(i))return[];return[e.slice(0,t),e.slice(t+1,i),e.slice(i+1)]},os=e=>{if(!e)return[];const t=[rs(e)];let i="";for(;i=Zi(Zi(t));){const e=rs(i);if(!e.length)break;const[n,s,r]=e;if("object"===n||Zn(n))break;if(t.push(e),ns(ss(r)))break}return t},as=(e,t)=>{if(!e||ns(ss(e)))return[];const i=os(e),n=Zi(i);if(!n)return i;const s=Zi(n);if(Xn(s)||Zn(s))return i;let r=is(t,s);const{length:o}=i;for(let e=o-1;e>-1;e--){const t=i[e],[n,s]=t;t[2]=r,r=`${n}:${s}/${r}`}return i},cs=e=>{if(!S(e))return;const t=e.split(";").map((e=>{const[t,i]=e.split("=");return[t,A(i)?Number(i):i]}));return Object.fromEntries(t)},ls=e=>e?Object.entries(e).map((e=>e.join("="))).join(";"):"",us=(e,t,i)=>t.startsWith(e)&&!i?t:`${e}:${ls(i)}/${t}`;class hs{constructor(...e){const[t]=e,{id:i,label:n,icon:s}=t;I(i,"id"),this.id=i,S(n)&&(this.label=n),S(s)&&(this.icon=s)}icon;id;definitionIcon(e,t){const{icon:i}=this;if(i)return this.urlIcon(i,e,t)}instanceFromObject(e={}){return new Tn(this.instanceArgs(e))}instanceArgs(e={}){return{...Object.fromEntries(this.properties.map((e=>[e.name,e.defaultValue]))),...e,definition:this}}label="";properties=[];get propertiesModular(){return this.properties.filter((e=>ve(e.type)))}toJSON(){const e={id:this.id,type:this.type};return this.icon&&(e.icon=this.icon),this.label!==this.id&&(e.label=this.label),e}toString(){return this.label}type;urlIcon(e,t,i){const n=us("image",e);return t.loadPromise(n).then((e=>{const{width:s,height:r}=e,o=Mi({width:s,height:r},i,!0),a={...o,...Xi(i,o)},c=us("svg",n,a);return t.loadPromise(c).then((e=>Dn(i,e)))}))}static fromObject(e){const{id:t,type:i}=e;return Te(i),I(t,"id"),lt[i].definition(e)}}class ds extends Tn{constructor(...e){super(...e);const[t]=e;if(!D(t))throw dn.invalid.object+"filter";const{parameters:i}=t;i?.length&&this.parameters.push(...i.map((e=>{const{name:t,dataType:i}=e;if(!i){const i=this.definition.parameters.find((e=>e.name===t));i&&(e.dataType=i.dataType)}return new pn(e)})))}commandFilters(e){return this.definition.commandFilters({...e,filter:this})}parameters=[];_parametersDefined;get parametersDefined(){if(this._parametersDefined)return this._parametersDefined;const e=[...this.parameters];return e.push(...this.definition.parameters.filter((t=>!e.find((e=>e.name===t.name))))),this._parametersDefined=e}filterSvg(e={}){return this.definition.filterDefinitionSvg({...e,filter:this})}filterSvgFilter(){const e=this.scalarObject();return this.definition.filterDefinitionSvgFilter(e)}scalarObject(e=!1){const t={},{parametersDefined:i}=this;return i.forEach((e=>{const{name:i,value:n}=e;if(S(n)){if(this.properties.find((e=>n===e.name)))return}(p(n)||r(n))&&(t[i]=n)})),this.properties.forEach((i=>{const{tweenable:n,name:s}=i;if(h(t[s]))return;if(t[s]=this.value(s),!e||!n)return;const r=`${s}${ci}`;t[r]=this.value(r)})),t}toJSON(){const e={id:this.definitionId};return this.parameters.length&&(e.parameters=this.parameters),e}toString(){return`[Filter ${this.label}]`}}class ps extends hs{commandFilters(e){const{filter:t,duration:i,filterInput:n}=e;I(n);const s=[],r=t.scalarObject(!!i);N(r);const{ffmpegFilter:o}=this,a={inputs:[n],ffmpegFilter:o,options:r,outputs:[yn(o)]};return s.push(a),s}commandFilter(e={}){const{ffmpegFilter:t}=this;return{ffmpegFilter:t,options:e,inputs:[],outputs:[yn(t)]}}_ffmpegFilter;get ffmpegFilter(){return this._ffmpegFilter||=this.id.split(".").pop()||this.id}filterDefinitionSvg(e){throw new Error(dn.unimplemented+"initialSvgContent")}instanceFromObject(e={}){return new ds(this.instanceArgs(e))}parameters=[];populateParametersFromProperties(){this.parameters=this.properties.map((t=>{const{name:i}=t;return new pn({name:i,value:i,dataType:e.DataType.String})}))}filterDefinitionSvgFilter(e){throw dn.unimplemented}colorCommandFilter(e,t=0,i=0,n="#FFFFFF00"){const{width:s,height:r}=e,o="color",a=yn(o),c={color:n,size:`${s}x${r}`};t&&(c.rate=t),i&&(c.duration=i);return{inputs:[],ffmpegFilter:o,options:c,outputs:[a]}}type=e.DefinitionType.Filter}class ms extends ps{constructor(...t){super(...t),this.properties.push(cn({custom:!0,name:"color",type:e.DataType.String,defaultValue:xt})),this.properties.push(cn({custom:!0,name:"similarity",type:e.DataType.Percent,defaultValue:.9,min:.1,step:.01,max:1})),this.properties.push(cn({custom:!0,name:"blend",type:e.DataType.Percent,defaultValue:0,step:.01,max:1})),this.populateParametersFromProperties()}filterDefinitionSvgFilter(e){const{similarity:t,color:i,blend:n}=e;l(t),l(n),I(i);const s=255,r=65025*(1-n),o=Zt(i),a=[],c={filter:"feColorMatrix",type:"matrix",values:`1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 ${1-t*(o.r/s)} ${1-t*(o.g/s)} ${1-t*(o.b/s)} -${r} ${r}`};return a.push(zn(c)),a}}const fs=(e="")=>{switch(e){case"ceil":return Math.ceil;case"floor":return Math.floor;default:return Math.round}},gs=(e,t="")=>fs(t)(e),ys=(e,t)=>({r:t[e],g:t[e+1],b:t[e+2],a:t[e+3]}),vs=(e,t,i)=>{const{x:n,y:s}=t,{width:r,height:o}=i,a=((e,t)=>({x:e%t,y:Math.floor(e/t)}))(e,r);return a.x=Math.max(0,Math.min(r-1,a.x+n)),a.y=Math.max(0,Math.min(o-1,a.y+s)),((e,t)=>e.y*t+e.x)(a,r)},Ts=(e,t,i)=>((e,t)=>{const i=[],n=Math.floor(1.5);for(let s=0;s<3;s+=1)for(let r=0;r<3;r+=1){const o={x:r-n,y:s-n};i.push(vs(e,o,t))}return i})(e,i).map((e=>((e,t)=>ys((e=>4*e)(e),t))(e,t))),bs=e=>{const t=String(e);return"0x"===t.slice(0,2)?`#${t.slice(2)}`:t},ws=(e,t,i="round")=>e&&t?gs(e/t,i):0;function Fs(e,t,i=1){return Object.fromEntries(Tt.map((n=>[n,Math.round(e[n]*i+t[n]*(1-i))])))}function Ss(e,t,i=1){return Object.fromEntries(vt.map((n=>[n,Math.round(e[n]*(1-i)+t[n]*i)])))}const Is=(e,t,i,n,s=0,r=0,o=!1)=>{const a=_t(i);let c=e.length/4;for(;c--;){const i=4*c,l=ys(i,e);if(f(l.a)){const u=_t(l),h=Fs(l,n,o?Mt(Cs(e,c,t),a,s,r):Rt(u,a,s,r));e[i+3]=h.a,h.a&&(e[i]=h.r,e[i+1]=h.g,e[i+2]=h.b)}}},Cs=(e,t,i)=>Ts(4*t,e,i).map((e=>_t(e))),xs=(e,t,i,n=!1,s=!1)=>{g(i),g(t);const r=n?t:0;return(e-t+r+(s?t:0))*i-r},Ds=(e,t,i,n)=>e+(t-e)/n*i,Ps=(e,t,i,n)=>{o(e),o(t);const s=i/n;if(V(Gt(e),"hex color"),7===e.length||4===e.length){return Ot(Ss(Zt(e),Zt(t),s))}return kt(Fs(Qt(e),Qt(t),s))},As=(e,t,i,n)=>({x:Ds(e.x,t.x,i,n),y:Ds(e.y,t.y,i,n),width:Ds(e.width,t.width,i,n),height:Ds(e.height,t.height,i,n)}),Vs=(e,t)=>{const{width:i,height:n}=e;return!Di(t)||Ai(e,t)?{width:i,height:n}:{width:Math.max(i,t.width),height:Math.max(n,t.height)}},Es=(e,t,i,n)=>{l(e);const s=n?Math.round(e):e;if(!p(t))return s;const r=n?Math.round(t):t;return s===r?s:(i.includes("n"),`(${s}+(${r-s}*${i}))`)},zs=(e,t,i="n")=>`(${i}/${e*t})`,Os=e=>{if(!n(e))return{};const t=Object.entries(e).filter((([e,t])=>p(t)));return Object.fromEntries(t)},ks=(e,t)=>({...e,...Os(t)}),Rs=(e,t)=>({...e,...Os(t)}),Ms=(e,t)=>h(t)?{...e,...Os(t)}:e,_s=(e,t,i={})=>{Pi(e),Hi(t);const{width:n,height:s}=e,{x:r,y:o,width:a,height:c}=t;g(r),g(o),g(a),g(c);const l=Ri(e,a,c),u=ki(l);return{...u,x:Math.round(xs(n,u.width,r,i.E,i.W)),y:Math.round(xs(s,u.height,o,i.N,i.S))}},$s=(e,t,i)=>{const n=b(t)?t:[t,t],[s,r]=n,o=Mi(e,s),a=Mi(e,r),[c,l]=i,{width:u,height:h}=c,{width:d,height:p}=l,m=Ri(o,u,h),f=Ri(a,d,p);return[ki(m),ki(f)]},Ns=(e,t,i)=>{const n=b(t)?t:[t,t],[s,r]=e,[o,a]=n,[c,l]=i,{x:u,y:h}=c,{x:d,y:p}=l;return[{x:u*(s.width-o.width),y:h*(s.height-o.height)},{x:d*(r.width-a.width),y:p*(r.height-a.height)}]},js=(e,t)=>({...e,...Gi(e,t)}),Ls=(e,t)=>e.map((e=>js(e,t))),qs=(t,i,n,s)=>{if(!s)return t;const{width:r,height:o}=i,a={...t};switch(s){case e.Orientation.H:a.width=o*a.height*n/r;break;case e.Orientation.V:a.height=r*a.width/n/o}return a},Gs=e=>{pi(e);const{clip:t}=e,{track:i}=t,{mash:n}=i,{quantize:s}=n,r=t.timeRange(s),o=e.tweenPoints(r,r);return!Fi(...o)},Bs=(e,t,i)=>Math.min(i,Math.max(t,e));class Us extends ps{constructor(...t){super(...t),this.properties.push(cn({tweenable:!0,custom:!0,name:"color",type:e.DataType.String})),this.populateParametersFromProperties()}_ffmpegFilter="geq";commandFilters(e){const t=[],{filter:i,videoRate:n,duration:s,filterInput:r}=e;l(s,"duration"),l(n,"videoRate");const o=i.value("color");I(o,"color");let a=r;I(a,"filterInput");const c="format",u=yn(c),h={inputs:[a],ffmpegFilter:c,options:{pix_fmts:"rgba"},outputs:[u]};t.push(h),a=u;const d=i.value(`color${ci}`)||o;I(d);const p=o.length>7,m=p?Qt(o):Zt(o),f=p?Qt(d):Zt(d),g=p?Tt:vt,y={},v=s?zs(n,s,"N"):0;g.forEach((e=>{const t=m[e],i=f[e];y[e]=t===i?t:`${t}+(${i-t}*${v})`})),p||(y.a="alpha(X,Y)");const T=yn("geq"),b={inputs:[a],ffmpegFilter:"geq",options:y,outputs:[T]};return t.push(b),t}}class Ws extends Us{constructor(...t){super(...t),this.properties.push(cn({tweenable:!0,name:"color",type:e.DataType.String}));["width","height"].forEach((t=>{this.properties.push(cn({tweenable:!0,name:t,type:e.DataType.Number}))})),this.populateParametersFromProperties()}commandFilters(e){const t=[],{filter:i,videoRate:n,duration:s}=e;T(n,"videoRate");const{ffmpegFilter:r}=this;let o=yn(r);const a=i.value("color");I(a);const c=s?i.value(`color${ci}`):void 0,u=S(c)&&a!==c,h=i.scalarObject(!!s);Pi(h);const{width:d,height:p}=h;let m=!1;const f={width:d,height:p},g={width:d,height:p};if(s){const{[`width${ci}`]:e=d,[`height${ci}`]:t=p}=h;l(e),l(t),m=!(d===e&&p===t),m&&(g.width=e,g.height=t)}const y=m?Vs(f,g):f,b={inputs:[],ffmpegFilter:r,options:{color:a,rate:n,size:Object.values(y).join("x")},outputs:[o]};if(v(s)&&(b.options.duration=s),t.push(b),u){const e="fade",i=yn(e),n={inputs:[o],ffmpegFilter:e,options:{type:"out",color:c,duration:s},outputs:[i]};t.push(n),o=i}if(m){const e="scale",i=yn(e),r=zs(n,s),a={inputs:[o],ffmpegFilter:e,options:{eval:"frame",width:Es(f.width,g.width,r),height:Es(f.height,g.height,r)},outputs:[i]};t.push(a)}return t}_ffmpegFilter="color";filterDefinitionSvg(e){const{filter:t}=e,i=t.scalarObject(!1),{width:n,height:s,color:r}=i;I(r);const o=globalThis.document.createElementNS(ht,"rect");return o.setAttribute("width",String(n)),o.setAttribute("height",String(s)),o.setAttribute("fill",bs(r)),o}}const Hs=Tt.flatMap((e=>Tt.map((t=>`${e}${t}`))));class Js extends ps{constructor(...t){super(...t),Hs.forEach((t=>{this.properties.push(cn({custom:!0,name:t,type:e.DataType.Number,defaultValue:t[0]===t[1]?1:0,min:0,max:1}))})),this.populateParametersFromProperties()}filterDefinitionSvgFilter(e){const t={filter:"feColorMatrix",type:"matrix",values:Tt.flatMap((t=>[...Tt.map((i=>Number(e[`${t}${i}`]))),0])).join(" ")};return[zn(t)]}}var Ks;e.ActivityType=void 0,(Ks=e.ActivityType||(e.ActivityType={})).Analyze="analyze",Ks.Complete="complete",Ks.Error="error",Ks.Load="load",Ks.Render="render";const Ys=(e,t)=>{const i=e.filter((e=>e.input)),n=i.findIndex((e=>e.inputId===t));return f(n)||console.log("commandFilesInputIndex",t,i),g(n,"commandFilesInputIndex"),n},Xs=(e,t,i)=>[Ys(e,t),i?"v":"a"].join(":"),Zs=e=>{e.preventDefault(),e.stopPropagation()},Qs=e=>n(e)&&"changeHandler"in e,er=(e,t)=>e.frame-t.frame,tr=(e,t)=>e.index-t.index,ir=(e,t)=>e.trackNumber-t.trackNumber,nr=(e,t,i)=>{if(!S(e)||!v(i))return Ki;const{document:n}=globalThis,r=n.createElement("canvas").getContext("2d");s(r),r.font=`${i}px ${t}`;const o=r.measureText(e),{actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:l,actualBoundingBoxRight:u,width:h}=o;return{x:l,y:a,width:l+u,height:a+c}};class sr extends ps{constructor(...e){super(...e),this.properties.push(cn({custom:!0,name:"bias",defaultValue:0,min:0,max:100,step:.01})),this.properties.push(cn({custom:!0,name:"matrix",defaultValue:"0 0 0 0 1 0 0 0 0"})),this.properties.push(cn({custom:!0,name:"multiplier",defaultValue:1,min:0,max:100,step:.01})),this.populateParametersFromProperties()}commandFilters(e){const{filterInput:t,filter:i,duration:n}=e;I(t,"filterInput");const s=[],r=i.scalarObject(!!n);or(r);const{ffmpegFilter:o}=this,a={inputs:[t],ffmpegFilter:o,options:pr(dr(r)),outputs:[yn(o)]};return s.push(a),s}filterDefinitionSvgFilter(e){or(e);const{matrix:t,bias:i,multiplier:n}=e,s={filter:"feConvolveMatrix",kernelMatrix:String(t),bias:String(i)};return v(n)&&(s.divisor=String(n)),[zn(s)]}}const rr=e=>n(e)&&"matrix"in e&&"bias"in e&&"multiplier"in e;function or(e){if(!rr(e))throw new Error("expected ConvolutionServerFilter")}const ar=e=>({combined:e,r:e,g:e,b:e,a:e}),cr=e=>(e=>({combined:e,r:e,g:e,b:e,a:e}))(String(e)),lr=e=>{const{combined:t}=e;return(e=>({combined:e,r:e,g:e,b:e,a:e}))((String(t)||"0 0 0 0 1 0 0 0 0").split(",").map((e=>parseInt(e.trim()))))},ur=e=>{const{combined:t}=e;return ar((i=String(t))?.length?parseFloat(i.trim()):0);var i},hr=e=>{const{combined:t}=e;return ar((e=>{if(!e?.length)return 1;if(e.includes("/")){const t=e.split("/").map((e=>parseFloat(e.trim()))),[i,n]=t;return i/n}return parseFloat(e.trim())})(String(t)))},dr=e=>{const t=cr(e.matrix),i=cr(e.multiplier),n=lr(t);return{multiplier:hr(i),matrix:n,bias:t.combined?ar(0):ur(cr(e.bias))}},pr=e=>{const t={};return Tt.map((e=>e)).forEach(((i,n)=>{const s=e.multiplier[i],r=e.matrix[i];t[`${n}m`]=r.join(" "),t[`${n}rdiv`]=s,t[`${n}bias`]=e.bias[i]})),t};class mr extends ps{constructor(...t){super(...t),this.properties.push(cn({custom:!0,name:"width",type:e.DataType.String})),this.properties.push(cn({custom:!0,name:"height",type:e.DataType.String})),this.properties.push(cn({tweenable:!0,custom:!0,name:"x",type:e.DataType.Number,defaultValue:0,min:0,step:1})),this.properties.push(cn({tweenable:!0,custom:!0,name:"y",type:e.DataType.Number,defaultValue:0,min:0,step:1})),this.populateParametersFromProperties()}commandFilters(e){const{filter:t,filterInput:i,duration:n,videoRate:s}=e;I(i);const r=[],o=t.scalarObject(!!n),a={exact:1},c=zs(s,n);a.x=Es(o.x,o[`x${ci}`],c,!0),a.y=Es(o.y,o[`y${ci}`],c,!0);const{width:l,height:u}=o;_(l)&&(a.w=l),_(u)&&(a.h=u);const{ffmpegFilter:h}=this,d={inputs:[i],ffmpegFilter:h,options:a,outputs:[yn(h)]};return r.push(d),r}}class fr extends ps{constructor(...t){super(...t),this.properties.push(cn({tweenable:!0,custom:!0,name:"x",type:e.DataType.Percent,defaultValue:.5})),this.properties.push(cn({tweenable:!0,custom:!0,name:"y",type:e.DataType.Percent,defaultValue:.5})),this.properties.push(cn({custom:!0,name:"format",type:e.DataType.String,defaultValue:"yuv420"})),this.properties.push(cn({custom:!0,name:"alpha",type:e.DataType.String,defaultValue:"straight"})),this.populateParametersFromProperties()}commandFilters(e){const t=[],{filter:i,filterInput:n,chainInput:s,duration:r,videoRate:o}=e;I(n,"filterInput"),I(s,"chainInput");const a=i.scalarObject(!!r),c={},{format:l,alpha:u}=a;S(l)&&(c.format=l),S(u)&&(c.alpha=u);const h=zs(o,r,"(n-1)"),d=Es(a.x,a[`x${ci}`],h,!0),p=Es(a.y,a[`y${ci}`],h,!0),m=0===p;0===d||(c.x=d),m||(c.y=p);const f={inputs:[s,n],ffmpegFilter:"overlay",options:c,outputs:[]};return t.push(f),t}}class gr extends ps{constructor(...t){super(...t),this.properties.push(cn({name:"width",type:e.DataType.Percent,defaultValue:1,max:2})),this.properties.push(cn({name:"height",type:e.DataType.Percent,defaultValue:1,max:2})),this.properties.push(cn({name:`width${ci}`,type:e.DataType.Percent,defaultValue:1,max:2})),this.properties.push(cn({name:`height${ci}`,type:e.DataType.Percent,defaultValue:1,max:2})),this.populateParametersFromProperties()}commandFilters(e){const t=[],{filter:i,duration:n,filterInput:s,videoRate:r}=e,o=i.scalarObject(!!n),{width:a,height:c,[`width${ci}`]:l,[`height${ci}`]:u}=o;I(s);const{ffmpegFilter:h}=this,d=zs(r,n),m={width:Es(a,l,d,!0),height:Es(c,u,d,!0)};p(m.width)&&p(m.height)||(m.eval="frame");const f={inputs:[s],ffmpegFilter:h,options:m,outputs:[yn(h)]};return t.push(f),t}}class yr extends ps{constructor(...t){super(...t),this.properties.push(cn({tweenable:!0,custom:!0,name:"opacity",type:e.DataType.Number,defaultValue:1})),this.populateParametersFromProperties()}commandFilters(e){const t=[],{filterInput:i,filter:n,duration:s,videoRate:r}=e,o=n.value("opacity");let a=i;l(o),I(a,"filterInput");const c={lum:"lum(X,Y)",cb:"cb(X,Y)",cr:"cr(X,Y)",a:`alpha(X,Y)*${o}`};if(s){const e=n.value(`opacity${ci}`);if(p(e)&&o!=e){const t=zs(r,s,"N"),i=e-o;c.a=`alpha(X,Y)*(${o}+(${i}*${t}))`}}const{ffmpegFilter:u}=this,h={inputs:[a],ffmpegFilter:u,options:c,outputs:[yn(u)]};return t.push(h),t}_ffmpegFilter="geq";filterDefinitionSvgFilter(e){const{opacity:t}=e;l(t);const i=globalThis.document.createElementNS(ht,"feColorMatrix");i.setAttribute("type","matrix");return _n(i,`1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 ${t} 0`,"values"),[i]}}class vr extends ps{constructor(...t){super(...t),this.properties.push(cn({custom:!0,name:"sar",type:e.DataType.String,defaultValue:"0"})),this.properties.push(cn({custom:!0,name:"max",type:e.DataType.Number,defaultValue:100})),this.populateParametersFromProperties()}}class Tr extends ps{constructor(...t){super(...t),this.properties.push(cn({custom:!0,name:"fps",type:e.DataType.Number})),this.populateParametersFromProperties()}}class br extends ps{constructor(...t){super(...t),this.properties.push(cn({custom:!0,name:"expr",type:e.DataType.String,defaultValue:"PTS-STARTPTS"})),this.populateParametersFromProperties()}}class wr extends ps{commandFilters(e){const t=[],{chainInput:i,filterInput:n}=e;I(i,"chainInput"),I(n,"filterInput");const{ffmpegFilter:s}=this,r={inputs:[i,n],ffmpegFilter:s,options:{},outputs:[yn(s)]};return t.push(r),t}}class Fr extends ps{constructor(...t){super(...t),this.properties.push(cn({custom:!0,name:"start",type:e.DataType.Number,defaultValue:0})),this.populateParametersFromProperties()}}class Sr extends Us{constructor(...t){super(...t),this.properties.push(cn({custom:!0,type:e.DataType.String,name:"fontfile"})),this.properties.push(cn({custom:!0,type:e.DataType.String,name:"textfile"})),this.properties.push(cn({custom:!0,type:e.DataType.Boolean,name:"stretch"})),this.properties.push(cn({tweenable:!0,custom:!0,type:e.DataType.Number,name:"height"})),this.properties.push(cn({tweenable:!0,custom:!0,type:e.DataType.Number,name:"width"})),this.properties.push(cn({custom:!0,type:e.DataType.Number,name:"intrinsicHeight"})),this.properties.push(cn({custom:!0,type:e.DataType.Number,name:"intrinsicWidth"})),this.properties.push(cn({tweenable:!0,custom:!0,type:e.DataType.Number,name:"x"})),this.properties.push(cn({tweenable:!0,custom:!0,type:e.DataType.Number,name:"y"})),this.properties.push(cn({tweenable:!0,custom:!0,type:e.DataType.String,name:"color"})),this.populateParametersFromProperties()}commandFilters(e){const t=[],{filter:i,duration:n,videoRate:s,filterInput:r}=e,o=i.value("color"),a=i.value("x"),c=i.value("y"),u=i.value("textfile"),h=i.value("fontfile"),d=i.value("height"),m=i.value("width"),f=!!i.value("stretch"),g=i.value("intrinsicWidth"),y=i.value("intrinsicHeight");I(u),I(h),l(d),l(m),l(g),l(y),l(a),l(c),I(o,"color");const T=i.value(`x${ci}`),b=i.value(`y${ci}`),w=n?i.value(`color${ci}`):void 0,F=S(w)&&o!==w,{ffmpegFilter:C}=this,x=yn(C),D=F||r?Ft:o;let P=wt;r||(P=F?It:St);const A={width:m,height:d},V={...A};if(n){const e=i.value(`height${ci}`)||0,t=i.value(`width${ci}`)||0;v(t)&&(V.width=t),v(e)&&(V.height=e)}const E=g/y,z=Vs(A,V),O=Math.round(E*z.height);O>z.width&&(z.width=O);let k=f||!Ai(A,V);const R={},M={fontsize:z.height,fontfile:h,textfile:u,x:Math.ceil(p(T)?Math.max(a,T):a),y:Math.ceil(p(b)?Math.max(c,b):c)},_=zs(s,n);if(F){const e=o.length>7,t=e?Qt(o):Zt(o),i=e?Qt(w):Zt(w),n=(e?Tt:vt).map((e=>{const n=t[e],s=i[e];return n===s?n:`${n}+(${s-n}*${_})`})).map((e=>["eif",e,"x",2].join(":"))).map((e=>`%{${e}}`));M.fontcolor_expr=`#${n.join("")}`}else M.fontcolor=D;const $=this.colorCommandFilter(z,s,n,P);t.push($);let N=Zi($.outputs);k&&(R.width=f?Es(m,V.width,_,!0):-1,R.height=Es(d,V.height,_,!0),p(R.width)&&p(R.height)||(R.eval="frame"));const j={inputs:[N],ffmpegFilter:C,options:M,outputs:[x]};if(t.push(j),N=x,!r){const e="format",i=yn(e),n={inputs:[N],ffmpegFilter:e,options:{pix_fmts:"yuva420p"},outputs:[i]};t.push(n),N=i}if(k){const e="scale",i=yn(e),n={inputs:[N],ffmpegFilter:e,options:R,outputs:[i]};t.push(n),N=i}return t}_ffmpegFilter="drawtext"}const Ir=`${dt}filter.`,Cr=[new wr({id:`${Ir}alphamerge`}),new ms({id:`${Ir}chromakey`}),new Js({id:`${Ir}colorchannelmixer`}),new Ws({id:`${Ir}color`}),new Us({id:`${Ir}colorize`}),new sr({id:`${Ir}convolution`}),new mr({id:`${Ir}crop`}),new Tr({id:`${Ir}fps`}),new yr({id:`${Ir}opacity`}),new fr({id:`${Ir}overlay`}),new gr({id:`${Ir}scale`}),new br({id:`${Ir}setpts`}),new vr({id:`${Ir}setsar`}),new Fr({id:`${Ir}trim`}),new Sr({id:`${Ir}text`})],xr=e=>{const{id:t}=e;return I(t),new ps(e)},Dr=e=>{const t=e.includes(".")?e:`${Ir}${e}`,i=Cr.find((e=>e.id===t));return i||xr({id:t})},Pr=e=>{const{id:t}=e;if(!t)throw dn.invalid.definition.id;return Dr(t).instanceFromObject(e)},Ar=e=>Dr(e).instanceFromObject({id:e});ct[e.DefinitionType.Filter]={definition:xr,definitionFromId:Dr,fromId:Ar,instance:Pr,defaults:Cr};const Vr=`${dt}content.default`,Er=e=>di(e)&&De(e.type);function zr(e,t){Er(e)||i(e,"Content",t)}const Or=e=>mi(e)&&De(e.type),kr=e=>Or(e)&&"loadType"in e;function Rr(e){if(!kr(e))throw new Error("expected PreloadableDefinition")}const Mr=e=>Er(e)&&kr(e.definition);const _r=[e.DefinitionType.Image,e.DefinitionType.Video,e.DefinitionType.VideoSequence],$r=e=>Mr(e);const Nr=e=>kr(e);function jr(t){return class extends t{constructor(...t){super(...t);const[i]=t,{container:n}=this;n&&(this.addProperties(i,cn({name:"x",type:e.DataType.Percent,defaultValue:.5,group:e.DataGroup.Point,tweenable:!0})),this.addProperties(i,cn({name:"y",type:e.DataType.Percent,defaultValue:.5,group:e.DataGroup.Point,tweenable:!0})),Me.forEach((t=>{this.addProperties(i,cn({name:`off${t}`,type:e.DataType.Boolean,group:e.DataGroup.Point}))})),this.addProperties(i,cn({tweenable:!0,name:"opacity",type:e.DataType.Percent,defaultValue:1,group:e.DataGroup.Opacity})))}_colorizeFilter;get colorizeFilter(){return this._colorizeFilter||=Ar("colorize")}colorizeCommandFilters(e){const{contentColors:t,videoRate:i,filterInput:n,time:s}=e;x(t);const r=k(s)?s.lengthSeconds:0,{colorizeFilter:o}=this,a={videoRate:i,duration:r,filterInput:n},[c,l]=t;return o.setValue(c,"color"),o.setValue(l,`color${ci}`),o.commandFilters(a)}colorMaximize=!1;containedVideo(e,t,i,n,s){const r=Math.round(Number(e.getAttribute("x"))),o=Math.round(Number(e.getAttribute("y"))),a=Ii(t);a.x-=r,a.y-=o;const c={...a,...qi(t)},l=$r(this),u=[],{div:h}=this,d=[];if(d.push(`left: ${r}px`),d.push(`top: ${o}px`),l){const e=this.intrinsicGraphFile({size:!0,editing:!0}),{preloader:t}=this.clip.track.mash,i=t.sourceUrl(e);d.push(`mask-image: url(${i})`),d.push("mask-repeat: no-repeat"),d.push("mask-mode: luminance"),d.push(`mask-size: ${c.width}px ${c.height}px`),d.push(`mask-position: ${c.x}px ${c.y}px`)}else{const e=this.pathElement(c);e.setAttribute("fill",Ft);let t=fn();const n=globalThis.document.createElementNS(ht,"clipPath");_n(n,t),On(n,e);const s=Dn(i);Gn(s,[kn([n])]),d.push(`clip-path:${wn(t)}`),u.push(s)}return h.setAttribute("style",d.join(";")+";"),Gn(h,[e]),u.push(h),Promise.resolve(u)}containedContent(e,t,i,n,r,o){const a=$r(this),c=$r(e),l=e.contentPreviewItemPromise(t,n,r,o).then((l=>{if(s(l),Bn(l))return V(!o,"not icon"),this.containedVideo(l,t,i,n,r);return this.containerPreviewItemPromise(t,n,r,o).then((s=>{const u=[];u.push(s);let h=fn();if(a&&!o){const e=Cn(t,"","transparent",h);e.setAttribute("vector-effect","non-scaling-stroke;"),u.push(e),h=fn()}s.setAttribute("id",h);const d=Fn();On(d,[Cn(t,"","transparent"),l]);const p=[d];$n(d,"contained");const m=En(void 0,d,!0);u.push(m);const f=Nn(h);m.appendChild(Cn(i,"","black")),m.appendChild(f),a||(s.setAttribute("vector-effect","non-scaling-stroke;"),f.setAttribute("fill",Ft));const g=this.containerSvgFilter(s,i,t,n,r);g?u.push(g):s.removeAttribute("filter");const y=e.contentSvgFilter(l,i,t,n,r);y?u.push(y):l.removeAttribute("filter");const v=(c||a)&&!o?this.svgElement:Dn();return Gn(v,[kn(u),...p]),Sn(v,i),[v]}))}));return l}containerColorCommandFilters(e){const t=[],{contentColors:i,containerRects:n,track:s}=e,{colorMaximize:r}=this;if(!r)return super.containerColorCommandFilters(e);x(i);const o=!Ji(...n)?Vs(...n):n[0],a={...e,outputSize:o};return t.push(...this.colorBackCommandFilters(a,`content-${s}`)),t}containerCommandFilters(e,t){const i=[],{contentColors:n,filterInput:s}=e;let r=s;return I(r,"filterInput"),n?.length||(i.push(...this.alphamergeCommandFilters({...e,filterInput:r})),r=Zi(Zi(i).outputs)),i.push(...this.containerFinalCommandFilters({...e,filterInput:r})),i}containerFinalCommandFilters(e){const t=[],{filterInput:i}=e;let n=i;I(n,"filterInput");const s=this.opacityCommandFilters(e);return s.length&&(t.push(...s),n=Zi(Zi(s).outputs)),t.push(...this.translateCommandFilters({...e,filterInput:n})),t}containerRects(e,t){const{size:i,time:n,timeRange:s}=e,{lock:r}=this,o=this.tweenRects(n,s),a=Ls(o,r),{width:c,height:l}=t,u=(c||i.width)/(l||i.height),[h,d]=a,p=qs(h,i,u,r),{directionObject:m}=this,f=_s(i,p,m);if(!!Ji(h,d))return[f,f];const g=qs(d,i,u,r),y=ks(p,g);return[f,_s(i,y,m)]}containerPreviewItemPromise(e,t,i,n){return Promise.resolve(this.pathElement(e))}containerSvgFilter(e,t,i,n,s){const[r]=this.tweenValues("opacity",n,s);if(!y(r))return;const{opacityFilter:o}=this;return o.setValue(r,"opacity"),Mn(o.filterSvgFilter(),e)}get directions(){return je}get directionObject(){return Object.fromEntries(Me.map((e=>[e,!!this.value(`off${e}`)])))}_div;get div(){return this._div||=globalThis.document.createElement("div")}get isDefault(){return this.definitionId===fi}opacityCommandFilters(e){const{outputSize:t,filterInput:i,clipTime:n,time:s,videoRate:r}=e;R(n);const o=[],a={dimensions:t,filterInput:i,videoRate:r,duration:k(s)?s.lengthSeconds:0},[c,l]=this.tweenValues("opacity",s,n);if(y(c)||h(l)&&y(l)){const{opacityFilter:e}=this;e.setValues({opacity:c,opacityEnd:l}),o.push(...e.commandFilters(a))}return o}_opacityFilter;get opacityFilter(){return this._opacityFilter||=Ar("opacity")}pathElement(e,t="none"){return Cn(e,"",t)}_svgElement;get svgElement(){return this._svgElement||=Dn()}translateCommandFilters(e){const t=[],{outputSize:i,time:n,containerRects:s,chainInput:r,filterInput:o,videoRate:a}=e;if(!r)return t;x(s);const[c,l]=s,u=k(n)?n.lengthSeconds:0,{overlayFilter:h}=this;h.setValue(c.x,"x"),h.setValue(c.y,"y"),u&&(h.setValue(l.x,`x${ci}`),h.setValue(l.y,`y${ci}`));const d={dimensions:i,filterInput:o,videoRate:a,duration:u,chainInput:r};return t.push(...h.commandFilters(d)),t}}}function Lr(t){return class extends t{constructor(...t){super(...t),this.properties.push(cn({name:"lock",type:e.DataType.String,defaultValue:e.Orientation.H,group:e.DataGroup.Size}))}type=e.DefinitionType.Container}}const qr=(e,t,i="")=>{if(e.fps===t.fps)return[e,t];const n=(s=e.fps,r=t.fps,s*r/((e,t)=>{let i=e,n=t,s=0;for(;0!==n;)s=n,n=i%n,i=s;return i})(s,r));var s,r;return[e.scale(n,i),t.scale(n,i)]};class Gr{constructor(e=0,t=1){if(!m(e)||e<0)throw dn.frame+e;if(!m(t)||t<1)throw dn.fps;this.frame=e,this.fps=t}add(e){const[t,i]=qr(this,e);return new Gr(t.frame+i.frame,t.fps)}addFrame(e){const t=this.copy;return t.frame+=e,t}closest(e){const t=e.frame+Math.round(e.frames/2),i=new Gr(t,e.fps),[n,s]=qr(i,this);return n.frame<s.frame?e.lastTime:e.startTime}get copy(){return new Gr(this.frame,this.fps)}get description(){return`${this.frame}@${this.fps}`}divide(e,t=""){return T(e),1===e?this:this.withFrame(gs(this.frame/e,t))}equalsTime(e){const[t,i]=qr(this,e);return t.frame===i.frame}fps;frame;durationFrames(e,t=0){const i=t||this.fps,n=[],s=Math.floor(i*e)-2,r=Math.min(s,this.scale(i,"floor").frame);if(this.isRange){const e=this.timeRange.endTime.scale(i,"ceil").frame,t=Math.min(s+1,e);for(let e=r;e<t;e+=1)n.push(e)}else n.push(r);return n}isRange=!1;get lengthSeconds(){return 0}min(e){const[t,i]=qr(this,e);return new Gr(Math.min(t.frame,i.frame),t.fps)}scale(e,t=""){if(this.fps===e)return this;const i=Number(this.frame)/Number(this.fps)*Number(e);return new Gr(gs(i,t),e)}scaleToFps(e){return this.scaleToTime(new Gr(0,e))}scaleToTime(e){return qr(this,e)[0]}get seconds(){return Number(this.frame)/Number(this.fps)}get startTime(){return this}subtract(e){const[t,i]=qr(this,e);let n=i.frame;return n>t.frame&&(n-=n-t.frame),new Gr(t.frame-n,t.fps)}subtractFrames(e){const t=this.copy;return t.frame-=e,t}get timeRange(){throw dn.timeRange}toString(){return`[${this.description}]`}withFrame(e){const t=this.copy;return t.frame=e,t}}class Br extends Gr{frames;constructor(e=0,t=1,i=1){if(super(e,t),!(m(i)&&i>=0))throw console.trace(this.constructor.name),dn.timeRange+" frames";this.frames=i}addFrames(e){const t=this.copy;return t.frames+=e,t}get copy(){return new Br(this.frame,this.fps,this.frames)}get description(){return`${this.frame}-${this.frames}@${this.fps}`}get end(){return this.frame+this.frames}get endTime(){return new Gr(this.end,this.fps)}equalsTimeRange(e){const[t,i]=qr(this,e);return t.frame===i.frame&&t.frames===i.frames}get frameTimes(){const{frames:e,frame:t,fps:i}=this;return Array.from({length:e},((e,n)=>new Gr(t,i)))}includes(e){return e>=this.frame&&e<=this.end}includesTime(e){const[t,i]=qr(this,e),n=t,{frame:s,end:r}=n,o=i.frame;return o>=s&&o<r}intersects(e){if(!e.isRange)return this.includesTime(e);const[t,i]=qr(e,this);return!(t.frame>=i.end)&&t.end>i.frame}isRange=!0;get last(){return this.frame+this.frames-1}get lastTime(){return new Gr(this.last,this.fps)}get lengthSeconds(){return Number(this.frames)/Number(this.fps)}get position(){return Number(this.frame)/Number(this.frames)}positionTime(e,t=""){const i=gs((this.frames-this.frame)*e,t);return new Gr(this.frame+i,this.fps)}get startTime(){return new Gr(this.frame,this.fps)}scale(e=1,t=""){if(this.fps===e)return this.copy;const i=Number(this.frames)/(Number(this.fps)/Number(e)),n=super.scale(e,t),s=Math.max(1,gs(i,t));return new Br(n.frame,n.fps,s)}get timeRange(){return this}get times(){const e=[this.startTime];return this.frames>1&&e.push(this.endTime),e}minEndTime(e){const[t,i]=qr(this,e);return t.frames=Math.min(t.frames,i.frame),t}withFrame(e){const t=this.copy;return t.frame=e,t}withFrames(e){const t=this.copy;return t.frames=e,t}}const Ur=(e=0,t=1,i=1)=>new Br(e,t,i),Wr=(e,t=1)=>Ur(e.frame,e.fps,t),Hr=(e,t)=>{if(!t)return Wr(e);const[i,n]=qr(e,t);if(n.frame<=i.frame)throw console.trace("fromTimes"),dn.argument+"fromTimes "+i+" "+n;const s=n.frame-i.frame;return Ur(i.frame,i.fps,s)},Jr=(e=0,t=1)=>new Gr(e,t),Kr=(e=0,t=1,i="")=>{if(!p(e)||e<0)throw dn.seconds;if(!m(t)||t<1)throw dn.fps;const n=gs(e*t,i);return Jr(n,t)},Yr={duration:3,label:"Unlabeled",editor:{buffer:10,fps:30,loop:!0,volume:.75,precision:3,autoplay:!1},cast:{label:"Cast",quantize:10,color:wt,gain:.75,buffer:10},mash:{label:"Mash",quantize:10,color:wt,gain:.75,buffer:10},definition:{image:{duration:2},textcontainer:{duration:3},shape:{duration:3},visible:{duration:3},video:{fps:0},videosequence:{pattern:"%.jpg",fps:10,increment:1,begin:1,padding:0},videostream:{duration:10}}};function Xr(t){return class extends t{constructor(...e){super(...e);const[t]=e,{container:i}=t;i&&(this.container=!0)}alphamergeCommandFilters(e){const t=[],{videoRate:i,outputSize:n,track:s,filterInput:r}=e;I(r),T(i),Pi(n);const o={videoRate:0,duration:0,filterInput:r,chainInput:`content-${s}`},{alphamergeFilter:a}=this;return t.push(...a.commandFilters(o)),t}_alphamergeFilter;get alphamergeFilter(){return this._alphamergeFilter||=Ar("alphamerge")}amixCommandFilters(e){const{chainInput:t,filterInput:i}=e;I(t),I(i);const n=[],s={inputs:[t,i],ffmpegFilter:"amix",options:{normalize:0},outputs:[]};return n.push(s),n}canColor(e){return!1}canColorTween(e){return!1}_clip;get clip(){return this._clip}set clip(e){this._clip=e}get clipped(){return!!this._clip}colorBackCommandFilters(e,t){const{contentColors:i=[],videoRate:n,outputSize:s,duration:r}=e;Pi(s);const o=zi(s),[a=Ct,c=Ct]=i,l=t||yn(At(a)||"back"),{colorFilter:u}=this,h={videoRate:n,duration:r};u.setValue(a,"color"),u.setValue(c,`color${ci}`),u.setValue(o.width,"width"),u.setValue(o.height,"height"),u.setValue(o.width,`width${ci}`),u.setValue(o.height,`height${ci}`);const d=u.commandFilters(h);if(Ai(o,s))Zi(d).outputs=[l];else{const e=Zi(Zi(d).outputs);I(e,"crop input");const t={inputs:[e],ffmpegFilter:"crop",options:{w:s.width,h:s.height,exact:1},outputs:[l]};d.push(t)}return d}_colorFilter;get colorFilter(){return this._colorFilter||=Ar("color")}commandFilters(e,t,i=!1){const n=[],{filterInput:s=""}=e;let r=s;const o=this.initialCommandFilters(e,t,i);return o.length&&(n.push(...o),r=Zi(Zi(o).outputs)),i?n.push(...this.containerCommandFilters({...e,filterInput:r},t)):n.push(...this.contentCommandFilters({...e,filterInput:r},t)),n}container=!1;containerColorCommandFilters(e){const t=[],{contentColors:i=[],containerRects:n,videoRate:s,duration:r}=e;w(n,"containerRects");const[o,a]=n,c={videoRate:s,duration:r},{colorFilter:l}=this,[u,h]=i;return l.setValue(u||Ft,"color"),l.setValue(h,`color${ci}`),l.setValue(o.width,"width"),l.setValue(o.height,"height"),l.setValue(a.width,`width${ci}`),l.setValue(a.height,`height${ci}`),t.push(...l.commandFilters(c)),t}containerCommandFilters(e,t){return[]}containerFinalCommandFilters(e){return[]}contentCommandFilters(e,t){return[]}copyCommandFilter(e,t,i="content"){return{inputs:[e],ffmpegFilter:"copy",options:{},outputs:[`${i}-${t}`]}}_cropFilter;get cropFilter(){return this._cropFilter||=Ar("crop")}definitionTime(e,t){const{fps:i}=t,n=e.scaleToFps(i),{startTime:s,endTime:r}=t,o=Math.max(Math.min(n.frame,r.frame),s.frame);return n.withFrame(o-s.frame)}frames(e){return Jr(Yr.duration,e).frame}fileCommandFiles(e){const t=[],i=this.fileUrls(e);let n=0;return t.push(...i.map(((e,t)=>{const{input:i}=e,s=t&&i?`${this.id}-${n}`:this.id,r={...e,inputId:s};return i&&n++,r}))),t}fileUrls(e){return[]}hasIntrinsicSizing=!1;hasIntrinsicTiming=!1;initialCommandFilters(e,t,i=!1){throw new Error(dn.unimplemented)}intrinsicRect(e=!1){throw new Error(dn.unimplemented)}intrinsicsKnown(e){return!0}intrinsicGraphFile(e){const{editing:t,size:i,duration:n}=e,r=Ur(),o={editing:t,time:r.startTime,clipTime:r,quantize:r.fps,visible:i,audible:n},[a]=this.fileUrls(o);return s(a),a}get isDefault(){return!1}mutable(){return!1}overlayCommandFilters(e,t,i){I(e,"bottomInput"),I(t,"topInput");const n=[],s={filterInput:t,chainInput:e,videoRate:0,duration:0},{overlayFilter:r}=this;i&&r.setValue("yuv420p10","format"),r.setValue(0,"x"),r.setValue(0,"y"),n.push(...r.commandFilters(s));return Zi(n).outputs=[yn(t)],n}_overlayFilter;get overlayFilter(){return this._overlayFilter||=Ar("overlay")}scaleCommandFilters(e){const{time:t,containerRects:i,filterInput:n,videoRate:s}=e;let r=n;I(r,"filterInput"),w(i,"containerRects");const[o,a]=i;Hi(o),Hi(a);const c=k(t)?t.lengthSeconds:0,l=[],{scaleFilter:u}=this,h={duration:c,videoRate:s,filterInput:r};return u.setValue(o.width,"width"),u.setValue(o.height,"height"),u.setValue(a.width,`width${ci}`),u.setValue(a.height,`height${ci}`),l.push(...u.commandFilters(h)),l}_scaleFilter;get scaleFilter(){return this._scaleFilter||=Ar("scale")}selectables(){return[this,...this.clip.selectables()]}selectType=e.SelectType.None;selectedItems(t){const i=[],{container:n,clip:s,selectType:r,definition:o}=this,{id:a}=o,{timing:c,sizing:l}=s,u=n?e.DataType.ContainerId:e.DataType.ContentId,h=s.properties.find((e=>e.type===u));an(h);const{name:d}=h,p={timing:c,sizing:l,[d]:a},m={...p},f=n?e.Timing.Container:e.Timing.Content,g=n?e.Sizing.Container:e.Sizing.Content,y=c===f,v=l===g;i.push({selectType:r,property:h,value:a,changeHandler:(i,r)=>{I(r);const o={...m,[d]:r};if(y||v){const t=yt.fromId(r),{type:i}=t;y&&!Se(i)&&(o.timing=e.Timing.Custom),v&&!we(i)&&(o.sizing=n?e.Sizing.Content:e.Sizing.Container)}const a={type:e.ActionType.ChangeMultiple,property:i,target:s,redoValues:o,undoValues:p};t.create(a)}});const{properties:T}=this,b=T.filter((e=>this.selectedProperty(e)));return b.forEach((e=>{i.push(...this.selectedProperties(t,e))})),i}selectedProperties(t,i){const n=[],{name:s,tweenable:r,type:o}=i,{selectType:a}=this,c=this.value(s),l=this,u=o===e.DataType.Frame?e.ActionType.ChangeFrame:e.ActionType.Change,h={selectType:a,property:i,value:c,changeHandler:(e,i)=>{I(e),t.create({type:u,property:e,target:l,redoValue:i,undoValue:c})}};if(n.push(h),r){const e=[s,ci].join(""),r=this,o=this.value(e),c={selectType:a,property:i,value:o,name:e,changeHandler:(e,i)=>{t.create({property:e,target:r,redoValue:i,undoValue:o})}};n.push(c)}return n}selectedProperty(e){const{name:t}=e;switch(t){case"muted":return this.mutable();case"opacity":return this.container}return!0}tween(e,t,i){const n=this.value(e),s=this.value(`${e}${ci}`);if(a(s))return n;const{frame:r,frames:o}=i,{frame:c}=t,u=c-r;return p(n)?(l(s),Ds(n,s,u,o)):(I(n),I(s),Ps(n,s,u,o))}tweenPoints(e,t){const[i,n]=this.tweenValues("x",e,t),[s,r]=this.tweenValues("y",e,t);l(i),l(s);const o={x:i,y:s};return[o,Rs(o,{x:n,y:r})]}tweenRects(e,t){const[i,n]=this.tweenSizes(e,t),[s,r]=this.tweenPoints(e,t);return[{...s,...i},{...r,...n}]}tweenSizes(e,t){const[i,n]=this.tweenValues("width",e,t),[s,r]=this.tweenValues("height",e,t);l(i),l(s);const o={width:i,height:s};return[o,Ms(o,{width:n,height:r})]}tweenValues(e,t,i){const n=[],s=k(t);return n.push(this.tween(e,s?t.startTime:t,i)),s&&n.push(this.tween(e,t.endTime,i)),n}visibleCommandFiles(e){const t={...e,audible:!1,visible:!0};return this.fileCommandFiles(t)}}}const Zr=jr(Xr(Tn));class Qr extends Zr{constructor(...t){super(...t);const[i]=t;this.addProperties(i,cn({tweenable:!0,name:"width",type:e.DataType.Percent,group:e.DataGroup.Size,defaultValue:1,max:2})),this.addProperties(i,cn({tweenable:!0,name:"height",type:e.DataType.Percent,group:e.DataGroup.Size,defaultValue:1,max:2}))}canColor(e){const{isDefault:t}=this;return!t&&!this.isTweeningColor(e)}containerColorCommandFilters(e){const t=[],{colorFilter:i,isDefault:n}=this,{contentColors:s,containerRects:r,videoRate:o,duration:a}=e;x(s,"contentColors");const[c,l]=r,[u,h]=s,d=n?c:Vs(...r),p={videoRate:o,duration:a};i.setValue(u||Ft,"color"),i.setValue(h,`color${ci}`),i.setValue(d.width,"width"),i.setValue(d.height,"height");const m=n;return i.setValue(m?l.width:void 0,`width${ci}`),i.setValue(m?l.height:void 0,`height${ci}`),t.push(...i.commandFilters(p)),t}containerCommandFilters(e,t){const i=[],{contentColors:n,commandFiles:s,filterInput:r}=e;let o=r;const a=C(n);if(this.requiresAlpha(e,!!t.size)){I(o,"container input");const{contentColors:n,...s}=e,r={...s,filterInput:o};i.push(...super.containerCommandFilters(r,t))}else if(this.isDefault||a){const{id:t}=this;o||=Xs(s,t,!0),I(o,"final input"),i.push(...this.containerFinalCommandFilters({...e,filterInput:o}))}return i}hasIntrinsicSizing=!0;initialCommandFilters(e,t,i=!1){const n=[],{contentColors:s,...r}=e,{commandFiles:o,upload:a,track:c,filterInput:l,containerRects:u,videoRate:h}=r;if(a)return n;let d=l;const p=this.requiresAlpha(e,!!t.size),{isDefault:m}=this,f=t.size?Vs(...u):u[0],g=zi(f),y=`content-${c}`,v=`container-${c}`;if(!t.canColor&&S(d)&&!m)if(p){const e="format",t=yn(e),i={inputs:[d],ffmpegFilter:e,options:{pix_fmts:"yuv420p"},outputs:[t]};n.push(i),d=t}else if(!Ai(g,f)){const t={...e,contentColors:[Ct,Ct],outputSize:g};n.push(...this.colorBackCommandFilters(t,`${y}-back`));const i=Zi(Zi(n).outputs);I(d,"overlay input"),n.push(...this.overlayCommandFilters(i,d)),d=Zi(Zi(n).outputs)}if(n.length?Zi(n).outputs=[y]:S(d)&&y!==d&&n.push(this.copyCommandFilter(d,c)),p){const{id:t}=this,i=Xs(o,t,!0);I(i,"scale input");const s={...e,contentColors:[Ct,Ct],outputSize:f};n.push(...this.colorBackCommandFilters(s,`${v}-back`));const r=Zi(Zi(n).outputs);n.push(...this.scaleCommandFilters({...e,filterInput:i})),d=Zi(Zi(n).outputs),I(d,"overlay input"),n.push(...this.overlayCommandFilters(r,d)),d=Zi(Zi(n).outputs);const a={duration:0,videoRate:h};I(d,"crop input");const{cropFilter:c}=this;c.setValue(f.width,"width"),c.setValue(f.height,"height"),c.setValue(0,"x"),c.setValue(0,"y"),n.push(...c.commandFilters({...a,filterInput:d})),d=Zi(Zi(n).outputs),I(d,"format input");const l={inputs:[d],ffmpegFilter:"format",options:{pix_fmts:p?"yuv420p":"yuva420p"},outputs:[v]};n.push(l)}return n}intrinsicRect(e=!1){const{pathHeight:t,pathWidth:i}=this.definition;return{width:i,height:t,...Si}}isTweeningColor(e){const{contentColors:t}=e;if(!C(t))return!1;let[i,n]=t;return i!==n}isTweeningSize(e){const{containerRects:t}=e;if(!C(t))return!1;return!Ji(...t)}pathElement(e,t=""){const{definition:i}=this,n=this.intrinsicRect(!0);if(!_i(n)){return Cn(e,"",t)}const{path:s}=i,r=Vn(s,"");return qn(r,n,e),r}requiresAlpha(e,t){const{contentColors:i}=e,n=C(i);return this.isDefault?!n&&(u(t)?t:this.isTweeningSize(e)):!n||this.isTweeningColor(e)}visibleCommandFiles(t){const{isDefault:i,id:n}=this,s=this.requiresAlpha(t),r=this.isTweeningColor(t);if(i&&!s)return[];const{definition:o}=this,{path:a}=o,{contentColors:c=[],containerRects:l,time:u,videoRate:h}=t;x(l,"containerRects");const d=k(u)?u.lengthSeconds:0,[p,m]=l,f={...Si,...Vs(p,m)},{width:g,height:y}=f;let[v]=c;s?v=Ft:r&&(v=wt);let T="none";i?T=Ft:s&&(T=wt);const b=i?f:this.intrinsicRect(),{width:w,height:F}=b,S=`width="${w}" height="${F}"`,I=Ln(b,f),C=[];C.push(`<svg viewBox="0 0 ${g} ${y}" xmlns="${ht}">`),C.push(`<g ${S} transform="${I}" >`),C.push(`<rect ${S} fill="${T}"/>`),i||C.push(`<path d="${a}" fill="${v}"/>`),C.push("</g>"),C.push("</svg>");const D=C.join(""),P={};d&&(P.loop=1,P.framerate=h,P.t=d);return[{type:e.GraphFileType.Svg,file:n,content:D,input:!0,inputId:n,definition:o,options:P}]}}function eo(t){return class extends t{constructor(...t){super(...t),this.properties.push(cn({name:"muted",type:e.DataType.Boolean}))}}}const to=Lr(eo(hs));class io extends to{constructor(...e){super(...e);const[t]=e,{path:i,pathHeight:n,pathWidth:s}=t;i&&(this.path=i),v(s)&&(this.pathWidth=s),v(n)&&(this.pathHeight=n)}definitionIcon(e,t){const i=super.definitionIcon(e,t);if(i)return i;const{id:n,pathHeight:s,pathWidth:r,path:o}=this;if(n===fi)return Promise.resolve(Dn(t,Cn(t,"","currentColor")));const a={width:r,height:s};if(!_i(a)||!S(o))return;const c=Mi(a,t,!0),l={...c,...Xi(t,c)},u=Vn(o);return qn(u,a,l),Promise.resolve(Dn(t,u))}instanceFromObject(e={}){return new Qr(this.instanceArgs(e))}path="";pathHeight=0;pathWidth=0;toJSON(){const e=super.toJSON();return this.path&&(e.path=this.path),v(this.pathHeight)&&(e.pathHeight=this.pathHeight),v(this.pathWidth)&&(e.pathWidth=this.pathWidth),e}}const no=e=>vi(e)&&"fontId"in e;const so=jr(Xr(Tn));class ro extends so{constructor(...e){const[t]=e;t.lock||="",super(...e);const{intrinsic:i}=t;Wi(i)&&(this._intrinsicRect=i)}canColor(e){return!0}canColorTween(e){return!0}_colorFilter;get colorFilter(){return this._colorFilter||=Ar("color")}definitionIds(){return[...super.definitionIds(),this.fontId]}_font;get font(){return this._font||=yt.fromId(this.fontId)}fileUrls(e){return this.font.fileUrls(e)}hasIntrinsicSizing=!0;initialCommandFilters(t,i){const n=[],{contentColors:s=[],outputSize:r,track:o,filterInput:a,containerRects:c,videoRate:l,commandFiles:u,duration:h}=t;let d=a;d&&n.push(this.copyCommandFilter(d,o));const[p,m]=c,{height:f,width:g}=p,y=Vs(...c);let v="";const T=!!d||i.size;if(T){const e=d?wt:It,i={...t,contentColors:[e,e],outputSize:y};n.push(...this.colorBackCommandFilters(i)),v=Zi(Zi(n).outputs)}const b=u.find((t=>t.inputId===this.id&&t.type===e.GraphFileType.Txt));V(b,"text file");const{resolved:w}=b;I(w,"textfile");const F=u.find((t=>t.inputId===this.id&&t.type===e.LoadType.Font));V(F,"font file");const{resolved:S}=F;I(S,"fontfile");const{textFilter:C,lock:x}=this,D=this.intrinsicRect(),P=D.x*(p.width/D.width),[A=Ft,E]=s;I(A);const z=D.x*(m.width/D.width),O=1e3/D.height,k=Math.round(f*O),R=Math.round(m.height*O),M={x:P,y:0,width:g,height:k,color:A,textfile:w,fontfile:S,stretch:!ke(x),intrinsicHeight:D.height,intrinsicWidth:D.width,[`x${ci}`]:z,[`y${ci}`]:0,[`color${ci}`]:E,[`height${ci}`]:R,[`width${ci}`]:m.width};C.setValues(M);const _={dimensions:r,videoRate:l,duration:h,filterInput:d};if(n.push(...C.commandFilters(_)),T){d=Zi(Zi(n).outputs),I(d,"overlay filterInput"),n.push(...this.overlayCommandFilters(v,d)),d=Zi(Zi(n).outputs),I(d,"crop filterInput");const e={duration:0,videoRate:l,filterInput:d},{cropFilter:t}=this;t.setValue(y.width,"width"),t.setValue(y.height,"height"),t.setValue(0,"x"),t.setValue(0,"y"),n.push(...t.commandFilters(e))}return n}_intrinsicRect;intrinsicRect(e=!1){return this._intrinsicRect||=this.intrinsicRectInitialize()}intrinsicRectInitialize(){const{family:e}=this.font;I(e);const t=this.string,i={width:0,height:1e3,...Si};if(!t)return i;return nr(t,e,1e3)}intrinsicsKnown(e){const{size:t}=e;return!t||(Wi(this._intrinsicRect)||!!this.font?.family)}pathElement(e){const{string:t,font:i}=this,{family:n}=i,s=globalThis.document.createElementNS(ht,"text");return s.setAttribute("font-family",n),s.setAttribute("font-size",String(1e3)),s.append(t),qn(s,this.intrinsicRect(!0),e),s}setValue(e,t,i){if(super.setValue(e,t,i),!i)switch(t){case"fontId":delete this._font,delete this._intrinsicRect;break;case"string":delete this._intrinsicRect}}_textFilter;get textFilter(){return this._textFilter||=Ar("text")}toJSON(){const e=super.toJSON();return e.intrinsic=this.intrinsicRect(!0),e}visibleCommandFiles(t){const i=super.visibleCommandFiles(t),{string:n}=this,s={definition:this.font,type:e.GraphFileType.Txt,file:this.id,content:n,inputId:this.id};return i.push(s),i}}class oo extends Tn{fileUrls(e){return this.definition.fileUrls(e)}}class ao extends hs{constructor(...e){super(...e);const[t]=e,{source:i,url:n}=t,s=i||n||"";this.source=i||s,this.url=n||s}family="";fileUrls(t){const{visible:i,editing:n}=t;if(!i)return[];const{url:s,source:r}=this,o=n?s:r;return[{type:e.LoadType.Font,file:o,definition:this}]}instanceFromObject(e={}){return new oo(this.instanceArgs(e))}loadType=e.LoadType.Font;toJSON(){const e=super.toJSON(),{url:t,source:i}=this;return e.url=t,e.source=i,e}source="";type=e.DefinitionType.Font;url=""}var co={label:"Butcherman",id:"com.moviemasher.font.butcherman",type:"font",source:"https://fonts.googleapis.com/css2?family=Butcherman"};var lo={label:"Croissant One",id:"com.moviemasher.font.croissant-one",type:"font",source:"https://fonts.googleapis.com/css2?family=Croissant+One"};var uo={label:"League Spartan",id:"com.moviemasher.font.default",type:"font",source:"https://fonts.googleapis.com/css2?family=League+Spartan"};var ho={label:"Germania One",id:"com.moviemasher.font.germania-one",type:"font",source:"https://fonts.googleapis.com/css2?family=Germania+One"};var po={label:"Kenia",id:"com.moviemasher.font.kenia",type:"font",source:"https://fonts.googleapis.com/css2?family=Kenia"};var mo={label:"Luckiest Guy",id:"com.moviemasher.font.luckiest-guy",type:"font",source:"https://fonts.googleapis.com/css2?family=Luckiest+Guy"};var fo={label:"Monoton",id:"com.moviemasher.font.monoton",type:"font",source:"https://fonts.googleapis.com/css2?family=Monoton"};var go={label:"Oleo Script",id:"com.moviemasher.font.oleo-script",type:"font",source:"https://fonts.googleapis.com/css2?family=Oleo+Script"};var yo={label:"Shojumaru",id:"com.moviemasher.font.shojumaru",type:"font",source:"https://fonts.googleapis.com/css2?family=Shojumaru"};var vo={label:"Rubik+Dirt",id:"com.moviemasher.font.rubik-dirt",type:"font",source:"https://fonts.googleapis.com/css2?family=Rubik+Dirt"};const To=uo.id,bo=t=>{const{id:i}=t,n=i&&S(i)?i:To;return new ao({...t,type:e.DefinitionType.Font,id:n})},wo=bo(uo),Fo=[wo,bo(co),bo(lo),bo(po),bo(ho),bo(mo),bo(fo),bo(go),bo(yo),bo(vo)],So=e=>{const t=Fo.find((t=>t.id===e));return t||bo({id:e})},Io=e=>{const{definitionId:t=""}=e;return So(t).instanceFromObject(e)},Co=e=>So(e).instanceFromObject();ct[e.DefinitionType.Font]={definition:bo,definitionFromId:So,fromId:Co,instance:Io,defaults:Fo};const xo=Lr(eo(hs));class Do extends xo{constructor(...t){super(...t),this.properties.push(cn({name:"string",custom:!0,type:e.DataType.String,defaultValue:"Text"})),this.properties.push(cn({name:"fontId",custom:!0,type:e.DataType.FontId,defaultValue:wo.id})),this.properties.push(cn({name:"height",tweenable:!0,custom:!0,type:e.DataType.Percent,defaultValue:.3,max:2,group:e.DataGroup.Size})),this.properties.push(cn({name:"width",tweenable:!0,custom:!0,type:e.DataType.Percent,defaultValue:.8,max:2,group:e.DataGroup.Size}))}definitionIcon(e,t){const i=super.definitionIcon(e,t);if(i)return i;const n={width:24,height:24},s=Mi(n,t,!0),r={...s,...Xi(t,s)},o=Vn("M2.5 4v3h5v12h3V7h5V4h-13zm19 5h-9v3h3v7h3v-7h3V9z");return qn(o,n,r),Promise.resolve(Dn(t,o))}instanceArgs(t){const i=t||{};return a(i.lock)&&(i.lock=e.Orientation.V),super.instanceArgs(i)}instanceFromObject(e={}){return new ro(this.instanceArgs(e))}}var Po={label:"Rectangle",type:"container"};var Ao={label:"Heart: Remix Icons",type:"container",id:"com.remixicon.container.heart",pathWidth:24,pathHeight:24,path:"M16.5 3C19.538 3 22 5.5 22 9c0 7-7.5 11-10 12.5C9.5 20 2 16 2 9c0-3.5 2.5-6 5.5-6C9.36 3 11 4 12 5c1-1 2.64-2 4.5-2z"};var Vo={label:"Cloud: Ant Design",id:"design.ant.container.cloud",pathWidth:1024,pathHeight:1024,path:"M811.4 418.7C765.6 297.9 648.9 212 512.2 212S258.8 297.8 213 418.6C127.3 441.1 64 519.1 64 612c0 110.5 89.5 200 199.9 200h496.2C870.5 812 960 722.5 960 612c0-92.7-63.1-170.7-148.6-193.3z"};var Eo={label:"Apple: Dev Icons",type:"container",id:"devicons.container.apple",pathWidth:32,pathHeight:32,path:"M23.023 17.093c-0.033-3.259 2.657-4.822 2.777-4.901-1.512-2.211-3.867-2.514-4.705-2.548-2.002-0.204-3.91 1.18-4.926 1.18-1.014 0-2.583-1.15-4.244-1.121-2.185 0.033-4.199 1.271-5.323 3.227-2.269 3.936-0.58 9.769 1.631 12.963 1.081 1.561 2.37 3.318 4.061 3.254 1.63-0.064 2.245-1.055 4.215-1.055s2.524 1.055 4.248 1.021c1.753-0.032 2.864-1.591 3.936-3.159 1.24-1.814 1.751-3.57 1.782-3.659-0.038-0.017-3.416-1.312-3.451-5.202zM19.783 7.53c0.897-1.089 1.504-2.602 1.34-4.108-1.294 0.053-2.861 0.86-3.79 1.948-0.832 0.965-1.561 2.502-1.365 3.981 1.444 0.112 2.916-0.734 3.816-1.821z"};var zo={label:"Starburst: Typicons",type:"container",id:"com.s-ings.container.starburst",pathWidth:24,pathHeight:24,path:"M19.064 10.109l1.179-2.387c.074-.149.068-.327-.015-.471-.083-.145-.234-.238-.401-.249l-2.656-.172-.172-2.656c-.011-.167-.104-.317-.249-.401-.145-.084-.322-.09-.472-.015l-2.385 1.18-1.477-2.215c-.186-.278-.646-.278-.832 0l-1.477 2.215-2.385-1.18c-.151-.075-.327-.069-.472.015-.145.083-.238.234-.249.401l-.171 2.656-2.657.171c-.167.011-.318.104-.401.249-.084.145-.089.322-.015.472l1.179 2.386-2.214 1.477c-.139.093-.223.249-.223.416s.083.323.223.416l2.215 1.477-1.18 2.386c-.074.15-.068.327.015.472.083.144.234.238.401.248l2.656.171.171 2.657c.011.167.104.317.249.401.144.083.32.088.472.015l2.386-1.179 1.477 2.214c.093.139.249.223.416.223s.323-.083.416-.223l1.477-2.214 2.386 1.179c.15.073.327.068.472-.015s.238-.234.249-.401l.171-2.656 2.656-.172c.167-.011.317-.104.401-.249.083-.145.089-.322.015-.472l-1.179-2.385 2.214-1.478c.139-.093.223-.249.223-.416s-.083-.323-.223-.416l-2.214-1.475z"};var Oo={label:"Rounded Rect",type:"container",id:"com.moviemasher.container.rounded-rect",pathWidth:1920,pathHeight:1080,path:"M 358.00 980.00 C 215.51 980.00 100.00 864.49 100.00 722.00 L 100.00 358.00 C 100.00 215.51 215.51 100.00 358.00 100.00 L 1562.00 100.00 C 1704.49 100.00 1820.00 215.51 1820.00 358.00 L 1820.00 722.00 C 1820.00 864.49 1704.49 980.00 1562.00 980.00 Z M 358.00 980.00"};var ko={label:"Fire: Ant Design",type:"container",id:"design.ant.container.fire",pathWidth:1024,pathHeight:1024,path:"M834.1 469.2A347.49 347.49 0 0 0 751.2 354l-29.1-26.7a8.09 8.09 0 0 0-13 3.3l-13 37.3c-8.1 23.4-23 47.3-44.1 70.8-1.4 1.5-3 1.9-4.1 2-1.1.1-2.8-.1-4.3-1.5-1.4-1.2-2.1-3-2-4.8 3.7-60.2-14.3-128.1-53.7-202C555.3 171 510 123.1 453.4 89.7l-41.3-24.3c-5.4-3.2-12.3 1-12 7.3l2.2 48c1.5 32.8-2.3 61.8-11.3 85.9-11 29.5-26.8 56.9-47 81.5a295.64 295.64 0 0 1-47.5 46.1 352.6 352.6 0 0 0-100.3 121.5A347.75 347.75 0 0 0 160 610c0 47.2 9.3 92.9 27.7 136a349.4 349.4 0 0 0 75.5 110.9c32.4 32 70 57.2 111.9 74.7C418.5 949.8 464.5 959 512 959s93.5-9.2 136.9-27.3A348.6 348.6 0 0 0 760.8 857c32.4-32 57.8-69.4 75.5-110.9a344.2 344.2 0 0 0 27.7-136c0-48.8-10-96.2-29.9-140.9z"};var Ro={label:"Flag: Ant Design",type:"container",id:"design.ant.container.flag",pathWidth:1024,pathHeight:1024,path:"M880 305H624V192c0-17.7-14.3-32-32-32H184v-40c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v784c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V640h248v113c0 17.7 14.3 32 32 32h416c17.7 0 32-14.3 32-32V337c0-17.7-14.3-32-32-32z"};var Mo={label:"Oval",type:"container",id:"com.moviemasher.container.oval",pathWidth:24,pathHeight:24,path:"M0,12 a12,12 0 1,0 24,0 a12,12 0 1,0 -24,0"};const _o=[new Do({label:"Text",type:"text",id:"com.moviemasher.container.text",fontId:"com.moviemasher.font.default"}),new io({id:fi,...Po}),new io(Oo),new io(Mo),new io(zo),new io(Ao),new io(Vo),new io(ko),new io(Ro),new io(Eo)],$o=t=>{const{id:i}=t;return I(i,"containerDefinition id"),new io({...t,type:e.DefinitionType.Container})},No=e=>{const t=_o.find((t=>t.id===e));return t||$o({id:e})},jo=e=>{const{definitionId:t}=e;if(!t)throw dn.id;return No(t).instanceFromObject(e)},Lo=e=>No(e).instanceFromObject({definitionId:e});function qo(t){return class extends t{type=e.DefinitionType.Content}}function Go(e){return class extends e{commandFilters(e){const t=[],{videoRate:i,filterInput:n,time:s}=e;I(n);const r=k(s)?s.lengthSeconds:0,{filters:o}=this.definition,a={videoRate:i,duration:r,filterInput:n};return t.push(...o.flatMap((e=>{this.setFilterValues(e);const t=e.commandFilters(a);return t.length&&(a.filterInput=Zi(Zi(t).outputs)),t}))),t}setFilterValues(e){const t=e.properties.map((e=>e.name));this.properties.map((e=>e.name)).filter((e=>t.includes(e))).forEach((t=>{const i=this.properties.find((e=>e.name===t));an(i);const{tweenable:n}=i;if(e.setValue(this.value(t),t),n){const i=`${t}${ci}`;e.setValue(this.value(i),i)}}))}svgFilters(e,t,i,n){const s=[],{filters:r}=this.definition;return s.push(...r.flatMap((e=>(this.setFilterValues(e),e.filterSvgFilter())))),s}}}ct[e.DefinitionType.Container]={definition:$o,definitionFromId:No,fromId:Lo,instance:jo,defaults:_o};const Bo=Go(Tn);class Uo extends Bo{_tweenable;get tweenable(){return this._tweenable}set tweenable(e){this._tweenable=e}selectables(){return[this,...this.tweenable.selectables()]}selectType=e.SelectType.None;selectedItems(t){return this.properties.map((i=>{const n=this.value(i.name),s=this;return{value:n,selectType:e.SelectType.None,property:i,changeHandler:(e,i)=>{I(e);const r={target:s,property:e,redoValue:i,undoValue:n};t.create(r)}}}))}}function Wo(e){return class extends e{constructor(...e){super(...e);const[t]=e,{properties:i,filters:n,initializeFilter:s,finalizeFilter:r}=t;i?.length&&this.properties.push(...i.map((e=>cn({...e,custom:!0})))),s&&(this.initializeFilter=Pr(s)),r&&(this.finalizeFilter=Pr(r)),n&&this.filters.push(...n.map((e=>Pr(e))))}filters=[];finalizeFilter;initializeFilter;toJSON(){const e=super.toJSON(),t=this.properties.filter((e=>e.custom));return t.length&&(e.properties=t),this.filters.length&&(e.filters=this.filters),e}}}const Ho=Wo(hs);class Jo extends Ho{constructor(...e){super(...e),this.properties.push(cn({name:"label",defaultValue:""}))}instanceArgs(e){const t=super.instanceArgs(e);return t.label||=this.label,t}instanceFromObject(e={}){return new Uo(this.instanceArgs(e))}type=e.DefinitionType.Effect}var Ko={label:"Chromakey",type:"effect",id:"com.moviemasher.effect.chromakey",properties:[{name:"blend",defaultValue:0,step:.01,min:0,max:1},{name:"similarity",defaultValue:.9,step:.01,min:0,max:1},{name:"color",type:"rgb",defaultValue:"#00FF00"}],filters:[{id:"com.moviemasher.filter.chromakey",parameters:[{name:"color",value:"color",dataType:"string"},{name:"blend",value:"blend",dataType:"string"},{name:"similarity",value:"similarity",dataType:"string"}]}]};var Yo={label:"Emboss",type:"effect",id:"com.moviemasher.effect.emboss",properties:[],filters:[{id:"com.moviemasher.filter.convolution",parameters:[{name:"matrix",value:"-2,-1,0,-1,1,1,0,1,2"}]}]};var Xo={label:"Grayscale",type:"effect",id:"com.moviemasher.effect.grayscale",filters:[{id:"com.moviemasher.filter.colorchannelmixer",parameters:[{name:"rr",value:.3},{name:"rg",value:.4},{name:"rb",value:.3},{name:"ra",value:0},{name:"gr",value:.3},{name:"gg",value:.4},{name:"gb",value:.3},{name:"ga",value:0},{name:"br",value:.3},{name:"bg",value:.4},{name:"bb",value:.3},{name:"ba",value:0},{name:"ar",value:0},{name:"ag",value:0},{name:"ab",value:0},{name:"aa",value:1}]}]};var Zo={label:"Sepia",type:"effect",id:"com.moviemasher.effect.sepia",filters:[{id:"com.moviemasher.filter.colorchannelmixer",parameters:[{name:"rr",value:.393},{name:"rg",value:.769},{name:"rb",value:.189},{name:"gr",value:.349},{name:"gg",value:.686},{name:"gb",value:.168},{name:"br",value:.272},{name:"bg",value:.534},{name:"bb",value:.131}]}]};var Qo={label:"Sharpen",type:"effect",id:"com.moviemasher.effect.sharpen",properties:[],filters:[{id:"com.moviemasher.filter.convolution",parameters:[{name:"matrix",value:"0,-1,0,-1,5,-1,0,-1,0"}]}]};const ea=t=>{const{id:i}=t;return I(i),new Jo({...t,type:e.DefinitionType.Effect})},ta=[ea({label:"Blur",type:"effect",id:"com.moviemasher.effect.blur",filters:[{id:"com.moviemasher.filter.convolution",parameters:[{name:"matrix",value:"1,1,1,1,1,1,1,1,1"},{name:"multiplier",value:"0.11"}]}]}),ea(Ko),ea(Yo),ea(Xo),ea(Zo),ea(Qo)],ia=e=>{const t=ta.find((t=>t.id===e));return t||ea({id:e})},na=e=>{const{definitionId:t=""}=e;return ia(t).instanceFromObject(e)},sa=e=>ia(e).instanceFromObject();ct[e.DefinitionType.Effect]={definition:ea,definitionFromId:ia,fromId:sa,instance:na,defaults:ta};const ra=e=>Er(e)&&oa(e.definition),oa=t=>ft(t)&&t.type===e.DefinitionType.Audio;function aa(t){return class extends t{constructor(...t){super(...t);const[i]=t,{isDefaultOrAudio:n,container:s}=this;n||s||(this.addProperties(i,cn({name:"x",type:e.DataType.Percent,defaultValue:.5,group:e.DataGroup.Point,tweenable:!0})),this.addProperties(i,cn({name:"y",type:e.DataType.Percent,defaultValue:.5,group:e.DataGroup.Point,tweenable:!0})),this.addProperties(i,cn({name:"lock",type:e.DataType.String,defaultValue:e.Orientation.H,group:e.DataGroup.Size})));const{effects:r}=i;r&&this.effects.push(...r.map((e=>{const t=na(e);return t.tweenable=this,t})))}audibleCommandFiles(e){const t={...e,audible:!0,visible:!1};return this.fileCommandFiles(t)}audibleCommandFilters(e){const t=[],{time:i,quantize:n,commandFiles:s,clipTime:r}=e,o=i.isRange?i.lengthSeconds:0,a=o?Math.min(o,r.lengthSeconds):0,{id:c}=this;let l=Xs(s,c,!1);const u="atrim",h=yn(u),d={},{frame:p}=this.definitionTime(i,r);a&&(d.duration=a),p&&(d.start=Jr(p,n).seconds);const m={inputs:[l],ffmpegFilter:u,options:d,outputs:[h]};t.push(m),l=h;const f=1e3*(r.seconds-i.seconds);if(f){const e="adelay",i=yn(e),n={ffmpegFilter:e,options:{delays:f,all:1},inputs:[l],outputs:[i]};t.push(n),l=i}return t.push(...this.amixCommandFilters({...e,filterInput:l})),t}contentCommandFilters(e,t){return this.effectsCommandFilters(e)}contentPreviewItemPromise(e,t,i,n){return this.itemPromise(e,t,i,n)}contentRects(e){const{containerRects:t,time:i,timeRange:n,loading:s,editing:r}=e,o=b(t)?t:[t,t];if(s&&!this.intrinsicsKnown({editing:r,size:!0}))return o;const a=this.intrinsicRect(r);if(!_i(a))return o;const{lock:c}=this,l=this.tweenRects(i,n),u=Ls(l,c),h=$s(a,t,u),[d,p]=h,m=Ns(h,t,u),[f,g]=m;return[Yi(d,f),Yi(p,g)]}contentSvgFilter(e,t,i,n,s){const{effects:r,isDefaultOrAudio:o}=this;if(o||!r.length)return;const a=this.effects.flatMap((e=>e.svgFilters(t,i,n,s))),c=Mn(a,e);return _n(c,"200%","width"),_n(c,"200%","height"),c}definitionIds(){return[...super.definitionIds(),...this.effects.flatMap((e=>e.definitionIds()))]}effectsCommandFilters(e){const t=[],{filterInput:i}=e;let n=i;I(n);const{effects:s,isDefaultOrAudio:r}=this;return r||t.push(...s.flatMap((t=>{const i=t.commandFilters({...e,filterInput:n});return i.length&&(n=Zi(Zi(i).outputs)),i}))),t}effects=[];intrinsicRect(e=!1){return Ki}get isDefault(){return"com.moviemasher.content.default"===this.definitionId}get isDefaultOrAudio(){return this.isDefault||ra(this)}itemPromise(e,t,i,n){throw new Error(dn.unimplemented)}selectedItems(t){const i=super.selectedItems(t);if(this.isDefaultOrAudio||this.container)return i;const{effects:n,selectType:s}=this,r=[...n],o=this,a={selectType:s,value:this.effects,removeHandler:i=>{const s={redoSelection:{...t.selection,effect:void 0},effects:n,undoEffects:r,redoEffects:n.filter((e=>e!==i)),type:e.ActionType.MoveEffect};t.create(s)},moveHandler:(i,s=0)=>{g(s,"index");const a=r.filter((e=>e!==i)),c=r.indexOf(i)<s?s-1:s;a.splice(c,0,i);const l={effects:n,undoEffects:r,redoEffects:a,type:e.ActionType.MoveEffect,effectable:o};t.create(l)},addHandler:(i,s=0)=>{g(s,"index");const o=[...n];o.splice(s,0,i),i.tweenable=this;const a={effects:n,undoEffects:r,redoEffects:o,redoSelection:{...t.selection,effect:i},type:e.ActionType.MoveEffect};t.create(a)}};return i.push(a),i}selectedProperty(e){const{name:t}=e;switch(t){case"effects":case"lock":case"width":case"height":case"x":case"y":return!this.isDefaultOrAudio}return super.selectedProperty(e)}toJSON(){const e=super.toJSON();return e.effects=this.effects,e}}}const ca=e=>Er(e)&&"color"in e,la=aa(Xr(Tn));class ua extends la{constructor(...t){super(...t);const[i]=t;this.addProperties(i,cn({tweenable:!0,name:"color",type:e.DataType.Rgb,defaultValue:this.definition.color,group:e.DataGroup.Color}))}_colorFilter;get colorFilter(){return this._colorFilter||=Ar("color")}contentColors(e,t){const[i,n]=this.tweenValues("color",e,t);I(i);return[i,S(n)?n:i]}contentPreviewItemPromise(e,t,i,n){const{colorFilter:s}=this,[r]=this.tweenValues("color",t,i),{x:o,y:a,width:c,height:l}=e;s.setValues({width:c,height:l,color:r});const u=s.filterSvg();return u.setAttribute("x",String(o)),u.setAttribute("y",String(a)),Promise.resolve(u)}}const ha=qo(eo(hs));class da extends ha{constructor(...e){super(...e);const[t]=e,{color:i}=t;S(i)&&(this.color=i)}color=wt;instanceFromObject(e={}){return new ua(this.instanceArgs(e))}}const pa=[new da({...{label:"Color",type:"content",id:"com.moviemasher.content.default",color:"#FFFFFF"},id:Vr})],ma=e=>{const{id:t}=e;throw I(t,"contentDefinition id"),"contentDefinition"},fa=e=>{const t=pa.find((t=>t.id===e));return t||ma({id:e})},ga=e=>{const{definitionId:t}=e;if(!t)throw dn.id;return fa(t).instanceFromObject(e)},ya=e=>fa(e).instanceFromObject({definitionId:e});ct[e.DefinitionType.Content]={definition:ma,definitionFromId:fa,fromId:ya,instance:ga,defaults:pa};class va{addSource(e,t){this.sourcesById.set(e,t)}_context;get context(){if(!this._context){const e=AudioContext||window.webkitAudioContext;if(!e)throw dn.audibleContext;this._context=new e}return this._context}createBuffer(e){const t=44100*e;return this.context.createBuffer(2,t,44100)}createBufferSource(e){const t=this.context.createBufferSource();return e&&(t.buffer=e),t}createGain(){return this.context.createGain()}get currentTime(){return this.context.currentTime}decode(e){return new Promise(((t,i)=>this.context.decodeAudioData(e,(e=>t(e)),(e=>i(e)))))}deleteSource(e){const t=this.getSource(e);if(!t)return;this.sourcesById.delete(e);const{gainSource:i,gainNode:n}=t;n.disconnect(this.destination),i.disconnect(n),i.stop()}get destination(){return this.context.destination}getSource(e){return this.sourcesById.get(e)}hasSource(e){return this.sourcesById.has(e)}sourcesById=new Map;startAt(e,t,i,n,s,r=!1){const o=this.createGain();t.loop=r,t.connect(o),o.connect(this.destination),t.start(this.currentTime+i,s,n),this.addSource(e,{gainSource:t,gainNode:o})}}const Ta=new va,ba={audible:()=>new va},wa=e=>n(e)&&"composition"in e;function Fa(e,t){wa(e)||i(e,"Mash",t)}class Sa extends li{constructor(t){super();const{createdAt:i,id:n,icon:s,preloader:r,quantize:o}=t;r&&(this._preloader=r),S(n)&&(this._id=n),S(s)&&(this.icon=s),S(i)&&(this.createdAt=i),v(o)&&(this.quantize=o),this.properties.push(cn({name:"label",type:e.DataType.String,defaultValue:""})),this.properties.push(cn({name:"color",type:e.DataType.Rgb,defaultValue:wt})),this.propertiesInitialize(t)}get buffer(){throw new Error(dn.unimplemented+"get buffer")}set buffer(e){throw new Error(dn.unimplemented+"set buffer")}createdAt="";data={};dataPopulate(e){const t=this.properties.map((e=>e.name));Object.entries(e).forEach((([e,i])=>{t.find((t=>t===e))||(this.data[e]=i)}))}destroy(){}_editor;get editor(){return this._editor}set editor(e){this._editor=e}_emitter;get emitter(){return this._emitter}set emitter(e){this._emitter=e,this.emitterChanged()}emitterChanged(){}editedGraphFiles(e){return[]}icon="";_id="";get id(){return this._id||=gn()}set id(t){this._id=t,this.emitter?.emit(e.EventType.Save)}_imageSize={...Vi};get imageSize(){return this._imageSize}set imageSize(e){$i(e,"imageSize"),this._imageSize=e}loadPromise(e){throw dn.unimplemented}get loading(){return!1}get mashes(){throw dn.unimplemented}_preloader;get preloader(){return this._preloader}putPromise(){throw new Error(dn.unimplemented)}quantize=Yr.mash.quantize;reload(){}selectables(){return[]}selectType=e.SelectType.None;selectedItems(e){return[]}previewItems(e){throw dn.unimplemented}toJSON(){const e=super.toJSON();return e.createdAt=this.createdAt,e.quantize=this.quantize,e.id=this.id,this.icon&&(e.icon=this.icon),Object.entries(this.data).forEach((([t,i])=>{a(e[t])&&(e[t]=i)})),e}}const Ia=e=>hi(e)&&"contentId"in e;function Ca(e,t){Ia(e)||i(e,"Clip",t)}const xa=e=>n(e)&&"frameForClipNearFrame"in e;function Da(e,t){xa(e)||i(e,"Track",t)}function Pa(e){return class extends e{constructor(...e){super(...e);const[t]=e,{source:i,url:n,bytes:s,mimeType:r}=t,o=i||n||"";this.source=i||o,this.url=n||o,s&&(this.bytes=s),r&&(this.mimeType=r)}bytes=0;loadType;mimeType="";source;toJSON(){const e=super.toJSON();return this.url&&(e.url=this.url),this.source&&(e.source=this.source),this.bytes&&(e.bytes=this.bytes),this.mimeType&&(e.mimeType=this.mimeType),e}url}}function Aa(e){return class extends e{}}function Va(t){return class extends t{constructor(...t){super(...t);const[i]=t,{container:n}=i,s=n?0:1;this.addProperties(i,cn({tweenable:!0,name:"width",type:e.DataType.Percent,group:e.DataGroup.Size,defaultValue:1,max:2,min:s})),this.addProperties(i,cn({tweenable:!0,name:"height",type:e.DataType.Percent,group:e.DataGroup.Size,defaultValue:1,max:2,min:s}))}colorMaximize=!0;containerCommandFilters(e,t){const i=[],{commandFiles:n,containerRects:s,filterInput:r,videoRate:o,track:a}=e;let c=r;const l=t.size?Vs(...s):s[0],u={...e,contentColors:[Ct,Ct],outputSize:l};i.push(...this.colorBackCommandFilters(u,`container-${a}-back`));const h=Zi(Zi(i).outputs),{id:d}=this,p=Xs(n,d,!0);i.push(...this.scaleCommandFilters({...e,filterInput:p})),c=Zi(Zi(i).outputs),t.size&&(I(c,"overlay input"),i.push(...this.overlayCommandFilters(h,c)),c=Zi(Zi(i).outputs));const m={duration:0,videoRate:o};I(c,"crop input");const{cropFilter:f}=this;return f.setValue(l.width,"width"),f.setValue(l.height,"height"),f.setValue(0,"x"),f.setValue(0,"y"),i.push(...f.commandFilters({...m,filterInput:c})),c=Zi(Zi(i).outputs),t.size||(I(c,"overlay input"),i.push(...this.overlayCommandFilters(h,c)),c=Zi(Zi(i).outputs)),I(c,"alphamerge input"),i.push(...this.alphamergeCommandFilters({...e,filterInput:c})),c=Zi(Zi(i).outputs),i.push(...this.containerFinalCommandFilters({...e,filterInput:c})),i}containerPreviewItemPromise(e,t,i,n){return this.itemPromise(e,t,i,n)}contentCommandFilters(e,t){const i=[],{containerRects:n,visible:s,time:r,videoRate:o,clipTime:a,commandFiles:c,filterInput:l,track:u,upload:h}=e;if(!s)return i;R(a),x(n,"containerRects");const{id:d}=this;let p=l||Xs(c,d,s);const m={containerRects:n,time:r,timeRange:a},f=this.contentRects(m),g=!Ji(...n),[y,v]=f,T=k(r)?r.lengthSeconds:0,b=g?Vs(...n):n[0],w=`content-${u}-back`;if(!h){const t={...e,contentColors:[bt,bt],outputSize:b};i.push(...this.colorBackCommandFilters(t,w))}const F={...e,filterInput:p,containerRects:f};if(i.push(...this.scaleCommandFilters(F)),h)return i;p=Zi(Zi(i).outputs),t.size&&(i.push(...this.overlayCommandFilters(w,p)),p=Zi(Zi(i).outputs));const S={duration:T,videoRate:o},{cropFilter:I}=this;I.setValue(b.width,"width"),I.setValue(b.height,"height"),I.setValue(y.x,"x"),I.setValue(y.y,"y"),I.setValue(v.x,`x${ci}`),I.setValue(v.y,`y${ci}`),i.push(...I.commandFilters({...S,filterInput:p})),p=Zi(Zi(i).outputs);const{setsarFilter:C}=this;return C.setValue("1/1","sar"),i.push(...C.commandFilters({...S,filterInput:p})),p=Zi(Zi(i).outputs),t.size||(i.push(...this.overlayCommandFilters(w,p,this.definition.alpha)),p=Zi(Zi(i).outputs)),i.push(...super.contentCommandFilters({...e,filterInput:p},t)),i}_setsarFilter;get setsarFilter(){return this._setsarFilter||=Ar("setsar")}hasIntrinsicSizing=!0;iconUrl(e,t,i){return this.definition.url}initialCommandFilters(e,t,i=!1){const n=[],{filterInput:s,track:r}=e;return i&&(I(s),n.push(this.copyCommandFilter(s,r))),n}intrinsicRect(e=!1){const t=e?"previewSize":"sourceSize",{[t]:i}=this.definition;$i(i,t);return{...Si,...i}}intrinsicsKnown(e){const{editing:t,size:i}=e;if(!i)return!0;const n=t?"previewSize":"sourceSize",{[n]:s}=this.definition;return _i(s)}itemIconPromise(e,t,i,n){const{clip:s}=this,{preloader:r}=s.track.mash,o=this.iconUrl(qi(e),t,i),a=us("image",o),c=us("svg",a,{...e}),l=n?this.definition:void 0;return r.loadPromise(c,l)}itemPreviewPromise(e,t,i){return this.itemIconPromise(e,t,i)}itemPromise(e,t,i,n){const{container:s}=this,r=s?e:this.itemContentRect(e,t,i);return n?this.itemIconPromise(r,t,i):this.itemPreviewPromise(r,t,i).then((e=>(Sn(e,r),e)))}itemContentRect(e,t,i){const n={containerRects:e,time:t,timeRange:i,editing:!0},[s]=this.contentRects(n),{x:r,y:o}=s,a={x:e.x-r,y:e.y-o};return Yi(s,a)}}}function Ea(e){return class extends e{constructor(...e){super(...e);const[t]=e,{sourceSize:i,previewSize:n}=t;_i(n)&&(this.previewSize=n),_i(i)&&(this.sourceSize=i)}alpha;previewSize;sourceSize;toJSON(){const e=super.toJSON(),{sourceSize:t,previewSize:i}=this;return t&&(e.sourceSize=this.sourceSize),i&&(e.previewSize=this.previewSize),e}}}const za=[e.DefinitionType.Audio,e.DefinitionType.Video,e.DefinitionType.VideoSequence],Oa=e=>Mr(e)&&"startOptions"in e;const ka=e=>kr(e)&&"audibleSource"in e;function Ra(e,t){ka(e)||i(e,"UpdatableDefinition",t)}function Ma(t){return class extends t{constructor(...e){super(...e);const[t]=e,{gain:i}=t;if(h(i))if(r(i))if(i.includes(",")){const e=i.split(",").map((e=>parseFloat(e))),t=e.length/2;for(let i=0;i<t;i+=1)this.gainPairs.push([e[2*i],e[2*i+1]]);this.gain=-1}else this.gain=Number(i);else f(i)&&(this.gain=i)}definitionTime(e,t){const i=super.definitionTime(e,t),{startTrim:n,endTrim:s,definition:r}=this,{duration:o}=r,a=Kr(o,t.fps).frame-(n+s),c=i.frame%a;return i.withFrame(c+n).divide(this.speed)}frames(e){const{definition:t,startTrim:i,endTrim:n}=this;return t.frames(e)-(i+n)}gain=1;gainPairs=[];fileUrls(t){const{editing:i,audible:n,time:s}=t;if(!n||i&&!s.isRange)return[];if(!this.mutable()||this.muted)return[];const{definition:r}=this,o=r.urlAudible(i);return[{type:e.LoadType.Audio,file:o,definition:r,input:!0}]}hasGain(){if(0===this.gain)return!0;if(f(this.gain))return!1;if(2!==this.gainPairs.length)return!1;const[e,t]=this.gainPairs;if(2!==e.length)return!1;if(2!==t.length)return!1;if(Math.max(...e))return!1;const[i,n]=t;return 1===i&&0===n}hasIntrinsicTiming=!0;initialCommandFilters(e,t,i=!1){const n=[],{time:s,quantize:r,commandFiles:o,clipTime:a,videoRate:c,duration:l}=e,{id:u}=this;let h=Xs(o,u,!0);I(h,"filterInput");const d="trim",p=yn(d),m={};l&&(m.duration=l);const{frame:f}=this.definitionTime(s,a);f&&(m.start=Jr(f,r).seconds);const g={inputs:[h],ffmpegFilter:d,options:m,outputs:[p]};if(n.push(g),h=p,l){const e="fps",t=yn(e),i={ffmpegFilter:e,options:{fps:c},inputs:[h],outputs:[t]};n.push(i),h=t}const y="setpts",v={ffmpegFilter:y,options:{expr:"PTS-STARTPTS"},inputs:[h],outputs:[yn(y)]};return n.push(v),n}intrinsicsKnown(e){if(!super.intrinsicsKnown(e))return!1;const{duration:t}=e;return!t||v(this.definition.duration)}mutable(){return this.definition.audio}selectedProperty(e){const{name:t}=e;return"gain"===t?this.mutable()&&!this.muted:super.selectedProperty(e)}setValue(e,t,i){if(super.setValue(e,t,i),!i)switch(t){case"startTrim":case"endTrim":case"speed":this.clip.resetTiming(this)}}startOptions(e,t){let i=t.withFrame(this.startTrim).seconds,n=t.seconds-e,s=t.lengthSeconds;return n<0&&(i-=n,s+=n,n=0),{start:n,offset:i,duration:s}}toJSON(){const e=super.toJSON(),{speed:t,gain:i}=this;return 1!==t&&(e.speed=t),1!==i&&(e.gain=i),e}_trimFilter;get trimFilter(){return this._trimFilter||=Ar("trim")}}}function _a(t){return class extends t{constructor(...t){super(...t);const[i]=t,{audioUrl:n,audio:s,loop:r,duration:o,waveform:a,loadedAudio:c}=i;(s||n||c)&&(this.audio=!0,S(n)&&(this.audioUrl=n),a&&(this.waveform=a),c&&(this.loadedAudio=c)),v(o)&&(this.duration=o),r&&(this.loop=r,this.properties.push(cn({name:"loops",defaultValue:1}))),this.properties.push(cn({name:"gain",defaultValue:1,type:e.DataType.Percent,min:0,max:2,step:.01})),this.properties.push(cn({name:"speed",defaultValue:1,type:e.DataType.Percent,min:.1,max:2,step:.1,group:e.DataGroup.Timing})),this.properties.push(cn({name:"startTrim",defaultValue:0,type:e.DataType.Frame,step:1,min:0,group:e.DataGroup.Timing})),this.properties.push(cn({name:"endTrim",defaultValue:0,type:e.DataType.Frame,step:1,min:0,group:e.DataGroup.Timing}))}audibleSource(e){const{loadedAudio:t}=this;if(t)return Ta.createBufferSource(t);const{audioUrl:i}=this;if(!S(i))return void(this.audio=!1);const n=us("audio",i),s=e.getCache(n);if(!s)return;const{error:r,result:o}=s;return r||!Wn(o)?(this.audio=!1,void(this.audioUrl="")):(this.loadedAudio=o,Ta.createBufferSource(o))}audio=!1;audioUrl="";duration=0;frames(t){const{duration:i}=this;return i?Kr(this.duration,t,"floor").frame:e.Duration.Unknown}loadedAudio;loop=!1;toJSON(){const e=super.toJSON(),{duration:t,audio:i,loop:n,waveform:s,audioUrl:r,url:o}=this;return t&&(e.duration=t),i&&(e.audio=i),n&&(e.loop=n),s&&(e.waveform=s),o?e.url=o:r&&(e.audioUrl=r),e}urlAudible(e=!1){return e?us("audio",this.audioUrl||this.url):this.source}waveform}}class $a{constructor(e){const{buffer:t,gain:i,preloader:n}=e;f(i)&&(this.gain=i),v(t)&&(this.buffer=t),this.preloader=n}adjustClipGain(e,t){const i=e.timeRange(t);this.clipSources(e).forEach((e=>{this.adjustSourceGain(e,i)}))}adjustSourceGain(e,t){const i=Ta.getSource(e.id);if(!i)return;const{gainNode:n}=i;if(0===this.gain)return void(n.gain.value=0);const s=e.gain;if(f(s))return void(n.gain.value=this.gain*s);const r=k(t)?e.startOptions(this.seconds,t):t,{start:o,duration:a}=r;n.gain.cancelScheduledValues(0),e.gainPairs.forEach((e=>{const[t,i]=e;n.gain.linearRampToValueAtTime(this.gain*i,o+t*a)}))}buffer=Yr.mash.buffer;bufferClips(e,t){return!!this.createSources(e,t)&&(this.destroySources(e),!0)}bufferSource;clear(){}clipSources(e){const t=[],{container:i,content:n}=e;return Oa(i)&&!i.muted&&t.push(i),Oa(n)&&!n.muted&&t.push(n),t}createSources(e,t,i){if(!this.playing&&!i)return!1;const n=e.filter((e=>!this.playingClips.includes(e)));if(!n.length)return!0;let s=!0;return n.forEach((e=>{const n=this.clipSources(e),r=e.timeRange(t),o=n.filter((e=>!Ta.hasSource(e.id)));s&&=o.every((e=>{const t=this.playing?this.seconds:i?.seconds||0,n=e.startOptions(t,r),{start:s,duration:o,offset:a}=n;if(f(s)&&v(o)){const{definition:t,id:i}=e;Ra(t);const r=t.audibleSource(this.preloader);if(!r)return!!s;const{loop:c}=t;Ta.startAt(i,r,s,o,a,c),this.adjustSourceGain(e,n)}else console.error(this.constructor.name,"createSources",n);return!0}))})),this.playingClips.push(...n),s}destroySources(e=[]){[...this.playingClips].filter((t=>!e.includes(t))).forEach((e=>{this.clipSources(e).forEach((e=>Ta.deleteSource(e.id)))})),this.playingClips=e}gain=Yr.mash.gain;setGain(e,t){this.gain!==e&&(this.gain=e,this.playing&&this.playingClips.forEach((e=>this.adjustClipGain(e,t))))}playing=!1;playingClips=[];preloader;get seconds(){return Ta.currentTime-this.contextSecondsWhenStarted+this.startedMashAt}startContext(){if(this.bufferSource)throw dn.internal+"bufferSource startContext";if(this.playing)throw dn.internal+"playing";const e=Ta.createBuffer(this.buffer);this.bufferSource=Ta.createBufferSource(e),this.bufferSource.loop=!0,this.bufferSource.connect(Ta.destination),this.bufferSource.start(0)}startPlaying(e,t,i){if(!this.bufferSource)throw dn.internal+"bufferSource startPlaying";if(this.playing)throw dn.internal+"playing";const{seconds:n}=e;return this.playing=!0,this.startedMashAt=n,this.contextSecondsWhenStarted=Ta.currentTime,!!this.createSources(t,i,e)||(this.stopPlaying(),!1)}startedMashAt=0;contextSecondsWhenStarted=0;stopContext(){this.bufferSource&&(this.bufferSource.stop(),this.bufferSource.disconnect(Ta.destination),delete this.bufferSource)}stopPlaying(){this.playing&&(this.playing=!1,this.destroySources(),this.startedMashAt=0,this.contextSecondsWhenStarted=0)}}const Na="BACKCOLOR",ja="SILENCE";class La{constructor(e){const{upload:t,mash:i,background:n,size:s,time:r,streaming:o,videoRate:a,visible:c}=e;Fa(i),this.mash=i,this.time=r,this.videoRate=a,this.background=n,this.upload=t,this.size=s,c&&(this.visible=!0),o&&(this.streaming=!0),V(v(this.videoRate),"videoRate"),V(this.time.fps===this.quantize,"time is in mash rate")}_id;get id(){return this._id||=yn("filtergraph")}get avType(){return this.visible?e.AVType.Video:e.AVType.Audio}background;get commandFilterVisible(){const{duration:e,videoRate:t,background:i,size:n}=this,s={ffmpegFilter:"color",options:{color:i||bt,rate:t,size:`${n.width}x${n.height}`},inputs:[],outputs:[Na]};return e&&(s.options.duration=e),s}get commandFilterAudible(){const{duration:e}=this,t={ffmpegFilter:"aevalsrc",options:{exprs:0,duration:e},inputs:[],outputs:[ja]};return e&&(t.options.duration=e),t}_clips;get clips(){return this._clips||=this.clipsInitialize}get clipsInitialize(){const{time:e,mash:t,avType:i}=this;return t.clipsInTimeOfType(e,i).sort(ir)}get commandInputs(){return this.inputCommandFiles.map((e=>{const{options:t}=e;return{source:this.preloader.key(e),options:t}}))}_commandFiles;get filterGraphCommandFiles(){return this._commandFiles||=this.commandFilesInitialize}get commandFilesInitialize(){const{time:e,videoRate:t,quantize:i,size:n,clips:s,visible:r,preloader:o}=this,a=s.flatMap((s=>{const o=s.timeRange(i),a={time:e,quantize:i,visible:r,outputSize:n,videoRate:t,clipTime:o};return s.clipCommandFiles(a)}));return a.forEach((e=>{const{definition:t}=e;gt(t);const i=o.key(e);e.resolved=i})),a}get commandFilters(){const e=[],{time:t,quantize:i,size:n,clips:s,visible:r,videoRate:o,filterGraphCommandFiles:a,upload:c}=this,l={videoRate:o,time:t,quantize:i,visible:r,outputSize:n,commandFiles:a,chainInput:"",clipTime:Wr(t),track:0,upload:c};r?c||(e.push(this.commandFilterVisible),l.chainInput=Na):(e.push(this.commandFilterAudible),l.chainInput=ja);const{length:u}=s;return s.forEach(((t,n)=>{l.clipTime=t.timeRange(i),l.track=n,e.push(...t.commandFilters(l));const s=Zi(e);n<u-1&&(s.outputs.length||s.outputs.push(yn("clip"))),l.chainInput=Zi(s.outputs)})),e}get duration(){return this.time.lengthSeconds}get inputCommandFiles(){return this.filterGraphCommandFiles.filter((e=>e.input))}mash;get preloader(){return this.mash.preloader}get quantize(){return this.mash.quantize}size;streaming=!1;time;upload;visible=!1;videoRate}class qa{args;constructor(t){this.args=t;const{avType:i,times:n,mash:s,...r}=t,{length:o}=n;if(!o)return void(this.time=Jr());const[a]=n,c=[],l=[],u=[];if(n.forEach((e=>{u.push(e.fps),c.push(e.frame),e.isRange&&l.push(e.timeRange.end)})),l.length){const e=Math.max(...u);if(e!==Math.min(...u))throw dn.internal+"timeranges fps";const t=Math.min(...c),i=Math.max(...l);this.time=Ur(t,e,i)}else V(1===o,"just one time"),this.time=a;if(i!==e.AVType.Video){V(1===o||i!==e.AVType.Audio,"single time for avtype audio");const t={...r,time:this.time,mash:s,visible:!1};this.filterGraphAudible=new La(t)}i!==e.AVType.Audio&&this.filterGraphsVisible.push(...n.map((e=>{const t={...r,time:e,mash:s,visible:!0};return new La(t)})))}assureDuration(){}assureSize(){}get duration(){return this.time.lengthSeconds}filterGraphsVisible=[];filterGraphAudible;get filterGraphVisible(){return this.filterGraphsVisible[0]}_graphFiles;get fileUrls(){const e=[...this.filterGraphsVisible];return this.filterGraphAudible&&e.push(this.filterGraphAudible),this._graphFiles||=e.flatMap((e=>e.filterGraphCommandFiles))}get graphFilesInput(){return this.fileUrls.filter((e=>e.input))}get loadPromise(){return this.args.mash.preloader.loadFilesPromise(this.fileUrls)}time}class Ga{args;constructor(e){this.args=e}get clip(){return this.args.clip}get container(){return this.clip.container}get editor(){return this.preview.editor}get icon(){return!!this.args.icon}get id(){return this.clip.id}pointerDown(){const t={...Si},{editor:i,container:n,timeRange:s,rect:r,clip:o}=this,{rect:a}=i,c=()=>{globalThis.window.removeEventListener("pointermove",h),globalThis.window.removeEventListener("pointermove",u),globalThis.window.removeEventListener("pointerup",l),globalThis.window.removeEventListener("pointerup",d)},l=e=>{Zs(e),c(),i.dragging=!1,i.redraw()},u=o=>{Zs(o);const{offE:c,offN:l,offS:u,offW:h}=n,{x:d,y:p,width:m,height:f}=r;let g=a.width-m,y=a.height-f,v=0,T=0;c&&(v-=m,g+=m),h&&(g+=m),l&&(T-=f,y+=f),u&&(y+=f);const{clientX:b,clientY:w}=o,F=b-a.x,S=w-a.y,I=t.x-a.x,C=S-(t.y-a.y-p),x=Bs(F-(I-d),v,v+g),D=Bs(C,T,T+y),P=Gs(n),{lastTime:A}=s,V=i.time.equalsTime(A),E=P&&V,z=E?`x${ci}`:"x",O=E?`y${ci}`:"y",k={[z]:n.value(z),[O]:n.value(O)},R={[z]:g?x/g:k[z],[O]:y?D/y:k[O]},M={property:e.DataGroup.Point,target:n,type:e.ActionType.ChangeMultiple,redoValues:R,undoValues:k};i.actions.create(M)},h=e=>{Zs(e);const{clientX:r,clientY:o}=e;if(!Fi({x:r,y:o},t)){if(Gs(n)){const{time:e}=i,t=e.closest(s);if(!e.equalsTime(t))return c(),void i.goToTime(t)}i.dragging=!0,globalThis.window.removeEventListener("pointermove",h),globalThis.window.addEventListener("pointermove",u),u(e)}},d=e=>{if(Zs(e),!(e instanceof PointerEvent))return;const{clientX:n,clientY:s}=e;t.x=n,t.y=s,globalThis.window.addEventListener("pointermove",h),globalThis.window.addEventListener("pointerup",l),i.selection.clip!==o&&i.selection.set(o)};return d}get preview(){return this.args.preview}get quantize(){return this.preview.quantize}_rect;get rect(){return this._rect||this.rectInitialize}get rectInitialize(){const{time:e,timeRange:t,clip:i,size:n}=this;$i(n,`${this.constructor.name}.rectInitialize size`);const s={size:n,time:e,timeRange:t,editing:!0},r=i.rects(s);return V(Ji(...r)),r[0]}get size(){return this.preview.size}editingSvgItem(e,t){const{container:i,rect:n}=this,s=i.pathElement(n);return s.setAttribute("vector-effect","non-scaling-stroke"),$n(s,e),t||s.addEventListener("pointerdown",this.pointerDown()),s}svgBoundsElement(e,t,i){const n=[],{rect:s,container:r}=this,{directions:o}=r,{width:a,height:c,x:l,y:u}=s,h={x:l-1,y:u-1,width:a,height:2};n.push(Cn(h,e)),h.y=u+c-1,n.push(Cn(h,e)),h.x=l+a-1,h.height=c,h.width=2,h.y=u,n.push(Cn(h,e)),h.x=l-1,n.push(Cn(h,e));const d={width:a,height:c};return o.forEach((e=>{const s=this.svgHandlePoint(d,e),r={x:l+s.x,y:u+s.y,width:8,height:8},o=Cn(r,[...t,e.toLowerCase()]);n.push(o),i||o.addEventListener("pointerdown",(e=>{this.editor.selection.set(this.clip),Zs(e)}))})),n}svgHandlePoint(t,i){const{width:n,height:s}=t,r={...Si},[o,a]=String(i).split("");$e(o,i);const c=a||o;switch($e(c),c){case e.Direction.W:r.x=-4;break;case e.Direction.E:r.x=n-4;break;default:r.x=Math.round(n/2)-4}switch(o){case e.Direction.N:r.y=-4;break;case e.Direction.S:r.y=s-4;break;default:r.y=Math.round(s/2)-4}return r}get time(){return this.preview.time}_timeRange;get timeRange(){return this._timeRange||=this.clip.timeRange(this.quantize)}}class Ba{constructor(e){const{selectedClip:t,editor:i,time:s,mash:r,background:o,onlyClip:a,size:c}=e;this.mash=r,this.size=c||r.imageSize,this.time=s,this.background=o,this.selectedClip=t,this.onlyClip=a,n(i)&&(this.editor=i)}audible=!1;background;_clips;get clips(){return this._clips||=this.clipsInitialize}get clipsInitialize(){const{mash:t,time:i,onlyClip:n}=this;return n?[n]:t.clipsInTimeOfType(i,e.AVType.Video).sort(ir)}combine=!1;get duration(){return this.time.lengthSeconds}get editing(){return n(this.editor)}editor;get intrinsicSizePromise(){const{clips:e,preloader:t}=this,i={editing:!0,size:!0},n=e.filter((e=>!e.intrinsicsKnown(i))).flatMap((e=>e.intrinsicGraphFiles(i)));return t.loadFilesPromise(n)}get itemsPromise(){const{clips:e,size:t,time:i,onlyClip:n}=this;let s=Promise.resolve([]);const r=!!n;return e.forEach((e=>{s=s.then((n=>e.previewItemsPromise(t,i,r).then((e=>[...n,...e]))))})),s}mash;onlyClip;get preloader(){return this.mash.preloader}get quantize(){return this.mash.quantize}size;selectedClip;streaming=!1;_svgItems;time;_trackPreviews;get trackPreviews(){return this._trackPreviews||=this.trackPreviewsInitialize}get trackPreviewsInitialize(){const e=[],{time:t,quantize:i,clips:n}=this,s=t.isRange?void 0:t.scale(i);return n.forEach((n=>{const r=n.timeRange(i).scale(t.fps),o=Math.max(0,t.frame-r.frame),a=r.withFrame(o),c={clip:n,preview:this,tweenTime:s,timeRange:a,icon:!!this.onlyClip};e.push(new Ga(c))})),e}get svgItemsPromise(){return this.previewItemsPromise}get previewItemsPromise(){if(this._svgItems)return Promise.resolve(this._svgItems);return this.intrinsicSizePromise.then((()=>this.itemsPromise)).then((e=>this._svgItems=this.tupleItems(e)))}tupleItems(e){const{size:t,editing:i,background:n,selectedClip:r,editor:o}=this,a=[...e];a.forEach((e=>$n(e,"track")));if(n){const e=Cn(t,"background",n),i=Dn(t,e);a.unshift(i)}if(!i||!e.length)return a;s(o);const{dragging:c}=o,{trackPreviews:l}=this,u=l.find((e=>e.clip===r)),h=l.map((e=>{const t=["outline"];return c||e===u||t.push("animate"),e.editingSvgItem(t)})),d=Dn(t,h);if($n(d,["outlines"]),a.push(d),!u)return a;const p=["bounds","back"],m=["line"],f=["handle"],g=Dn(t,u.svgBoundsElement(m,f,!0));$n(g,p),p[1]="fore";const y=Dn(t,u.svgBoundsElement(m,f));return $n(y,p),a.push(g,y),a}visible=!0}class Ua extends Tn{constructor(...e){super(...e);const[t]=e,{container:i,content:n}=t;this.containerInitialize(i||{}),this.contentInitialize(n||{})}assureTimingAndSizing(t,i,n){const{timing:s,sizing:r,containerId:o}=this;let a=s!==t,c=r!==i;return a||=n.hasIntrinsicTiming,c||=n.hasIntrinsicSizing,a||(t===e.Timing.Content&&o?this.timing=e.Timing.Container:this.timing=e.Timing.Custom),c||(i===e.Sizing.Content&&o?this.sizing=e.Sizing.Container:this.sizing=e.Sizing.Preview),!(c&&a)}get audible(){return this.mutable}clipFileUrls(e){const t=[],{quantize:i}=e,{content:n,container:s,frames:r}=this;return v(r)&&(e.clipTime||=this.timeRange(i)),s&&t.push(...s.fileUrls(e)),t.push(...n.fileUrls(e)),t}clipIcon(e,t,i=1){const{container:n}=this;if(!n)return;const{track:s}=this,{quantize:r,imageSize:o}=s.mash;$i(o,"track.mash.imageSize");const a=zi(Mi(o,e,!0));$i(a,`${this.constructor.name}.clipIcon containedSize`);const c=a.width+i,l=Math.ceil(e.width/c),u=this.timeRange(r),{startTime:h}=u,d=[],{mash:p}=s;let m=0;for(let e=0;e<l;e++){const{copy:e}=h,i=new Ba({mash:p,time:e,onlyClip:this,size:a});d.push(i),m+=c,h.frame=u.frame+ws(m,t,"floor")}let f=Promise.resolve([]);return d.forEach((e=>{f=f.then((t=>e.svgItemsPromise.then((e=>[...t,...e]))))})),f.then((t=>{const i={...Si},n=Dn(e);return t.forEach((e=>{Sn(e,i),On(n,e),i.x+=c})),n}))}clipCommandFiles(e){const t=[],{visible:i,quantize:n,outputSize:s,time:r}=e,o=this.timeRange(n),{content:a,container:c}=this,l={...e,clipTime:o};if(i){$i(s,"outputSize"),Ti(c);const e={size:s,time:r,timeRange:o,loading:!0},i=this.rects(e),n=ca(a)?a.contentColors(r,o):void 0,u={...l,outputSize:s,contentColors:n,containerRects:i};if(!n){const e=a.visibleCommandFiles(u);t.push(...e)}const h=c.visibleCommandFiles(u);t.push(...h)}else V(!i,"outputSize && container"),t.push(...this.content.audibleCommandFiles(l));return t}commandFilters(e){const t=[],{visible:i,quantize:n,outputSize:s,time:r}=e,o=this.timeRange(n),a={...e,clipTime:o},{content:c,container:l}=this;if(!i)return this.content.audibleCommandFilters(a);$i(s,"outputSize"),Ti(l);const u={size:s,time:r,timeRange:o},h=this.rects(u);a.containerRects=h;const d={point:!Fi(...h),size:!Ai(...h)},p=ca(c)?c.contentColors(r,o):void 0,m=C(p);m&&(d.color=p[0]!==p[1],d.canColor=d.color?l.canColorTween(e):l.canColor(e));const f=r.isRange?r.lengthSeconds:0,g=f?Math.min(f,o.lengthSeconds):0,y={...a,contentColors:p,outputSize:s,containerRects:h,duration:g};return m?d.canColor||(t.push(...l.containerColorCommandFilters(y)),y.filterInput=Zi(Zi(t).outputs)):(t.push(...c.commandFilters(y,d)),y.filterInput=Zi(Zi(t).outputs)),t.push(...l.commandFilters(y,d,!0)),t}_container;get container(){return this._container||this.containerInitialize()}containerInitialize(t={}){const{containerId:i}=this,n=i||t.definitionId;if(!S(n))return;const s=yt.fromId(n),r={...t,definitionId:n,container:!0},o=s.instanceFromObject(r);return Ti(o),this.assureTimingAndSizing(e.Timing.Container,e.Sizing.Container,o),o.clip=this,this.timing===e.Timing.Container&&this._track&&this.resetTiming(o),this._container=o}_content;get content(){return this._content||this.contentInitialize()}contentInitialize(t={}){const{contentId:i}=this,n=i||t.definitionId;I(n);const s=yt.fromId(n),r={...t,definitionId:n},o=s.instanceFromObject(r);if(zr(o),this.assureTimingAndSizing(e.Timing.Content,e.Sizing.Content,o)){const{container:t}=this;t&&this.assureTimingAndSizing(e.Timing.Container,e.Sizing.Container,t)}return o.clip=this,this.timing===e.Timing.Content&&this._track&&this.resetTiming(o),this._content=o}copy(){const e={...this.toJSON(),id:""};return this.definition.instanceFromObject(e)}definitionIds(){const e=[...super.definitionIds(),...this.content.definitionIds()];return this.container&&e.push(...this.container.definitionIds()),e}get endFrame(){return this.frame+this.frames}endTime(e){return Jr(this.endFrame,e)}intrinsicsKnown(e){const{content:t,container:i}=this;let n=t.intrinsicsKnown(e);return i&&(n&&=i.intrinsicsKnown(e)),n}intrinsicGraphFiles(e){const{content:t,container:i}=this,n=[];return t.intrinsicsKnown(e)||n.push(t.intrinsicGraphFile(e)),i&&!i.intrinsicsKnown(e)&&n.push(i.intrinsicGraphFile(e)),n}maxFrames(e,t){return 0}get mutable(){const{content:e}=this;if(e.mutable())return!0;const{container:t}=this;if(!t)return!1;return t.mutable()}get notMuted(){const{content:e,muted:t}=this;if(t)return!1;if(e.mutable()&&!e.muted)return!0;const{container:i}=this;return!i?.mutable()||!i.muted}previewItemsPromise(e,t,i){$i(e,"previewItemsPromise");const n=this.timeRange(this.track.mash.quantize),s=t||n.startTime,{container:r,content:o}=this;Ti(r);const a={size:e,time:s,timeRange:n,editing:!0},c=this.rects(a);V(Ji(...c));const[l]=c;return r.containedContent(o,l,e,s,n,i)}rectIntrinsic(t,i,n){const s={...t,...Si},{sizing:r}=this;if(r===e.Sizing.Preview)return s;const o=r===e.Sizing.Container?this.container:this.content;pi(o);const a=o.intrinsicsKnown({editing:n,size:!0});if(i&&!a)return s;V(a,"intrinsicsKnown");return o.intrinsicRect(n)}rects(e){const{size:t,loading:i,editing:n}=e,s=this.rectIntrinsic(t,i,n),{container:r}=this;return Ti(r),r.containerRects(e,s)}resetTiming(t,i){const{timing:n}=this,s=this._track;switch(n){case e.Timing.Custom:if(v(this.frames))break;this.frames=Yr.duration*(i||s.mash.quantize);break;case e.Timing.Container:{const e=vi(t)?t:this.container;if(!e)break;this.frames=e.frames(i||s.mash.quantize);break}case e.Timing.Content:{const e=Er(t)?t:this.content;if(!e)break;this.frames=e.frames(i||s.mash.quantize);break}}}selectType=e.SelectType.Clip;selectables(){return[this,...this.track.selectables()]}selectedItems(t){const i=[],{properties:n}=this;return n.filter((e=>this.selectedProperty(e))).forEach((n=>{const{name:s}=n,r="frames"===s||"frame"===s,o=this.value(s),a=this;i.push({value:o,selectType:e.SelectType.Clip,property:n,changeHandler:(i,n)=>{I(i);const s={property:i,target:a,redoValue:n,undoValue:o,type:r?e.ActionType.ChangeFrame:e.ActionType.Change};t.create(s)}})})),i}selectedProperty(t){const{name:i,type:n}=t;switch(n){case e.DataType.ContainerId:case e.DataType.ContentId:return!1}switch(i){case"sizing":return!ra(this.content);case"timing":if(this.content.hasIntrinsicTiming)break;return!!this.container?.hasIntrinsicSizing;case"frame":return!this.track.dense;case"frames":return this.timing===e.Timing.Custom}return!0}setValue(e,t,i){switch(super.setValue(e,t,i),t){case"containerId":this._container&&this.containerInitialize(this._container.toJSON());break;case"contentId":this._content&&this.contentInitialize(this._content.toJSON())}}time(e){return Jr(this.frame,e)}timeRange(e){const{frame:t,frames:i}=this;return g(t,"timeRange frame"),T(i,"timeRange frames"),Ur(this.frame,e,this.frames)}timeRangeRelative(e,t){const i=this.timeRange(t).scale(e.fps),n=Math.max(0,e.frame-i.frame);return e.withFrame(n)}toJSON(){const e=super.toJSON(),{container:t,content:i}=this;return e.content=i,e.contentId=i.definitionId,t?(e.container=t,e.containerId=t.definitionId):e.containerId="",e}toString(){return`[Clip ${this.label}]`}_track;get track(){return this._track}set track(e){this._track=e}get trackNumber(){const{track:e}=this;return e?e.index:-1}set trackNumber(e){e<0&&delete this._track}get visible(){return!!this.containerId}}class Wa extends hs{constructor(...t){super(...t),this.properties.push(cn({name:"containerId",type:e.DataType.ContainerId,defaultValue:fi})),this.properties.push(cn({name:"contentId",type:e.DataType.ContentId,defaultValue:Vr})),this.properties.push(cn({name:"label",type:e.DataType.String})),this.properties.push(cn({name:"sizing",type:e.DataType.Sizing,defaultValue:e.Sizing.Content})),this.properties.push(cn({name:"timing",type:e.DataType.Timing,defaultValue:e.Timing.Content,group:e.DataGroup.Timing})),this.properties.push(cn({name:"frame",type:e.DataType.Frame,group:e.DataGroup.Timing,defaultValue:e.Duration.None,min:0,step:1})),this.properties.push(cn({name:"frames",type:e.DataType.Frame,defaultValue:e.Duration.Unknown,min:1,step:1,group:e.DataGroup.Timing}))}audible=!1;instanceArgs(t={}){const i=super.instanceArgs(t),{containerId:n,contentId:s}=i,r=a(s)||s===Vr;let o=a(n)||n===fi;return i.sizing===e.Sizing.Content&&r&&(i.sizing=e.Sizing.Container),i.sizing===e.Sizing.Container&&o&&(i.sizing=e.Sizing.Preview),i.timing===e.Timing.Content&&r&&(i.timing=e.Timing.Container),i.timing===e.Timing.Container&&o&&(i.timing=e.Timing.Custom),i}instanceFromObject(e={}){return new Ua(this.instanceArgs(e))}streamable=!1;type=e.DefinitionType.Clip;visible=!1}const Ha=new Wa({label:"Visible",type:"visible",id:"com.moviemasher.clip.default",containerId:"com.moviemasher.container.default",contentId:"com.moviemasher.content.default"}),Ja=Ha.id,Ka=[Ha],Ya=t=>{const{id:i}=t;return I(i),new Wa({...t,type:e.DefinitionType.Clip})},Xa=e=>{const t=Ka.find((t=>t.id===e));return t||Ya({id:e})},Za=(e={})=>{const{definitionId:t=Ja}=e;if(!t)throw dn.id;return Xa(t).instanceFromObject(e)},Qa=e=>Xa(e).instanceFromObject({definitionId:e});ct[e.DefinitionType.Clip]={definition:Ya,definitionFromId:Xa,fromId:Qa,instance:Za,defaults:Ka};class ec extends li{constructor(e){super();const{clips:t,index:i,dense:n}=e;f(i)&&(this.index=i),this.dense=h(n)?!!n:!this.index,this.properties.push(cn({name:"dense",defaultValue:!1})),this.propertiesInitialize(e),t&&this.clips.push(...t.map((e=>{const t=Za(e);return t.track=this,t})))}addClips(e,t=0){let i=t||0;this.dense||(i=0);const n=i,s=this.clips.filter(((t,s)=>{const r=e.includes(t);return n&&r&&s<n&&(i-=1),!r}));s.splice(i,0,...e),this.sortClips(s),Qi(this.clips,s)}assureFrame(e){const t=e||this.clips;let i=!1,n=0;const s=[],{dense:r}=this;return t.forEach((e=>{const{frame:t}=e;(r?t!==n:s.some((e=>e.includes(t))))&&(i=!0,e.frame=n),n=e.frame+e.frames,r||s.push(e.timeRange(1))})),i}assureFrames(e,t){const i=h(t);(t||this.clips).forEach((t=>{const{frames:n}=t;v(n)||(t.resetTiming(void 0,e),!v(t.frames)&&i&&(t.frames=Math.floor(Yr.duration*e)))}))}clips=[];dense=!1;frameForClipNearFrame(e,t=0){if(this.dense)return t;const i=this.clips.filter((i=>e!==i&&i.endFrame>t));if(!i.length)return t;const n=e.frame,s=e.endFrame-n;let r=t;return i.find((e=>{if(e.frame>=r+s)return!0;r=e.endFrame})),r}get frames(){const{clips:t}=this,{length:i}=t;if(!i)return e.Duration.None;for(const i of t){const{frames:t}=i;switch(t){case e.Duration.Unknown:case e.Duration.Unlimited:return t}}const n=Zi(t),{frame:s,frames:r}=n;return s+r}_identifier;get identifier(){return this._identifier||=yn("track")}index=0;_mash;get mash(){const{_mash:e}=this;return Fa(e),e}set mash(e){this._mash=e}removeClips(e){const t=this.clips.filter((t=>!e.includes(t)));V(t.length!==this.clips.length),e.forEach((e=>e.trackNumber=-1)),this.sortClips(t),Qi(this.clips,t)}selectType=e.SelectType.Track;selectables(){return[this,...this.mash.selectables()]}selectedItems(t){return this.properties.map((i=>{const n=this.value(i.name),s=this;return{value:n,property:i,selectType:e.SelectType.Track,changeHandler:(e,i)=>{I(e);const r={target:s,property:e,redoValue:i,undoValue:n};t.create(r)}}}))}sortClips(e){const t=e||this.clips,i=this.assureFrame(t);return t.sort(er),i}toJSON(){const e=super.toJSON();return e.clips=this.clips,e}}const tc=e=>new ec(e),ic={instance:tc};class nc extends Ba{get clips(){return[]}}class sc extends Sa{constructor(e){super(e);const{createdAt:t,icon:i,id:n,label:s,frame:r,preloader:o,rendering:a,tracks:c,...l}=e;this.dataPopulate(l),S(a)&&(this._rendering=a),S(t)&&(this.createdAt=t),v(r)&&(this._frame=r),C(c)&&c.forEach(((e,t)=>{const i={dense:!t,...e,index:t},n=tc(i);n.mash=this,n.assureFrames(this.quantize),n.sortClips(),this.tracks.push(n)})),this.assureTrack(),this.tracks.sort(tr),this._preview=new nc({mash:this,time:Jr()}),this.label||=Yr.mash.label}addClipToTrack(e,t=0,i=0,n){const s=b(e)?e:[e],r=this.trackClips(s,t);this.emitIfFramesChange((()=>{r.forEach((e=>{const[t,s]=e,r=this.tracks[t];Da(r,"track"),s.forEach((e=>{const i=e.trackNumber;f(i)&&i!==t&&e.track.removeClips([e]),f(n)&&(e.frame=n),e.track=r})),r.assureFrames(this.quantize,s),r.addClips(s,i)}))}))}addTrack(t={}){f(t.index)||(t.index=this.tracks.length);const i=tc(t);return i.mash=this,this.tracks.push(i),this.tracks.sort(tr),this.emitter?.emit(e.EventType.Track),i}assureTrack(){if(!this.tracks.length){const e=tc({dense:!0});e.mash=this,this.tracks.push(e)}}_buffer=Yr.mash.buffer;get buffer(){return this._buffer}set buffer(e){if(!v(e))throw dn.invalid.argument+"buffer "+e;this._buffer!==e&&(this._buffer=e,this._composition&&(this.composition.buffer=e))}bufferStart(){this._bufferTimer||(this._bufferTimer=setInterval((()=>{if(this._paused)return;this.loadPromiseUnlessBuffered({editing:!0,audible:!0});const e=this.clipsAudibleInTime(this.timeToBuffer);this.composition.bufferClips(e,this.quantize)}),Math.round(1e3*this.buffer/2)))}bufferStop(){this._bufferTimer&&(clearInterval(this._bufferTimer),delete this._bufferTimer)}_bufferTimer;changeTiming(e,t,i){this.emitIfFramesChange((()=>{e.setValue(i,t)}))}clearDrawInterval(){this.drawInterval&&(clearInterval(this.drawInterval),this.drawInterval=void 0)}clearPreview(){delete this._preview}clipIntersects(e,t){return!e.frames||e.timeRange(this.quantize).intersects(t)}get clips(){return this.tracks.map((e=>e.clips)).flat()}clipsAudibleInTime(e){const{clips:t}=this,i=t.filter((e=>e.mutable&&e.notMuted));return this.filterIntersecting(i,e)}clipsInTime(e){return this.filterIntersecting(this.clips,e)}clipsInTimeOfType(t,i=e.AVType.Both){switch(i){case e.AVType.Both:return this.clipsInTime(t);case e.AVType.Audio:return this.clipsAudibleInTime(t);case e.AVType.Video:return this.clipsVisibleInTime(t)}}get clipsVisible(){return this.clips.filter((e=>e.container))}clipsVisibleInTime(e){return this.filterIntersecting(this.clipsVisible,e)}compositeVisible(t){this.drawingTime=t,this.clearPreview(),this.emitter?.emit(e.EventType.Draw)}compositeVisibleRequest(e){requestAnimationFrame((()=>{this.compositeVisible(e)}))}_composition;get composition(){if(!this._composition){const e={buffer:this.buffer,gain:this.gain,preloader:this.preloader};this._composition=new $a(e)}return this._composition}get definitionIds(){const{clips:e}=this,t=e.flatMap((e=>e.definitionIds()));return[...new Set(t)]}destroy(){this.paused=!0,this.clearDrawInterval()}draw(){const{time:e}=this;this.compositeVisible(e)}drawInterval;drawRequest(){const{time:e}=this;this.compositeVisibleRequest(e)}drawTime(t){const i=t!==this.time;this.drawnTime=t,this.drawRequest(),this.emitter?.emit(i?e.EventType.Time:e.EventType.Loaded)}drawWhilePlayerNotPlaying(){const e=performance.now();if(e-this.drawnSeconds<1/this.quantize)return;this.drawnSeconds=e;const{time:t}=this;if(!this.clipsVisibleInTime(t).filter((e=>e.definition.streamable)).length)return;this.graphFilesUnloaded({time:t,editing:!0,visible:!0}).length||this.drawRequest()}drawingTime;drawnSeconds=0;drawnTime;get duration(){return this.endTime.seconds}emitIfFramesChange(t){const i=this.frames;t();const{frames:n}=this;i!==n&&(this.emitter?.emit(e.EventType.Duration),this.frame>n&&this.seekToTime(Jr(n,this.quantize)))}get endTime(){return Jr(this.frames,this.quantize)}filterGraphs(t={}){const{background:i,time:n,avType:s,graphType:r,size:o,videoRate:a,...c}=t,l=n||this.time,u=s||(l.isRange?e.AVType.Both:e.AVType.Video),h={...c,times:this.timeRanges(u,l),avType:u,graphType:r||e.GraphType.Mash,size:o||this.imageSize,videoRate:a||l.fps,mash:this,background:i||this.color};return new qa(h)}filterIntersecting(e,t){const i=t.scale(this.quantize);return e.filter((e=>this.clipIntersects(e,i)))}_frame=0;get frame(){return this.time.scale(this.quantize,"floor").frame}get frames(){const{tracks:t}=this;if(t.length){const t=this.tracks.map((e=>e.frames));return f(Math.min(...t))?Math.max(0,...t):e.Duration.Unknown}return e.Duration.None}_gain=Yr.mash.gain;get gain(){return this._gain}set gain(e){if(!f(e))throw dn.invalid.argument+"gain "+e;this._gain!==e&&(this._gain=e,this._composition&&this.composition.setGain(e,this.quantize))}graphFileOptions(e={}){const{time:t,audible:i,visible:n,editing:s,streaming:r}=e,o=t||this.time,{isRange:a}=o,c=n||!a,l=a&&i,u={editing:s,streaming:r,audible:l,visible:c,time:o,quantize:this.quantize};return V(c||l,"audible || visible"),u}editedGraphFiles(t){const i=this.graphFileOptions(t),{time:n,audible:s,visible:r}=i,{quantize:o}=this;O(n);const a=n.scale(this.quantize),c=s&&r?e.AVType.Both:s?e.AVType.Audio:e.AVType.Video;return this.clipsInTimeOfType(a,c).flatMap((e=>{const t=e.timeRange(o),s={...i,clipTime:t,quantize:o,time:n};return e.clipFileUrls(s)}))}graphFilesUnloaded(e){const t=this.editedGraphFiles(e);if(!t.length)return[];const{preloader:i}=this;return t.filter((e=>!i.loadedFile(e)))}handleDrawInterval(){const{seconds:t}=this.composition,i=this.time.withFrame(this.time.frame);if(t>=this.endTime.seconds)this.loop?this.seekToTime(this.time.withFrame(0)):(this.paused=!0,this.emitter?.emit(e.EventType.Ended));else if(t>=i.seconds){const e=Kr(t,this.time.fps);this.drawTime(e)}}_layer;get layer(){return this._layer}set layer(e){this._layer=e}loadPromise(e={}){return this.loadPromiseUnlessBuffered(e)||Promise.resolve()}loadingPromises=[];get loading(){return!!this.loadingPromises.length}loadPromiseUnlessBuffered(e={}){e.time||=this.timeToBuffer;const t=this.graphFilesUnloaded(e);if(!t.length)return;const i=this.preloader.loadFilesPromise(t),n=i.then((()=>{const e=this.loadingPromises.indexOf(i);if(e<0)throw dn.internal+"couldn't find promise~";this.loadingPromises.splice(e,1)}));return this.loadingPromises.push(i),n}loop=!1;get mashes(){return[this]}_paused=!0;get paused(){return this._paused}set paused(t){const i=t||!this.frames;if(this._paused!==i)if(this._paused=i,i)this.playing=!1,this.bufferStop(),this._bufferTimer&&(clearInterval(this._bufferTimer),delete this._bufferTimer),this.composition.stopContext(),this.emitter?.emit(e.EventType.Pause);else{this.composition.startContext(),this.bufferStart();const t=this.loadPromiseUnlessBuffered({editing:!0,audible:!0,visible:!0});t?t.then((()=>{this.playing=!0})):this.playing=!0,this.emitter?.emit(e.EventType.Play)}}_playing=!1;get playing(){return this._playing}set playing(t){if(this._playing!==t)if(this._playing=t,t){const{quantize:t,time:i}=this,n=this.clipsAudibleInTime(this.timeToBuffer);if(!this.composition.startPlaying(i,n,t)){const e=this.clipsAudibleInTime(this.timeToBuffer);if(!this.composition.startPlaying(i,e,t))return void(this._playing=!1)}this.emitter?.emit(e.EventType.Playing),this.setDrawInterval()}else this.composition.stopPlaying(),this.clearDrawInterval()}_preview;preview(e){return this._preview||=this.previewInitialize(e)}previewInitialize(e){return new Ba(this.previewArgs(e))}previewArgs(e={}){const{editor:t}=e,i=t?.selection.clip,n=Ia(i)?i:void 0,{drawingTime:s,time:r,quantize:o}=this,c={selectedClip:n,time:(s||r).scale(o),mash:this,...e};return a(e.background)&&(c.background=this.color),c}putPromise(){const{quantize:e,preloader:t}=this,i=this.clips.flatMap((t=>{const{container:i}=t;if(no(i)&&!i.intrinsicsKnown({editing:!0,size:!0})){const n={editing:!0,visible:!0,quantize:e,time:t.time(e),clipTime:t.timeRange(e)};return i.fileUrls(n)}return[]}));return t.loadFilesPromise(i)}removeClipFromTrack(e){const t=b(e)?e:[e];this.emitIfFramesChange((()=>{t.forEach((e=>{e.track.removeClips([e])}))}))}removeTrack(t){const i=f(t)?t:this.tracks.length-1;g(i),this.emitIfFramesChange((()=>{this.tracks.splice(i,1)})),this.emitter?.emit(e.EventType.Track)}_rendering="";get rendering(){return this._rendering}set rendering(t){this._rendering=t,this.emitter?.emit(e.EventType.Render)}restartAfterStop(t,i,n){t.equalsTime(this.time)&&(n&&(delete this.seekTime,this.emitter?.emit(e.EventType.Seeked)),this.drawTime(t),i||(this.playing=!0))}reload(){return this.stopLoadAndDraw()}seekTime;seekToTime(t){return this.seekTime!==t&&(this.seekTime=t,this.emitter?.emit(e.EventType.Seeking),this.emitter?.emit(e.EventType.Time)),this.stopLoadAndDraw(!0)}selectType=e.SelectType.Mash;selectables(){const e=[this];return this._layer&&e.push(...this.layer.selectables()),e}selectedItems(t){return this.properties.map((i=>{const n=this.value(i.name),s=this;return{value:n,selectType:e.SelectType.Mash,property:i,changeHandler:(e,i)=>{I(e);const r={property:e,target:s,redoValue:i,undoValue:n};t.create(r)}}}))}setDrawInterval(){this.drawInterval||(this.clearDrawInterval(),this.drawInterval=setInterval((()=>{this.handleDrawInterval()}),500/this.time.fps))}stopLoadAndDraw(e){const{time:t,paused:i,playing:n}=this;n&&(this.playing=!1);const s=this.loadPromiseUnlessBuffered({editing:!0,visible:!0,audible:n});if(s)return s.then((()=>{this.restartAfterStop(t,i,e)}));this.restartAfterStop(t,i,e)}previewItems(e){return this.preview(e).previewItemsPromise}get time(){return this.seekTime||this.drawnTime||Jr(this._frame,this.quantize)}get timeRange(){const{endTime:e,time:t}=this,i=e.scale(t.fps);return Wr(t,i.frame)}timeRanges(t,i){const n=i||this.time,{quantize:s}=this,r=n.scale(this.quantize,"floor"),o=r.isRange?r.timeRange.endTime:void 0,a=this.clipsInTimeOfType(n,t),{length:c}=a;if(!c)return[];if(1===c||!r.isRange||t===e.AVType.Audio)return[n];const l=new Set;a.forEach((e=>{l.add(Math.max(e.frame,r.frame)),l.add(Math.min(e.frame+e.frames,o.frame))}));const u=[...l].sort(((e,t)=>e-t));let h=u.shift();return u.map((e=>{const t=Ur(h,s,e-h);return h=e,t}))}get timeToBuffer(){const{time:e,quantize:t,buffer:i,paused:n}=this;return n?Jr(e.scale(t,"floor").frame,t):Hr(e,Kr(i+e.seconds,e.fps))}toJSON(){const e=super.toJSON();return e.tracks=this.tracks,this._rendering&&(e.rendering=this.rendering),e}trackClips(e,t){if(f(t))return[[t,e]];let i=this.tracks.length-e.length;return e.map((e=>[i++,[e]]))}tracks=[]}const rc=(e={})=>new sc(e),oc=e=>e instanceof sc;class ac extends li{constructor(t){super(),this.properties.push(cn({name:"label",type:e.DataType.String})),this.propertiesInitialize(t)}_cast;get cast(){return this._cast}set cast(e){this._cast=e}_id;get id(){return this._id||=yn("layer")}get mashes(){throw dn.unimplemented+"mashes"}selectType=e.SelectType.Layer;selectables(){return[this,...this.cast.selectables()]}selectedItems(t){return this.properties.map((i=>{const n=this.value(i.name),s=this;return{value:n,selectType:e.SelectType.Layer,property:i,changeHandler:(e,i)=>{I(e);const r={property:e,target:s,redoValue:i,undoValue:n};t.create(r)}}}))}toJSON(){const e=super.toJSON();return e.type=this.type,e.triggers=this.triggers,e}triggers=[];type}class cc extends ac{constructor(e){super(e);const{label:t,layers:i,collapsed:n}=e;t||(this.label=Yr.label),this.collapsed=n,this.layers=i}collapsed;layers;get mashes(){return this.layers.flatMap((e=>e.mashes))}toJSON(){const e=super.toJSON();return e.layers=this.layers,e.collapsed=this.collapsed,e}type=e.LayerType.Folder}class lc extends ac{constructor(e){super(e);const{mash:t}=e;this.label||(this.label=t.label),this.mash=t,t.layer=this}get mashes(){return[this.mash]}mash;toJSON(){const e=super.toJSON();return e.mash=this.mash,e}type=e.LayerType.Mash}const uc=e=>n(e)&&"type"in e&&G(e.type),hc=t=>uc(t)&&t.type===e.LayerType.Folder,dc=t=>uc(t)&&t.type===e.LayerType.Mash;e.LayerType.Folder,e.LayerType.Mash;const pc=(e,t)=>{const{preloader:i}=e;e.layers||=[];const n={...e,layers:e.layers.map((e=>fc({preloader:i,...e})))};return new cc(n)},mc=(e,t)=>{const{preloader:i}=e;e.mash||={};const n=rc({preloader:i,...e.mash}),s={...e,mash:n};return new lc(s)},fc=(e,t)=>{if(dc(e))return mc(e);if(hc(e))return pc(e);throw new Error("expected LayerObject")},gc=e=>e instanceof ac;function yc(e){if(!gc(e))throw"expected Layer"}const vc=e=>e instanceof lc;function Tc(e){if(!vc(e))throw"expected LayerMash"}const bc=e=>e instanceof cc;function wc(e){if(!bc(e))throw"expected LayerFolder"}const Fc=e=>e.flatMap((e=>bc(e)?[e,...Fc(e.layers)]:[])),Sc=(t,i)=>i===e.DroppingPosition.After?t+1:t,Ic=(e,t)=>{if(t.includes(e))return;return Fc(t).find((t=>t.layers.includes(e)))};class Cc extends Sa{constructor(e){super(e);const{createdAt:t,icon:i,id:n,label:s,definitions:r,layers:o,preloader:a,...c}=e;this.dataPopulate(c),C(o)&&this.layers.push(...o.map((e=>this.createLayer(e)))),this.label||=Yr.cast.label}addLayer(t,i={}){const{layers:n,index:s}=((t,i)=>{const{layer:n,position:s=e.DroppingPosition.At}=i,r=p(s),o=!!n,a=o&&bc(n),c=r?s:0;if(!o||r)return{index:c,layers:a?n.layers:t};if(a&&s===e.DroppingPosition.At)return{index:0,layers:n.layers};const l=Ic(n,t);if(!l)return{index:c,layers:t};const{layers:u}=l,h=u.indexOf(n);if(h<0)throw new Error(dn.internal);return{layers:u,index:Sc(h,s)}})(this.layers,i);n.splice(s,0,t)}_buffer=Yr.cast.buffer;get buffer(){return this._buffer}set buffer(e){if(!v(e))throw dn.invalid.argument+"buffer "+e;this._buffer!==e&&(this._buffer=e,this.mashes.forEach((t=>{t.buffer=e})))}createLayer(e){const{preloader:t}=this,i={preloader:t,...e},n=fc(i);return yc(n),n.cast=this,n}destroy(){this.mashes.forEach((e=>e.destroy()))}emitterChanged(){this.mashes.forEach((e=>e.emitter=this.emitter))}editedGraphFiles(e){return this.mashes.flatMap((t=>t.editedGraphFiles(e)))}get imageSize(){return super.imageSize}set imageSize(e){super.imageSize=e;const{imageSize:t}=this;this.mashes.forEach((e=>{e.imageSize=t}))}layers=[];get layerFolders(){return Fc(this.layers)}loadPromise(e){return Promise.all(this.mashes.map((t=>t.loadPromise(e)))).then(ut)}get loading(){return this.mashes.some((e=>e.loading))}get mashes(){return this.layers.flatMap((e=>e.mashes))}moveLayer(e,t){const i=this.removeLayer(e);return this.addLayer(e,t),i}putPromise(){return Promise.all(this.mashes.map((e=>e.putPromise()))).then(ut)}reload(){}removeLayer(e){const t=Ic(e,this.layers),i=t?.layers||this.layers,n=i.indexOf(e);if(n<0)throw console.error("removeLayer",n,i.length,e.label,t?.label),new Error(dn.internal);return i.splice(n,1),{position:n,layer:t}}selectType=e.SelectType.Cast;selectables(){return[this]}selectedItems(t){return this.properties.map((i=>{const n=this.value(i.name),s=this;return{value:n,selectType:e.SelectType.Cast,property:i,changeHandler:(e,i)=>{I(e);const r={property:e,target:s,redoValue:i,undoValue:n};t.create(r)}}}))}setValue(e,t,i){if(super.setValue(e,t,i),!i&&"color"===t)this.mashes.forEach((n=>n.setValue(e,t,i)))}previewItems(e){const{mashes:t,imageSize:i}=this,n=[],{background:s=this.color}=e,r={...e,color:""},o=Dn(i,Cn(i,"",s));let a=Promise.resolve([o]);return en(t).forEach((e=>{a=a.then((t=>(n.push(...t),e.previewItems(r))))})),a.then((e=>(n.push(...e),n)))}toJSON(){const e=super.toJSON();return e.layers=this.layers,e}}const xc=(e={},t)=>{const i={...e,preloader:t};return new Cc(i)},Dc=e=>e instanceof Cc;function Pc(e){if(!Dc(e))throw new Error("expected Cast")}const Ac=e=>wa(e)||Dc(e);class Vc{constructor(e){const{redoSelection:t,type:i,undoSelection:n}=e;this.redoSelection=t,this.type=i,this.undoSelection=n}get cast(){const{cast:e}=this.redoSelection;if(Dc(e))return e;const{cast:t}=this.undoSelection;return Pc(t),t}done=!1;get mash(){const{mash:e}=this.redoSelection;if(wa(e))return e;const{mash:t}=this.undoSelection;return Fa(t),t}redo(){this.redoAction(),this.done=!0}redoAction(){throw dn.unimplemented+"redoAction"}redoSelection;get selection(){return this.done?this.redoSelection:this.undoSelection}type;undo(){this.undoAction(),this.done=!1}undoAction(){throw dn.unimplemented+"undoAction"}undoSelection}const Ec=e=>e instanceof Vc;function zc(e){if(!Ec(e))throw new Error("expected Action")}class Oc extends Vc{constructor(e){super(e);const{createTracks:t}=e;this.createTracks=t}createTracks;redoAction(){for(let e=0;e<this.createTracks;e+=1)this.mash.addTrack()}undoAction(){for(let e=0;e<this.createTracks;e+=1)this.mash.removeTrack()}}class kc extends Oc{constructor(e){super(e);const{clips:t,insertIndex:i,trackIndex:n,redoFrame:s,undoFrame:r}=e;this.clips=t,this.insertIndex=i,this.trackIndex=n,this.redoFrame=s,this.undoFrame=r}clips;insertIndex;trackIndex;get track(){return this.mash.tracks[this.trackIndex]}redoAction(){super.redoAction();const{mash:e,redoFrame:t,trackIndex:i,insertIndex:n,clips:s}=this;e.addClipToTrack(s,i,n,t)}redoFrame;undoAction(){const{mash:e,clips:t}=this;e.removeClipFromTrack(t),super.undoAction()}undoFrame}class Rc extends Vc{constructor(e){super(e);const{effect:t,effects:i,index:n}=e;this.effect=t,this.effects=i,this.index=n}effect;effects;index;redoAction(){this.effects.splice(this.index,0,this.effect)}undoAction(){this.effects.splice(this.index,1)}}const Mc=e=>n(e)&&"target"in e&&"property"in e;class _c extends Vc{constructor(e){super(e);const{property:t,redoValue:i,target:n,undoValue:s}=e;this.property=t,this.redoValue=i,this.target=n,this.undoValue=s}property;redoValue;target;undoValue;get redoValueNumeric(){return Number(this.redoValue)}get undoValueNumeric(){return Number(this.undoValue)}redoAction(){this.target.setValue(this.redoValue,this.property)}undoAction(){this.target.setValue(this.undoValue,this.property)}updateAction(e){const{redoValue:t}=e;this.redoValue=t,this.redo()}}const $c=e=>e instanceof _c;class Nc extends _c{constructor(e){super(e)}redoAction(){this.mash.changeTiming(this.target,this.property,this.redoValueNumeric)}undoAction(){this.mash.changeTiming(this.target,this.property,this.undoValueNumeric)}}class jc extends Oc{constructor(e){super(e);const{clip:t,insertIndex:i,redoFrame:n,trackIndex:s,undoFrame:r,undoInsertIndex:o,undoTrackIndex:a}=e;this.clip=t,this.insertIndex=i,this.redoFrame=n,this.trackIndex=s,this.undoFrame=r,this.undoInsertIndex=o,this.undoTrackIndex=a}clip;insertIndex;trackIndex;undoTrackIndex;undoInsertIndex;undoFrame;redoFrame;addClip(e,t,i){this.mash.addClipToTrack(this.clip,e,t,i)}redoAction(){super.redoAction(),this.addClip(this.trackIndex,this.insertIndex,this.redoFrame)}undoAction(){this.addClip(this.undoTrackIndex,this.undoInsertIndex,this.undoFrame),super.undoAction()}}class Lc extends Vc{constructor(e){super(e);const{effects:t,redoEffects:i,undoEffects:n}=e;this.effects=t,this.redoEffects=i,this.undoEffects=n}effects;redoEffects;redoAction(){this.effects.splice(0,this.effects.length,...this.redoEffects)}undoAction(){this.effects.splice(0,this.effects.length,...this.undoEffects)}undoEffects}class qc extends Vc{constructor(e){super(e);const{clip:t,index:i,track:n}=e;this.clip=t,this.index=i,this.track=n}track;clip;index;get trackIndex(){return this.track.index}redoAction(){this.mash.removeClipFromTrack(this.clip)}undoAction(){this.mash.addClipToTrack(this.clip,this.trackIndex,this.index)}}class Gc extends Vc{constructor(e){super(e);const{layerAndPosition:t}=e;t&&(this.layerAndPosition=t)}layerAndPosition;get layer(){const{layer:e}=this.redoSelection;return yc(e),e}redoAction(){this.cast.addLayer(this.layer,this.layerAndPosition)}undoAction(){this.cast.removeLayer(this.layer)}}class Bc extends Vc{get layer(){const{layer:e}=this.redoSelection;return yc(e),e}layerAndPosition;redoAction(){this.layerAndPosition=this.cast.removeLayer(this.layer)}undoAction(){this.cast.addLayer(this.layer,this.layerAndPosition)}}class Uc extends Gc{get layer(){const{layer:e}=this.redoSelection;return yc(e),e}undoLayerAndPosition;redoAction(){this.undoLayerAndPosition=this.cast.moveLayer(this.layer,this.layerAndPosition)}undoAction(){this.cast.moveLayer(this.layer,this.undoLayerAndPosition)}}class Wc extends _c{constructor(e){const{redoValues:t,undoValues:i}=e;super(e),this.undoValues=i,this.redoValues=t}redoAction(){const{target:e,redoValues:t}=this;Object.entries(t).forEach((([t,i])=>{e.setValue(i,t)}))}redoValues;undoAction(){const{target:e,undoValues:t}=this;Object.entries(t).forEach((([t,i])=>{e.setValue(i,t)}))}updateAction(e){const{redoValues:t}=e;this.redoValues=t,this.redo()}undoValues}const Hc=t=>{const{type:i}=t;if(!S(i))throw dn.type+JSON.stringify(t);switch(i){case e.ActionType.AddClipToTrack:return new kc(t);case e.ActionType.AddEffect:return new Rc(t);case e.ActionType.AddLayer:return new Gc(t);case e.ActionType.AddTrack:return new Oc(t);case e.ActionType.Change:return new _c(t);case e.ActionType.ChangeFrame:return new Nc(t);case e.ActionType.ChangeMultiple:return new Wc(t);case e.ActionType.MoveClip:return new jc(t);case e.ActionType.MoveEffect:return new Lc(t);case e.ActionType.MoveLayer:return new Uc(t);case e.ActionType.RemoveClip:return new qc(t);case e.ActionType.RemoveLayer:return new Bc(t);default:throw dn.type+i}},Jc={createFromObject:Hc};class Kc{editor;constructor(e){this.editor=e}add(e){const t=this.instances.length-(this.index+1);f(t)&&this.instances.splice(this.index+1,t),this.instances.push(e)}get canRedo(){return this.index<this.instances.length-1}get canSave(){return this.canUndo}get canUndo(){return this.index>-1}create(t){const{editor:i}=this,{undoSelection:n,redoSelection:s,type:r=e.ActionType.Change,...o}=t,a={...o,type:r,undoSelection:n||{...i.selection.object},redoSelection:s||{...i.selection.object}};if(Mc(t)&&this.currentActionLast){const{currentAction:e}=this;if($c(e)){const{target:n,property:s}=t;if(e.target===n&&e.property===s)return e.updateAction(t),void i.handleAction(e)}}const c=Hc(a);this.add(c),i.handleAction(this.redo())}get currentAction(){return this.instances[this.index]}get currentActionLast(){return this.canUndo&&!this.canRedo}destroy(){this.index=-1,this.instances.splice(0,this.instances.length)}index=-1;instances=[];redo(){this.index+=1;const e=this.currentAction;return zc(e),e.redo(),e}reusableChangeAction(e,t){if(!this.currentActionLast)return;const i=this.currentAction;return $c(i)&&i.target===e&&i.property===t?i:void 0}save(){this.instances.splice(0,this.index+1),this.index=-1}get selection(){return this.editor.selection}undo(){const e=this.currentAction;return zc(e),this.index-=1,e.undo(),e}}const Yc=e=>n(e)&&"cast"in e,Xc=e=>n(e)&&"mash"in e;function Zc(e,t){Xc(e)||i(e,"MashData",t)}class Qc extends EventTarget{dispatch(e,t){this.dispatchEvent(this.event(e,t))}emit(e,t){if(!this.trapped.has(e))return void this.dispatch(e,t);const i=this.trapped.get(e);i&&i(this.event(e,t))}event(e,t){return new CustomEvent(e,t?{detail:t}:void 0)}trap(e,t){this.trapped.has(e)||this.trapped.set(e,t||null)}trapped=new Map}const el=t=>hi(t)&&t.type===e.DefinitionType.Effect;function tl(e){if(!el(e))throw new Error("expected Effect")}const il=t=>ft(t)&&t.type===e.DefinitionType.Font;class nl{constructor(e){this.endpoint=e||{}}absoluteUrl(e){return e}browsing=!0;cacheGet(e,t){const i=this.key(e),n=this.cacheKey(e),s=this.loaderCache.get(n);if(s||!t)return s;const{definition:r,type:o}=e,a=[];ft(r)&&a.push(r);const c={loaded:!1,definitions:a};return this.cacheSet(n,c),c.promise=this.cachePromise(i,e,c).then((e=>(c.loaded=!0,c.result=e,e))).catch((e=>(c.error=e,c.loaded=!0,e))),c}cacheKey(e){const{type:t}=e;return`${t}:/${this.key(e)}`}cachePromise(e,t,i){const n={loaderPath:this.cacheKey(t),urlOrLoaderPath:e,loaderType:t.type};return this.filePromise(n)}cacheSet(e,t){const i=r(e)?e:this.cacheKey(e);this.loaderCache.set(i,t)}endpoint;filePromise(e){throw dn.unimplemented+"filePromise"}flushFilesExcept(e=[]){const t=e.map((e=>this.cacheKey(e)));[...this.loaderCache.keys()].filter((e=>!t.includes(e))).forEach((e=>{this.loaderCache.get(e)&&this.loaderCache.delete(e)}))}getCache(e){const t=this.parseUrlPath(e),[i]=t;return s(i),this.loaderCache.get(i.loaderPath)}getError(e){return this.cacheGet(e)?.error}getLoaderCache(t,i,n){const{loaderPath:s,loaderType:r}=t,o=this.loaderCache.get(s);if(o||!i)return o;const a=[];ft(n)&&a.push(n);const c={loaded:!1,definitions:a};return r!==e.GraphFileType.Svg&&this.setLoaderCache(s,c),c.promise=this.filePromise(t).then((e=>(c.loaded=!0,c.result=e,e))).catch((e=>(c.error=e,c.loaded=!0,e))),c}imagePromise(e){const t=new Image;return t.src=e,t.decode().then((()=>t))}info(e){e||console.trace(this.constructor.name,"info NO loaderPath");const t=this.parseUrlPath(e);t.reverse();for(const e of t){const t=this.loaderCache.get(e.urlOrLoaderPath);if(!t)continue;const{loadedInfo:i}=t;if(D(i))return i}}key(e){throw dn.unimplemented+"key"}lastCssUrl(e){const t=[...e.matchAll(/url\(([^)]+)\)(?!.*\1)/g)];return Zi(Zi(t))}loadFilesPromise(e){const t=e.map((e=>this.loadGraphFilePromise(e)));return Promise.all(t).then(ut)}loadGraphFilePromise(e){const{type:t,file:i,definition:n}=e,s=`${t}:/${i}`;return this.loadPromise(s,n)}loadPromise(e,t){const i=this.loaderCache.get(e);if(i){const{promise:e,result:t,loaded:n,error:r}=i;return n||r?Promise.resolve(t):(s(e),e)}const n=this.parseUrlPath(e);n.reverse();const r=n.shift();s(r);let o=this.loaderFilePromise(r,t);return n.forEach((e=>{o=o.then((()=>this.loaderFilePromise(e)))})),o.then((e=>e))}loadedFile(e){return!!this.cacheGet(e)?.loaded}loaderCache=new Map;loaderFilePromise(e,t){let i=this.getLoaderCache(e,!0,t);s(i);const{promise:n,result:r,loaded:o,error:a}=i;return r&&o&&!a?Promise.resolve(r):(s(n),n)}media(e){const t=this.loaderCache.get(e);if(t){const{result:e,loaded:i,error:n}=t;if(i||n)return e}}parseUrlPath(e){I(e);return as(e,this.endpoint).map((e=>{const[t,i,n]=e,s=`${t}:${i}/${n}`;Jn(t);return{loaderPath:s,urlOrLoaderPath:n,loaderType:t,options:cs(i)}}))}setLoaderCache(e,t){this.loaderCache.set(e,t)}sourceUrl(t){const i=this.cacheGet(t);if(!i?.loaded)return this.key(t);const{type:n}=t,{result:r}=i;switch(s(r),n){case e.LoadType.Image:case e.LoadType.Video:return r.src}return""}updateDefinitionDuration(e,t,i){const{duration:n}=e;v(n)||(e.duration=t),i&&(e.audio=!0)}updateDefinitionSize(e,t,i){const n=this.browsing?"previewSize":"sourceSize",{[n]:s}=e;Ai(t,s)||(e[n]=t),e.alpha||=i}updateDefinitionFamily(e,t){const{family:i}=e;i||(e.family=t)}updateCache(e,t){e.loadedInfo||={};const{definitions:i,loadedInfo:s}=e,{duration:r,width:o,height:a,audible:c,family:l,info:u,alpha:h}=t,d={width:o,height:a},p=v(r),m=_i(d),f=n(u);m&&(s.width||=d.width,s.height||=d.height),p&&(c&&(s.audible=!0),s.duration||=r),l&&(s.family||=l),i.forEach((e=>{f&&kr(e)&&(e.info||=u),m&&Nr(e)&&this.updateDefinitionSize(e,d,h),p&&ka(e)&&this.updateDefinitionDuration(e,r,c),l&&il(e)&&this.updateDefinitionFamily(e,l)}))}updateLoaderFile(e,t){const i=this.getLoaderCache(e);s(i),this.updateCache(i,t)}updateDefinitions(e,t){const i=this.cacheGet(e);s(i),this.updateCache(i,t)}videoPromise(e){return new Promise(((t,i)=>{const n=this.videoFromUrl(e);n.oncanplay=()=>{n.oncanplay=null,n.onerror=null;const{videoWidth:e,clientWidth:i,videoHeight:s,clientHeight:r}=n,o=e||i,a=s||r;n.width=o,n.height=a,t(n)},n.onerror=i,n.autoplay=!1,n.load()}))}videoFromUrl(e){if(!globalThis.document)throw"wrong environment";const t=globalThis.document.createElement("video");return t.src=e,t}}class sl extends nl{constructor(e){super(e);const[t,i]=this.canvasContext({width:1,height:1});i.fillRect(0,0,1,1),this.svgImagePromise(t.toDataURL()).then((()=>{this.svgImageEmitsLoadEvent=!0}))}absoluteUrl(e){return is(this.endpoint,e)}arrayBufferPromise(e){return fetch(e).then((e=>e.arrayBuffer()))}audioBufferPromise(e){return Ta.decode(e)}audioInfo(e){const{duration:t}=e;return{duration:t,audible:!0}}audioPromise(e){I(e,"url");return(e.startsWith("blob:")?this.blobAudioPromise(e):this.arrayBufferPromise(e)).then((e=>this.audioBufferPromise(e)))}blobAudioPromise(e){return fetch(e).then((e=>e.blob())).then((e=>new Promise(((t,i)=>{const n=new FileReader;n.onload=()=>{t(n.result)},n.onerror=i,n.readAsArrayBuffer(e)}))))}svgImageEmitsLoadEvent=!1;canvas(e){const{width:t,height:i}=e,n=document.createElement("canvas");return n.height=i,n.width=t,n}canvasContext(e){const t=this.canvas(e),i=t.getContext("2d");return V(i),[t,i]}copyVideoPromise(e,t){s(t);const i=e.split(":").pop();I(i);const n=this.seekingVideos.get(i);if(n)return Promise.resolve(n);const r=this.seekingVideoPromises.get(i);if(r)return r;const o=this.sourcePromise(e).then((e=>this.videoPromise(e).then((e=>this.seekPromise(i,Kr(1),e).then((()=>(this.seekingVideos.set(i,e),e)))))));return this.seekingVideoPromises.set(i,o),o}filePromise(t){const{loaderType:i}=t;switch(i){case e.LoadType.Audio:return this.requestAudio(t);case e.LoadType.Font:return this.requestFont(t);case e.LoadType.Image:return this.requestImage(t);case e.LoadType.Video:return this.requestVideo(t);case e.GraphFileType.Svg:return this.requestSvgImage(t)}throw dn.invalid.type+i}filePromises(t,i){return t.map((t=>{const{name:n,type:s}=t,r=s.split("/").shift(),o={label:n,error:""};if(!fe(r))return Promise.resolve({...o,error:"import.type",value:r});const a=fn(),c=us("object",a),l=URL.createObjectURL(t),u={type:r,label:n,url:us(r,c),source:l,id:gn()},h=r===e.LoadType.Audio,d=r===e.LoadType.Image,p=h||r===e.LoadType.Video,m=r===e.LoadType.Image||r===e.LoadType.Video;return this.mediaPromise(r,l).then((e=>{const t=this.mediaInfo(e);if(p){const{duration:e}=t;if(!v(e))return{...o,error:"import.duration",value:e};u.audio=!0,u.duration=e,u.audioUrl=m?us("video",c):c}if(m){const n=qi(t);if(!_i(n))return{...o,error:"import.size",value:Bi(n)};const s=i?Mi(n,i,!0):n,{width:r,height:a}=s;u.previewSize=s,d?(u.icon=us("image",c,{width:r,height:a}),u.loadedImage=e):(u.icon=us("video",c,{fps:10,frame:10}),u.loadedVideo=e)}else u.loadedAudio=e;return this.loadLocalFile(e,c,t),u}))}))}fontFamily(e){return e.replaceAll(/[^a-z0-9]/gi,"_")}imageInfo(e){return qi(e)}key(e){const{file:t,type:i}=e;return de(i)?is(this.endpoint,t):t}loadLocalFile(e,t,i){const n={definitions:[],result:e,loadedInfo:i,promise:Promise.resolve(e),loaded:!0};this.setLoaderCache(t,n)}mediaInfo(e){return Bn(e)?this.videoInfo(e):Un(e)?this.imageInfo(e):this.audioInfo(e)}mediaPromise(t,i){switch(pe(t),I(i,"url"),t){case e.LoadType.Audio:return this.audioPromise(i);case e.LoadType.Image:return this.imagePromise(i);case e.LoadType.Video:return this.videoPromise(i)}throw dn.internal}requestAudio(e){const{urlOrLoaderPath:t,options:i}=e;I(t,"urlOrLoaderPath");const n=Zn(t),r=!n&&t.startsWith("video:");if(!n&&!r)return this.loadPromise(t);return(n?this.audioPromise(t):this.requestVideoAudio(e)).then((t=>(s(t),this.updateLoaderFile(e,this.audioInfo(t)),t)))}requestFont(t){const{urlOrLoaderPath:i}=t,n=fetch(i).then((t=>{const i=t.headers.get("content-type");return!S(i)||i.startsWith(e.LoadType.Font)?t.arrayBuffer():(V(i.startsWith("text/css")),t.text().then((e=>this.arrayBufferPromise(this.lastCssUrl(e)))))})),s=this.fontFamily(i);return n.then((e=>new FontFace(s,e).load())).then((e=>{const{fonts:i}=globalThis.document;return i.add(e),i.ready.then((()=>{const i={family:s};return this.updateLoaderFile(t,i),e}))}))}requestImage(e){const{urlOrLoaderPath:t}=e;return Zn(t)?this.imagePromise(t).then((t=>{const{width:i,height:n}=t,s={width:i,height:n};return this.updateLoaderFile(e,s),t})):this.requestLoadedImage(e)}requestLoadedImage(t){const{urlOrLoaderPath:i,options:n}=t,s=this.loadPromise(i);return i.split(":").shift()===e.LoadType.Video||n?s.then((e=>{const t=qi(e),i=_i(n)?Mi(t,n):t,{width:s,height:r}=i,[o,a]=this.canvasContext(i);return a.drawImage(e,0,0,s,r),this.imagePromise(o.toDataURL())})):s}requestSvgImage(e){const{urlOrLoaderPath:t,options:i}=e;return this.sourcePromise(t).then((e=>{const t=this.svgImagePromise(e);return i?t.then((e=>{const{lock:t,...n}=i,s=ke(t)?t:void 0;return Pn(e,n,s),e})):t}))}requestVideo(e){const{urlOrLoaderPath:t,options:i}=e;Xn(t);const n=Zn(t);return i?this.seekingVideoPromise(t,i):n?this.videoPromise(t).then((t=>{const i=this.videoInfo(t);return this.updateLoaderFile(e,i),t})):this.loadPromise(t)}requestVideoAudio(e){const{urlOrLoaderPath:t}=e;return this.loadPromise(t).then((e=>{const{src:t}=e;return I(t),this.audioPromise(t)}))}seek(e,t){if(!t)throw dn.internal+"seek";t.currentTime=e.seconds}seekNeeded(e,t){const{currentTime:i}=t;if(!i&&!e.frame)return!0;return!Kr(i,e.fps).equalsTime(e)}seekPromise(e,t,i){const n=new Promise((n=>{if(!this.seekNeeded(t,i))return this.seekingPromises.delete(e),n(i);i.onseeked=()=>{i.onseeked=null,this.seekingPromises.delete(e),n(i)},this.seek(t,i)})),s=this.seekingPromises.get(e);return this.seekingPromises.set(e,n),s?s.then((()=>n)):n}seekingVideoPromise=(e,t)=>{s(t);const i=e.split(":").pop();return I(i),this.copyVideoPromise(e,t).then((e=>{const{frame:n=0,fps:s}=t;g(n),g(s);const r=Jr(n,s);return this.seekPromise(i,r,e)}))};seekingVideoPromises=new Map;seekingPromises=new Map;seekingVideos=new Map;sourcePromise(e){return Zn(e)?Promise.resolve(e):this.loadPromise(e).then((e=>{s(e);const{src:t}=e;return I(t),t}))}_svgElement;get svgElement(){return this._svgElement||=Dn()}set svgElement(e){this._svgElement=e}svgImagePromise(e){return new Promise(((t,i)=>{const n=An(),s=()=>{n.removeEventListener("error",r),n.removeEventListener("load",o),this.svgImageEmitsLoadEvent||this.svgElement.removeChild(n)},r=e=>{s(),i(e)},o=()=>{s(),t(n)};n.addEventListener("error",r,{once:!0}),n.addEventListener("load",o,{once:!0}),this.svgImageEmitsLoadEvent||this.svgElement.appendChild(n),_n(n,e,"href")}))}videoInfo(e){const{duration:t,videoWidth:i,clientWidth:n,videoHeight:s,clientHeight:r}=e,o=i||n,a=s||r,c=e;let l=c.mozHasAudio;l||=Boolean(c.webkitAudioDecodedByteCount),l||=Boolean(c.audioTracks?.length),l||console.log(Object.values(e));return{width:o,height:a,duration:t,audible:l}}}class rl{get[e.SelectType.None](){}get[e.SelectType.Cast](){const{cast:e}=this._object;if(Dc(e))return e}get[e.SelectType.Clip](){const{clip:e}=this._object;if(Ia(e))return e}get[e.SelectType.Layer](){const{layer:e}=this._object;if(gc(e))return e}get[e.SelectType.Mash](){const{mash:e}=this._object;if(wa(e))return e;const{layer:t}=this;return vc(t)?t.mash:void 0}get[e.SelectType.Track](){const{clip:e,track:t}=this._object;return xa(t)?t:Ia(e)?e.track:void 0}get[e.SelectType.Container](){const{clip:e}=this._object;if(Ia(e))return e.container}get[e.SelectType.Content](){const{clip:e}=this._object;if(Ia(e))return e.content}get[e.SelectType.Effect](){const{effect:e}=this._object;if(el(e))return e}_editor;get editor(){return this._editor}set editor(e){this._editor=e}_focus=e.SelectType.Mash;get focus(){return this._focus}set focus(e){this._focus=e}get(e){return this[e]}unset(e){const t=this.object[e];if(!t)return;const i=t.selectables();V(i[0]===t),i.shift(),this.object=this.selectionFromSelectables(i)}set(e){const{selectType:t}=e;this.object={[t]:e}}_object={};get object(){return Object.fromEntries(X.map((e=>[e,this.get(e)])))}set object(t){const i=this.selectionPopulated(t),{object:n}=this;this.clear(),Object.assign(this._object,i);const{object:s}=this,{mash:r,cast:o,clip:a}=n,{mash:c,cast:l,clip:u}=s;u!==a&&(Ia(u)&&f(u.trackNumber)&&u.track.mash.clearPreview(),Ia(a)&&f(a.trackNumber)&&a.track.mash.clearPreview()),Object.assign(this._object,i),this.editor.eventTarget.emit(e.EventType.Selection),l!==o&&this.editor.eventTarget.emit(e.EventType.Cast),c!==r&&(this.editor.eventTarget.emit(e.EventType.Mash),this.editor.eventTarget.emit(e.EventType.Track),this.editor.eventTarget.emit(e.EventType.Duration))}clear(){X.forEach((e=>{delete this._object[e]}))}selectionFromSelectables(e){return Object.fromEntries(e.map((e=>[e.selectType,e])))}selectionPopulated(e){const{mash:t,object:i}=this,{cast:n}=i,{clip:s,track:r,layer:o,cast:a,mash:c,effect:l}=e,u=l||s||r||c||o||a||n||t;return V(u,"target"),this.selectionFromSelectables(u.selectables())}get selectTypes(){const t=[],{mash:i,object:n}=this,{clip:s,track:r,cast:o,layer:a,effect:c}=n;return o&&(t.push(e.SelectType.Cast),a&&t.push(e.SelectType.Layer)),i?(o||t.push(e.SelectType.Mash),r?(t.push(e.SelectType.Track),Ia(s)?(t.push(e.SelectType.Clip),t.push(e.SelectType.Content),el(c)&&t.push(e.SelectType.Effect),S(s.containerId)&&t.push(e.SelectType.Container),t):t):t):t}selectedItems(e=X){const{selectTypes:t,object:i}=this,n=t.filter((t=>e.includes(t))),{clip:s}=i;return n.flatMap((e=>{let t=i[e];return ee(e)&&Ia(s)&&(t=s[e]),V(t,e),t.selectedItems(this.editor.actions)}))}}const ol=()=>new rl,al=t=>ft(t)&&t.type===e.DefinitionType.Video,cl=t=>hi(t)&&t.definition.type===e.DefinitionType.Video;const ll=t=>ft(t)&&t.type===e.DefinitionType.Image;class ul{constructor(e){const{autoplay:t,precision:i,loop:n,fps:s,volume:r,buffer:o,endpoint:a,preloader:c,editType:l,readOnly:h,dimensions:d,edited:m}=e,f=bi(d)?Ii(d):Si,g=Di(d)?qi(d):Vi;this._rect={...f,...g},H(l)&&(this._editType=l),h&&(this.readOnly=!0),this.editing=!this.readOnly,u(t)&&(this.autoplay=t),p(i)&&(this.precision=i),u(n)&&(this._loop=n),p(s)&&(this._fps=s),p(r)&&(this._volume=r),p(o)&&(this._buffer=o),this.actions=new Kc(this),this.preloader=c||new sl(a),m&&this.load(m)}actions;add(t,i){const n=b(t)?t:[t];if(!n.length)return Promise.resolve([]);const s=n.map((e=>(P(e),yt.fromObject(e))));if(!i)return Promise.resolve(s);const r=s.map((t=>{const{id:i,type:n}=t,s={};return Or(t)?s.contentId=i:s.containerId=i,n===e.DefinitionType.Audio&&(s.containerId=""),Ha.instanceFromObject(s)})),o={editing:!0,duration:!0},a=r.filter((e=>e.intrinsicsKnown(o))).flatMap((e=>e.intrinsicGraphFiles(o))),{preloader:c}=this;return c.loadFilesPromise(a).then((()=>this.addClip(r,i).then((()=>s))))}addClip(t,i){const{clip:n=0,track:s=0}=i,r=b(t)?t:[t],[o]=r;if(!o)return Promise.resolve();return this.assureMash(t).then((()=>{const{mash:t}=this.selection;Fa(t);const{tracks:i}=t,{length:a}=i;T(a);const c=f(s),l=c?i[s]:void 0,u=l?.clips||[],h=l?.dense,d={...this.selection.object,clip:o},p=c?0:r.length,m={clips:r,type:e.ActionType.AddClipToTrack,trackIndex:s,redoSelection:d,createTracks:p};if(h){const e=f(n)?n:u.length;m.insertIndex=e}else if(p)m.redoFrame=f(n)?n:0;else{Da(l);const e=f(n)?n:l.frames;m.redoFrame=l.frameForClipNearFrame(o,e)}return this.actions.create(m),this.loadMashAndDraw()}))}addEffect(t,i=0){const{clip:n}=this.selection;if(!Ia(n))throw console.error(this.constructor.name,"addEffect expected effectable selection"),dn.selection+"effectable";const{content:s}=n;zr(s);const{effects:r}=s;if(!r)throw dn.selection;const o=[...r],a=[...r];a.splice(i,0,t);const c={effects:r,undoEffects:o,redoEffects:a,redoSelection:{...this.selection.object,effect:t},type:e.ActionType.MoveEffect};return this.actions.create(c),this.loadMashAndDraw()}addFiles(t,i){const{preloader:n,eventTarget:r,rect:o}=this;let a=Promise.resolve([]);return n.filePromises(t,o).forEach((t=>{a=a.then((i=>{const o={id:yn("activity"),type:e.ActivityType.Analyze};return r.emit(e.EventType.Active,o),t.then((t=>{const a={...o},{label:c}=t;if(a.label=c,mt(t)){i.push(t);const{url:r,type:o}=t;I(r);const c=n.info(r);s(c),a.type=e.ActivityType.Complete,a.value=c}else{const{error:i,value:n}=t;a.type=e.ActivityType.Error,a.error=i,a.value=n}return r.emit(e.EventType.Active,a),i}))}))})),a.then((t=>this.add(t,i).then((t=>{if(t.length){const i=tn(t.map((e=>e.type)));this.eventTarget.emit(e.EventType.Added,{definitionTypes:i})}return t}))))}addFolder(t,i){const{cast:n}=this.selection;Pc(n);const s=n.createLayer({type:e.LayerType.Folder,label:t});wc(s);const r={cast:n,layer:s},o={type:e.ActionType.AddLayer,redoSelection:r,layerAndPosition:i};this.actions.create(o)}addMash(t,i){const{cast:n}=this.selection;Pc(n);const s=t?.mashObject||{},r=t?.definitionObjects||[];yt.define(...r);const o={type:e.LayerType.Mash,mash:s},a=n.createLayer(o);Tc(a);const{mash:c}=a;this.configureMash(c);const l={cast:n,layer:a,mash:c},u={type:e.ActionType.AddLayer,redoSelection:l,layerAndPosition:i};this.actions.create(u)}addTrack(){const{mash:t,cast:i}=this.selection,n={mash:t,cast:i};this.actions.create({redoSelection:n,type:e.ActionType.AddTrack,createTracks:1})}assureMash(t){const{selection:i,editType:n}=this,{mash:s}=i;if(!wa(s)){const i=b(t)?t[0]:t,{label:s}=i.content.definition,r={label:s};if(n===e.EditType.Mash)return this.load({mash:r});this.addMash({mashObject:r,definitionObjects:[]})}return Promise.resolve()}autoplay=Yr.editor.autoplay;_buffer=Yr.editor.buffer;get buffer(){return this._buffer}set buffer(e){const t=Number(e);if(this._buffer!==t){this._buffer=t;const{edited:e}=this;e&&(e.buffer=t)}}can(t){const{selection:i}=this,{track:n,clip:s,mash:r,layer:o}=i;switch(t){case e.MasherAction.Save:return this.actions.canSave;case e.MasherAction.Undo:return this.actions.canUndo;case e.MasherAction.Redo:return this.actions.canRedo;case e.MasherAction.Remove:return!!(s||n||o);case e.MasherAction.Render:return!this.actions.canSave&&!(!r?.id||vn(r.id));default:throw dn.argument+"can"}}castDestroy(){const{cast:e}=this.selection;return!!e&&(e.destroy(),this.preloader.flushFilesExcept(),!0)}clearActions(){this.actions.instances.length&&(this.actions=new Kc(this),this.eventTarget.emit(e.EventType.Action))}get clips(){return this.selection.mash.clips}configureCast(e){return this.configureEdited(e),e.loadPromise({editing:!0,visible:!0}).then((()=>{this.selection.set(e),this.handleDraw()}))}configureEdited(e){e.editor=this;const{rect:t}=this;_i(t)&&(e.imageSize=qi(t)),e.emitter=this.eventTarget}configureMash(e){return e.buffer=this.buffer,e.gain=this.gain,e.loop=this.loop,this.configureEdited(e),e.loadPromise({editing:!0,visible:!0}).then((()=>{this.selection.set(e),this.handleDraw()}))}create(){this.load({[this.editType]:{}})}get currentTime(){const{mash:e}=this.selection;return e&&e.drawnTime?e.drawnTime.seconds:0}dataPutRequest(){const{edited:e,editType:t}=this;s(e),J(t);const{label:i}=e;if(!S(i)){const i=Yr[t].label;I(i,"defaultLabel"),e.setValue(i,"label")}return e.putPromise().then((()=>{if(wa(e))return{mash:e.toJSON(),definitionIds:e.definitionIds};if(Dc(e))return{cast:e.toJSON(),definitionIds:Object.fromEntries(e.mashes.map((e=>[e.id,e.definitionIds])))};throw new Error(dn.internal)}))}define(e){(Array.isArray(e)?e:[e]).forEach((e=>{const{id:t,type:i}=e;if(I(t,"define id"),yt.fromId(t))return void console.warn(this.constructor.name,"define NOT redefining",t);Te(i);const n=lt[i].definition(e);yt.install(n)}))}get definitions(){const{mashes:e}=this,t=[...new Set(e.flatMap((e=>e.definitionIds)))].map((e=>yt.fromId(e)));return t}get definitionsUnsaved(){const{definitions:e}=this;return e.filter((e=>{const{type:t,id:i}=e;return!!de(t)&&vn(i)}))}destroy(){this.castDestroy()||this.mashDestroy()}dragging=!1;drawTimeout;get duration(){return this.selection.mash?.duration||0}_editType;get editType(){return this._editType||(this._editType=this.editingCast?e.EditType.Cast:e.EditType.Mash),this._editType}get edited(){return this.selection.cast||this.selection.mash}editedData;editing;get editingCast(){return!!this.selection.cast}get endTime(){const{mash:e}=this.selection;return e?e.endTime.scale(this.fps,"floor"):Jr()}eventTarget=new Qc;_fps=Yr.editor.fps;get fps(){return this._fps||this.selection.mash?.quantize||Yr.editor.fps}set fps(t){const i=Number(t);this._fps!==i&&(this._fps=i,this.eventTarget.emit(e.EventType.Fps),this.time=this.time.scale(this.fps))}get frame(){return this.time.frame}set frame(e){this.goToTime(Jr(Number(e),this.fps))}get frames(){return this.endTime.frame}get gain(){return this.muted?0:this.volume}goToTime(e){const{fps:t,time:i}=this,{frame:n}=i,s=e?e.scaleToFps(t):Jr(0,t),{frame:r}=s,{frame:o}=this.endTime,a=o-1,c=a<1?0:Math.min(r,a);if(e&&n===c)return Promise.resolve();const l=this.selection.mash?.seekToTime(Jr(c,t));return l||Promise.resolve()}handleAction(t){const{edited:i}=this;V(i);const{selection:n}=t,{mash:s}=n;if(wa(s)&&(s.clearPreview(),t instanceof _c)){const{property:e,target:i}=t;if("gain"===e)Ia(i)&&s.composition.adjustClipGain(i,s.quantize)}this.selection.object=n;(i.reload()||Promise.resolve()).then((()=>{s||this.handleDraw(),this.eventTarget.emit(e.EventType.Action,{action:t})}))}handleDraw(t){!this.drawTimeout&&this.edited?.loading&&(this.drawTimeout=setTimeout((()=>{this.eventTarget.dispatch(e.EventType.Draw),delete this.drawTimeout}),10))}load(e){return this.editedData=e,this.loadEditedData()}loadCastData(t={}){const{cast:i={},definitions:n=[]}=t;yt.undefineAll(),yt.define(...n),this.eventTarget.trap(e.EventType.Draw,this.handleDraw.bind(this));const s=xc(i,this.preloader);return this.configureCast(s)}loadEditedData(){const{rect:e,editedData:t}=this;return _i(e)?(s(t),delete this.editedData,this.destroy(),this.paused=!0,this.clearActions(),this.selection.clear(),Yc(t)?this.loadCastData(t):(Zc(t),this.loadMashData(t).then((()=>this.goToTime().then((()=>{const{edited:e}=this;wa(e)&&e.clearPreview(),this.autoplay&&(this.paused=!1)})))))):Promise.resolve()}loadMashAndDraw(){const{mash:e}=this.selection;if(!e)throw new Error(dn.selection);const t={editing:!0,visible:!0};return this.paused||(t.audible=!0),e.loadPromise(t).then((()=>{e.draw()}))}loadMashData(e={}){const{mash:t={},definitions:i=[]}=e;yt.undefineAll(),yt.define(...i);const n=rc({...t,preloader:this.preloader});return this.mashDestroy(),this.configureMash(n)}_loop=Yr.editor.loop;get loop(){return this._loop}set loop(e){const t=!!e;this._loop=t;const{mash:i}=this.selection;i&&(i.loop=t)}mashDestroy(){const{mash:e}=this.selection;return!!e&&(e.destroy(),this.preloader.flushFilesExcept(),!0)}get mashes(){const{edited:e}=this;return e?Dc(e)?e.mashes:[e]:[]}move(e,t={}){if(P(e,"clip"),Ia(e))return void this.moveClip(e,t);tl(e);const{clip:i=0}=t;this.moveEffect(e,i)}moveClip(t,i={}){Ca(t);const{clip:n=0,track:s=0}=i;g(n);const{mash:r}=this.selection;Fa(r);const{tracks:o}=r,{trackNumber:a}=t,c={clip:t,trackIndex:s,undoTrackIndex:a,type:e.ActionType.MoveClip},l=!f(s);l&&(c.createTracks=1);const u=f(a)&&o[a].dense,h=f(s)&&o[s].dense,d=l?-1:o[s].clips.indexOf(t);if(h&&(c.insertIndex=n),u&&(c.undoInsertIndex=d,n<d&&(c.undoInsertIndex+=1)),!h||!u){const{frame:e}=t,i=(l?0:o[s].frameForClipNearFrame(t,n))-e;if(!i&&s===a)return;c.undoFrame=e,c.redoFrame=e+i}this.actions.create(c)}moveEffect(t,i=0){if(!f(i))throw dn.argument+"index";const{clip:n}=this.selection;if(!n)throw dn.selection;Ca(n);const s=n.content;zr(s);const{effects:r}=s,o=[...r],a=o.filter((e=>e!==t)),c=o.indexOf(t)<i?i-1:i;a.splice(c,0,t);const l={effects:r,undoEffects:o,redoEffects:a,type:e.ActionType.MoveEffect,effectable:s};this.actions.create(l)}moveLayer(t,i){const{cast:n}=this.selection;Pc(n),yc(t);const s={cast:n,layer:t},r={type:e.ActionType.MoveLayer,redoSelection:s,layerAndPosition:i};this.actions.create(r)}moveTrack(){console.debug(this.constructor.name,"moveTrack coming soon...")}_muted=!1;get muted(){return this._muted}set muted(e){const t=!!e;if(this._muted!==t){this._muted=t;const{mash:e}=this.selection;e&&(e.gain=this.gain)}}pause(){this.paused=!0}get paused(){const{mash:e}=this.selection;return!e||e.paused}set paused(e){const{mash:t}=this.selection;t&&(t.paused=e),e&&this.redraw()}play(){this.paused=!1}get position(){let e=0;return this.time.frame&&(e=this.time.seconds/this.duration,1!==e&&(e=parseFloat(e.toFixed(this.precision)))),e}set position(e){this.goToTime(Kr(this.duration*Number(e),this.fps))}get positionStep(){return parseFloat(`0.${"0".repeat(this.precision-1)}1`)}precision=Yr.editor.precision;preloader;readOnly=!1;_rect;get rect(){return this._rect}set rect(t){$i(t);const{editedData:i,rect:n}=this;if(Ji(n,t))return;this._rect=t;(i?this.loadEditedData():Promise.resolve()).then((()=>{const{edited:i,rect:n,eventTarget:s}=this;Ac(i)&&(i.imageSize=qi(n),s.emit(e.EventType.Resize,{rect:t}),this.redraw())}))}redo(){this.actions.canRedo&&this.handleAction(this.actions.redo())}redraw(){const{edited:t}=this;t&&(t.mashes.forEach((e=>{e.clearPreview()})),this.eventTarget.dispatch(e.EventType.Draw))}removeClip(t){const{mash:i}=this.selection;if(!i)throw new Error(dn.selection);const{track:n}=t,s={redoSelection:{...this.selection,clip:void 0},clip:t,track:n,index:n.clips.indexOf(t),type:e.ActionType.RemoveClip};this.actions.create(s)}removeEffect(t){const{clip:i}=this.selection;if(!i)throw dn.selection;Ca(i);const{content:n}=i;zr(n);const{effects:s}=n,r=[...s],o=s.filter((e=>e!==t)),a={...this.selection.object};delete a.effect;const c={redoSelection:a,effects:s,undoEffects:r,redoEffects:o,type:e.ActionType.MoveEffect};this.actions.create(c)}removeLayer(t){const{cast:i}=this.selection;Pc(i);const n={cast:i,layer:t};this.actions.create({type:e.ActionType.RemoveLayer,redoSelection:n})}removeTrack(e){console.debug(this.constructor.name,"removeTrack coming soon...")}saved(t){if(t){const{edited:e}=this;V(e),Object.entries(t).forEach((([t,i])=>{if(e.id===t)return void(e.id=i);if(yt.installed(t))return void yt.updateDefinitionId(t,i);Pc(e);const n=e.mashes.find((e=>e.id===t));Fa(n),n.id=i}))}this.actions.save(),this.eventTarget.emit(e.EventType.Action)}_selection;get selection(){if(this._selection)return this._selection;const e=ol();return e.editor=this,this._selection=e}get svgElement(){return this.preloader.svgElement}set svgElement(e){this.preloader.svgElement=e}previewItems(e){const{edited:t}=this;if(!t)return Promise.resolve([Dn(this.rect)]);const i={};return e&&this.paused&&(i.editor=this),t.previewItems(i)}get time(){return this.selection.mash?.time||Jr(0,this.fps)}set time(e){this.goToTime(e)}get timeRange(){return this.selection.mash?.timeRange||Ur(0,this.fps)}undo(){const{canUndo:e}=this.actions;e&&this.handleAction(this.actions.undo())}updateDefinition(e,t){const{id:i,type:n}=e,s=e.id||t.id;I(s);const r=t||yt.fromId(i),{id:o,type:a}=r,c=o!==s,l=ve(n)&&a!==n;if(l){const t=lt[n].definition(e);yt.updateDefinition(r,t)}else c&&(yt.updateDefinitionId(r.id,s),Object.assign(r,e),al(r)?delete r.loadedVideo:ka(r)?delete r.loadedAudio:ll(r)&&delete r.loadedImage);const{edited:u}=this;if(!u||!l&&!c)return Promise.resolve();return this.mashes.flatMap((e=>e.tracks)).flatMap((e=>e.clips)).forEach((e=>{e.containerId===o&&e.setValue(i,"containerId"),e.contentId===o&&e.setValue(i,"contentId")})),this.loadMashAndDraw()}_volume=Yr.editor.volume;get volume(){return this._volume}set volume(t){const i=Number(t);if(this._volume!==i){if(!f(i))throw dn.invalid.volume;this._volume=i,v(i)&&(this.muted=!1);const{mash:t}=this.selection;t&&(t.gain=this.gain),this.eventTarget.emit(e.EventType.Volume)}}}e.editorSingleton=void 0;const hl=(e={})=>({autoplay:Yr.editor.autoplay,precision:Yr.editor.precision,loop:Yr.editor.loop,fps:Yr.editor.fps,volume:Yr.editor.volume,buffer:Yr.editor.buffer,...e}),dl=Ma(Aa(aa(Xr(Tn))));class pl extends dl{contentPreviewItemPromise(e,t,i,n){return Promise.resolve(Cn(e,"","currentColor"))}mutable(){return!0}}const ml=_a(Pa(qo(eo(hs))));class fl extends ml{constructor(...e){super(...e);const[t]=e,{audioUrl:i,url:n}=t;!i&&n&&(this.audioUrl=n)}instanceFromObject(e={}){return new pl(this.instanceArgs(e))}type=e.DefinitionType.Audio;loadType=e.LoadType.Audio}const gl=e=>{const{id:t}=e;if(!t)throw dn.id;return new fl(e)},yl=e=>gl({id:e}),vl=e=>gl(e).instanceFromObject(e),Tl=e=>vl({id:e});ct[e.DefinitionType.Audio]={definition:gl,definitionFromId:yl,fromId:Tl,instance:vl};const bl=Va(Aa(aa(jr(Xr(Tn)))));class wl extends bl{visibleCommandFiles(e){const t=[],{visible:i,time:n,videoRate:s}=e;if(!i)return t;const r=this.fileUrls(e),[o]=r,a=k(n)?n.lengthSeconds:0,c={loop:1,framerate:s};a&&(c.t=a);const{id:l}=this,u={...o,inputId:l,options:c};return t.push(u),t}fileUrls(t){const{visible:i,editing:n}=t,s=[];if(!i)return s;const{definition:r}=this,{url:o,source:a}=r,c=n?o:a;I(c,n?"url":"source");const l={input:!0,type:e.LoadType.Image,file:c,definition:r};return s.push(l),s}}const Fl=Ea(Pa(qo(Lr(eo(hs)))));class Sl extends Fl{constructor(...e){super(...e);const[t]=e,{loadedImage:i}=t;i&&(this.loadedImage=i)}definitionIcon(e,t){const i=super.definitionIcon(e,t);if(i)return i;const{url:n}=this;return this.urlIcon(n,e,t)}instanceFromObject(e={}){return new wl(this.instanceArgs(e))}loadType=e.LoadType.Image;loadedImage;type=e.DefinitionType.Image}const Il=e=>{const{id:t}=e;return I(t,"imageDefinition id"),new Sl(e)},Cl=e=>Il({id:e}),xl=e=>Il(e).instanceFromObject(e),Dl=e=>xl({id:e});ct[e.DefinitionType.Image]={definition:Il,definitionFromId:Cl,fromId:Dl,instance:xl};const Pl=Ma(Va(Aa(aa(jr(Xr(Tn))))));class Al extends Pl{fileUrls(t){const i=[],{editing:n,time:s,audible:r,visible:o,icon:a}=t,{definition:c}=this,{url:l,source:u}=c,h=n?l:u;if(I(h,n?"url":"source"),o&&!a){const t={input:!0,type:e.LoadType.Video,file:h,definition:c};i.push(t)}if(r){if((!c.duration||this.mutable())&&!this.muted){const t={input:!0,type:e.LoadType.Audio,definition:c,file:this.definition.urlAudible(n)};i.push(t)}}return i}_foreignElement;get foreignElement(){return this._foreignElement||=this.foreignElementInitialize}get foreignElementInitialize(){return globalThis.document.createElementNS(ht,"foreignObject")}iconUrl(e,t,i){const n=qi(this.intrinsicRect(!0)),s=Mi(n,e),{width:r,height:o}=s,a=this.definitionTime(t,i),{frame:c}=a,{fps:l}=i,{definition:u}=this,{url:h}=u,d=us("video",h,{frame:c,fps:l});return us("image",d,{width:r,height:o})}itemPreviewPromise(e,t,i){const{clientCanMaskVideo:n}=Al,{_foreignElement:s,_loadedVideo:r}=this,o=!!s;return o||r?(this.updateForeignElement(e,t,i,o),Promise.resolve(n?this.foreignElement:this.loadedVideo)):this.loadVideoPromise.then((()=>(this.updateForeignElement(e,t,i),n?this.foreignElement:this.loadedVideo)))}_loadedVideo;get loadedVideo(){return this._loadedVideo}get loadVideoPromise(){const{_loadedVideo:e}=this;if(e)return Promise.resolve(e);const{definition:t}=this,{loadedVideo:i}=t;if(i)return this._loadedVideo=i.cloneNode(),Promise.resolve(this._loadedVideo);const{preloader:n}=this.clip.track.mash,s=this.intrinsicGraphFile({editing:!0,size:!0}),{file:r}=s,o=us("video",r);return n.loadPromise(o).then((e=>(t.loadedVideo=e,this._loadedVideo=e.cloneNode())))}updateVideo(e,t,i){const{loadedVideo:n}=this,{currentTime:s}=n,r=this.definitionTime(t,i),o=t.isRange?1:1/t.fps,{seconds:a}=r;Math.abs(a-s)>o&&(n.currentTime=a);const{width:c,height:l}=e;return n.width=c,n.height=l,n}updateForeignElement(e,t,i,n){const{clientCanMaskVideo:s}=Al;if(s){const{foreignElement:t}=this;n||t.appendChild(this.loadedVideo),Sn(t,e)}this.updateVideo(e,t,i)}static _clientCanMaskVideo;static get clientCanMaskVideo(){const{_clientCanMaskVideo:e}=this;if(u(e))return e;const{navigator:t}=globalThis,{userAgent:i}=t,n=i.includes("Safari")&&!i.includes("Chrome");return this._clientCanMaskVideo=!n}}const Vl=_a(Ea(Pa(qo(Lr(eo(hs))))));class El extends Vl{constructor(...e){super(...e);const[t]=e,{loadedVideo:i}=t;i&&(this.loadedVideo=i)}instanceFromObject(e={}){return new Al(this.instanceArgs(e))}loadType=e.LoadType.Video;loadedVideo;pattern="%.jpg";toJSON(){const e=super.toJSON();return e.url=this.url,this.source&&(e.source=this.source),e}type=e.DefinitionType.Video}const zl=e=>{const{id:t}=e;return I(t),new El(e)},Ol=e=>zl({id:e}),kl=e=>zl(e).instanceFromObject(e),Rl=e=>kl({id:e});ct[e.DefinitionType.Video]={definition:zl,definitionFromId:Ol,fromId:Rl,instance:kl};const Ml=Ma(Va(Aa(aa(jr(Xr(Tn))))));class _l extends Ml{visibleCommandFiles(e){const t=super.visibleCommandFiles(e),{streaming:i,visible:n}=e;return n&&i?(t.forEach((e=>{const{options:t={}}=e;t.loop=1,t.re="",e.options=t})),t):t}fileUrls(t){const{time:i,clipTime:n,editing:s,visible:r}=t,o=this.definitionTime(i,n),a={...t,time:o},c=super.fileUrls(a);if(r){const{definition:t}=this;if(s){const i=t.framesArray(o).map((i=>({type:e.LoadType.Image,file:t.urlForFrame(i),input:!0,definition:t})));i.push(...i)}else{const i={type:e.LoadType.Video,file:t.source,definition:t,input:!0};c.push(i)}}return c}iconUrl(e,t,i){const n=this.definitionTime(t,i),{definition:s}=this,r=s.framesArray(n),[o]=r;return s.urlForFrame(o)}speed=1;toJSON(){const e=super.toJSON();return 1!==this.speed&&(e.speed=this.speed),e}}const $l=_a(Ea(Pa(qo(eo(hs)))));class Nl extends $l{constructor(...e){super(...e);const[t]=e,{padding:i,begin:n,fps:s,increment:r,pattern:o}=t;if(f(n)&&(this.begin=n),s&&(this.fps=s),r&&(this.increment=r),o&&(this.pattern=o),i)this.padding=i;else{const e=this.begin+(this.increment*this.framesMax-this.begin);this.padding=String(e).length}}begin=Yr.definition.videosequence.begin;fps=Yr.definition.videosequence.fps;framesArray(e){const{duration:t,fps:i}=this;return e.durationFrames(t,i)}get framesMax(){const{fps:e,duration:t}=this;return Math.floor(e*t)-2}increment=Yr.definition.videosequence.increment;instanceFromObject(e={}){return new _l(this.instanceArgs(e))}loadType=e.LoadType.Image;padding;pattern="%.jpg";toJSON(){const e=super.toJSON(),{videosequence:t}=Yr.definition,{pattern:i,increment:n,begin:s,fps:r,padding:o}=this;return i!==t.pattern&&(e.pattern=i),n!==t.increment&&(e.increment=n),s!==t.begin&&(e.begin=s),r!==t.fps&&(e.fps=r),o!==t.padding&&(e.padding=o),e}type=e.DefinitionType.VideoSequence;urlForFrame(e){const{increment:t,begin:i,padding:n,url:s,pattern:r}=this;let o=String(e*t+i);return n&&(o=o.padStart(n,"0")),(s+r).replaceAll("%",o)}}const jl=e=>{const{id:t}=e;return I(t),new Nl(e)},Ll=e=>jl({id:e}),ql=e=>jl(e).instanceFromObject(e),Gl=e=>ql({id:e});ct[e.DefinitionType.VideoSequence]={definition:jl,definitionFromId:Ll,fromId:Gl,instance:ql};class Bl{args;constructor(e){this.args=e}assureClipFrames(){const{durationClips:e,args:t}=this,{quantize:i}=t.mash;e.forEach((e=>{const{content:t}=e,{definition:n}=t;if(ka(n)){const t=n.frames(i);t&&(e.frames=t)}}))}_avType=e.AVType.Both;get avType(){return this._avType}get avTypeNeededForClips(){const{avType:t}=this;if(t!==e.AVType.Both)return t;const{renderingClips:i}=this,n=new Set;if(i.forEach((t=>{t.audible&&n.add(e.AVType.Audio),t.visible&&n.add(e.AVType.Video)})),2===n.size)return t;const[s]=n;return s}get commandOutput(){return this.args.commandOutput}get duration(){return this.timeRange.lengthSeconds}_durationClips;get durationClips(){return this._durationClips||=this.durationClipsInitialize}get durationClipsInitialize(){const{mash:e}=this.args,{frames:t}=e;if(f(t))return[];const{clips:i}=e,n={duration:!0};return i.filter((e=>!e.intrinsicsKnown(n)))}get endTime(){return this.args.endTime||this.args.mash.endTime}get filterGraphs(){const{filterGraphsOptions:e}=this;return this.args.mash.filterGraphs(e)}get filterGraphsOptions(){const{timeRange:e,graphType:t,videoRate:i,args:n}=this,{upload:s}=n;return{time:e,graphType:t,videoRate:i,size:this.sizeCovered(),avType:this.avTypeNeededForClips,upload:s}}graphType=e.GraphType.Mash;get mashDurationPromise(){const e=this.durationClips;if(!e.length)return Promise.resolve();const{mash:t}=this.args,i={duration:!0},n=e.flatMap((e=>e.intrinsicGraphFiles(i))),{preloader:s}=t;return s.loadFilesPromise(n)}get mashSize(){const{visibleGraphFiles:e}=this,t=e.map((e=>e.definition)).filter((e=>Nr(e))),i=[...new Set(t)].filter((e=>e.sourceSize));if(!i.length)return;const n=i.map((e=>e.sourceSize));return{width:Math.max(...n.map((e=>e.width))),height:Math.max(...n.map((e=>e.height)))}}get outputCover(){return!!this.args.commandOutput.cover}get outputSize(){const{width:t,height:i}=this.args.commandOutput;if(!t||!i){if(this.avType===e.AVType.Audio)return{width:0,height:0};throw dn.invalid.size+this.outputType+".outputSize for avType "+this.avType}return{width:t,height:i}}outputType;get preloadPromise(){return this.filterGraphs.loadPromise}get renderingClips(){return this.args.mash.clipsInTimeOfType(this.timeRange,this.avType)}renderingDescriptionPromise(t){let i=this.mashDurationPromise;return i=i.then((()=>{this.assureClipFrames()})),i=i.then((()=>this.sizePromise)),i=i.then((()=>this.preloadPromise)),i.then((()=>{this.assureClipFrames();const{commandOutput:t}=this,i={commandOutput:t},n=this.avTypeNeededForClips,{filterGraphs:s}=this;if(n!==e.AVType.Audio){const{filterGraphsVisible:t}=s,n=t.map((t=>{const{commandInputs:i,commandFilters:n,duration:s}=t;return{inputs:i,commandFilters:n,duration:s,avType:e.AVType.Video}}));i.visibleCommandDescriptions=n}if(n!==e.AVType.Video){const{filterGraphAudible:t,duration:n}=s;if(t){const{commandFilters:s,commandInputs:r}=t,o={inputs:r,commandFilters:s,duration:n,avType:e.AVType.Audio};i.audibleCommandDescription=o}}return i}))}get startTime(){if(this.args.startTime)return this.args.startTime;const{quantize:e,frame:t}=this.args.mash;return Jr(t,e)}sizeCovered(){const{outputSize:e,outputCover:t}=this;if(!t)return e;const{mashSize:i}=this;if(!Di(i))return e;const{width:n,height:s}=i;return T(n),T(s),Mi(i,e)}get sizePromise(){if(this.avType===e.AVType.Audio||!this.outputCover)return Promise.resolve();const{visibleGraphFiles:t}=this;if(!t.length)return Promise.resolve();const{preloader:i}=this.args.mash;return i.loadFilesPromise(t)}get timeRange(){return Hr(this.startTime,this.endTime)}get videoRate(){return this.args.commandOutput.videoRate||0}get visibleGraphFiles(){const{timeRange:t,args:i}=this,{mash:n}=i,s=n.clipsInTimeOfType(t,e.AVType.Video),r={size:!0};return s.filter((e=>!e.intrinsicsKnown(r))).flatMap((e=>e.intrinsicGraphFiles(r)))}}class Ul extends Bl{_avType=e.AVType.Audio;outputType=e.OutputType.Audio}var Wl={options:{},audioBitrate:160,audioCodec:"libmp3lame",audioChannels:2,audioRate:44100,extension:"mp3",outputType:"audio"};var Hl={options:{},width:320,height:240,extension:"jpg",outputType:"image",cover:!0,offset:0};var Jl={options:{},width:320,height:240,extension:"png",outputType:"image",format:"image2",cover:!0,offset:0};var Kl={options:{g:60,level:41,movflags:"faststart"},width:1920,height:1080,videoRate:30,videoBitrate:2e3,audioBitrate:160,audioCodec:"aac",videoCodec:"libx264",audioChannels:2,audioRate:44100,g:0,format:"mp4",extension:"mp4",outputType:"video",cover:!1};var Yl={options:{},format:"image2",width:320,height:240,videoRate:10,extension:"jpg",outputType:"imagesequence",cover:!1};var Xl={options:{},width:320,height:240,forecolor:"#000000",backcolor:"#00000000",audioBitrate:160,audioCodec:"aac",audioChannels:2,audioRate:44100,extension:"png",outputType:"waveform"};var Zl={width:320,height:240,videoRate:30,videoBitrate:2e3,audioBitrate:160,audioCodec:"aac",videoCodec:"libx264",audioChannels:2,audioRate:44100,format:"mdash",extension:"dash",streamingFormat:"mdash",options:{hls_delete_threshold:10,g:60}};var Ql={width:320,height:240,videoRate:30,videoBitrate:2e3,audioBitrate:160,audioCodec:"aac",videoCodec:"libx264",audioChannels:2,audioRate:44100,format:"hls",extension:"m3u8",streamingFormat:"hls",options:{hls_segment_filename:"%06d.ts",hls_time:6,hls_list_size:10,hls_flags:"delete_segments",hls_delete_threshold:10,g:60}};var eu={width:320,height:240,videoRate:30,videoBitrate:2e3,audioBitrate:160,audioCodec:"aac",videoCodec:"libx264",audioChannels:2,audioRate:44100,format:"flv",extension:"flv",streamingFormat:"rtmp",options:{g:60}};const tu=e=>({...Wl,...e||{}}),iu=e=>({...Kl,...e||{}}),nu=e=>({...Yl,...e||{}}),su=e=>({...Xl,...e||{}}),ru=e=>({...Jl,...e||{}}),ou=e=>({...Hl,...e||{}}),au=t=>{const{outputType:i}=t;switch(i){case e.OutputType.Audio:return tu(t);case e.OutputType.Image:return ou(t);case e.OutputType.Video:return iu(t);case e.OutputType.ImageSequence:return nu(t);case e.OutputType.Waveform:return su(t)}},cu={[e.OutputFormat.AudioConcat]:e.OutputType.Audio,[e.OutputFormat.Mdash]:e.OutputType.Video,[e.OutputFormat.Flv]:e.OutputType.Video,[e.OutputFormat.Hls]:e.OutputType.Video,[e.OutputFormat.Jpeg]:e.OutputType.Image,[e.OutputFormat.Mp3]:e.OutputType.Audio,[e.OutputFormat.Mp4]:e.OutputType.Video,[e.OutputFormat.Png]:e.OutputType.Image,[e.OutputFormat.Rtmp]:e.OutputType.Video,[e.OutputFormat.VideoConcat]:e.OutputType.Video},lu={[e.OutputType.Audio]:e.OutputFormat.Mp3,[e.OutputType.Image]:e.OutputFormat.Png,[e.OutputType.Video]:e.OutputFormat.Mp4,[e.OutputType.ImageSequence]:e.OutputFormat.Jpeg,[e.OutputType.Waveform]:e.OutputFormat.Png},uu=e=>({...Ql,...e||{}}),hu=e=>({...Zl,...e||{}}),du=e=>({...eu,...e||{}});class pu extends Bl{_avType=e.AVType.Video;get commandOutput(){const{upload:e,commandOutput:t}=this.args;if(!e)return t;const{renderingClips:i}=this,[n]=i,{definition:r}=n.content;Rr(r);const{info:o}=r;s(o);const{streams:a}=o,[c]=a,{pix_fmt:l,codec_name:u}=c;if("png"!==u)return t;const{width:h,height:d,basename:p}=t;return ru({width:h,height:d,basename:p})}get endTime(){}get filterGraphsOptions(){const{args:e,graphType:t,avType:i,startTime:n}=this,{mash:s,upload:r}=e,{quantize:o}=s;return{time:n,graphType:t,videoRate:o,size:this.sizeCovered(),avType:i,upload:r}}outputType=e.OutputType.Image;get startTime(){const{commandOutput:e,mash:t}=this.args,{offset:i}=e;return i||t.frames<0?Jr(0,t.quantize):t.timeRange.positionTime(Number(i||0),"ceil")}}class mu extends Ul{_avType=e.AVType.Video;outputType=e.OutputType.ImageSequence}class fu extends Ul{get avType(){return this.args.commandOutput.mute?e.AVType.Video:e.AVType.Both}get outputCover(){return!!this.args.commandOutput.cover}outputType=e.OutputType.Video}class gu extends Bl{_avType=e.AVType.Audio;outputType=e.OutputType.Waveform;get sizePromise(){return Promise.resolve()}}const yu=e=>new Ul(e),vu=e=>new pu(e),Tu=e=>new fu(e),bu=e=>new mu(e),wu=e=>new gu(e),Fu={[e.OutputType.Audio]:yu,[e.OutputType.Image]:vu,[e.OutputType.Video]:Tu,[e.OutputType.ImageSequence]:bu,[e.OutputType.Waveform]:wu};class Su{constructor(e){this.args=e}args;streamingDescription(t){const{mashes:i}=this.args,n=i.map((e=>e.preloader.loadFilesPromise(e.editedGraphFiles({audible:!0,visible:!0,streaming:!0}))));let s=Promise.all(n).then((()=>{const t=[],n=[],s=[],r=e.AVType.Both;i.forEach((i=>{const o={size:this.outputSize,videoRate:this.args.commandOutput.videoRate,graphType:e.GraphType.Cast,avType:r},a=i.filterGraphs(o),{filterGraphVisible:c}=a;s.push(...c.commandInputs),t.push(...a.fileUrls.filter((e=>e.input))),n.push(...c.commandFilters)}));const o={...this.args.commandOutput.options},a={...this.args.commandOutput,options:o};return{inputs:s,commandFilters:n,commandOutput:a,avType:r}}));return s}mashes=[];get outputSize(){const{width:e,height:t}=this.args.commandOutput;return{width:e,height:t}}}e.Action=Vc,e.ActionFactory=Jc,e.Actions=Kc,e.AddClipToTrackAction=kc,e.AddEffectAction=Rc,e.AddLayerAction=Gc,e.AddTrackAction=Oc,e.AlphamergeFilter=wr,e.Anchors=je,e.ApiVersion="5.1.1",e.AudibleContext=va,e.AudibleContextInstance=Ta,e.AudioClass=pl,e.AudioDefinitionClass=fl,e.AudioOutputClass=Ul,e.AudioPreview=$a,e.BrowserLoaderClass=sl,e.CastClass=Cc,e.ChangeAction=_c,e.ChangeFramesAction=Nc,e.ChangeMultipleAction=Wc,e.ChromaKeyFilter=ms,e.ClassButton="button",e.ClassCollapsed="collapsed",e.ClassDisabled="disabled",e.ClassDropping="dropping",e.ClassDroppingAfter="dropping-after",e.ClassDroppingBefore="dropping-before",e.ClassSelected="selected",e.ClipClass=Ua,e.ClipDefinitionClass=Wa,e.ClipSelectTypes=Q,e.ColorChannelMixerFilter=Js,e.ColorContentClass=ua,e.ColorContentDefinitionClass=da,e.ColorFilter=Ws,e.ColorizeFilter=Us,e.Colors=Pt,e.ContainerDefinitionMixin=Lr,e.ContainerMixin=jr,e.ContainerTypes=Ie,e.ContentDefinitionMixin=qo,e.ContentMixin=aa,e.ContentTypes=xe,e.ContextFactory=ba,e.ConvolutionFilter=sr,e.CropFilter=mr,e.DataGroups=sn,e.DataTypes=Ae,e.Default=Yr,e.DefaultContainerId=fi,e.DefaultContentId=Vr,e.Defined=yt,e.DefinitionBase=hs,e.DefinitionTypes=ye,e.DirectionLabels=["top","right","bottom","left","top right","bottom right","bottom left","top left"],e.Directions=Me,e.EditTypes=W,e.EditedClass=Sa,e.EditorClass=ul,e.EditorSelectionClass=rl,e.EffectClass=Uo,e.EffectDefinitionClass=Jo,e.Emitter=Qc,e.EmptyMethod=ut,e.Endpoints=at,e.Errors=dn,e.EventTypes=Ue,e.ExtDash="dash",e.ExtHls="m3u8",e.ExtJpeg="jpg",e.ExtJson="json",e.ExtPng="png",e.ExtRtmp="flv",e.ExtText="txt",e.ExtTs="ts",e.Factories=ct,e.Factory=lt,e.FillTypes=oe,e.FilterClass=ds,e.FilterDefinitionClass=ps,e.FilterGraphClass=La,e.FilterGraphInputAudible=ja,e.FilterGraphInputVisible=Na,e.FilterGraphsClass=qa,e.FilterIdPrefix=Ir,e.FontClass=oo,e.FontDefinitionClass=ao,e.FpsFilter=Tr,e.GraphFileTypes=ce,e.IdPrefix=dt,e.IdSuffix=pt,e.ImageClass=wl,e.ImageDefinitionClass=Sl,e.ImageOutputClass=pu,e.ImageSequenceOutputClass=mu,e.InstanceBase=Tn,e.LayerClass=ac,e.LayerFolderClass=cc,e.LayerMashClass=lc,e.LayerTypes=q,e.LoadTypes=he,e.LoaderClass=nl,e.MashClass=sc,e.ModularDefinitionMixin=Wo,e.ModularMixin=Go,e.MoveClipAction=jc,e.MoveEffectAction=Lc,e.MoveLayerAction=Uc,e.NamespaceLink="http://www.w3.org/1999/xlink",e.NamespaceSvg=ht,e.NamespaceXhtml="http://www.w3.org/1999/xhtml",e.NonePreview=nc,e.OpacityFilter=yr,e.Orientations=Oe,e.OutputFactory=Fu,e.OutputFilterGraphPadding=6,e.OutputTypes=se,e.OverlayFilter=fr,e.Parameter=pn,e.PointZero=Si,e.PreloadableDefinitionMixin=Pa,e.PreloadableMixin=Aa,e.PreviewClass=Ba,e.PropertiedClass=li,e.PropertyTweenSuffix=ci,e.PropertyTypesNumeric=ni,e.RectZero=Ki,e.RemoveClipAction=qc,e.RemoveLayerAction=Bc,e.RenderingOutputClass=Bl,e.ScaleFilter=gr,e.SelectTypes=X,e.ServerTypes=Ye,e.SetptsFilter=br,e.SetsarFilter=vr,e.ShapeContainerClass=Qr,e.ShapeContainerDefinitionClass=io,e.SizeIcon=Li,e.SizeOutput=Ni,e.SizePreview=ji,e.SizeZero=Vi,e.SizingDefinitionTypes=be,e.Sizings=tt,e.StreamingOutputClass=Su,e.TextContainerClass=ro,e.TextContainerDefinitionClass=Do,e.TextContainerId=gi,e.TextFilter=Sr,e.TimeClass=Gr,e.TimeRangeClass=Br,e.TimingDefinitionTypes=Fe,e.Timings=Qe,e.TrackClass=ec,e.TrackFactory=ic,e.TrackPreviewClass=Ga,e.TrackPreviewHandleSize=8,e.TrackPreviewLineSize=2,e.TriggerTypes=qe,e.TrimFilter=Fr,e.TweenableDefinitionMixin=eo,e.TweenableMixin=Xr,e.UpdatableDurationDefinitionMixin=_a,e.UpdatableDurationDefinitionTypes=za,e.UpdatableDurationMixin=Ma,e.UpdatableSizeDefinitionMixin=Ea,e.UpdatableSizeDefinitionType=_r,e.UpdatableSizeMixin=Va,e.UploadTypes=me,e.VideoClass=Al,e.VideoDefinitionClass=El,e.VideoOutputClass=fu,e.VideoSequenceClass=_l,e.VideoSequenceDefinitionClass=Nl,e.VideoStreamOutputClass=class extends Su{},e.WaveformOutputClass=gu,e.actionInstance=Hc,e.arrayLast=Zi,e.arrayReversed=en,e.arraySet=Qi,e.arrayUnique=tn,e.assertAboveZero=T,e.assertAction=zc,e.assertArray=w,e.assertBoolean=function(e,t){u(e)||i(e,"Boolean",t)},e.assertCast=Pc,e.assertChangeAction=function(e){if(!$c(e))throw new Error("expected ChangeAction")},e.assertClip=Ca,e.assertContainer=Ti,e.assertContainerObject=function(e){yi(e)||i(e,"ContainerObject")},e.assertContainerType=function(e){if(!Ce(e))throw new Error("expected ContainerType")},e.assertContent=zr,e.assertContentType=function(e){if(!De(e))throw new Error("expected ContentType")},e.assertConvolutionServerFilter=or,e.assertDataGroup=function(e,t){rn(e)||i(e,"DataGroup",t)},e.assertDataType=Ee,e.assertDefined=function(e,t){h(e)||i(e,"defined",t)},e.assertDefinition=gt,e.assertDefinitionType=Te,e.assertDirection=$e,e.assertEditType=J,e.assertEdited=function(e){Ac(e)||i(e,"Edited")},e.assertEffect=tl,e.assertFontDefinition=function(e){if(!il(e))throw new Error("expected FontDefinition")},e.assertLayer=yc,e.assertLayerFolder=wc,e.assertLayerMash=Tc,e.assertLayerType=function(e){if(!G(e))throw new Error("expected LayerType")},e.assertLoadType=pe,e.assertLoaderPath=function(e,t){Kn(e)||i(e,"LoaderPath",t)},e.assertLoaderType=Jn,e.assertMash=Fa,e.assertMashClass=function(e){if(!oc(e))throw new Error("expected MashClass")},e.assertMashData=Zc,e.assertNumber=l,e.assertObject=s,e.assertPoint=wi,e.assertPopulatedArray=x,e.assertPopulatedObject=P,e.assertPopulatedString=I,e.assertPositive=g,e.assertPreloadable=function(e){if(!Mr(e))throw new Error("expected Preloadable")},e.assertPreloadableDefinition=Rr,e.assertProperty=an,e.assertRect=Hi,e.assertRgb=function(e,t){E(e)||i(e,"Rgb",t)},e.assertSelectType=function(e,t){Z(e)||i(e,"SelectType",t)},e.assertSize=Pi,e.assertSizeAboveZero=$i,e.assertString=o,e.assertTextContainer=function(e){if(!no(e))throw new Error("expected TextContainer")},e.assertTime=O,e.assertTimeRange=R,e.assertTrack=Da,e.assertTrue=V,e.assertTweenable=pi,e.assertTweenableDefinition=function(e){if(!mi(e))throw new Error("expected TweenableDefinition")},e.assertUpdatableDuration=function(e,t){Oa(e)||i(e,"Updatable",t)},e.assertUpdatableDurationDefinition=Ra,e.assertUpdatableSize=function(e){$r(e)||i(e,"UpdatableSize")},e.assertUpdatableSizeDefinition=function(e){Nr(e)||i(e,"UpdatableSizeDefinition")},e.assertValue=function(e,t){M(e)||i(e,"Value",t)},e.assertValueObject=N,e.assertVideo=function(e){if(!cl(e))throw new Error("expected Video")},e.audioDefinition=gl,e.audioDefinitionFromId=yl,e.audioFromId=Tl,e.audioInstance=vl,e.castInstance=xc,e.centerPoint=Xi,e.clipDefault=Ha,e.clipDefaultId=Ja,e.clipDefaults=Ka,e.clipDefinition=Ya,e.clipDefinitionFromId=Xa,e.clipFromId=Qa,e.clipInstance=Za,e.colorAlpha=Jt,e.colorAlphaColor=e=>{const t=Qt(e);return{alpha:t.a,color:Ot(t)}},e.colorBlack=wt,e.colorBlackOpaque=Ct,e.colorBlackTransparent=It,e.colorBlue="#0000FF",e.colorFromRgb=e=>{const{r:t,g:i,b:n}=e;return`rgb(${t},${i},${n})`},e.colorFromRgba=e=>{const{r:t,g:i,b:n,a:s}=e;return`rgb(${t},${i},${n},${s})`},e.colorGreen=xt,e.colorHexRegex=jt,e.colorHexToRgb=Yt,e.colorHexToRgba=Kt,e.colorName=At,e.colorRed="#FF0000",e.colorRgb=ei,e.colorRgbDifference=e=>{const{r:t,g:i,b:n}=e;return{...e,r:255-t,g:255-i,b:255-n}},e.colorRgbKeys=vt,e.colorRgbRegex=$t,e.colorRgbToHex=Ot,e.colorRgbToYuv=_t,e.colorRgba=ti,e.colorRgbaKeys=Tt,e.colorRgbaRegex=Nt,e.colorRgbaToHex=kt,e.colorRgbaToRgba=Xt,e.colorRgbaTransparent=ii,e.colorServer=e=>Gt(e)?`${e.slice(0,7)}@0x${e.slice(-2)}`:e,e.colorStrip=Lt,e.colorToRgb=Zt,e.colorToRgba=Qt,e.colorTransparent=bt,e.colorValid=qt,e.colorValidHex=Gt,e.colorValidRgb=Ut,e.colorValidRgba=Bt,e.colorWhite=Ft,e.colorWhiteOpaque="#FFFFFFFF",e.colorWhiteTransparent=St,e.colorYellow="#FFFF00",e.colorYuvBlend=Mt,e.colorYuvDifference=Rt,e.colorYuvToRgb=e=>{const t=zt(e);return Et({r:t.y+1.4075*(t.v-128),g:t.y-.3455*(t.u-128)-.7169*(t.v-128),b:t.y+1.779*(t.u-128)})},e.commandFilesInput=Xs,e.commandFilesInputIndex=Ys,e.containerDefaults=_o,e.containerDefinition=$o,e.containerDefinitionFromId=No,e.containerFromId=Lo,e.containerInstance=jo,e.contentDefaults=pa,e.contentDefinition=ma,e.contentDefinitionFromId=fa,e.contentFromId=ya,e.contentInstance=ga,e.editorArgs=hl,e.editorInstance=(t={})=>e.editorSingleton=new ul(hl(t)),e.editorSelectionInstance=ol,e.effectDefaults=ta,e.effectDefinition=ea,e.effectDefinitionFromId=ia,e.effectFromId=sa,e.effectInstance=na,e.eventStop=Zs,e.fetchCallback=e=>{const{endpoint:t,request:i}=e,n=i||{},s="Content-Type",r="application/json";switch(n.method||="POST",n.headers||={},n.headers[s]||=r,n.headers[s]){case r:n.body=JSON.stringify(n.body);break;case"multipart/form-data":{const e=new FormData;Object.entries(n.body).forEach((([t,i])=>{a(i)||e.set(t,i instanceof Blob?i:String(i))})),n.body=e,delete n.headers[s];break}}const o=is(t);return fetch(o,n).then((e=>e.json()))},e.filterDefaults=Cr,e.filterDefinition=xr,e.filterDefinitionFromId=Dr,e.filterFromId=Ar,e.filterInstance=Pr,e.fontDefault=wo,e.fontDefaults=Fo,e.fontDefinition=bo,e.fontDefinitionFromId=So,e.fontFromId=Co,e.fontInstance=Io,e.getChunksFromString=Wt,e.hex256=Ht,e.idGenerate=yn,e.idGenerateString=fn,e.idIsTemporary=vn,e.idPrefixSet=e=>{mn.prefix=e},e.idTemporary=gn,e.imageDefinition=Il,e.imageDefinitionFromId=Cl,e.imageFromId=Dl,e.imageInstance=xl,e.isAboveZero=v,e.isAction=Ec,e.isActionEvent=e=>t(e)&&e.detail,e.isActionInit=e=>Ec(e.action),e.isArray=b,e.isAudio=ra,e.isAudioDefinition=oa,e.isBelowOne=y,e.isBoolean=u,e.isCast=Dc,e.isCastData=Yc,e.isChangeAction=$c,e.isChangeActionObject=Mc,e.isClip=Ia,e.isClipObject=e=>ui(e),e.isClipSelectType=ee,e.isColorContent=ca,e.isContainer=vi,e.isContainerDefinition=e=>mi(e)&&Ce(e.type),e.isContainerObject=yi,e.isContainerType=Ce,e.isContent=Er,e.isContentDefinition=Or,e.isContentType=De,e.isConvolutionServerFilter=rr,e.isCustomEvent=t,e.isDataGroup=rn,e.isDataType=Ve,e.isDefined=h,e.isDefinition=ft,e.isDefinitionObject=mt,e.isDefinitionType=ve,e.isDirection=_e,e.isEditType=H,e.isEdited=Ac,e.isEffect=el,e.isEffectDefinition=t=>ft(t)&&t.type===e.DefinitionType.Effect,e.isEventType=e=>Ue.includes(e),e.isFillType=e=>oe.includes(e),e.isFloat=e=>p(e)&&!m(e),e.isFontDefinition=il,e.isGraphFileType=le,e.isImageDefinition=ll,e.isInstance=hi,e.isInstanceObject=ui,e.isInteger=m,e.isLayer=gc,e.isLayerFolder=bc,e.isLayerFolderObject=hc,e.isLayerMash=vc,e.isLayerMashObject=dc,e.isLayerObject=uc,e.isLayerType=G,e.isLoadType=de,e.isLoadedAudio=Wn,e.isLoadedImage=Un,e.isLoadedVideo=Bn,e.isLoaderPath=Kn,e.isLoaderType=Hn,e.isMash=wa,e.isMashAndDefinitionsObject=e=>n(e)&&"mashObject"in e&&"definitionObjects"in e,e.isMashClass=oc,e.isMashData=Xc,e.isMethod=e=>"function"==typeof e,e.isNan=d,e.isNumber=p,e.isNumberOrNaN=c,e.isNumeric=A,e.isObject=n,e.isOrientation=ke,e.isPoint=bi,e.isPopulatedArray=C,e.isPopulatedObject=D,e.isPopulatedString=S,e.isPositive=f,e.isPreloadable=Mr,e.isPreloadableDefinition=kr,e.isPropertied=e=>e instanceof li,e.isProperty=on,e.isRect=Wi,e.isRgb=E,e.isSelectType=Z,e.isSelectedProperty=Qs,e.isShapeContainer=e=>vi(e)&&"path"in e,e.isSize=Di,e.isSizingDefinitionType=we,e.isString=r,e.isTextContainer=no,e.isTime=z,e.isTimeRange=k,e.isTimingDefinitionType=Se,e.isTrack=xa,e.isTriggerType=e=>qe.includes(e),e.isTrueValue=_,e.isTweenable=di,e.isTweenableDefinition=mi,e.isUndefined=a,e.isUpdatableDuration=Oa,e.isUpdatableDurationDefinition=ka,e.isUpdatableDurationType=e=>ve(e)&&za.includes(e),e.isUpdatableSize=$r,e.isUpdatableSizeDefinition=Nr,e.isUpdatableSizeType=e=>ve(e)&&_r.includes(e),e.isUploadType=fe,e.isValue=M,e.isValueObject=$,e.isVideo=cl,e.isVideoDefinition=al,e.layerFolderInstance=pc,e.layerInstance=fc,e.layerMashInstance=mc,e.mashInstance=rc,e.outputDefaultAudio=tu,e.outputDefaultDash=hu,e.outputDefaultFormatByType=lu,e.outputDefaultHls=uu,e.outputDefaultImage=ou,e.outputDefaultImageSequence=nu,e.outputDefaultPng=ru,e.outputDefaultPopulate=au,e.outputDefaultRendering=(e,t)=>au({...t,outputType:e}),e.outputDefaultRtmp=du,e.outputDefaultStreaming=t=>{const{format:i}=t;switch(i){case e.OutputFormat.Mdash:return hu(t);case e.OutputFormat.Rtmp:return du(t);case e.OutputFormat.Hls:default:return uu(t)}},e.outputDefaultTypeByFormat=cu,e.outputDefaultVideo=iu,e.outputDefaultWaveform=su,e.outputInstanceAudio=yu,e.outputInstanceImage=vu,e.outputInstanceVideo=Tu,e.outputInstanceVideoSequence=bu,e.outputInstanceWaveform=wu,e.pixelColor=bs,e.pixelFromFrame=(e,t,i="ceil")=>{if(!e||!t)return 0;return gs(e*t,i)},e.pixelNeighboringRgbas=Ts,e.pixelPerFrame=(e,t,i=1)=>{if(!e||!t)return 0;const n=t/e,s=Math.min(1,n),r=Math.max(1,n);return 1===i?r:i?s+(r-s)*i:s},e.pixelRgbaAtIndex=ys,e.pixelToFrame=ws,e.pixelsMixRbg=Ss,e.pixelsMixRbga=Fs,e.pixelsRemoveRgba=(e,t,i,n=0,s=0,r=!1)=>{Is(e,t,i,ii,n,s)},e.pixelsReplaceRgba=Is,e.pointCopy=Ii,e.pointNegate=e=>{const{x:t,y:i}=e;return{x:-t,y:-i}},e.pointRound=Ci,e.pointString=xi,e.pointValueString=e=>{const{x:t,y:i}=e;return`${t},${i}`},e.pointsEqual=Fi,e.propertyInstance=cn,e.propertyTypeCoerce=ai,e.propertyTypeDefault=ri,e.propertyTypeIsString=t=>t!==e.DataType.Boolean&&!si(t),e.propertyTypeValid=oi,e.rectCopy=e=>({...Ii(e),...qi(e)}),e.rectFromSize=Yi,e.rectRound=e=>({...Oi(e),...Ci(e)}),e.rectString=e=>{const t=[];return Di(e)&&t.push(Bi(e)),bi(e)&&t.push(xi(e)),t.join(";")},e.rectsEqual=Ji,e.rectsFromSizes=(e,t)=>{const i=t||[Si,Si],[n,s]=e,[r,o]=i;return[Yi(n,r),Yi(s,o)]},e.rgbNumeric=Et,e.rgbValue=Vt,e.roundMethod=fs,e.roundWithMethod=gs,e.selectedPropertiesScalarObject=e=>Object.fromEntries(Object.entries(e).map((e=>[e[0],e[1].value]))),e.selectedPropertyObject=(e,t,i)=>{const n=e.filter((e=>!!Qs(e)&&(e.property.group===t&&e.selectType===i)));return Object.fromEntries(n.map((e=>{const{name:t,property:i}=e,{name:n}=i;return[t||n,e]})))},e.sizeAboveZero=_i,e.sizeCeil=ki,e.sizeCopy=qi,e.sizeCover=Mi,e.sizeEven=zi,e.sizeFloor=e=>{const{width:t,height:i}=e;return{width:Math.max(2,Math.floor(t)),height:Math.max(2,Math.floor(i))}},e.sizeFromElement=e=>{const t={width:Number(e.getAttribute("width")),height:Number(e.getAttribute("height"))};return $i(t,"sizeFromElement"),t},e.sizeLock=Gi,e.sizeLockNegative=Ui,e.sizeRound=Oi,e.sizeScale=Ri,e.sizeString=Bi,e.sizedEven=Ei,e.sizesEqual=Ai,e.sortByFrame=er,e.sortByIndex=tr,e.sortByLabel=(e,t)=>e.label<t.label?-1:e.label>t.label?1:0,e.sortByTrack=ir,e.stringFamilySizeRect=nr,e.stringPluralize=(e,t,i="s")=>S(t)?`${e} ${t}${1===e?"":i}`:t,e.stringSeconds=(e,t=0,i=0)=>{const n=[];let s=2,r=3600,o=!1;const a=i||e;return a>=r&&(e>=r?(n.push(String(Math.floor(e/r)).padStart(s,"0")),o=!0,e%=r):n.push("00:")),r=60,(o||a>=r)&&(o&&n.push(":"),e>=r?(n.push(String(Math.floor(e/r)).padStart(s,"0")),o=!0,e%=r):n.push("00:")),r=1,o||a>=r?(o&&n.push(":"),e>=r?(n.push(String(Math.floor(e/r)).padStart(s,"0")),o=!0,e%=r):n.push("00")):n.push("00"),t>1&&(10===t&&(s=1),n.push("."),e?(e=1===s?Math.round(10*e)/10:Math.round(100*e)/100,e=Number(String(e).slice(2)),n.push(String(e).padEnd(s,"0"))):n.push("0".padStart(s,"0"))),n.join("")},e.svgAddClass=$n,e.svgAppend=On,e.svgDefsElement=kn,e.svgDifferenceDefs=(e,t)=>{const i=fn(),n=zn({filter:"feBlend",mode:"difference"});_n(n,i,"in"),_n(n,"SourceGraphic","in2");const s=Rn(e,i),r=Mn([s,n],t,Si);return _n(r,"100%","width"),_n(r,"100%","height"),r},e.svgElement=Dn,e.svgFeImageElement=Rn,e.svgFilter=zn,e.svgFilterElement=Mn,e.svgFunc=(e,t)=>{const i=globalThis.document.createElementNS(ht,e);return _n(i,t,"tableValues"),_n(i,"discrete","type"),i},e.svgGroupElement=Fn,e.svgId=bn,e.svgImageElement=An,e.svgMaskElement=En,e.svgPathElement=Vn,e.svgPatternElement=(e,t,i)=>{const n=globalThis.document.createElementNS(ht,"pattern");return _n(n,t),xn(n,e),_n(n,"userSpaceOnUse","patternUnits"),On(n,i),n},e.svgPolygonElement=Cn,e.svgRectPoints=In,e.svgSet=_n,e.svgSetBox=xn,e.svgSetChildren=Gn,e.svgSetDimensions=Sn,e.svgSetDimensionsLock=Pn,e.svgSetTransform=jn,e.svgSetTransformPoint=(e,t)=>{wi(t);const{x:i,y:n}=t;(i||n)&&jn(e,`translate(${i}, ${n})`)},e.svgSetTransformRects=qn,e.svgTransform=Ln,e.svgUrl=wn,e.svgUseElement=Nn,e.throwError=i,e.timeEqualizeRates=qr,e.timeFromArgs=Jr,e.timeFromSeconds=Kr,e.timeRangeFromArgs=Ur,e.timeRangeFromSeconds=(e=0,t=1)=>Ur(e,1,t),e.timeRangeFromTime=Wr,e.timeRangeFromTimes=Hr,e.trackInstance=tc,e.tweenColorStep=Ps,e.tweenColors=(e,t,i)=>{I(e);const n=[e];if(S(t)&&i>1)for(let s=1;s<i;s++)n.push(Ps(e,t,s,i));return n},e.tweenCoverPoints=Ns,e.tweenCoverSizes=$s,e.tweenInputTime=(e,t,i,n,s)=>{if(n){if(!t)return i?e.startTime:e.lastTime;if(s){if(i)return e.lastTime}else if(!i)return e.startTime}},e.tweenMaxSize=Vs,e.tweenMinMax=Bs,e.tweenMinSize=(e,t)=>{const{width:i,height:n}=e;return!Di(t)||Ai(e,t)?{width:i,height:n}:{width:Math.min(i,t.width),height:Math.min(n,t.height)}},e.tweenNumberObject=Os,e.tweenNumberStep=Ds,e.tweenOption=Es,e.tweenOverPoint=Rs,e.tweenOverRect=ks,e.tweenOverSize=Ms,e.tweenPad=xs,e.tweenPosition=zs,e.tweenRectLock=js,e.tweenRects=(e,t,i)=>{const n=[e];if(t&&i>1)for(let s=1;s<i;s++)n.push(As(e,t,s,i));return n},e.tweenRectsLock=Ls,e.tweenScaleSizeRatioLock=qs,e.tweenScaleSizeToRect=_s,e.tweenableRects=(e,t)=>!!Wi(t)&&(e.x!==t.x||(e.y!==t.y||(e.width!==t.width||e.height!==t.height))),e.tweeningPoints=Gs,e.urlCombine=es,e.urlEndpoint=Yn,e.urlForEndpoint=is,e.urlFromEndpoint=ts,e.urlHasProtocol=Qn,e.urlIsHttp=Zn,e.urlIsObject=Xn,e.urlIsRootProtocol=ns,e.urlOptions=ls,e.urlOptionsObject=cs,e.urlParse=rs,e.urlPrependProtocol=us,e.urlProtocol=ss,e.urlsAbsolute=as,e.urlsParsed=os,e.videoDefinition=zl,e.videoDefinitionFromId=Ol,e.videoFromId=Rl,e.videoInstance=kl,e.videoSequenceDefinition=jl,e.videoSequenceDefinitionFromId=Ll,e.videoSequenceFromId=Gl,e.videoSequenceInstance=ql,e.yuvNumeric=zt,Object.defineProperty(e,"__esModule",{value:!0})}));
