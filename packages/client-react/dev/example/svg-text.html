<!DOCTYPE html>
<html lang='en'>
  <head>
    <title>SVG Text</title>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <style> /* fit root DIV to viewport */
      body { margin: 0px; padding: 0px; font-family: sans-serif; }
      body { width: 100vw; height: 100vh; }
      #rect, line { stroke-dasharray: 4px; stroke-width: 1px }
      line.origin { stroke: red; stroke-width: 2px }
      line.box.north { stroke: blue }
      line.box.south { stroke: green }
      line.box.east { stroke: blue }
      line.box.west { stroke: green }
      #rect { stroke: yellowgreen }
    </style>
  </head>
  <body>
    <svg width="1000" height="300" viewBox="0 0 1000 300">
      <rect x="0" y="0" width="1000" height="300" fill="snow"></rect>
      <line class="origin" x1="0" y1="200" x2="100" y2="200"></line>
      <line class="origin" x1="100" y1="0" x2="100" y2="200"></line>

      <line class="box north" id="north" x1="0" y1="0" x2="1000" y2="1"></line>
      <line class="box south" id="south" x1="0" y1="0" x2="1000" y2="1"></line>
      <line class="box east" id="east" x1="0" y1="0" x2="1" y2="300"></line>
      <line class="box west" id="west" x1="0" y1="0" x2="1" y2="300"></line>
      <text id="text" x="100" y="200" font-size="100" font-family="sans-serif">
        Amazingly
      </text>
      <rect id="rect" x="0" y="0" width="1" height="1" fill="none"></rect>
    </svg>
    <form>
      <div>
        dominant-baseline: 
        <select id="dominant-baseline" onchange="changeDominant(this.value)">
          <option>auto</option>
          <option>alphabetic</option>
          <option>central</option>
          <option>hanging</option>
          <option>ideographic</option>
          <option>mathematical</option>
          <option>middle</option>
          <option>text-after-edge</option>
          <option>text-before-edge</option>
          <option>text-bottom</option>
          <option>text-top</option>
        </select>
      </div>
      <div>
        alignment-baseline:
        <select id="alignment-baseline" onchange="changeAlignment(this.value)">
          <option>auto</option>
          <option>baseline</option>
          <option>before-edge</option>
          <option>text-before-edge</option>
          <option>middle</option>
          <option>central</option>
          <option>after-edge</option>
          <option>text-after-edge</option>
          <option>ideographic</option>
          <option>alphabetic</option>
          <option>hanging</option>
          <option>mathematical</option>
          <option>top</option>
          <option>center</option>
          <option>bottom</option>
        </select>
      </div>
      
      <input type="text" id="input" value="wow" onchange="changeInput(this.value)" />
    </form>
    <script>


const stringFamilySizeRect = (string, family, size) => {
  if (!string) return { x: 0, y: 0, width: 0, height: 0 }

  const { document } = globalThis  
  const canvas = document.createElement('canvas')
  const ctx = canvas.getContext('2d')
  ctx.font = `${size}px ${family}`
  const metrics = ctx.measureText(string)
  const { 
    actualBoundingBoxAscent, 
    actualBoundingBoxDescent, 
    actualBoundingBoxLeft, 
    actualBoundingBoxRight, 
    width, 
  } = metrics
  return {
    x: actualBoundingBoxLeft, y: actualBoundingBoxAscent,
    width: actualBoundingBoxLeft + actualBoundingBoxRight,
    height: actualBoundingBoxAscent + actualBoundingBoxDescent,
  } 
}

const text = document.getElementById('text')
const changeInput = (value) => {
  text.replaceChildren(value)
  updateBox()
}
const changeDominant = (value) => {
  text.setAttribute('dominant-baseline', value)
}
const changeAlignment = (value) => {
  text.setAttribute('alignment-baseline', value)
}

const width = 1000
const height = 300
const x = 100
const y = 200
const updateBox = () => {
  const family = text.getAttribute('font-family')
  const size = Number(text.getAttribute('font-size'))
  const value = text.innerHTML
  const stringRect = stringFamilySizeRect(value, family, size)
  console.log("stringRect", stringRect, value, family, size)
  const north = document.getElementById('north')
  const south = document.getElementById('south')
  const east = document.getElementById('east')
  const west = document.getElementById('west')

  const rect = document.getElementById('rect')
  rect.setAttribute('x', String(rect.x + x))
  rect.setAttribute('y', String(rect.y + y))
  rect.setAttribute('width', String(rect.width))
  rect.setAttribute('height', String(rect.height))

  north.setAttribute('y1', String(y + stringRect.y))
  north.setAttribute('y2', String(y + stringRect.y))
  
  south.setAttribute('y1', String(y + stringRect.height))
  south.setAttribute('y2', String(y + stringRect.height))
  
  east.setAttribute('x1', String(x + stringRect.x))
  east.setAttribute('x2', String(x + stringRect.x))
  
  west.setAttribute('x1', String(x + stringRect.width))
  west.setAttribute('x2', String(x + stringRect.width))
  text.setAttribute('y', String(y + stringRect.y))
  


}

updateBox()
    </script>
  </body>
</html>
