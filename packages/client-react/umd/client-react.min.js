!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("@moviemasher/moviemasher.js"),require("@moviemasher/theme-default")):"function"==typeof define&&define.amd?define(["exports","react","@moviemasher/moviemasher.js","@moviemasher/theme-default"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).MovieMasherClient={},e.React,e.MovieMasher,e.MovieMasherTheme)}(this,(function(e,t,n,a){"use strict";function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=s(t);function l(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(n[a[s]]=e[a[s]])}return n}function o(e,t,n,a){return new(n||(n=Promise))((function(s,r){function l(e){try{i(a.next(e))}catch(e){r(e)}}function o(e){try{i(a.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,o)}i((a=a.apply(e,t||[])).next())}))}const i=r.default.forwardRef(((e,t)=>r.default.createElement("div",Object.assign({ref:t},e)))),c=/{{([a-z0-9_]*)}}/,u={import:{bytes:"Size above {{value}}",extension:"Extension {{value}}",type:"Type {{value}}",size:"Dimensions {{value}}",duration:"Duration {{value}}",render:"{{value}}",displaySize:"{{width}}x{{height}}"}},d={audible:"Audible",clip:"Clip",update:"Save",delete:"Remove {{type}}",unlabeled:"Unlabeled {{type}}",analyze:"Analyzing...",load:"Loading...",complete:"Completed",layer:"Layer",create:"New",render:"Render",view:"View",open:"Open...",undo:"Undo",redo:"Redo",cast:"Cast",mash:"Mash"},f=e=>{const[t,n]=e.split(".");return u[t][n]},p=e=>e.includes(".")?f(e):d[e]||e,m=(e,t)=>{let n=p(e);const a=n.match(c);return a?(a.forEach(((e,a)=>{if(!a)return;const s=`{{${e}}}`,r=p(t[e]);n=n.replace(s,r)})),n):n},g=e=>{if(!n.isObject(e))return"";const{label:t,error:a,type:s,value:r}=e;return a?r?m(a,{value:r}):p(a):p(s)};var y;e.ActivityGroup=void 0,(y=e.ActivityGroup||(e.ActivityGroup={})).Active="active",y.Error="error",y.Complete="complete";const h=Object.values(e.ActivityGroup),E=e=>n.isPopulatedString(e)&&h.includes(e);function b(e,t){E(e)||n.throwError(e,"ActivityGroup",t)}const v={label:"",activities:[],allActivities:[],picked:e.ActivityGroup.Active,pick:n.EmptyMethod},C=r.default.createContext(v),O={changeDefinition:n.EmptyMethod,drop:()=>Promise.resolve([]),editorIndex:{},icons:{},save:n.EmptyMethod,setDraggable:n.EmptyMethod},T=r.default.createContext(O),j=(e,t)=>{const n=r.default.useContext(T),{editor:a}=n,s=t||a.eventTarget,l=t=>{const{type:n}=t,a=e[n];a&&a(t)},o=()=>(Object.keys(e).forEach((e=>{s.addEventListener(e,l)})),()=>{Object.keys(e).forEach((e=>{s.removeEventListener(e,l)}))});r.default.useEffect((()=>o()),[])},k=r.default.createContext({collapsed:!1,changeCollapsed:()=>{}});function S(t){const{initialPicked:a=e.ActivityGroup.Active,collapsed:s,className:o}=t,c=l(t,["initialPicked","collapsed","className"]),[u,d]=r.default.useState(!!s);b(a);const f=r.default.useRef([]),{current:p}=f,[m,y]=r.default.useState((()=>[])),[h,E]=r.default.useState((()=>a||e.ActivityGroup.Active)),[v,O]=r.default.useState(""),T=e=>f.current.filter((t=>t.activityGroup===e));j({[n.EventType.Activity]:t=>{const{type:a}=t;if(n.isEventType(a)&&t instanceof CustomEvent){const a=t.detail,{id:s,type:r}=a,l=p.find((e=>e.id===s)),o=l||{id:s,activityGroup:e.ActivityGroup.Active,infos:[]};o.infos.unshift(a),u&&O(g(a)),r===n.ActivityType.Complete?o.activityGroup=e.ActivityGroup.Complete:r===n.ActivityType.Error&&(o.activityGroup=e.ActivityGroup.Error),l||p.unshift(o),y(T(h))}}});const S={activities:m,picked:h,pick:e=>{y((()=>T(e))),E((()=>e))},allActivities:p,label:v},D={collapsed:u,changeCollapsed:e=>{O(""),d(e)}},P=[];o&&P.push(o),u&&P.push(n.ClassCollapsed);const x=Object.assign(Object.assign({},c),{className:P.join(" ")});return r.default.createElement(C.Provider,{value:S},r.default.createElement(k.Provider,{value:D},r.default.createElement(i,Object.assign({},x))))}const D={infos:[],activityGroup:e.ActivityGroup.Active,id:""},P=r.default.createContext(D);function x(e){const t=r.default.useContext(C),a=r.default.useContext(k),{collapsed:s}=a,{activities:o}=t;if(s)return null;const{children:c}=e,u=l(e,["children"]),d=r.default.Children.only(c);n.assertTrue(r.default.isValidElement(d));const f=o.map((e=>{const t={children:r.default.cloneElement(d),value:e,key:e.id};return r.default.createElement(P.Provider,Object.assign({},t))})),p=Object.assign(Object.assign({},u),{children:f});return r.default.createElement(i,Object.assign({},p))}function N(e){const{collapsed:t}=e,n=l(e,["collapsed"]),[a,s]=r.default.useState(!!t),o={collapsed:a,changeCollapsed:s};return r.default.createElement(k.Provider,{value:o},r.default.createElement(i,Object.assign({},n)))}function w(e){const t=r.default.useContext(k),{collapsed:n}=t,a=r.default.useContext(P),{infos:s}=a,[l]=s,o=(s.find((e=>e.label))||{label:""}).label||l.type,c=Object.assign({},e);if(n)c.children=o;else{const e=[o,...s.map((e=>g(e)))];c.children=e.map(((e,t)=>r.default.createElement(i,{key:t,children:e})))}return r.default.createElement(i,Object.assign({},c))}const A={child:"single child element expected"};function R(e){const t=r.default.useContext(C),{id:a,children:s}=e;b(a);const{picked:l}=t;if(a!==l)return null;const o=r.default.Children.only(s);return n.assertTrue(r.default.isValidElement(o),A.child),o}function M(e){const{id:t,className:a,children:s}=e,o=l(e,["id","className","children"]);b(t);const i=r.default.Children.only(s);n.assertTrue(r.default.isValidElement(i),A.child);const c=r.default.useContext(C),{picked:u,pick:d}=c,f=[];a&&f.push(a),t===u&&f.push(n.ClassSelected);const p=Object.assign(Object.assign({},o),{className:f.join(" "),key:`activity-picker-${t}`,onClick:()=>d(t)});return r.default.cloneElement(i,p)}function I(t){const a=r.default.useContext(C),s=r.default.useContext(P),{infos:l,id:o}=s,c=[];let u=0,d=0;if(n.isPopulatedArray(l)){const[e]=l,{step:t,steps:a}=e;n.isPositive(t)&&n.isAboveZero(a)&&(d=t,u=a)}else{const{allActivities:t,label:s}=a;n.isPopulatedString(s)&&c.push(r.default.createElement("label",{key:"label"},s));const l=t.filter((t=>t.activityGroup===e.ActivityGroup.Active));l.length&&l.forEach((e=>{const{infos:t}=e,[a]=t;n.assertObject(a);const{step:s,steps:r}=a;n.isPositive(r)&&(u+=r),n.isPositive(s)&&(d+=s)}))}if(u){const e=d/u,t={value:e,max:1,children:`${Math.round(100*e)}%`,key:"progress"};c.push(r.default.createElement("progress",Object.assign({},t)))}const f=Object.assign(Object.assign({},t),{key:"activity-progress",children:c});return r.default.createElement(i,Object.assign({},f))}function B(e){const{before:t,content:n,after:a,props:s={}}=e;if(!(t||n||a))return null;const l=[t,n,a].filter(Boolean);return s.children=l,r.default.createElement(i,Object.assign({},s))}const G=e=>{var t,a,s,r,l,o,i,c,u;return e.header||(e.header={}),(t=e.header).props||(t.props={}),(a=e.header.props).key||(a.key="header"),(s=e.header.props).className||(s.className="head"),e.content||(e.content={}),(r=e.content).props||(r.props={}),(l=e.content.props).key||(l.key="content"),(o=e.content.props).className||(o.className="content"),e.footer||(e.footer={}),(i=e.footer).props||(i.props={}),(c=e.footer.props).key||(c.key="footer"),(u=e.footer.props).className||(u.className="foot"),e.props||(e.props={}),n.assertPopulatedObject(e.icons),e};function L(e){const t=r.default.useContext(k),{collapsed:n}=t;if(n)return null;const{before:a,content:s,after:l,props:o={}}=e;if(!(a||s||l))return null;const c=[a,s,l].filter(Boolean);return o.children=c,r.default.createElement(i,Object.assign({},o))}function z(e){const t=r.default.useContext(k),{collapsed:n,changeCollapsed:a}=t,s=Object.assign(Object.assign({},e),{onClick:()=>{a(!n)}});return r.default.createElement(i,Object.assign({},s))}function F(e){return r.default.useContext(k).collapsed?null:r.default.createElement(r.default.Fragment,null,e.children)}function V(e){return r.default.useContext(k).collapsed?r.default.createElement(r.default.Fragment,null,e.children):null}const $=function(t={}){var a,s,l,o,c,u;const d=G(t),{icons:f}=d;(a=d.props).key||(a.key="activity"),(s=d.props).className||(s.className="panel activity"),(l=d.props).initialPicked||(l.initialPicked=e.ActivityGroup.Active),n.isUndefined(d.props.collapsed)&&(d.props.collapsed=!0),(o=d.header).content||(o.content=[f.activity,r.default.createElement(F,{key:"not-collapsed"},r.default.createElement(i,{key:"view"})),r.default.createElement(V,{key:"collapsed"},r.default.createElement(I,{key:"progress",className:"progress"})),r.default.createElement(z,{key:"collapse-control"},r.default.createElement(F,{key:"not-collapsed",children:f.collapse}),r.default.createElement(V,{key:"collapsed",children:f.collapsed}))]),(c=d.content).children||(c.children=r.default.createElement(N,{className:"item",collapsed:!0},r.default.createElement(z,{key:"collapse-control"},r.default.createElement(F,{key:"not-collapsed",children:f.collapse}),r.default.createElement(V,{key:"collapsed",children:f.collapsed})),r.default.createElement(w,{key:"label",className:"label"}),r.default.createElement(R,{key:"active",id:"active"},r.default.createElement(I,{key:"progress"})),r.default.createElement(R,{key:"error",id:"error",children:f.error}),r.default.createElement(R,{key:"complete",id:"complete",children:f.complete}))),(u=d.footer).content||(u.content=[r.default.createElement(M,{key:"active",id:"active",className:n.ClassButton,children:f.active}),r.default.createElement(M,{key:"error",id:"error",className:n.ClassButton,children:f.error}),r.default.createElement(M,{key:"complete",id:"complete",className:n.ClassButton,children:f.complete})]);const p=r.default.createElement(r.default.Fragment,null,r.default.createElement(B,Object.assign({},d.header)),r.default.createElement(x,Object.assign({},d.content.props),d.content.children),r.default.createElement(L,Object.assign({},d.footer)));return Object.assign(Object.assign({},d.props),{children:p})},H={enabled:!1,servers:{},endpointPromise:()=>Promise.resolve({})},q=r.default.createContext(H);function U(e){const t=r.default.useContext(q),{enabled:n}=t;return n?r.default.createElement(r.default.Fragment,null,e.children):null}const W={width:0,height:0,videoRate:0,streaming:!1,updating:!1,preloading:!1,setPreloading:()=>{},setStreaming:()=>{},setWidth:()=>{},setHeight:()=>{},setVideoRate:()=>{},setUpdating:()=>{},setId:()=>{},id:"",setUrl:()=>{},url:""},Z=r.default.createContext(W);const J={error:"",processing:!1,progress:0,setError:()=>{},setProcessing:()=>{},setProgress:()=>{},setStatus:()=>{},status:""},X=r.default.createContext(J);const _=()=>r.default.useContext(T).editor;const K={addPicker:n.EmptyMethod,definitions:[],pick:n.EmptyMethod,picked:"",removePicker:n.EmptyMethod},Y=r.default.createContext(K);function Q(e){const{initialPicked:t="container"}=e,a=l(e,["initialPicked"]);n.assertPopulatedString(t);const[s,c]=r.default.useState({}),u=r.default.useContext(q),d=r.default.useContext(T),{changeDefinition:f}=d,[p,m]=r.default.useState([]),[g,y]=r.default.useState(t),{enabled:h,servers:E,endpointPromise:b}=u,v=e=>{const t=(e=>{const t=e.map((e=>n.Defined.byType(e)));return 1===t.length?t[0]:t.flat()})(e);if(!h||!E[n.ServerType.Data])return Promise.resolve(t);const a={types:e};return b(n.Endpoints.data.definition.retrieve,a).then((e=>{console.debug("DataDefinitionRetrieveResponse",n.Endpoints.data.definition.retrieve,e);const{definitions:a}=e,s=a.filter((e=>{const{id:n}=e;return!t.some((e=>e.id===n))}));return[...t,...s.map((e=>n.DefinitionBase.fromObject(e)))]}))},C=e=>o(this,void 0,void 0,(function*(){f(),m(yield v(e))})),O=e=>o(this,void 0,void 0,(function*(){const t=n.isPopulatedString(e)&&s[e]||[];yield C(t)})),k=e=>o(this,void 0,void 0,(function*(){n.assertPopulatedString(e),y(e),yield O(e)}));j({[n.EventType.Added]:e=>o(this,void 0,void 0,(function*(){const{type:t}=e;if(n.isEventType(t)&&e instanceof CustomEvent){const{detail:t}=e,{definitionTypes:a}=t;if(n.isPopulatedArray(a)){const e=a,t=Object.keys(s).filter((t=>{const a=s[t];return n.assertPopulatedArray(a),a.some((t=>e.includes(t)))}));if(!n.isPopulatedArray(t))return;const r=t.includes(g)?g:t.shift();n.assertPopulatedString(r),yield k(r)}}})),[n.EventType.Resize]:()=>{O().then((()=>{O(g)}))}});const S={value:{definitions:p,picked:g,pick:k,addPicker:(e,t)=>o(this,void 0,void 0,(function*(){c((n=>(n[e]=t,n))),e===g&&(yield C(t))})),removePicker:e=>{c((t=>(delete t[e],t)))}},children:r.default.createElement(i,Object.assign({},a))};return r.default.createElement(Y.Provider,Object.assign({},S))}const ee={},te=r.default.createContext(ee),ne="/x-moviemasher",ae=e=>n.isObject(e)&&"offset"in e;const se=e=>ae(e)&&"definitionObject"in e;function re(e){se(e)||n.throwError(e,"DragDefinitionObject")}var le;e.DragType=void 0,(le=e.DragType||(e.DragType={})).Mash="mash",le.Layer="layer",le.Track="track";const oe=Object.values(e.DragType),ie=e=>n.isString(e)&&oe.includes(e),ce="Files",ue=e=>n.isString(e)&&e.endsWith(ne),de=e=>{if(e)return e.types.find(ue)},fe=e=>{const[t]=e.split("/");return n.assertDefinitionType(t),t},pe=e=>{const t=de(e);if(!t)return;const[a]=t.split("/");return ie(a)||n.isDefinitionType(a)?a:void 0},me=e=>{const{types:t}=e;return t.filter((e=>e===ce||ue(e)))},ge=(e,t)=>{const n=t?`${t}${ne}`:me(e).find(ue);if(!n)return{};const a=e.getData(n);return a?JSON.parse(a):{}},ye=e=>e.getBoundingClientRect(),he=(e,t)=>{const n=t instanceof Element?ye(t):t,{x:a,y:s}=n,{clientY:r,clientX:l}=e;return{x:l-a,y:r-s}},Ee=(e,t={})=>{const a=[],{length:s}=e;if(!s)return a;const r=n.isPopulatedObject(t),{extensions:l={},uploadLimits:o={}}=t,i=l,c=o;for(let t=0;t<s;t++){const s=e.item(t);if(!s)continue;const{name:l,size:o,type:u}=s,d=u.split("/").shift();if(!n.isUploadType(d)){a.push({label:l,value:d,error:"import.type"});continue}const f=c[d];if(r&&!(n.isAboveZero(f)&&1024*f*1024>o)){a.push({label:l,value:`${f}MB`,error:"import.bytes"});continue}const p=l.toLowerCase().split(".").pop(),m=n.isPopulatedString(p),g=i[d];!r&&m||m&&n.isArray(g)&&g.includes(p)?a.push(s):a.push({label:l,value:p,error:"import.extension"})}return a},be=e=>{if(n.isUndefined(e))return"";switch(e){case n.DroppingPosition.After:return n.ClassDroppingAfter;case n.DroppingPosition.Before:return n.ClassDroppingBefore;case n.DroppingPosition.None:return""}return n.ClassDropping};function ve(e){const[t,a]=r.default.useState(!1),{className:s,children:o}=e,c=l(e,["className","children"]),u=r.default.Children.only(o);n.assertTrue(r.default.isValidElement(u));const d=r.default.useContext(T),f=r.default.useContext(Y).definitions||[],{drop:p}=d,m=e=>!!e&&me(e).includes(ce),g=e=>{n.eventStop(e),a(!1)},y=[];s&&y.push(s),t&&y.push(n.ClassDropping);const h=Object.assign(Object.assign({},c),{className:y.join(" "),key:"browser-content",children:(()=>{const e=u.props;return f.map((t=>{const n=Object.assign(Object.assign({},e),{key:t.id}),a={children:r.default.cloneElement(u,n),value:{definition:t},key:t.id};return r.default.createElement(te.Provider,Object.assign({},a))}))})(),onDrop:e=>{g(e);const{dataTransfer:t}=e;m(t)&&p(t.files)},onDragOver:e=>{n.eventStop(e),a(m(e.dataTransfer))},onDragLeave:g});return r.default.createElement(i,Object.assign({},h))}const Ce=(e,t,a)=>e?[e]:t?n.isString(t)?t.split(",").map((e=>e.trim())):t:a?a.map((e=>e.name)):[],Oe=(e,t,a)=>{const s=Ce(e,t);a&&!s.length&&s.push(a);return s.filter((e=>n.isDefinitionType(e))).map((e=>e))},Te=(e,t,a)=>{const s=Ce(e,t);a&&!s.length&&s.push(a);return s.filter((e=>n.isSelectType(e))).map((e=>e))};function je(e){const{children:t,type:a,types:s,className:o,id:i}=e,c=l(e,["children","type","types","className","id"]);n.assertPopulatedString(i);const u=r.default.Children.only(t);n.assertTrue(r.default.isValidElement(u),A.child);const d=r.default.useContext(Y),{pick:f,picked:p,addPicker:m,removePicker:g}=d,y=[];o&&y.push(o),p===i&&y.push(n.ClassSelected);r.default.useEffect((()=>(m(i,Oe(a,s,i)),()=>{g(i)})),[]);const h=Object.assign(Object.assign({},c),{className:y.join(" "),key:`browser-picker-${i}`,onClick:()=>{f(i)}});return r.default.cloneElement(u,h)}const ke="upload-control-id";function Se(e){const t=r.default.useRef(null),a=r.default.useContext(q),s=r.default.useContext(T),{servers:o}=a,{drop:i}=s,{children:c}=e,u=l(e,["children"]),{file:d={}}=o,{extensions:f=Object.fromEntries(n.UploadTypes.map((e=>[e,[]])))}=d;n.assertObject(f);const p=Object.entries(f).flatMap((([e,t])=>[`${e}/*`,...t.map((e=>`.${e}`))])).join(","),m=Object.assign({accept:p,id:ke,onChange:e=>{const{files:t}=e.currentTarget;t&&i(t)},type:"file",key:"browser-control-input",ref:t},u),g=r.default.createElement("input",Object.assign({},m));if(!r.default.isValidElement(c))return g;const y={children:[r.default.Children.only(c),g],key:"browser-control",htmlFor:ke};return r.default.createElement("label",Object.assign({},y))}const De=()=>r.default.useContext(te).definition;function Pe(e){const{className:t,iconRatio:a}=e,s=l(e,["className","iconRatio"]),c=a||.25,u=r.default.useRef(null),d=r.default.useRef(null),f=r.default.useContext(T),{editor:p,definition:m,changeDefinition:g}=f;n.assertTrue(p);const y=De(),{id:h,label:E}=y,b=()=>o(this,void 0,void 0,(function*(){const{rect:e,preloader:t}=p,{current:a}=u;if(!a||!n.sizeAboveZero(e))return;const s=n.sizeCeil(n.sizeScale(n.sizeCopy(e),c,c)),r=yield y.definitionIcon(t,s);r&&a.replaceChildren(r)}));r.default.useEffect((()=>{b()}),[]),u.current&&b();const v=e=>{e.stopPropagation(),g(y)},C=e=>{v(e);const t=d.current.getBoundingClientRect(),{left:n}=t,{clientX:a}=e,s={offset:a-n,definitionObject:y},r=JSON.stringify(s),{dataTransfer:l}=e;l&&(l.effectAllowed="copy",l.setData(y.type+ne,r))},O=Object.assign(Object.assign({},s),{className:t,children:(()=>{const e=[r.default.createElement(i,{key:"icon",ref:u})];return E&&e.unshift(r.default.createElement("label",{key:"label"},E)),e})(),ref:d,key:h});return e.draggable&&(O.onDragStart=C,O.onPointerDown=v,O.className=(()=>{const e=[];return t&&e.push(t),(null==m?void 0:m.id)===h&&e.push(n.ClassSelected),e.join(" ")})()),r.default.createElement(i,Object.assign({},O))}const xe=function(e={}){var t,a,s,l,o,i,c,u;const d=G(e),{icons:f}=d;(t=d.props).key||(t.key="browser"),(a=d.props).className||(a.className="panel browser"),(s=d.props).initialPicked||(s.initialPicked="container"),(l=d.header).content||(l.content=[f.browser]),(o=d.footer).content||(o.content=[r.default.createElement(je,{key:"effect",id:"effect",className:n.ClassButton,children:f.browserEffect}),r.default.createElement(je,{key:"container",id:"container",className:n.ClassButton,children:f.container}),r.default.createElement(je,{key:"content",id:"content",className:n.ClassButton,children:f.content})]),(i=d.footer).before||(i.before=[r.default.createElement(je,{key:"video",id:"video",types:"video,videosequence",className:n.ClassButton,children:f.browserVideo}),r.default.createElement(je,{key:"audio",id:"audio",className:n.ClassButton,children:f.browserAudio}),r.default.createElement(je,{key:"image",id:"image",className:n.ClassButton,children:f.browserImage})]),(c=d.footer).after||(c.after=[r.default.createElement(Se,{key:"import",children:f.import})]),(u=d.content).children||(u.children=r.default.createElement(Pe,{draggable:!0,className:"definition preview"}));const p=r.default.createElement(r.default.Fragment,null,r.default.createElement(B,Object.assign({},d.header)),r.default.createElement(ve,Object.assign({},d.content.props),d.content.children),r.default.createElement(B,Object.assign({},d.footer)));return Object.assign(Object.assign({},d.props),{children:p})},Ne={prevClipEnd:0},we=r.default.createContext(Ne),Ae={},Re=r.default.createContext(Ae),Me={dragTypeValid:()=>!1,frame:0,frames:0,onDragLeave:n.EmptyMethod,onDrop:n.EmptyMethod,rect:n.RectZero,refreshed:0,refresh:n.EmptyMethod,scale:0,scroll:{x:0,y:0},setDroppingClip:n.EmptyMethod,setDroppingPosition:n.EmptyMethod,setDroppingTrack:n.EmptyMethod,setRect:n.EmptyMethod,setScroll:n.EmptyMethod,setZoom:n.EmptyMethod,zoom:1},Ie=r.default.createContext(Me),Be={depth:0},Ge=r.default.createContext(Be),Le=()=>r.default.useContext(Ge).layer;function ze(e){const{className:t}=e,a=l(e,["className"]),s=r.default.useRef(null),o=r.default.useRef(null),c=_(),u=r.default.useContext(Re),d=r.default.useContext(Ie),[f,p]=r.default.useState(0),m=()=>{p((new Date).valueOf())},g=r.default.useRef({}),{current:y}=g,h=r.default.useContext(we),{droppingPosition:E,droppingClip:b,scale:v,selectedClip:C,onDrop:O,dragTypeValid:T,setDroppingPosition:k,setDroppingClip:S,setDroppingTrack:D,onDragLeave:P}=d,{track:x}=u,{clip:N,prevClipEnd:w}=h;n.assertTrue(N);const A=()=>{const{current:e}=s,t=null==e?void 0:e.parentNode;return t instanceof HTMLDivElement?t.getBoundingClientRect().height:0},[R,M]=r.default.useState(A),{label:I,type:B,frame:G,frames:L}=N,z=()=>{if(!n.isAboveZero(v)||!n.isAboveZero(L))return 0;const e=n.pixelFromFrame(L,v,"floor"),{width:t}=y;return e&&e!==t&&(y.width=e,m()),e},F=z();j({[n.EventType.Action]:e=>{if(y.redraw)return;const{type:t}=e;if(!n.isEventType(t))return;if(!(e instanceof CustomEvent))return;if(t!==n.EventType.Action)return;const{detail:a}=e;if(!a)return;const{action:s}=a;if(!s)return;const{target:r}=s;if(n.isObject(r)){switch(r){case N:case N.container:case N.content:break;default:if("color"===s.property)break;return}m()}},[n.EventType.Save]:m});const V=()=>{const{width:e,redraw:t}=y;delete y.timeout,delete y.redraw;const{current:a}=s,{edited:r}=c,l=a&&r&&e&&e===z();if((t||!l)&&(m(),!l))return Promise.resolve();const o=(()=>{const{rect:e}=c,t={width:R*(e.width/e.height),height:R};return n.sizeCeil(t)})(),i=(e=>{const{width:t,height:n}=e;return{width:Math.max(t,F),height:n}})(o),u=N.clipIcon(i,d.scale,2);return u?u.then((t=>{const s=z();t&&e>=s&&a.replaceChildren(((e,t,a)=>{const s=n.colorToRgb(e),r=n.colorRgbDifference(s),l=n.colorFromRgb(r),o=n.svgPolygonElement(t,"",e),i={x:t.width,y:0,width:a,height:t.height},c=n.svgPolygonElement(i,"",l),u={width:t.width+a,height:t.height},f=n.idGenerate("pattern"),p=[o,c],m=n.svgPatternElement(u,f,p),g=n.svgDefsElement([m]),y={width:d.rect.width,height:R},h=n.svgPolygonElement(y,"",n.svgUrl(f));return n.svgElement(y,[g,h])})(r.color,o,2),t)})):Promise.resolve()};r.default.useEffect((()=>{if(!R)return M(A);const{current:e}=s,{edited:t}=c;e&&t&&(y.timeout?y.redraw||(y.redraw=!0):y.timeout=setTimeout(V,500))}),[f,v,R]);const $=e=>{e.stopPropagation(),c.selection.set(N)},H={width:F};w>-1&&(H.marginLeft=n.pixelFromFrame(G-w,v,"floor"));const q=Object.assign(Object.assign({},a),{style:H,className:(()=>{const e=N===C,a=[];return t&&a.push(t),e&&a.push(n.ClassSelected),b===N&&a.push(be(E)),a.join(" ")})(),onPointerDown:$,onDragStart:e=>{$(e);const{dataTransfer:t,clientX:n}=e,{current:a}=o;if(!t||!a)return;const s=a.getBoundingClientRect(),{left:r}=s,l={offset:n-r},i=JSON.stringify(l);t.effectAllowed="move",t.setData(B+ne,i)},onDragEnd:e=>{n.eventStop(e);const{dataTransfer:t}=e;if(!t)return;const{dropEffect:a}=t;"none"===a&&c.removeClip(N)},onDragOver:e=>{n.eventStop(e);const{dataTransfer:t}=e;if(!t)return;const a=T(t,N),s=a?n.DroppingPosition.At:n.DroppingPosition.None;D(a?x:void 0),S(a?N:void 0),k(s)},onDragLeave:P,onDrop:O,onClick:e=>e.stopPropagation(),draggable:!0,ref:o,children:(()=>{const e={key:"clip-previews",ref:s},t={width:F,height:R};if(n.sizeAboveZero(t)){const{width:n,height:a}=t;e.width=n,e.height=a,e.viewBox=`0 0 ${n} ${a}`}const a=[r.default.createElement("svg",Object.assign({},e))];return I&&a.unshift(r.default.createElement("label",{key:"label"},I)),a})()});return r.default.createElement(i,Object.assign({},q))}const Fe={refreshed:0,refresh:n.EmptyMethod,validDragType:()=>{},droppingPosition:n.DroppingPosition.None,setDroppingPosition:n.EmptyMethod,onDrop:n.EmptyMethod,setDroppingLayer:n.EmptyMethod,onDragLeave:n.EmptyMethod},Ve=r.default.createContext(Fe);function $e(t){const a=r.default.useContext(T),[s,l]=r.default.useState(void 0),[o,c]=r.default.useState(void 0),[u,d]=r.default.useState(0),[f,p]=r.default.useState(n.DroppingPosition.None),{editor:m,draggable:g,drop:y}=a,h=()=>{d((e=>e+1))};if(j({[n.EventType.Selection]:()=>{l(m.selection.layer)},[n.EventType.Cast]:h}),!m)return null;const E=t=>{if(!t)return;const n=pe(t);return ie(n)&&[e.DragType.Mash,e.DragType.Layer].includes(n)?n:void 0},b={refreshed:u,refresh:h,selectedLayer:s,validDragType:E,droppingPosition:f,setDroppingPosition:p,onDrop:t=>{t.preventDefault(),p(n.DroppingPosition.None),h();const{dataTransfer:a}=t;n.assertObject(a);if(me(a).includes(ce)){const e={};return void y(a.files,e)}const s=E(a);if(!s)return;const r={layer:o,position:f};switch(s){case e.DragType.Layer:n.isLayer(g)&&m.moveLayer(g,r);break;case e.DragType.Mash:{const e={mashObject:{},definitionObjects:[]};m.addMash(e,r);break}default:g&&y(g)}},droppingLayer:o,setDroppingLayer:c,onDragLeave:()=>{p(n.DroppingPosition.None),c(void 0)}},v={children:r.default.createElement(i,Object.assign({},t)),value:b};return r.default.createElement(Ve.Provider,Object.assign({},v))}function He(e){const t=r.default.useRef(null);r.default.useContext(T);const a=r.default.useContext(Ve),s=r.default.useContext(Ge),{validDragType:o,droppingPosition:c,setDroppingPosition:u,onDrop:d,droppingLayer:f,setDroppingLayer:p,onDragLeave:m}=a,g=_(),{layer:y}=s;if(!y)return null;const{className:h="layer"}=e,E=l(e,["className"]),b=e=>{e.stopPropagation(),g.selection.set(y)},v=r.default.useMemo((()=>{const e=y===g.selection.layer,t=[h];return e&&t.push(n.ClassSelected),f===y&&t.push(be(c)),t.join(" ")}),[c,f,g.selection.layer]),C=Object.assign(Object.assign({},E),{className:v,ref:t,onMouseDown:b,onDragStart:e=>{const a=he(e,t.current);b(e);const{dataTransfer:s}=e;n.isObject(s)&&(s.effectAllowed="move",s.setData(`layer${ne}`,JSON.stringify(a)))},onDragEnd:e=>{const{dataTransfer:t}=e;if(!t)return;const{dropEffect:n}=t;"none"===n&&g.removeLayer(y)},onClick:e=>{e.stopPropagation(),g.selection.set(y)},onDragLeave:m,onDragOver:e=>{const a=(e=>{const{dataTransfer:a}=e,{current:s}=t;if(!s||!o(a))return n.DroppingPosition.None;const r=ye(t.current),l=he(e,r),i=Math.ceil(r.height/4),c=n.isLayerFolder(y);return l.y<i*(c?1:2)?n.DroppingPosition.Before:!c||l.y>3*i?n.DroppingPosition.After:n.DroppingPosition.At})(e);u(a),p(y),n.eventStop(e)},onDrop:d,draggable:!0});return r.default.createElement(i,Object.assign({},C))}function qe(e){const t=r.default.useContext(Ve),{droppingLayer:a,setDroppingLayer:s,droppingPosition:o,setDroppingPosition:c,onDrop:u,onDragLeave:d}=t,f=_(),{className:p="content",children:m}=e,g=l(e,["className","children"]),y=r.default.Children.only(m);n.assertTrue(r.default.isValidElement(y));const h=(e,t=0)=>e.flatMap((n=>n?E(n,t):(console.trace("layersArray no layer",t,e),[]))),E=(e,t)=>{const a={layer:e,depth:t},s={key:`layer-${e.id}`,value:a,children:r.default.createElement(He,Object.assign({},y.props))},l=[r.default.createElement(Ge.Provider,Object.assign({},s))];return n.isLayerFolder(e)&&!e.collapsed&&l.push(...h(e.layers,t+1)),l},b=r.default.useMemo((()=>{var e;return h((null===(e=f.selection.cast)||void 0===e?void 0:e.layers)||[])}),[t.refreshed,t.selectedLayer]),v=r.default.useMemo((()=>{const e=[p];return o===n.DroppingPosition.None||a||e.push(n.ClassDropping),e.join(" ")}),[o,a,f.selection.layer]),C=Object.assign(Object.assign({},g),{children:b,key:"composer-view",onClick:()=>{f.selection.unset(n.SelectType.Layer)},onDragLeave:d,onDragOver:e=>{e.preventDefault();const{dataTransfer:t}=e;(e=>!!e&&(!!me(e).includes(ce)||!!pe(e)))(t)&&(c(b.length),s())},onDrop:u,className:v});return r.default.createElement(i,Object.assign({},C))}function Ue(e){const t=r.default.useContext(Ge),{depth:n}=t,a=r.default.Children.only(e.children);if(!r.default.isValidElement(a))throw A.child;const s=new Array(n).fill(!0).map(((e,t)=>{const n=Object.assign(Object.assign({},a.props),{key:`depth-${t}`});return r.default.cloneElement(a,n)}));return r.default.createElement(r.default.Fragment,null,s)}function We(e){const t=r.default.useContext(Ve),a=Le();if(a.type!==n.LayerType.Folder)return null;const s=a;if(s.collapsed)return null;const{children:o}=e,i=l(e,["children"]),c=r.default.Children.only(o);if(!r.default.isValidElement(c))throw A.child;const u=Object.assign(Object.assign({},i),{onClick:()=>{s.collapsed=!0,t.refresh()}});return r.default.cloneElement(c,u)}function Ze(e){const{children:t}=e,a=l(e,["children"]),s=r.default.Children.only(t);if(!r.default.isValidElement(s))throw A.child;const o=r.default.useContext(Ve),i=Le();if(i.type!==n.LayerType.Folder)return null;const c=i;if(!c.collapsed)return null;const u=Object.assign(Object.assign({},a),{onClick:()=>{c.collapsed=!1,o.refresh()}});return r.default.cloneElement(s,u)}function Je(e){return Le().type!==n.LayerType.Folder?null:r.default.createElement(r.default.Fragment,null,e.children)}function Xe(e){const t=Le(),[a,s]=r.default.useState(t.label);j({[n.EventType.Action]:e=>{if(!n.isActionEvent(e))return;const{action:a}=e.detail;n.isChangeAction(a)&&t===a.target&&s(t.label)}});const l=Object.assign(Object.assign({},e),{children:a});return r.default.createElement("label",Object.assign({},l))}function _e(e){return Le().type!==n.LayerType.Mash?null:r.default.createElement(r.default.Fragment,null,e.children)}function Ke(e){const{useView:t,selected:a}=e,s=l(e,["useView","selected"]);if(!t)return r.default.createElement("button",Object.assign({},s));const{disabled:o,className:c}=s,u=l(s,["disabled","className"]),d=[n.ClassButton];c&&d.push(c),o?d.push(n.ClassDisabled):a&&d.push(n.ClassSelected);const f=Object.assign(Object.assign({},u),{className:d.join(" ")});return r.default.createElement(i,Object.assign({},f))}function Ye(e){const t=_(),n=r.default.useContext(Ve),{children:a}=e,s=l(e,["children"]),o=r.default.Children.only(a);if(!r.default.isValidElement(o))throw A.child;const i=Object.assign(Object.assign({},s),{onClick:()=>{t.addFolder(),n.refresh()}});return r.default.cloneElement(o,i)}function Qe(e){const t=_(),n=r.default.useContext(Ve),{children:a}=e,s=l(e,["children"]),o=r.default.Children.only(a);if(!r.default.isValidElement(o))throw A.child;const i=Object.assign(Object.assign({},s),{onClick:()=>{t.addMash(),n.refresh()}});return r.default.cloneElement(o,i)}const et=function(e={}){var t,a,s,l,o,i;const c=G(e),{icons:u}=c;(t=c.props).key||(t.key="composer"),(a=c.props).className||(a.className="panel composer"),(s=c.props).initialPicked||(s.initialPicked="container"),(l=c.header).content||(l.content=[u.composer]),(o=c.footer).content||(o.content=[r.default.createElement(Qe,null,r.default.createElement(Ke,null,u.add,u.mmWide)),r.default.createElement(Ye,null,r.default.createElement(Ke,null,u.add,u.folder))]),(i=c.content).children||(i.children=r.default.createElement("div",{key:"layer",className:"layer"},r.default.createElement("div",{key:"icons"},r.default.createElement(Ue,{key:"depth"},r.default.createElement("div",{className:"depth"})),r.default.createElement(Je,{key:"layer-folder"},r.default.createElement(Ze,{key:"folder-open"},r.default.createElement("div",{className:n.ClassButton},u.folder)),r.default.createElement(We,{key:"folder-close"},r.default.createElement("div",{className:n.ClassButton},u.folderOpen))),r.default.createElement(_e,{key:"layer-mash"},r.default.createElement("div",{key:"mash-icon",className:n.ClassButton},u.mmTube))),r.default.createElement(Xe,{key:"label"}),r.default.createElement("div",{key:"play-button",className:n.ClassButton},u.playerPlay)));const d=r.default.createElement(r.default.Fragment,null,r.default.createElement(B,Object.assign({},c.header)),r.default.createElement(qe,Object.assign({},c.content.props),c.content.children),r.default.createElement(B,Object.assign({},c.footer)));return Object.assign(Object.assign({},c.props),{children:d})};function tt(e){const{children:t}=e,a=l(e,["children"]),s=_(),o=()=>s.can(n.MasherAction.Save),[i,c]=r.default.useState(o),u=()=>{c(o())};j({[n.EventType.Action]:u,[n.EventType.Mash]:u,[n.EventType.Cast]:u,[n.EventType.Save]:u});const d=Object.assign(Object.assign({},a),{onClick:()=>{i||s.create()},disabled:i});return r.default.cloneElement(r.default.Children.only(t),d)}function nt(e){const[t,a]=r.default.useState(!0),s=_();j({[n.EventType.Action]:()=>{a(!s.can(n.MasherAction.Redo))}});const{children:o}=e,i=l(e,["children"]),c=Object.assign(Object.assign({},i),{onClick:()=>{s.redo()},disabled:t});return r.default.cloneElement(r.default.Children.only(o),c)}function at(e){const{children:t,type:a}=e,s=l(e,["children","type"]),o=a||n.SelectType.Clip;n.assertSelectType(o);const i=_(),[c,u]=r.default.useState(!i.selection[o]);j({[n.EventType.Selection]:()=>{u(!i.selection[o])}});const d=r.default.Children.only(t),f=Object.assign(Object.assign(Object.assign({},s),d.props),{onClick:()=>{if(c)return;const e=i.selection[o];n.isEffect(e)?i.removeEffect(e):n.isClip(e)?i.removeClip(e):n.isTrack(e)&&i.removeTrack(e)},disabled:c});return r.default.cloneElement(d,f)}function st(e){const t=_(),[a,s]=r.default.useState(!0);j({[n.EventType.Action]:()=>{s(!t.can(n.MasherAction.Undo))}});const{children:o}=e,i=l(e,["children"]),c=Object.assign(Object.assign({},i),{onClick:()=>{t.undo()},disabled:a});return r.default.cloneElement(r.default.Children.only(o),c)}function rt(e){const t=r.default.useContext(X),a=r.default.useContext(q),{children:s}=e,o=l(e,["children"]),{processing:i,setProcessing:c,setError:u}=t,{endpointPromise:d}=a,f=_(),p=()=>!f.can(n.MasherAction.Render),[m,g]=r.default.useState(p),y=()=>g(p());j({[n.EventType.Save]:y,[n.EventType.Mash]:y,[n.EventType.Action]:y});const h=(e,t)=>{setTimeout((()=>{console.debug("handleApiCallback request",e),n.fetchCallback(e).then((a=>{console.debug("handleApiCallback response",a);const{apiCallback:s,error:r}=a;if(r)E(e.endpoint.prefix,e.request,a,r);else if(s){const{request:e,endpoint:a}=s;if(a.prefix===n.Endpoints.data.mash.put){const n=e.body,{rendering:a}=n.mash;a&&(t.rendering=a)}h(s,t)}else c(!1)}))}),2e3)},E=(e,t,n,a)=>{c(!1),u(a),console.error(e,t,n,a)},b=Object.assign(Object.assign({},o),{onClick:()=>{if(m||i)return;const{edited:e}=f;n.assertMash(e),c(!0);const t={mash:e.toJSON(),definitions:f.definitions.map((e=>e.toJSON())),outputs:[{outputType:n.OutputType.Video}]};console.debug("RenderingStartRequest",n.Endpoints.rendering.start,t),d(n.Endpoints.rendering.start,t).then((a=>{console.debug("RenderingStartResponse",n.Endpoints.rendering.start,a);const{apiCallback:s,error:r}=a;r?E(n.Endpoints.rendering.start,t,a,r):h(s,e)}))},disabled:m||i});return r.default.cloneElement(r.default.Children.only(s),b)}function lt(e){const t=_(),a=r.default.useContext(T),{save:s}=a,o=()=>!t.can(n.MasherAction.Save),[i,c]=r.default.useState(o),u=()=>{c(o())};j({[n.EventType.Action]:u,[n.EventType.Save]:u});const{children:d}=e,f=l(e,["children"]),p=Object.assign(Object.assign({},f),{onClick:()=>{i||(c(!0),s())},disabled:i});return r.default.cloneElement(r.default.Children.only(d),p)}const ot={actionCount:0,selectedInfo:{tweenDefined:{},tweenSelected:{},selectedType:n.SelectType.None,selectTypes:[]},selectedItems:[],changeSelected:n.EmptyMethod,changeTweening:n.EmptyMethod},it=r.default.createContext(ot);function ct(e){var t,a;const s=_(),[l,o]=r.default.useState(!1),[i,c]=r.default.useState((()=>[])),[u,d]=r.default.useState((null===(t=s.edited)||void 0===t?void 0:t.id)||""),f=r.default.useContext(q),g=r.default.useContext(it),{selectedInfo:y}=g,{selectedType:h}=y,[E,b]=r.default.useState((null===(a=s.edited)||void 0===a?void 0:a.label)||""),v=()=>s.can(n.MasherAction.Save),[C,O]=r.default.useState(v),{enabled:T,servers:k,endpointPromise:S}=f,D=()=>{O(v())},P=e=>{const{type:t}=e;if(!n.isEventType(t)||!n.isSelectType(t))return;if(t!==h)return;const{edited:a}=s;n.assertObject(a);const{id:r,label:l}=a;c((e=>{const t=e.filter((e=>n.isPopulatedString(e.label))),s=t.findIndex((e=>e.id===r));return n.isPositive(s)?t.splice(s,1,a):t.push(a),d(r),b(l),t}))};j({[n.EventType.Action]:()=>{const{edited:e}=s;n.assertObject(e);const{label:t}=e;E!==t&&(c((e=>[...e])),b(t)),D()},[n.EventType.Mash]:P,[n.EventType.Cast]:P,[n.EventType.Save]:D},s.eventTarget);r.default.useEffect((()=>{if(!T||!k[n.ServerType.Data])return;if(l)return;o(!0);const e={partial:!0},t=n.Endpoints.data[s.editType].retrieve;console.debug("RetrieveRequest",t,e),S(t,e).then((e=>{console.debug("RetrieveResponse",t,e);const{described:n,error:a}=e;a?console.error("RetrieveResponse",t,a):c((e=>{const t=[...e];return n.forEach((e=>{const{id:n}=e,a=t.find((e=>e.id===n));a||t.push(e)})),t}))}))}),[k,T]);const x=Object.assign(Object.assign({},e),{onChange:e=>{if(C)return;const{selectedIndex:t}=e.target,a=i[t];n.assertObject(a);const{id:r}=a,l={id:r},{editType:o}=s,c=n.Endpoints.data[o].get;console.debug("GetRequest",c,l),S(c,l).then((e=>{console.debug("GetResponse",c,e);const{error:t}=e;if(!t)return s.load(e);console.error("GetResponse",c,t)}))},disabled:C,children:(()=>{const{editType:e,edited:t}=s,a=[r.default.createElement("optgroup",{key:"group",label:p("open")})];if(!t)return a;const{id:l,label:o}=t;return a.push(...i.map((t=>{const{label:a,id:s}=t,i=s===l?o:a,c={children:n.isPopulatedString(i)?i:m("unlabeled",{type:e}),value:s,key:s};return r.default.createElement("option",Object.assign({},c))}))),a})(),value:u});return r.default.createElement("select",Object.assign({},x))}function ut(e){const t=_(),a=()=>{const{edited:e}=t;if(!n.isMash(e))return!0;const{rendering:a}=e;return!a},[s,o]=r.default.useState(a),i=()=>o(a());j({[n.EventType.Render]:i,[n.EventType.Mash]:i});const{children:c}=e,u=l(e,["children"]),d=Object.assign(Object.assign({},u),{onClick:()=>{if(s)return;const{edited:e}=t;n.assertMash(e);const a=n.urlForEndpoint(t.preloader.endpoint,e.rendering);window.open(a)},disabled:s});return r.default.cloneElement(r.default.Children.only(c),d)}const dt=r.default.createElement((function(e){return null}),{key:"empty"}),ft={[n.DataType.Frame]:dt,[n.DataType.Number]:dt,[n.DataType.Rgb]:dt,[n.DataType.String]:dt,[n.DataType.DefinitionId]:dt,[n.DataType.FontId]:dt,[n.DataType.Percent]:dt,[n.DataType.ContainerId]:dt,[n.DataType.ContentId]:dt,[n.DataType.Boolean]:dt,[n.DataType.Timing]:dt,[n.DataType.Sizing]:dt},pt={value:"",name:"",property:{type:n.DataType.String,name:"",defaultValue:""}},mt=r.default.createContext(pt);function gt(){const e=r.default.useContext(mt),{changeHandler:t,property:n,value:a,name:s}=e;if(!n)return null;const l={type:"checkbox",name:s,checked:!!a};return t?l.onChange=e=>{t(s,e.target.checked)}:l.disabled=!0,r.default.createElement("input",Object.assign({},l))}function yt(e){const{type:t,types:a,children:s,className:c}=e,u=l(e,["type","types","children","className"]),d=r.default.Children.only(s);n.assertTrue(r.default.isValidElement(d));const[f,p]=r.default.useState(!1),m=r.default.useContext(mt),g=r.default.useContext(T),{drop:y}=g,{changeHandler:h,value:E,name:b}=m;n.assertTrue(h);const v=Oe(t,a),C=e=>{const{dataTransfer:t}=e;n.assertTrue(t);if(me(t).includes(ce))return!0;const a=pe(t);return!!n.isDefinitionType(a)&&v.includes(a)},O=r.default.useMemo((()=>{const e=[];return c&&e.push(c),f&&e.push(n.ClassDropping),e.join(" ")}),[f]),j=Object.assign(Object.assign({},u),{className:O,children:(()=>{if(!E)return null;n.assertPopulatedString(E);const e=n.Defined.fromId(E);n.assertDefinition(e);const t={definition:e,key:e.id},a={children:r.default.cloneElement(d,t),value:{definition:e}};return r.default.createElement(te.Provider,Object.assign({},a))})(),onDragLeave:()=>{p(!1)},onDragOver:e=>{const t=C(e);p(t),t&&e.preventDefault()},onDrop:e=>o(this,void 0,void 0,(function*(){if(n.eventStop(e),p(!1),!C(e))return;const{dataTransfer:t}=e;n.assertTrue(t);if(me(t).includes(ce))return void(yield y(t.files).then((e=>{if(!e.length)return;const t=e.filter((e=>"containerId"!==b||n.isContainerDefinition(e))),[a]=t;a&&(n.assertTrue(n.Defined.installed(a.id),`${a.type} installed`),h(b,a.id))})));const a=de(t),s=t.getData(a),r=JSON.parse(s),{definitionObject:l}=r,[o]=n.Defined.define(l);("containerId"!==b||n.isContainerDefinition(o))&&h(b,l.id)})),value:String(E),key:`${b}-drop`});return r.default.createElement(i,Object.assign({},j))}function ht(){const e=r.default.useContext(mt),{changeHandler:t,value:a,name:s}=e;n.assertTrue(t);const l={children:n.Defined.byType(n.DefinitionType.Font).map((e=>{const{id:t,label:n}=e,a={value:t,children:n,key:t};return r.default.createElement("option",Object.assign({},a))})),name:s,onChange:e=>{t(s,e.target.value)},value:String(a),key:`${s}-select`};return r.default.createElement("select",Object.assign({},l))}function Et(){const e=r.default.useContext(mt),t=_(),{changeHandler:a,property:s,value:l,name:i,time:c}=e;if(!s)return null;const{min:u,max:d,step:f}=s,p={type:"number",name:i,value:String(l)};return n.isDefined(u)&&(p.min=u),n.isDefined(d)&&(p.max=d),n.isDefined(f)&&(p.step=f),a?p.onChange=e=>o(this,void 0,void 0,(function*(){const{value:n}=e.target;c&&(yield t.goToTime(c)),a(i,n)})):p.disabled=!0,r.default.createElement("input",Object.assign({},p))}function bt(e){const{className:t,onChange:n}=e,a=Object.assign({},e),s=["slider"];if(t&&s.push(t),a.className=s.join(" "),n){const e=e=>{n(e,e.currentTarget.valueAsNumber)};a.onChange=e}return r.default.createElement("input",Object.assign({type:"range"},a))}function vt(){const e=_(),t=r.default.useContext(mt),{changeHandler:a,property:s,value:l,name:i,time:c,defaultValue:u}=t;if(!s)return null;const{max:d,min:f,step:p,defaultValue:m}=s,g={value:n.isDefined(l)?l:n.isDefined(u)?u:m,min:n.isNumber(f)?f:0,max:n.isNumber(d)?d:1,step:n.isNumber(p)?p:.01,name:i};if(a){const t=(t,s)=>o(this,void 0,void 0,(function*(){const t=n.isArray(s)?s[0]:s;c&&(yield e.goToTime(c)),a(i,t)}));g.onChange=t}else g.disabled=!0;return r.default.createElement(bt,Object.assign({className:"slider"},g))}function Ct(){r.default.useContext(T);const e=r.default.useContext(mt),t=_(),{changeHandler:a,property:s,value:l,name:i,time:c,defaultValue:u}=e;if(!s)return null;const{defaultValue:d}=s,f=n.isDefined(l)?l:n.isDefined(u)?u:d,p={type:"color",name:i,value:String(f)};return a?p.onChange=e=>o(this,void 0,void 0,(function*(){const{value:n}=e.target;c&&(yield t.goToTime(c)),a(i,n)})):p.disabled=!0,r.default.createElement("input",Object.assign({},p))}function Ot(){const e=r.default.useContext(mt),{changeHandler:t,property:a,value:s,name:l}=e;if(!a)return null;const o={children:n.Sizings.map((e=>{const t={value:e,children:e,key:e};return r.default.createElement("option",Object.assign({},t))})),name:l,value:String(s),key:`${l}-select`};return t?o.onChange=e=>{t(l,e.target.value)}:o.disabled=!0,r.default.createElement("select",Object.assign({},o))}function Tt(){const e=r.default.useContext(mt),{changeHandler:t,property:n,value:a,name:s}=e;if(!n)return null;const l={name:s,type:"text",value:String(a)};return t?l.onChange=e=>{t(s,e.target.value)}:l.disabled=!0,r.default.createElement("input",Object.assign({},l))}function jt(){const e=r.default.useContext(mt),{changeHandler:t,property:a,value:s,name:l}=e;if(!a)return null;const o={children:n.Timings.map((e=>{const t={value:e,children:e,key:e};return r.default.createElement("option",Object.assign({},t))})),name:l,value:String(s),key:`${l}-select`};return t?o.onChange=e=>{t(l,e.target.value)}:o.disabled=!0,r.default.createElement("select",Object.assign({},o))}ft[n.DataType.Boolean]=r.default.createElement(gt,null),ft[n.DataType.ContainerId]=r.default.createElement(yt,{types:n.ContainerTypes,className:"definition-drop"},r.default.createElement(Pe,{className:"definition preview"})),ft[n.DataType.ContentId]=r.default.createElement(yt,{types:n.ContentTypes,className:"definition-drop"},r.default.createElement(Pe,{className:"definition preview"})),ft[n.DataType.FontId]=r.default.createElement(ht,null),ft[n.DataType.Number]=r.default.createElement(Et,null),ft[n.DataType.Frame]=r.default.createElement(Et,null),ft[n.DataType.Percent]=r.default.createElement(vt,null),ft[n.DataType.Rgb]=r.default.createElement(Ct,null),ft[n.DataType.Sizing]=r.default.createElement(Ot,null),ft[n.DataType.String]=r.default.createElement(Tt,null),ft[n.DataType.Timing]=r.default.createElement(jt,null);const kt={[n.DataGroup.Size]:dt,[n.DataGroup.Sizing]:dt,[n.DataGroup.Point]:dt,[n.DataGroup.Opacity]:dt,[n.DataGroup.Color]:dt,[n.DataGroup.Effects]:dt,[n.DataGroup.Timing]:dt};function St(e){const t=r.default.useContext(T),{icons:a}=t,s=_(),{selectType:o}=e,c=l(e,["selectType"]);n.assertSelectType(o);const u=r.default.useContext(it),{selectedItems:d,changeTweening:f,selectedInfo:p}=u,{tweenDefined:m,tweenSelected:g,onEdge:y,time:h,nearStart:E,timeRange:b}=p;n.assertTimeRange(b),n.assertTime(h);const v=m[n.DataGroup.Color],C=g[n.DataGroup.Color],O=n.selectedPropertyObject(d,n.DataGroup.Color,o),{color:j,[`color${n.PropertyTweenSuffix}`]:k}=O,S=C?k:j,{property:D,changeHandler:P,value:x,name:N}=S,{type:w,name:A}=D,R=N||A,M=ft[w],I={property:D,value:x,name:R,changeHandler:P};I.time=n.tweenInputTime(b,y,E,v,C),C&&(I.defaultValue=j.value);const B=[n.ClassSelected,n.ClassButton].join(" "),G={children:a.start,className:C?n.ClassButton:B,key:"start",onClick:()=>{s.goToTime(b.startTime),f(n.DataGroup.Color,!1)}},L={key:"end",className:C?B:n.ClassButton,children:v?a.end:a.endUndefined,onClick:()=>{s.goToTime(b.lastTime),f(n.DataGroup.Color,!0)}},z={key:"context",value:I,children:M},F=Object.assign(Object.assign({},c),{key:`inspector-${o}-${R}`,children:[a.color,r.default.createElement(mt.Provider,Object.assign({},z)),r.default.createElement(i,{className:"start-end",key:"start-end"},r.default.createElement(i,Object.assign({},G)),r.default.createElement(i,Object.assign({},L)))]});return r.default.createElement(i,Object.assign({},F))}kt[n.DataGroup.Color]=r.default.createElement(St,{className:"color tween row",key:"color-group-input"});const Dt=(e,t)=>{if(!t||!e)return;const{width:n,height:a}=t;e.style.setProperty("--preview-width",`${n}px`),e.style.setProperty("--preview-height",`${a}px`)},Pt=r.default.forwardRef(((e,t)=>r.default.createElement("video",Object.assign({},e,{ref:t}))));function xt(e){const{className:t,removeHandler:a,index:s,effect:o,selectedEffect:c,setSelectedEffect:u}=e,d=l(e,["className","removeHandler","index","effect","selectedEffect","setSelectedEffect"]),f=c===o,p=()=>{f||u(o)},m=[t||"effect"];f&&m.push(n.ClassSelected);const g=Object.assign(Object.assign({},d),{children:o.label,className:m.join(" "),onMouseDown:p,onDragStart:e=>{f||p();const t={index:s},n=JSON.stringify(t),{dataTransfer:a}=e;a&&(a.effectAllowed="move",a.setData(`effect${ne}`,n))},onDragEnd:e=>{const{dataTransfer:t}=e;if(!t)return;const{dropEffect:n}=t;"none"===n&&a(o)},onClick:e=>e.stopPropagation(),draggable:!0});return r.default.createElement(i,Object.assign({},g))}function Nt(e){const{defaultValue:t,changeHandler:a,time:s,property:l,value:o,name:i}=e,{type:c,defaultValue:u}=l,d={key:"context",value:{property:l,value:o,changeHandler:a,name:i,time:s,defaultValue:n.isDefined(t)?t:u},children:ft[c]};return r.default.createElement(mt.Provider,Object.assign({},d))}function wt(e){const t=r.default.useContext(T),{icons:a}=t,s=r.default.useContext(it),{selectedItems:l}=e,{selectedItems:o}=s,c=l||o,u=[],d=[],f={},p=new Set;return c.forEach((t=>{if(n.isSelectedProperty(t)){const{property:n,changeHandler:s,selectType:l,value:o,name:c}=t,{name:m,group:g}=n;if(g){const e=[g,l].join("-");return void(f[e]||(f[e]=!0,d.push(r.default.cloneElement(kt[g],{selectType:l}))))}const y=c||m;p.add(l);const h=Object.assign({key:`inspector-${l}-${y}`,property:n,value:o,changeHandler:s,name:y},e),E=a[y],b=r.default.createElement(Nt,Object.assign({},h));if(E){const e=[b];e.unshift(E);const t={children:e,className:"row",key:`icon-${l}-${y}`};u.push(r.default.createElement(i,Object.assign({},t)))}else u.push(b)}else{const e={key:"inspector-effects",selectedEffects:t};d.push(r.default.cloneElement(kt.effects,e))}})),p.has(n.SelectType.Clip)&&u.push(),r.default.createElement(r.default.Fragment,null,u,d)}function At(e){const t=r.default.useContext(T),{icons:a}=t,{selectedEffects:s}=e,o=l(e,["selectedEffects"]),c=r.default.useRef(null),[u,d]=r.default.useState(!1),[f,p]=r.default.useState(null),m=_(),{actions:g}=m;n.assertTrue(s);const{value:y,addHandler:h,removeHandler:E,moveHandler:b}=s,v=f&&y.includes(f)?f:null;v!==f&&p(v);const C=e=>{const{dataTransfer:t}=e;return pe(t)===n.DefinitionType.Effect},O=r.default.useMemo((()=>{const e=["list"];return u&&e.push(n.ClassDropping),e.join(" ")}),[u]),j={children:y.map(((e,t)=>{const n={key:e.id,selectedEffect:v,setSelectedEffect:p,effect:e,index:t,removeHandler:E};return r.default.createElement(xt,Object.assign({},n))})),ref:c,onDragLeave:()=>{d(!1)},onDragOver:e=>{const t=C(e);d(t),t&&e.preventDefault()},onDrop:e=>{if(d(!1),!C(e))return;e.preventDefault();const{dataTransfer:t}=e;if(!t)return;const a=de(t),s=t.getData(a),r=JSON.parse(s),{definitionObject:l,index:o}=r,i=(e=>{const{target:t}=e;if(t&&t instanceof HTMLDivElement){const e=t.getAttribute("index");if(e)return Number(e)}return y.length})(e);if(n.isObject(l)){const e=n.Defined.fromObject(l);if(n.isEffectDefinition(e)){const t=e.instanceFromObject();h(t,i)}}else{if(i===o)return;n.assertEffect(v),b(v,i)}},onClick:()=>{p(null)},key:"view",className:O},k=Object.assign(Object.assign({},o),{key:"effects",children:[a.browserEffect,r.default.createElement(i,Object.assign({},j))]}),S=r.default.createElement(i,Object.assign({},k));return v?r.default.createElement(r.default.Fragment,null,S,r.default.createElement(wt,{selectedItems:v.selectedItems(g)})):S}function Rt(e){const t=r.default.useContext(T),{icons:a}=t,s=_(),{selectType:o}=e,c=l(e,["selectType"]);n.assertSelectType(o);const u=r.default.useContext(it),{selectedItems:d,changeTweening:f,selectedInfo:p}=u,{tweenDefined:m,tweenSelected:g,onEdge:y,time:h,nearStart:E,timeRange:b}=p;n.assertTimeRange(b),n.assertTime(h);const v=m[n.DataGroup.Opacity],C=g[n.DataGroup.Opacity],O=n.selectedPropertyObject(d,n.DataGroup.Opacity,o),{opacity:j,[`opacity${n.PropertyTweenSuffix}`]:k}=O,S=C?k:j,{property:D,changeHandler:P,value:x,name:N}=S,{type:w,name:A}=D,R=N||A,M=ft[w],I={property:D,value:x,name:R,changeHandler:P};I.time=n.tweenInputTime(b,y,E,v,C),C&&(I.defaultValue=j.value);const B=[n.ClassSelected,n.ClassButton].join(" "),G={children:a.start,className:C?n.ClassButton:B,key:"start",onClick:()=>{s.goToTime(b.startTime),f(n.DataGroup.Opacity,!1)}},L={key:"end",className:C?B:n.ClassButton,children:v?a.end:a.endUndefined,onClick:()=>{s.goToTime(b.lastTime),f(n.DataGroup.Opacity,!0)}},z={key:"context",value:I,children:M},F=Object.assign(Object.assign({},c),{key:`inspector-${o}-${R}`,children:[a.opacity,r.default.createElement(mt.Provider,Object.assign({},z)),r.default.createElement(i,{className:"start-end",key:"start-end"},r.default.createElement(i,Object.assign({},G)),r.default.createElement(i,Object.assign({},L)))]});return r.default.createElement(i,Object.assign({},F))}function Mt(e){const t=r.default.useContext(T),{icons:a}=t,s=_(),{selectType:l}=e;n.assertSelectType(l);const o=r.default.useContext(it),{selectedItems:c,changeTweening:u,selectedInfo:d}=o,{tweenDefined:f,tweenSelected:p,onEdge:m,time:g,nearStart:y,timeRange:h}=d;n.assertTimeRange(h),n.assertTime(g);const E=f[n.DataGroup.Point],b=p[n.DataGroup.Point],v=n.selectedPropertyObject(c,n.DataGroup.Point,l),C=n.selectedPropertiesScalarObject(v),{offE:O,offW:j,offN:k,offS:S,x:D,y:P,[`x${n.PropertyTweenSuffix}`]:x,[`y${n.PropertyTweenSuffix}`]:N}=v,w=b?x:D,A=b?N:P,{offE:R,offW:M,offN:I,offS:B}=C,G={},L=[w,A],z=n.tweenInputTime(h,m,y,E,b);L.forEach((e=>{if(!e)return void console.error("PointInput",w,A);const{property:t,changeHandler:a,value:s,name:o}=e,{type:i,name:c}=t,u=o||c,d=u.replace(n.PropertyTweenSuffix,""),f=ft[i],p=`inspector-${l}-${u}`,m={property:t,value:s,name:u,changeHandler:a,time:z};b&&(m.defaultValue=C[d]);const g={key:p,value:m,children:f};G[d]=r.default.createElement(mt.Provider,Object.assign({},g))}));const F=[n.ClassSelected,n.ClassButton].join(" "),V={children:a.start,className:b?n.ClassButton:F,key:"start",onClick:()=>{s.goToTime(h.startTime),u(n.DataGroup.Point,!1)}},$={key:"end",className:b?F:n.ClassButton,children:E?a.end:a.endUndefined,onClick:()=>{s.goToTime(h.lastTime),u(n.DataGroup.Point,!0)}},H=[a.point,r.default.createElement(i,{className:"start-end",key:`${l}-point-start-end`},r.default.createElement(i,Object.assign({},V)),r.default.createElement(i,Object.assign({},$)))],q={key:"lock-east",className:n.ClassButton,children:R?a.unlock:a.lock,onClick:()=>{O.changeHandler("offE",!R)}},U=r.default.createElement(i,Object.assign({},q)),W={key:"lock-west",className:n.ClassButton,children:M?a.unlock:a.lock,onClick:()=>{j.changeHandler("offW",!M)}},Z=r.default.createElement(i,Object.assign({},W)),J={key:"lock-north",className:n.ClassButton,children:I?a.unlock:a.lock,onClick:()=>{k.changeHandler("offN",!I)}},X=r.default.createElement(i,Object.assign({},J)),K={key:"lock-south",className:n.ClassButton,children:B?a.unlock:a.lock,onClick:()=>{S.changeHandler("offS",!B)}},Y=r.default.createElement(i,Object.assign({},K)),Q=[r.default.createElement(i,{key:"x",className:"point",children:[a.horz,U,G.x,Z]}),r.default.createElement(i,{key:"y",className:"point",children:[a.vert,X,G.y,Y]})];return r.default.createElement("fieldset",null,r.default.createElement("legend",{key:"legend"},r.default.createElement(i,null,H)),Q)}kt[n.DataGroup.Effects]=r.default.createElement(At,{className:"effects row",key:"effects-group-input"}),kt[n.DataGroup.Opacity]=r.default.createElement(Rt,{className:"opacity tween row",key:"opacity-group-input"}),kt[n.DataGroup.Point]=r.default.createElement(Mt,{key:"point-input"});const It={[n.Orientation.H]:"width",[n.Orientation.V]:"height"};function Bt(e){const t=r.default.useContext(T),{icons:a}=t,s=_(),{selectType:l}=e;n.assertSelectType(l);const o=r.default.useContext(it),{selectedItems:c,selectedInfo:u,changeTweening:d}=o,{tweenDefined:f,tweenSelected:p,onEdge:m,time:g,nearStart:y,timeRange:h}=u;n.assertTimeRange(h),n.assertTime(g);const E=f[n.DataGroup.Size],b=p[n.DataGroup.Size],v=n.selectedPropertyObject(c,n.DataGroup.Size,l),{lock:C,width:O,height:j,[`width${n.PropertyTweenSuffix}`]:k,[`height${n.PropertyTweenSuffix}`]:S}=v,D=b?k:O,P=b?S:j,x=n.selectedPropertiesScalarObject(v),{lock:N}=x;n.assertString(N);const w=n.isOrientation(N)?N:void 0,A={},R=[D,P],M=n.tweenInputTime(h,m,y,E,b);R.forEach((e=>{const{property:t,changeHandler:a,value:s,name:o}=e,{type:i,name:c}=t,u=o||c,d=u.replace(n.PropertyTweenSuffix,""),f=ft[i],p=`inspector-${l}-${u}`,m={property:t,value:s,name:u,time:M};b&&(m.defaultValue=x[d]),w&&d===It[w]||(m.changeHandler=a);const g={key:p,value:m,children:f};A[d]=r.default.createElement(mt.Provider,Object.assign({},g))}));const I={key:"lock-width",className:n.ClassButton,children:w===n.Orientation.H?a.lock:a.unlock,onClick:()=>{const e=w===n.Orientation.H?"":n.Orientation.H;C.changeHandler("lock",e)}},B=r.default.createElement(i,Object.assign({},I)),G={key:"lock-height",className:n.ClassButton,children:w===n.Orientation.V?a.lock:a.unlock,onClick:()=>{const e=w===n.Orientation.V?"":n.Orientation.V;C.changeHandler("lock",e)}},L=[n.ClassSelected,n.ClassButton].join(" "),z=r.default.createElement(i,Object.assign({},G)),F={children:a.start,className:b?n.ClassButton:L,key:"start",onClick:()=>{s.goToTime(h.startTime),d(n.DataGroup.Size,!1)}},V={key:"end",className:b?L:n.ClassButton,children:E?a.end:a.endUndefined,onClick:()=>{s.goToTime(h.lastTime),d(n.DataGroup.Size,!0)}},$=[a.size,r.default.createElement(i,{className:"start-end",key:`${l}-size-start-end`},r.default.createElement(i,Object.assign({},F)),r.default.createElement(i,Object.assign({},V)))],H=[r.default.createElement(i,{key:"width",className:"size",children:[a.width,A.width,B]}),r.default.createElement(i,{key:"height",className:"size",children:[a.height,A.height,z]})];return r.default.createElement("fieldset",null,r.default.createElement("legend",{key:"legend"},r.default.createElement(i,null,$)),H)}function Gt(e){const{selectType:t}=e;n.assertSelectType(t);const a=r.default.useContext(it),{selectedItems:s}=a,l=n.selectedPropertyObject(s,n.DataGroup.Sizing,t),o=Object.fromEntries(Object.entries(l).map((([t,n])=>{const{property:a,changeHandler:s,selectType:l,value:o,name:i}=n,{name:c}=a,u=i||c,d=Object.assign({key:`inspector-${l}-group-${u}`,property:a,value:o,changeHandler:s,name:u},e);return[t,r.default.createElement(Nt,Object.assign({},d))]})));return r.default.createElement(i,null,Object.values(o))}function Lt(e){const t=r.default.useContext(T),{icons:a}=t,{selectType:s}=e;n.assertSelectType(s);const o=r.default.useContext(it),{selectedItems:c}=o,u=n.selectedPropertyObject(c,n.DataGroup.Timing,s),d=Object.fromEntries(Object.entries(u).map((([t,n])=>{const{property:a,changeHandler:s,selectType:l,value:o,name:i}=n,{name:c}=a,u=i||c,d=Object.assign({key:`inspector-${l}-group-${u}`,property:a,value:o,changeHandler:s,name:u},e);return[t,r.default.createElement(Nt,Object.assign({},d))]}))),{timing:f}=d,p=l(d,["timing"]);if(!n.isPopulatedObject(p)){const e={key:"timing",children:[a.timing,f],className:"row"};return r.default.createElement(i,Object.assign({},e))}const m=[a.timing];f&&m.push(f);const g=Object.entries(p).map((([e,t])=>{const n=a[e],s=[t];n&&s.unshift(n);const l={className:"timing",key:"timing",children:s};return r.default.createElement(i,Object.assign({},l))}));return r.default.createElement("fieldset",null,r.default.createElement("legend",{key:"legend"},r.default.createElement(i,null,m)),g)}function zt(e){const t=_(),[a,s]=r.default.useState((()=>0)),l=r.default.useRef({tweenDefined:{},tweenSelected:{},selectedType:n.SelectType.None,selectTypes:[]}),[o,c]=r.default.useState((()=>n.SelectTypes)),[u,d]=r.default.useState((()=>[])),f=()=>{s((e=>e+1))},p=()=>{const{selection:e}=t,{selectTypes:a,clip:s,mash:r}=e,{current:i}=l,{selectedType:c,selectTypes:u}=i,p=o.find((e=>a.includes(e)));n.assertSelectType(p),p!==c&&(i.selectedType=p),n.arraySet(u,a);const m=t.selection.selectedItems([p]),g={};if(s&&r){const e=m.filter((e=>{if(!n.isSelectedProperty(e))return;const{property:t,name:a}=e,{tweenable:s,group:r}=t;return s&&r&&a?a.endsWith(n.PropertyTweenSuffix):void 0}));if(e.forEach((e=>{const{property:t,value:a}=e,{group:s}=t;n.assertDataGroup(s),g[s]=n.isDefined(a)})),e.length){const{time:e,quantize:t}=r,a=s.timeRange(t);i.time=e,i.timeRange=a;const l=a.frame+Math.round(a.frames/2),o=n.timeFromArgs(l,t),[c,u]=n.timeEqualizeRates(o,e);i.nearStart=c.frame>u.frame;const d=i.nearStart?a.startTime:a.lastTime;i.onEdge=e.equalsTime(d)}}i.tweenDefined=g,d(m),f()};j({[n.EventType.Action]:f,[n.EventType.Selection]:p});const m=r.default.useCallback((e=>{n.assertSelectType(e),c((t=>{const a=t.indexOf(e);n.assertPositive(a);const s=[e];return a&&s.push(...t.slice(0,a)),a<t.length-1&&s.push(...t.slice(a+1)),n.assertTrue(s.length===t.length,"type lengths match"),n.arraySet(t,s),p(),t})),l.current.selectedType=e,d(t.selection.selectedItems([e]))}),[]),g=Object.assign(Object.assign({},ot),{actionCount:a,selectedItems:u,changeSelected:m,changeTweening:(e,t)=>{l.current.tweenSelected[e]=t,p()},selectedInfo:l.current});return r.default.createElement(it.Provider,{value:g},r.default.createElement(i,Object.assign({},e)))}function Ft(e){return r.default.createElement(i,Object.assign({},e))}function Vt(e){const t=r.default.useContext(it),{selectedInfo:a}=t,{selectedType:s}=a,{type:l,types:o,children:i}=e,c=Te(l,o);return n.assertPopulatedArray(c),c.includes(s)?r.default.createElement(r.default.Fragment,null,i):null}function $t(e){const{id:t,children:a,className:s}=e;n.assertSelectType(t);const l=r.default.useContext(it),{changeSelected:o,selectedInfo:c}=l,{selectTypes:u,selectedType:d}=c;if(!u.includes(t))return null;const f=[];n.isPopulatedString(s)&&f.push(s),d===t&&f.push(n.ClassSelected);const p={children:a,onClick:()=>{o(t)},className:f.join(" ")};return r.default.createElement(i,Object.assign({},p))}kt[n.DataGroup.Size]=r.default.createElement(Bt,{key:"size-group-input"}),kt[n.DataGroup.Sizing]=r.default.createElement(Gt,{key:"sizing-group-input"}),kt[n.DataGroup.Timing]=r.default.createElement(Lt,{key:"timing-group-input"});const Ht=function(e={}){var t,a,s,l,o;const c=G(e),{icons:u}=c;(t=c.props).key||(t.key="inspector"),(a=c.props).className||(a.className="panel inspector"),(s=c.header).content||(s.content=[u.inspector]),(l=c.footer).content||(l.content=[r.default.createElement($t,{key:"mash",className:n.ClassButton,id:"mash"},u.document),r.default.createElement($t,{key:"cast",className:n.ClassButton,id:"cast"},u.document),r.default.createElement($t,{key:"layer",className:n.ClassButton,id:"layer"},u.composer),r.default.createElement($t,{key:"clip",className:n.ClassButton,id:"clip"},u.clip),r.default.createElement($t,{key:"container",className:n.ClassButton,id:"container"},u.container),r.default.createElement($t,{key:"content",className:n.ClassButton,id:"content"},u.content)]);const d=[r.default.createElement(wt,{key:"properties"})],f=[n.SelectType.Clip,n.SelectType.Track,n.SelectType.Layer];d.push(r.default.createElement(U,{key:"api-enabled"},r.default.createElement(Vt,{type:"mash",key:"inspector-mash"},r.default.createElement(i,null,r.default.createElement(rt,{key:"render-process"},r.default.createElement(Ke,null,p("render"),u.render)),r.default.createElement(ut,{key:"view-control"},r.default.createElement(Ke,null,p("view"),u.view)))),r.default.createElement(Vt,{types:"mash,cast",key:"inspector-document"},r.default.createElement(ct,{key:"select-edited"}),r.default.createElement(i,{key:"view"},r.default.createElement(lt,{key:"save-process"},r.default.createElement(Ke,{key:"button"},p("update"),u.document)),r.default.createElement(tt,{key:"create-edited"},r.default.createElement(Ke,null,p("create"),u.document)))))),f.forEach((e=>{d.push(r.default.createElement(Vt,{key:`${e}-delete`,type:e},r.default.createElement(at,{type:e},r.default.createElement(Ke,null,m("delete",{type:e}),u.remove))))})),(o=c.content).children||(o.children=r.default.createElement(r.default.Fragment,null,d));const g=r.default.createElement(r.default.Fragment,null,r.default.createElement(B,Object.assign({},c.header)),r.default.createElement(Ft,Object.assign({},c.content.props),c.content.children),r.default.createElement(B,Object.assign({},c.footer)));return Object.assign(Object.assign({},c.props),{children:g})};const qt={paused:!1,changePaused:n.EmptyMethod,changeVolume:n.EmptyMethod,volume:0},Ut=r.default.createContext(qt);function Wt(e){const{children:t,className:a}=e,s=l(e,["children","className"]),o=_(),[c,u]=r.default.useState((()=>n.rectCopy(o.rect))),d=r.default.useRef(null),f=r.default.useRef(null),p=r.default.useContext(T),[m,g]=r.default.useState(!1),y=r.default.useContext(Ut),{disabled:h}=y,{drop:E}=p,b=r.default.useRef({}),{current:v}=b,[C]=r.default.useState(new ResizeObserver((()=>{const{current:e}=f;if(!e)return;const t=n.rectRound(e.getBoundingClientRect());u((()=>(o.rect=t,n.rectCopy(t))))})));r.default.useEffect((()=>{const{current:e}=f;return e&&C.observe(e),()=>{C.disconnect()}}),[]);const O=()=>{const{redraw:e}=v;return delete v.timeout,delete v.redraw,o.svgItems(!h).then((t=>{(e=>{const{current:t}=d;n.assertObject(t),t.replaceChildren(...e)})(t),e&&S()}))},k=()=>{O().then(n.EmptyMethod)},S=()=>{const{current:e}=d,{rect:t}=o;e&&n.sizeAboveZero(t)&&(v.timeout?v.redraw=!0:v.timeout=setTimeout(k,10))};j({[n.EventType.Draw]:S,[n.EventType.Selection]:S});const D=e=>{if(!e)return!1;return!!me(e).includes(ce)||n.isDefinitionType(pe(e))},P=e=>{n.eventStop(e),g(!1)},x=[];a&&x.push(a),m&&x.push(n.ClassDropping);const N=Object.assign(Object.assign({},s),{ref:f,className:x.join(" "),key:"player-content",onDragOver:e=>{n.eventStop(e),g(D(e.dataTransfer))},onDrop:e=>{P(e);const{dataTransfer:t}=e;if(!D(t))return;const{edited:a}=o;n.assertObject(a);const s={clip:o.time.scale(a.quantize).frame,track:-1};if(me(t).includes(ce))E(t.files,s);else{const e=pe(t);n.assertDefinitionType(e);const a=ge(t,e);re(a),E(a.definitionObject,s)}},onDragLeave:P,onPointerDown:()=>{o.selection.unset(n.SelectType.Clip)}});if(n.sizeAboveZero(c)){const e={ref:d,key:"svg",className:"svgs"},n=[r.default.createElement("div",Object.assign({},e))];if(t){const e=r.default.Children.only(t);r.default.isValidElement(e)&&n.push(e)}N.children=n}return r.default.createElement(i,Object.assign({},N))}function Zt(e){const t=r.default.useContext(Ut),{paused:n,changePaused:a}=t,s=Object.assign(Object.assign({},e),{key:"player-button",onClick:()=>{a(!n)}});return r.default.createElement(i,Object.assign({},s))}function Jt(e){const t=_(),a=()=>t.timeRange.timeRange,[s,l]=r.default.useState(a),o=()=>{l(a())};j({[n.EventType.Time]:o,[n.EventType.Duration]:o},t.eventTarget);const i=Object.assign({value:s.frame,min:0,max:s.frames,step:1,onChange:(e,a)=>{const r=n.isArray(a)?a[0]:a;t.time=n.timeFromArgs(r,s.fps)},className:"frame slider"},e);return r.default.createElement(bt,Object.assign({},i))}function Xt(e){return r.default.useContext(Ut).paused?null:e.children}function _t(e){return r.default.useContext(Ut).paused?e.children:null}function Kt(e){const t=_(),a=()=>t.timeRange,[s,l]=r.default.useState(a),o=()=>{l(a())};j({[n.EventType.Time]:o,[n.EventType.Duration]:o},t.eventTarget);const{seconds:c,fps:u,lengthSeconds:d}=s,f=[n.stringSeconds(c,u,d),"/",n.stringSeconds(d,u,d)],p=Object.assign(Object.assign({},e),{key:"player-time",children:f});return r.default.createElement(i,Object.assign({},p))}const Yt=function(e={}){var t,a,s,l,o;const c=G(e),{icons:u}=c;(t=c.props).key||(t.key="player"),(a=c.props).className||(a.className="panel player"),(s=c.content).children||(s.children=r.default.createElement(Wt,Object.assign({},c.content.props),r.default.createElement(i,{key:"drop-box",className:"drop-box"}))),(l=c.header).content||(l.content=[u.app,r.default.createElement(st,{key:"undo"},r.default.createElement(Ke,null,u.undo,p("undo"))),r.default.createElement(nt,{key:"redo"},r.default.createElement(Ke,null,u.redo,p("redo")))]),(o=c.footer).content||(o.content=[r.default.createElement(Zt,{key:"play-button",className:n.ClassButton},r.default.createElement(Xt,{key:"playing"},u.playerPause),r.default.createElement(_t,{key:"not-playing"},u.playerPlay)),r.default.createElement(Jt,{key:"time-slider"}),r.default.createElement(Kt,{key:"time",className:"time"})]);const d=r.default.createElement(r.default.Fragment,null,r.default.createElement(B,Object.assign({},c.header)),c.content.children,r.default.createElement(B,Object.assign({},c.footer)));return Object.assign(Object.assign({},c.props),{children:d})};function Qt(e){const t=r.default.useContext(Ie),{scale:a,frame:s}=t,l=r.default.useMemo((()=>Object.assign(Object.assign({},e),{style:{left:n.pixelFromFrame(s,a)}})),[s,a]);return r.default.createElement(i,Object.assign({},l))}function en(e){const t=_(),{selection:a}=t,{mash:s}=a,{className:o,children:c}=e,u=l(e,["className","children"]),d=r.default.Children.only(c);n.assertTrue(r.default.isValidElement(d));const f=r.default.useContext(Re),p=r.default.useContext(Ie),{track:m}=f;n.assertMash(s),n.assertTrack(m);const{clips:g,dense:y,index:h}=m,{dragTypeValid:E,onDragLeave:b,onDrop:v,droppingTrack:C,setDroppingTrack:O,droppingPosition:T,setDroppingPosition:j,setDroppingClip:k,selectedTrack:S}=p,D=r.default.useMemo((()=>{const e=m===S,t=[];return o&&t.push(o),e&&t.push(n.ClassSelected),C===m&&t.push(be(T)),t.join(" ")}),[T,C,S]),P=Object.assign(Object.assign({},u),{className:D,children:(()=>{let e=y?-1:0;const t=d.props;return g.map((n=>{const a=Object.assign(Object.assign({},t),{key:n.id}),s={children:r.default.cloneElement(d,a),value:{clip:n,prevClipEnd:e},key:n.id},l=r.default.createElement(we.Provider,Object.assign({},s));return y||(e=n.frames+n.frame),l}))})(),onDragLeave:b,onDragOver:e=>{n.eventStop(e);const{dataTransfer:t}=e;if(!t)return;const a=E(t),s=a?n.DroppingPosition.At:n.DroppingPosition.None;k(),O(a?m:void 0),j(s)},onDrop:v,key:`track-${h}`});return r.default.createElement(i,Object.assign({},P))}function tn(e){const t=r.default.useRef(null),n=r.default.useContext(Ie),[a]=r.default.useState(new ResizeObserver((()=>{const{setRect:e}=n;e(t.current.getBoundingClientRect())})));r.default.useEffect((()=>{const{current:e}=t;return e&&a.observe(e),()=>{a.disconnect()}}),[t.current]);const s=Object.assign(Object.assign({},e),{ref:t});return r.default.createElement(i,Object.assign({},s))}function nn(e){const t=_(),a=r.default.useContext(Ie),s=()=>!t.selection.mash,[l,o]=r.default.useState(s);j({[n.EventType.Selection]:()=>{o(s())}});const i=Object.assign({disabled:l,key:"time-slider",value:a.zoom,min:0,max:1,step:.01,onChange:(e,t)=>{const s=n.isArray(t)?t[0]:t;a.zoom!==s&&a.setZoom(s)}},e);return r.default.createElement(bt,Object.assign({className:"zoom slider"},i))}function an(e){const[t,a]=r.default.useState((()=>0)),s=()=>{a((e=>e+1))},l=_();j({[n.EventType.Mash]:s,[n.EventType.Track]:s});const{children:o}=e,i={key:"track-content",children:r.default.useMemo((()=>{const{mash:e}=l.selection;if(!e)return[];const{tracks:t}=e;return n.arrayReversed(t).map(((e,t)=>{const{identifier:n,index:a}=e,s={children:r.default.Children.map(o,(e=>{if(!r.default.isValidElement(e))throw"TimelineTracks";return r.default.cloneElement(e,{key:`track-clone-${t}-${a}-${n}`})})),value:{track:e},key:`track-context-${t}-${a}-${n}`};return r.default.createElement(Re.Provider,Object.assign({},s))}))}),[t])};return r.default.createElement(r.default.Fragment,Object.assign({},i))}function sn(e){const t=_(),a=r.default.useRef(-1),s=r.default.useRef(null),o=r.default.useContext(Ie),{frames:c,scale:u,rect:d}=o,{className:f,inactive:p,styleHeight:m,styleWidth:g}=e,y=l(e,["className","inactive","styleHeight","styleWidth"]),h=()=>!t.selection.mash,[E,b]=r.default.useState(h);j({[n.EventType.Selection]:()=>{b(h())}});const v=()=>{const{window:e}=globalThis,r=e=>{n.eventStop(e);const{current:r}=s;if(!r||!t.selection.mash)return;const{clientX:l}=e;if(a.current===l)return;a.current=l;const o=r.getBoundingClientRect(),i=Math.max(0,Math.min(o.width,l-o.x)),c=n.pixelToFrame(i,u,"floor");t.time=n.timeFromArgs(c,t.selection.mash.quantize)},l=t=>{r(t),e.removeEventListener("pointermove",r),e.removeEventListener("pointerup",l)};return t=>{t.stopPropagation(),a.current=-1,e.addEventListener("pointermove",r),e.addEventListener("pointerup",l),r(t)}},{width:C,height:O}=d,T=r.default.useMemo((()=>{const e=[];f&&e.push(f),E&&e.push(n.ClassDisabled);const t=Object.assign(Object.assign({},y),{ref:s,className:e.join(" ")});if(g||m){const e={};if(m&&(e.minHeight=O),g){const t=n.pixelFromFrame(c,u,"ceil");e.minWidth=Math.max(t,t)}t.style=e}return p||E||(t.onPointerDown=v()),t}),[c,u,C,O,E]);return r.default.createElement(i,Object.assign({},T))}function rn(e){const{className:t}=e,a=l(e,["className"]),s=r.default.useContext(Ie),{dragTypeValid:o,onDrop:c,setScroll:u,setDroppingClip:d,setDroppingTrack:f,setDroppingPosition:p}=s,m=r.default.useRef(null),[g,y]=r.default.useState(!1),h=_();j({[n.EventType.Mash]:()=>{var e;null===(e=m.current)||void 0===e||e.scrollTo(0,0)}});const E=e=>{n.eventStop(e),y(!1)},b=[];t&&b.push(t),g&&b.push(n.ClassDropping);const v=Object.assign(Object.assign({className:b.join(" ")},a),{onPointerDown:e=>{h.selection.unset(n.SelectType.Track)},onScroll:()=>{const{current:e}=m;if(!e)return;const{scrollLeft:t,scrollTop:n}=e;u({x:t,y:n})},onDragOver:e=>{n.eventStop(e);const{dataTransfer:t}=e;if(!t)return;const a=o(t),s=a?n.DroppingPosition.At:n.DroppingPosition.None;d(),f(),p(s),y(a)},onDragLeave:E,onDrop:e=>{E(e),c(e)},ref:m});return r.default.createElement(i,Object.assign({},v))}function ln(e){const t=_(),a=()=>!t.selection.mash,[s,o]=r.default.useState(a);j({[n.EventType.Selection]:()=>{o(a())}});const{children:i}=e,c=l(e,["children"]),u=Object.assign(Object.assign({},c),{disabled:s});return u.onClick=()=>{t.addTrack()},r.default.cloneElement(r.default.Children.only(i),u)}function on(e){const{className:t,icons:a}=e,s=l(e,["className","icons"]),o=r.default.useContext(Ie),c=r.default.useContext(Re),{droppingTrack:u,droppingPosition:d,selectedTrack:f}=o,{track:p}=c,m=r.default.useMemo((()=>{const e=[];return t&&e.push(t),p===f&&e.push(n.ClassSelected),p===u&&e.push(be(d)),e.join(" ")}),[d,u,f]);if(!p)return null;const{dense:g,index:y}=p,h=g?a.trackDense:a.track,E=Object.assign(Object.assign({},s),{className:m,children:h,key:`track-icon-${y}`});return r.default.createElement(i,Object.assign({},E))}function cn(e){const t=_(),{zoom:a,children:s}=e,o=l(e,["zoom","children"]),i=r.default.useContext(Ie),c=()=>!t.selection.mash,[u,d]=r.default.useState(c);j({[n.EventType.Selection]:()=>{d(c())}});const f=Object.assign(Object.assign({},o),{onClick:()=>{i.setZoom(a)},disabled:u});return r.default.cloneElement(r.default.Children.only(s),f)}function un(e){const t=_(),a=r.default.useContext(T),{definition:s,drop:o}=a,i=()=>!t.selection.mash,[c,u]=r.default.useState(i);j({[n.EventType.Selection]:()=>{u(i())}});const{children:d}=e,f=l(e,["children"]),p=Object.assign(Object.assign({},f),{disabled:c});return p.onClick=()=>{const{selection:e,edited:a}=t,{clip:r,track:l}=e,i=(null==s?void 0:s.toJSON())||{id:n.DefaultContentId},c={clip:0,track:-1};r&&l?(c.clip=l.dense?l.clips.indexOf(r):r.endFrame,c.track=l.index):c.clip=t.time.scale(a.quantize).frame,o(i,c)},r.default.cloneElement(r.default.Children.only(d),p)}const dn=function(e={}){var t,n,a,s,l;const o=G(e),{icons:i}=o;(t=o.props).key||(t.key="timeline"),(n=o.props).className||(n.className="panel timeline"),(a=o.header).content||(a.content=[i.timeline]),(s=o.footer).content||(s.content=[r.default.createElement(un,{key:"add-clip"},r.default.createElement(Ke,{children:i.add})),r.default.createElement(ln,{key:"add-track"},r.default.createElement(Ke,{children:[i.add,i.trackDense]})),r.default.createElement(cn,{key:"zoom-out",zoom:0},r.default.createElement(Ke,{useView:!0},i.zoomLess)),r.default.createElement(nn,{key:"zoomer"}),r.default.createElement(cn,{key:"zoom-in",zoom:1},r.default.createElement(Ke,{useView:!0},i.zoomMore))]),(l=o.content).children||(l.children=r.default.createElement(r.default.Fragment,null,r.default.createElement(sn,{styleWidth:!0,inactive:!0,styleHeight:!0,className:"scrubber-bar"},r.default.createElement(Qt,{className:"scrubber-element-bar"})),r.default.createElement(sn,{styleWidth:!0,className:"scrubber-icon"},r.default.createElement(Qt,{className:"scrubber-element-icon"})),r.default.createElement(an,null,r.default.createElement(on,{className:"track-icon",icons:i}),r.default.createElement(en,{className:"track"},r.default.createElement(ze,{className:"clip preview"}))),r.default.createElement(tn,{className:"drop-box"})));const c=r.default.createElement(r.default.Fragment,null,r.default.createElement(B,Object.assign({},o.header)),r.default.createElement(rn,Object.assign({},o.content.props),o.content.children),r.default.createElement(B,Object.assign({},o.footer)));return Object.assign(Object.assign({},o.props),{children:c})};function fn(e){const{disabled:t}=e,a=l(e,["disabled"]),s=_(),[o,c]=r.default.useState(s.paused),[u,d]=r.default.useState(s.volume),f=()=>{c(s.paused)};j({[n.EventType.Pause]:f,[n.EventType.Play]:f,[n.EventType.Volume]:()=>{d(s.volume)}});const p={value:{paused:o,disabled:t,volume:u,changePaused:e=>{s.paused=e},changeVolume:e=>{s.volume=e}},children:r.default.createElement(i,Object.assign({},a))};return r.default.createElement(Ut.Provider,Object.assign({},p))}function pn(e){const t=_(),a=r.default.useContext(T),{drop:s}=a,l=()=>{var e;return(null===(e=t.selection.mash)||void 0===e?void 0:e.frame)||0},o=()=>{var e;return(null===(e=t.selection.mash)||void 0===e?void 0:e.frames)||0},[c,u]=r.default.useState(o),[d,f]=r.default.useState(l),[p,m]=r.default.useState(n.DroppingPosition.None),[g,y]=r.default.useState(),[h,E]=r.default.useState(),[b,v]=r.default.useState(),[C,O]=r.default.useState(0),[k,S]=r.default.useState(),[D,P]=r.default.useState(1),[x,N]=r.default.useState(n.RectZero),[w,A]=r.default.useState(n.RectZero),R=()=>{O((e=>e+1))};j({[n.EventType.Mash]:()=>{P(1)},[n.EventType.Action]:R,[n.EventType.Selection]:()=>{S(t.selection.clip),v(t.selection.track)},[n.EventType.Time]:()=>{f(l())},[n.EventType.Duration]:()=>{u(o())}},t.eventTarget);const M=(e,t)=>{const a=me(e);if(a.includes(ce))return!0;const s=a.find(ue);if(!s)return!1;if(t)return!0;return fe(s)!==n.DefinitionType.Effect},I=e=>{n.eventStop(e),m(n.DroppingPosition.None),y(void 0),E(void 0)},{width:B}=x,G=r.default.useMemo((()=>B?n.pixelPerFrame(c,B,D):0),[D,B,c]),L={scroll:w,setScroll:A,scale:G,refreshed:C,refresh:R,zoom:D,setZoom:P,rect:x,setRect:N,droppingTrack:g,setDroppingTrack:y,droppingClip:h,setDroppingClip:E,droppingPosition:p,setDroppingPosition:m,onDragLeave:I,onDrop:e=>{n.eventStop(e);const{dataTransfer:a,clientX:r}=e;if(!a||!M(a,h))return void console.log("Timeline onDrop invalid",null==a?void 0:a.types,!!h);const l=me(a).includes(ce),o=!!(null==g?void 0:g.dense),i=g?g.index:-1,c=(null==g?void 0:g.clips)||[],u=l?{}:ge(a),d=!l&&ae(u),f=d?u.offset:0;let m=((e,t)=>{if(!e)return-1;if(!h)return 0;const a=t.indexOf(h);return p===n.DroppingPosition.After?a+1:a})(o,c);if(!n.isPositive(m)){const e=r-x.x,t=n.pixelToFrame(Math.max(0,w.x+(e-f)),G);m=o?((e,t)=>{const{length:n}=t;if(!n)return 0;const a=t.findIndex((t=>e<t.frame+t.frames));return a>-1?a:n})(t,c):t}const y={clip:m,track:i};if(l)s(a.files,y);else if(d)if(se(u)){const{definitionObject:e}=u;s(e,y)}else{const{clip:e}=t.selection;n.assertClip(e),t.moveClip(e,y)}I(e)},dragTypeValid:M,selectedClip:k,selectedTrack:b,frame:d,frames:c},z={children:r.default.createElement(i,Object.assign({},e)),value:L};return r.default.createElement(Ie.Provider,Object.assign({},z))}function mn(e){return r.default.createElement(i,Object.assign({},e))}const gn=function(e={}){e.className||(e.className="editor masher"),e.icons||(e.icons=a.Icons);const{panels:t={}}=e,s=l(e,["panels"]),{player:o={},browser:i={},timeline:c={},inspector:u={},activity:d={}}=t,f=[];if(o&&(o.icons||(o.icons=e.icons),f.push(r.default.createElement(fn,Object.assign({},Yt(o))))),i&&(i.icons||(i.icons=e.icons),f.push(r.default.createElement(Q,Object.assign({},xe(i))))),u||d){const t=[];u&&(u.icons||(u.icons=e.icons),t.push(r.default.createElement(zt,Object.assign({},Ht(u))))),d&&(d.icons||(d.icons=e.icons),t.push(r.default.createElement(S,Object.assign({},$(d)))));const n={children:t,key:"panels",className:"panels"};f.push(r.default.createElement(mn,Object.assign({},n)))}return c&&(c.icons||(c.icons=e.icons),f.push(r.default.createElement(pn,Object.assign({},dn(c))))),Object.assign(Object.assign({className:"editor masher"},s),{editType:n.EditType.Mash,children:f})};function yn(e){const t=r.default.useContext(X),{processing:n,error:a}=t;return n||a?r.default.createElement(r.default.Fragment,null,e.children):r.default.createElement(i,null)}function hn(e){return r.default.useContext(X).processing?null:r.default.createElement(r.default.Fragment,null,e.children)}const En={devices:[]},bn=r.default.createContext(En);const vn={setClient:()=>{}},Cn=r.default.createContext(vn);class On{constructor(e,t){this.setStatus=t,this.endpointPromise=e}beforeAnswer(e){return o(this,void 0,void 0,(function*(){const t=window.navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((e=>e)).catch((e=>{console.error("beforeAnswer",e)}));if(this.localStream=yield t,!this.localStream)return;this.localStream.getTracks().forEach((t=>{this.localStream&&e.addTrack(t,this.localStream)}));const{close:n}=e;e.close=(...t)=>{if(this.localStream)return this.localStream.getTracks().forEach((e=>{e.stop()})),n.apply(e,t)}}))}closeConnection(){var e;null===(e=this.localPeerConnection)||void 0===e||e.close()}createConnection(e={}){const{stereo:t}=e;return this.endpointPromise(n.Endpoints.streaming.webrtc,{}).then((e=>{const{id:a,localDescription:s}=e,r=new RTCPeerConnection({});this.localPeerConnection=r,r.close=()=>{const e={id:a};return this.endpointPromise(n.Endpoints.streaming.delete,e).then((e=>{})),RTCPeerConnection.prototype.close.apply(r)};try{r.setRemoteDescription(s).then((()=>{this.beforeAnswer(r).then((()=>(r.createAnswer().then((e=>{const s=new RTCSessionDescription({type:"answer",sdp:t?(l=e.sdp,l.replace(/a=fmtp:111/,"a=fmtp:111 stereo=1\r\na=fmtp:111")):e.sdp});var l;console.debug(this.constructor.name,"createConnection setLocalDescription"),r.setLocalDescription(s).then((()=>{const{localDescription:e}=r;if(!e)throw n.Errors.invalid.object+"localDescription";const t={id:a,localDescription:e};console.debug("StreamingRemoteRequest",n.Endpoints.streaming.remote,t),this.endpointPromise(n.Endpoints.streaming.remote,t).then((e=>{console.debug("StreamingRemoteResponse",n.Endpoints.streaming.remote,e)}))}))})),r)))}))}catch(e){throw console.trace(this.constructor.name,"createConnection",e),this.localPeerConnection.close(),e}}))}}function Tn(e){const t=r.default.useContext(Cn),n=r.default.useContext(X),a=r.default.useContext(q),{setStatus:s,processing:l,setProcessing:o}=n,{endpointPromise:c}=a,{client:u,setClient:d}=t,f=Object.assign(Object.assign({},e),{onClick:()=>{if(u)s("Closing WebRTC connection"),u.closeConnection(),o(!1),d(void 0);else{const e=new On(c,s);s("Opening WebRTC connection..."),e.createConnection().then((()=>{s("Opened WebRTC connection"),o(!0),d(e)}))}}});return r.default.createElement(i,Object.assign({},f))}function jn(e){const t=r.default.useRef(null),n=r.default.useContext(Cn),a=r.default.useContext(X),{client:s}=n,{processing:o}=a,{current:i}=t;i&&(i.srcObject=o&&(null==s?void 0:s.localStream)||null),r.default.useEffect((()=>()=>{}),[]);const c=l(e,["children"]),u=Object.assign(Object.assign({},c),{ref:t,autoPlay:!0,muted:!0});return r.default.createElement(Pt,Object.assign({},u))}function kn(e){const[t,a]=r.default.useState(),s=r.default.useContext(q),{enabled:l,servers:o}=s;if(!l||!o[n.ServerType.Streaming])return null;const c={client:t,setClient:a};return r.default.createElement(Cn.Provider,{value:c},r.default.createElement(i,Object.assign({},e)))}const Sn=r.default.createElement(kn,{className:"panel webrtc"},r.default.createElement("div",{className:"head"},r.default.createElement(Tn,null,r.default.createElement(yn,null,r.default.createElement(Ke,null,"Stop Broadcasting")),r.default.createElement(hn,null,r.default.createElement(Ke,null,"Start Broadcasting")))),r.default.createElement(jn,{className:"content"}),r.default.createElement("div",{className:"foot"}));e.Activity=S,e.ActivityContent=x,e.ActivityContentContext=P,e.ActivityContentContextDefault=D,e.ActivityContext=C,e.ActivityContextDefault=v,e.ActivityGroups=h,e.ActivityItem=N,e.ActivityLabel=w,e.ActivityPicked=R,e.ActivityPicker=M,e.ActivityProgress=I,e.ActivityPropsDefault=$,e.ApiClient=function(e){const{endpoint:t,children:a,path:s}=e,l=t||n.urlEndpoint({prefix:s||n.Endpoints.api.callbacks}),[o,i]=r.default.useState((()=>({[n.Endpoints.api.callbacks]:{endpoint:l}}))),[c,u]=r.default.useState((()=>({}))),d=(e,t)=>f(e).then((e=>(n.isPopulatedObject(t)&&(e.request||(e.request={}),e.request.body=Object.assign({version:n.ApiVersion},t)),n.fetchCallback(e)))),f=e=>{const t=o[e];if(t)return Promise.resolve(t);const a={id:e,version:n.ApiVersion},s={endpoint:l,request:{body:a}};return n.fetchCallback(s).then((t=>{const{apiCallbacks:n}=t;return i((e=>Object.assign(Object.assign({},e),n))),n[e]}))};r.default.useEffect((()=>{d(n.Endpoints.api.servers,{}).then((e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.temporaryIdPrefix)&&n.idPrefixSet(e.data.temporaryIdPrefix),u(e)}))}),[]);const p={enabled:!0,endpointPromise:d,servers:c};return r.default.createElement(q.Provider,{value:p},a)},e.ApiContext=q,e.ApiContextDefault=H,e.ApiEnabled=U,e.Bar=B,e.BooleanTypeInput=gt,e.Broadcaster=function(e){const[t,n]=r.default.useState(!1),[a,s]=r.default.useState(!1),[l,o]=r.default.useState(!1),[c,u]=r.default.useState(""),[d,f]=r.default.useState(""),[p,m]=r.default.useState(0),[g,y]=r.default.useState(0),[h,E]=r.default.useState(0),b={updating:l,setUpdating:o,videoRate:h,setVideoRate:E,height:g,setHeight:y,width:p,setWidth:m,url:d,setUrl:f,streaming:t,setStreaming:n,preloading:a,setPreloading:s,id:c,setId:u};return r.default.createElement(Z.Provider,{value:b},r.default.createElement(i,Object.assign({},e)))},e.BroadcasterContent=function(e){const t=r.default.useContext(Z),a=_(),{rect:s}=a,{url:l,streaming:o}=t;if(!o||!l)return r.default.createElement(i,Object.assign({},e));const c=Object.assign(Object.assign(Object.assign({},n.sizeCopy(s)),e),{autoPlay:!0});return r.default.createElement("video",Object.assign({src:l},c))},e.BroadcasterControl=function(e){const t=r.default.useContext(X),a=r.default.useContext(q),s=r.default.useContext(Z),{setProcessing:l,processing:o,setStatus:c}=t,[u,d]=r.default.useState(o),{endpointPromise:f}=a,{setStreaming:p,setId:m,setUrl:g,setWidth:y,setHeight:h,setVideoRate:E}=s,b=Object.assign(Object.assign({},e),{onClick:()=>{u||(d(!0),(()=>{const e={};console.debug("StreamingStartRequest",n.Endpoints.streaming.start,e),f(n.Endpoints.streaming.start,e).then((e=>{console.debug("StreamingStartResponse",n.Endpoints.streaming.start,e),c("Started stream");const{id:t,readySeconds:a,width:s,height:r,videoRate:o}=e;m(t),y(s),h(r),E(o);const i=()=>{setTimeout((()=>{const e={id:t};console.debug("StreamingStatusRequest",n.Endpoints.streaming.status,e),f(n.Endpoints.streaming.status,e).then((e=>{console.debug("StreamingStatusResponse",n.Endpoints.streaming.status,e);const{streamUrl:t}=e;t?(g(t),p(!0),l(!0),c("Streaming")):i()}))}),1e3*a)};i()}))})())},disabled:u});return r.default.createElement(i,Object.assign({},b))},e.BroadcasterPreloadControl=function(e){const t=r.default.useContext(X),a=r.default.useContext(q),s=r.default.useContext(Z),{id:l,setPreloading:o,preloading:c,updating:u,streaming:d}=s,{setStatus:f}=t,{endpointPromise:p}=a,m=c||u||!d,g=Object.assign(Object.assign({},e),{onClick:()=>{m||(o(!0),(()=>{const e={files:[],id:l};f("Preloading..."),console.debug("StreamingPreloadRequest",n.Endpoints.streaming.preload,e),p(n.Endpoints.streaming.preload,e).then((e=>{console.debug("StreamingPreloadResponse",n.Endpoints.streaming.preload,e),f("Preloaded"),o(!1)}))})())},disabled:m});return r.default.createElement(i,Object.assign({},g))},e.BroadcasterUpdateControl=function(e){const t=_(),a=r.default.useContext(X),s=r.default.useContext(q),l=r.default.useContext(Z),{updating:o,setUpdating:c,streaming:u,preloading:d,id:f}=l,{setStatus:p}=a,{endpointPromise:m}=s,g=o||d||!u,y=Object.assign(Object.assign({},e),{onClick:()=>{g||(c(!0),(()=>{const{edited:e,definitions:a}=t;n.assertCast(e);const{mashes:s}=e,r={definitionObjects:a.map((e=>e.toJSON())),mashObjects:s.map((e=>e.toJSON())),id:f};console.debug("StreamingCutRequest",n.Endpoints.streaming.cut,r),p("Updating stream"),m(n.Endpoints.streaming.cut,r).then((e=>{console.debug("StreamingCutResponse",n.Endpoints.streaming.cut,e),p("Updated stream"),c(!1)}))})())},disabled:g});return r.default.createElement(i,Object.assign({},y))},e.Browser=Q,e.BrowserContent=ve,e.BrowserContext=Y,e.BrowserContextDefault=K,e.BrowserControl=Se,e.BrowserPicker=je,e.BrowserPropsDefault=xe,e.Button=Ke,e.ClipContext=we,e.ClipContextDefault=Ne,e.ClipItem=ze,e.ColorGroupInput=St,e.Composer=$e,e.ComposerContent=qe,e.ComposerContext=Ve,e.ComposerContextDefault=Fe,e.ComposerDepth=Ue,e.ComposerFolderClose=We,e.ComposerFolderOpen=Ze,e.ComposerLayer=He,e.ComposerLayerFolder=Je,e.ComposerLayerLabel=Xe,e.ComposerLayerMash=_e,e.CreateEditedControl=tt,e.DataGroupInputs=kt,e.DataTypeInputs=ft,e.DefaultComposerProps=et,e.DefaultPlayerProps=Yt,e.DefaultStreamerProps=e=>({className:"editor caster",children:Sn}),e.DefaultTimelineProps=dn,e.DefinitionContext=te,e.DefinitionContextDefault=ee,e.DefinitionDrop=yt,e.DefinitionItem=Pe,e.DefinitionSelect=ht,e.DragElementPoint=he,e.DragElementRect=ye,e.DragSuffix=ne,e.DragTypes=oe,e.EditorRedoButton=nt,e.EditorRemoveButton=at,e.EditorUndoButton=st,e.EffectsGroupInput=At,e.EmptyElement=dt,e.InputContext=mt,e.InputContextDefault=pt,e.Inspector=zt,e.InspectorContent=Ft,e.InspectorContext=it,e.InspectorContextDefault=ot,e.InspectorEffect=xt,e.InspectorPicked=Vt,e.InspectorPicker=$t,e.InspectorProperties=wt,e.InspectorProperty=Nt,e.InspectorPropsDefault=Ht,e.LayerContext=Ge,e.LayerContextDefault=Be,e.Masher=function(e){const{editType:t=n.EditType.Mash,previewSize:a,icons:s={},edited:c}=e,u=l(e,["editType","previewSize","icons","edited"]),d=r.default.useRef({}),f=r.default.useRef(null),{current:p}=d,[m,g]=r.default.useState(),y=r.default.useRef(null),h=r.default.useContext(q),[E]=r.default.useState((()=>n.editorInstance({editType:t}))),[b,v]=r.default.useState(!1),[C,O]=r.default.useState(),{enabled:j,endpointPromise:k,servers:S}=h;r.default.useEffect((()=>{Dt(y.current,a)}),[a]);const D=e=>{const s=e||c||{[t]:{},definitions:[]},{previewSize:r=a}=s,o=l(s,["previewSize"]),{current:i}=f,{current:u}=y;n.assertObject(i),n.sizeAboveZero(r)&&Dt(u,r),E.svgElement=i,E.load(o)};r.default.useEffect((()=>{if(j){if(!b&&S[n.ServerType.Data]){v(!0);const e={};k(n.Endpoints.data[t].default,e).then((e=>{var a;console.debug("DataDefaultResponse",n.Endpoints.data[t].default,e),l(e,["previewSize"]),(null===(a=S.file)||void 0===a?void 0:a.prefix)&&(E.preloader.endpoint.prefix=String(S.file.prefix)),D(e)}))}}else D()}),[S]);const P=(e,t,a)=>{console.debug("handleApiCallback request",a);const{eventTarget:s}=E;return n.fetchCallback(a).then((r=>{console.debug("handleApiCallback response",r);const{apiCallback:l,error:o}=r;if(o)return x(a.endpoint.prefix,o,e);if(l){const{request:o,endpoint:i}=l;if(i.prefix===n.Endpoints.data.definition.put){n.assertObject(o);const{body:e}=o;n.assertObject(e);const a=e,{definition:s}=a;console.debug("handleApiCallback calling updateDefinition",s),E.updateDefinition(s,t)}if(a.endpoint.prefix===n.Endpoints.rendering.status){const t=r;let a=0,l=0;n.OutputTypes.forEach((e=>{const n=t[e];n&&(a+=n.total,l+=n.completed)})),a&&s.emit(n.EventType.Activity,{id:e,step:l,steps:a,type:n.ActivityType.Render})}return new Promise((e=>{setTimeout(e,2e3)})).then((()=>P(e,t,l)))}s.emit(n.EventType.Activity,{id:e,type:n.ActivityType.Complete})}))},x=(e,t,a)=>(E.eventTarget.emit(n.EventType.Activity,{id:a,type:n.ActivityType.Error,error:"import.render",value:t}),console.error(e,t),Promise.reject(t)),N=e=>{g(e)},w={editor:E,draggable:C,setDraggable:O,save:()=>o(this,void 0,void 0,(function*(){const{definitionsUnsaved:e}=E,t=(e=>{let t=Promise.resolve();const{eventTarget:a}=E;return e.forEach((e=>{n.assertPreloadableDefinition(e);const{label:s,type:r,source:l}=e,o=n.idGenerate("activity");a.emit(n.EventType.Activity,{id:o,label:s,type:n.ActivityType.Render});const{rendering:i}=n.Endpoints,c=fetch(l).then((e=>e.blob())).then((e=>new File([e],s))).then((t=>{const a={type:r,name:s,size:t.size};return console.debug("RenderingUploadRequest",i.upload,a),k(i.upload,a).then((a=>{console.debug("RenderingUploadResponse",i.upload,a);const{error:s,fileApiCallback:r,apiCallback:l,fileProperty:c}=a;return s?x(i.upload,s,o):r&&r.request?(c?r.request.body[c]=t:r.request.body=t,n.fetchCallback(r).then((t=>{console.debug("FileStoreResponse",t);const{error:a}=t;return a?x(r.endpoint.prefix,a,o):(n.assertObject(l),P(o,e,l))}))):(n.assertObject(l),P(o,e,l))}))}));t=t.then((()=>c))})),t})(e),a=t.then((()=>E.dataPutRequest())).then((e=>{const{editType:t}=E;console.debug("DataPutRequest",n.Endpoints.data[t].put,JSON.parse(JSON.stringify(e))),k(n.Endpoints.data[t].put,e).then((e=>{console.debug("DataPutResponse",n.Endpoints.data[t].put,e);const{error:a,temporaryIdLookup:s}=e;a?console.error(n.Endpoints.data[t].put,a):E.saved(s)}))}));yield a})),editorIndex:p,drop:(e,t)=>e?n.isClip(e)||n.isEffect(e)||n.isLayer(e)?Promise.resolve([]):n.isDefinitionObject(e)?((e,t)=>E.add(e,t))(e,t):n.isMashAndDefinitionsObject(e)?Promise.resolve([]):((e,t)=>{const a=Ee(e,S.file);if(a.length){const e=[],s=[],{eventTarget:r}=E;if(a.forEach((t=>{t instanceof File?s.push(t):e.push(t)})),e.length&&e.forEach((e=>{const t=n.idGenerate("activity-error"),a=Object.assign({id:t,type:n.ActivityType.Error},e);r.emit(n.EventType.Activity,a)})),s.length)return E.addFiles(s,t)}return Promise.resolve([])})(e,t).then((e=>{const[t]=e;return n.isDefinition(t)&&N(t),e})):Promise.resolve([]),definition:m,changeDefinition:N,icons:s},A=Object.assign(Object.assign({},u),{onDrop:n.eventStop,ref:y});return r.default.createElement(T.Provider,{value:w},r.default.createElement(i,Object.assign({},A)),r.default.createElement("svg",{style:{display:"none"},ref:f}))},e.MasherCastProps=function(e={}){e.className||(e.className="editor caster");const t=gn(e),{panels:a={}}=e,{composer:s={}}=a;if(!s)return t;s.icons||(s.icons=e.icons);const l=r.default.createElement(r.default.Fragment,null,t.children,r.default.createElement($e,Object.assign({},et(s))));return Object.assign(Object.assign({},t),{children:l,editType:n.EditType.Cast})},e.MasherContext=T,e.MasherContextDefault=O,e.MasherDefaultProps=gn,e.NumericTypeInput=Et,e.OpacityGroupInput=Rt,e.Panel=function(e){const{children:t,className:n,collapsed:a}=e,[s,l]=r.default.useState(!!a),o=[];n&&o.push(n),s&&o.push("collapsed");const c={children:t,className:o.join(" ")},u={collapsed:s,changeCollapsed:l};return r.default.createElement(k.Provider,{value:u},r.default.createElement(i,Object.assign({},c)))},e.PanelContent=function(e){const{children:t,className:n}=e;if(!t)return null;const a={className:n,children:t};return r.default.createElement(i,Object.assign({},a))},e.PanelFoot=L,e.PanelHead=function(e){const{children:t,className:n}=e;if(!t)return null;const a={className:n,children:t};return r.default.createElement(i,Object.assign({},a))},e.Panels=mn,e.PercentTypeInput=vt,e.Player=fn,e.PlayerButton=Zt,e.PlayerContent=Wt,e.PlayerContext=Ut,e.PlayerContextDefault=qt,e.PlayerNotPlaying=_t,e.PlayerPlaying=Xt,e.PlayerTime=Kt,e.PlayerTimeControl=Jt,e.PointGroupInput=Mt,e.Problems=A,e.Process=function(e){const t=r.default.useContext(q),[a,s]=r.default.useState(!1),[l,o]=r.default.useState(0),[i,c]=r.default.useState(""),[u,d]=r.default.useState(""),{children:f,id:p}=e,{enabled:m,servers:g}=t;if(!n.ServerTypes.map(String).includes(p))return null;if(!m||!g[p])return null;const y={processing:a,setProcessing:s,status:i,setStatus:c,progress:l,setProgress:o,error:u,setError:d};return r.default.createElement(X.Provider,{value:y},f)},e.ProcessActive=yn,e.ProcessContext=X,e.ProcessContextDefault=J,e.ProcessInactive=hn,e.ProcessProgress=function(e){const t=r.default.useContext(X),{progress:n,processing:a}=t;if(!a)return r.default.createElement(i,{className:"progress-holder"});const s={value:n,max:1,children:`${Math.round(100*n)}%`};return r.default.createElement("progress",Object.assign({},s))},e.ProcessStatus=function(e){const{className:t}=e,n=l(e,["className"]),a=r.default.useContext(X),{status:s,error:o,setError:c}=a,u=["process-status"];t&&u.push(t),o&&u.push("error");const d=Object.assign(Object.assign({},n),{onClick:()=>{o&&c("")},key:"process-status",className:u.join(" "),children:o||s});return r.default.createElement(i,Object.assign({},d))},e.RenderControl=rt,e.RgbTypeInput=Ct,e.SaveControl=lt,e.SelectEditedControl=ct,e.Shooter=function(e){const[t,n]=r.default.useState([]);r.default.useEffect((()=>{navigator.mediaDevices.enumerateDevices().then(n)}),[]);const a={devices:t},s={children:t.map((e=>r.default.createElement(i,null,JSON.stringify(e))))};return r.default.createElement(bn.Provider,{value:a},r.default.createElement(i,Object.assign({},s)))},e.ShooterContext=bn,e.ShooterContextDefault=En,e.SizeGroupInput=Bt,e.SizingGroupInput=Gt,e.SizingTypeInput=Ot,e.Slider=bt,e.Streamer=function(e){return r.default.createElement(i,Object.assign({},e))},e.Streamers=function(e){return r.default.createElement(i,Object.assign({},e))},e.StreamersCreateControl=function(e){return r.default.createElement(i,Object.assign({},e))},e.TextTypeInput=Tt,e.Timeline=pn,e.TimelineAddClipControl=un,e.TimelineAddTrackControl=ln,e.TimelineContent=rn,e.TimelineContext=Ie,e.TimelineContextDefault=Me,e.TimelineDefaultZoom=1,e.TimelineScrubber=sn,e.TimelineScrubberElement=Qt,e.TimelineSizer=tn,e.TimelineTrack=en,e.TimelineTrackIcon=on,e.TimelineTracks=an,e.TimelineZoom=cn,e.TimelineZoomer=nn,e.TimingGroupInput=Lt,e.TimingTypeInput=jt,e.TrackContext=Re,e.TrackContextDefault=Ae,e.TransferTypeFiles=ce,e.TweenInputKey="tween-input-key",e.VideoView=Pt,e.View=i,e.ViewControl=ut,e.ViewerContext=Z,e.ViewerContextDefault=W,e.Webrtc=kn,e.WebrtcButton=Tn,e.WebrtcClient=On,e.WebrtcContent=jn,e.WebrtcContext=Cn,e.WebrtcContextDefault=vn,e.activityLabel=g,e.assertActivityGroup=b,e.assertDragDefinitionObject=re,e.assertDragOffsetObject=function(e){ae(e)||n.throwError(e,"DragOffsetObject")},e.dragData=ge,e.dragDefinitionType=fe,e.dragType=pe,e.dragTypes=me,e.dropFilesFromList=Ee,e.dropType=de,e.droppingPositionClass=be,e.elementSetPreviewSize=Dt,e.isActivityGroup=E,e.isDragDefinitionObject=se,e.isDragOffsetObject=ae,e.isDragType=ie,e.isTransferType=ue,e.labelInterpolate=m,e.labelLookup=f,e.labelObjects=u,e.labelTranslate=p,e.labels=d,e.panelOptionsStrict=G,e.propsDefinitionTypes=Oe,e.propsSelectTypes=Te,e.sessionGet=e=>globalThis.window.sessionStorage.getItem(e)||"",e.sessionSet=(e,t)=>{globalThis.window.sessionStorage.setItem(e,String(t))},e.useClip=()=>r.default.useContext(we).clip,e.useDefinition=De,e.useEditor=_,e.useLayer=Le,e.useListeners=j,Object.defineProperty(e,"__esModule",{value:!0})}));
