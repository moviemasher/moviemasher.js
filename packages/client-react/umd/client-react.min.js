!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("@moviemasher/moviemasher.js"),require("@moviemasher/theme-default")):"function"==typeof define&&define.amd?define(["exports","react","@moviemasher/moviemasher.js","@moviemasher/theme-default"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).MovieMasherClient={},e.React,e.MovieMasher,e.MovieMasherTheme)}(this,(function(e,t,n,a){"use strict";function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=s(t);function l(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(n[a[s]]=e[a[s]])}return n}function o(e,t,n,a){return new(n||(n=Promise))((function(s,r){function l(e){try{i(a.next(e))}catch(e){r(e)}}function o(e){try{i(a.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,o)}i((a=a.apply(e,t||[])).next())}))}const i=r.default.forwardRef(((e,t)=>r.default.createElement("div",Object.assign({ref:t},e)))),c=/{{([a-z0-9_]*)}}/,u={import:{bytes:"Size above {{value}}",extension:"Extension {{value}}",type:"Type {{value}}",size:"Dimensions {{value}}",duration:"Duration {{value}}",render:"{{value}}",displaySize:"{{width}}x{{height}}"}},d={audible:"Audible",clip:"Clip",update:"Save",delete:"Remove {{type}}",unlabeled:"Unlabeled {{type}}",analyze:"Analyzing...",load:"Loading...",complete:"Completed",layer:"Layer",create:"New",render:"Render",view:"View",open:"Open...",undo:"Undo",redo:"Redo",cast:"Cast",mash:"Mash"},f=e=>{const[t,n]=e.split(".");return u[t][n]},p=e=>e.includes(".")?f(e):d[e]||e,m=(e,t)=>{let n=p(e);const a=n.match(c);return a?(a.forEach(((e,a)=>{if(!a)return;const s=`{{${e}}}`,r=p(t[e]);n=n.replace(s,r)})),n):n},g=e=>{if(!n.isObject(e))return"";const{label:t,error:a,type:s,value:r}=e;return a?r?m(a,{value:r}):p(a):p(s)};var y;e.ActivityGroup=void 0,(y=e.ActivityGroup||(e.ActivityGroup={})).Active="active",y.Error="error",y.Complete="complete";const h=Object.values(e.ActivityGroup),E=e=>n.isPopulatedString(e)&&h.includes(e);function v(e,t){E(e)||n.throwError(e,"ActivityGroup",t)}const b={label:"",activities:[],allActivities:[],picked:e.ActivityGroup.Active,pick:n.EmptyMethod},C=r.default.createContext(b),O=r.default.createContext({collapsed:!1,changeCollapsed:()=>{}}),T={changeDefinition:n.EmptyMethod,drop:()=>Promise.resolve([]),editorIndex:{},icons:{},save:n.EmptyMethod,setDraggable:n.EmptyMethod},j=r.default.createContext(T),k=()=>{const t=r.default.useContext(j),{editor:a}=t;n.assertDefined(a);const s=r.default.useRef([]),{eventTarget:l}=a,o=t=>{const{type:a}=t;if(n.isEventType(a)&&t instanceof CustomEvent){const a=t.detail,{id:r,type:l}=a,{current:o}=s,i=o.find((e=>e.id===r)),c=i||{id:r,activityGroup:e.ActivityGroup.Active,infos:[]};c.infos.unshift(a),l===n.ActivityType.Complete?c.activityGroup=e.ActivityGroup.Complete:l===n.ActivityType.Error&&(c.activityGroup=e.ActivityGroup.Error),i||o.unshift(c)}},i=r.default.useSyncExternalStore((e=>(l.addEventListener(n.EventType.Active,e),()=>{l.removeEventListener(n.EventType.Active,e)})),(()=>s.current)),c=()=>(l.addEventListener(n.EventType.Active,o),()=>{l.removeEventListener(n.EventType.Active,o)});return r.default.useEffect((()=>c()),[]),[a,i]};function S(t){const{initialPicked:a=e.ActivityGroup.Active,initialCollapsed:s=!1,className:o}=t,c=l(t,["initialPicked","initialCollapsed","className"]);v(a);const[u,d]=r.default.useState(s),[f,p]=r.default.useState(""),[m,g]=k(),[y,h]=r.default.useState(a),E={activities:r.default.useMemo((()=>g.filter((e=>e.activityGroup===y))),[y,g.length]),allActivities:g,picked:y,pick:h,label:f},b={collapsed:u,changeCollapsed:d},T=[];o&&T.push(o),u&&T.push(n.ClassCollapsed);const j=Object.assign(Object.assign({},c),{className:T.join(" ")});return r.default.createElement(C.Provider,{value:E},r.default.createElement(O.Provider,{value:b},r.default.createElement(i,Object.assign({},j))))}const D={infos:[],activityGroup:e.ActivityGroup.Active,id:""},x=r.default.createContext(D);function P(e){const t=r.default.useContext(C),a=r.default.useContext(O),{collapsed:s}=a,{activities:o}=t;if(s)return null;const{children:c}=e,u=l(e,["children"]),d=r.default.Children.only(c);n.assertTrue(r.default.isValidElement(d));const f=o.map((e=>{const t={children:r.default.cloneElement(d),value:e,key:e.id};return r.default.createElement(x.Provider,Object.assign({},t))})),p=Object.assign(Object.assign({},u),{children:f});return r.default.createElement(i,Object.assign({},p))}function N(e){const{collapsed:t}=e,n=l(e,["collapsed"]),[a,s]=r.default.useState(!!t),o={collapsed:a,changeCollapsed:s};return r.default.createElement(O.Provider,{value:o},r.default.createElement(i,Object.assign({},n)))}function w(e){const t=r.default.useContext(O),{collapsed:n}=t,a=r.default.useContext(x),{infos:s}=a,[l]=s,o=(s.find((e=>e.label))||{label:""}).label||l.type,c=Object.assign({},e);if(n)c.children=o;else{const e=[o,...s.map((e=>g(e)))];c.children=e.map(((e,t)=>r.default.createElement(i,{key:t,children:e})))}return r.default.createElement(i,Object.assign({},c))}const A={child:"single child element expected"};function R(e){const t=r.default.useContext(C),{id:a,children:s}=e;v(a);const{picked:l}=t;if(a!==l)return null;const o=r.default.Children.only(s);return n.assertTrue(r.default.isValidElement(o),A.child),o}function M(e){const{id:t,className:a,children:s}=e,o=l(e,["id","className","children"]);v(t);const i=r.default.Children.only(s);n.assertTrue(r.default.isValidElement(i),A.child);const c=r.default.useContext(C),{picked:u,pick:d}=c,f=[];a&&f.push(a),t===u&&f.push(n.ClassSelected);const p=Object.assign(Object.assign({},o),{className:f.join(" "),key:`activity-picker-${t}`,onClick:()=>d(t)});return r.default.cloneElement(i,p)}function I(t){const a=r.default.useContext(C),s=r.default.useContext(x),{infos:l,id:o}=s,c=[];let u=0,d=0;if(n.isPopulatedArray(l)){const[e]=l,{step:t,steps:a}=e;n.isPositive(t)&&n.isAboveZero(a)&&(d=t,u=a)}else{const{allActivities:t,label:s}=a;n.isPopulatedString(s)&&c.push(r.default.createElement("label",{key:"label"},s));const l=t.filter((t=>t.activityGroup===e.ActivityGroup.Active));l.length&&l.forEach((e=>{const{infos:t}=e,[a]=t;n.assertObject(a);const{step:s,steps:r}=a;n.isPositive(r)&&(u+=r),n.isPositive(s)&&(d+=s)}))}if(u){const e=d/u,t={value:e,max:1,children:`${Math.round(100*e)}%`,key:"progress"};c.push(r.default.createElement("progress",Object.assign({},t)))}const f=Object.assign(Object.assign({},t),{key:"activity-progress",children:c});return r.default.createElement(i,Object.assign({},f))}function B(e){const{before:t,content:n,after:a,props:s={}}=e;if(!(t||n||a))return null;const l=[t,n,a].filter(Boolean);return s.children=l,r.default.createElement(i,Object.assign({},s))}const L=e=>{var t,a,s,r,l,o,i,c,u;return e.header||(e.header={}),(t=e.header).props||(t.props={}),(a=e.header.props).key||(a.key="header"),(s=e.header.props).className||(s.className="head"),e.content||(e.content={}),(r=e.content).props||(r.props={}),(l=e.content.props).key||(l.key="content"),(o=e.content.props).className||(o.className="content"),e.footer||(e.footer={}),(i=e.footer).props||(i.props={}),(c=e.footer.props).key||(c.key="footer"),(u=e.footer.props).className||(u.className="foot"),e.props||(e.props={}),n.assertPopulatedObject(e.icons),e};function G(e){const t=r.default.useContext(O),{collapsed:n}=t;if(n)return null;const{before:a,content:s,after:l,props:o={}}=e;if(!(a||s||l))return null;const c=[a,s,l].filter(Boolean);return o.children=c,r.default.createElement(i,Object.assign({},o))}function z(e){const t=r.default.useContext(O),{collapsed:n,changeCollapsed:a}=t,s=Object.assign(Object.assign({},e),{onClick:()=>{a(!n)}});return r.default.createElement(i,Object.assign({},s))}function F(e){return r.default.useContext(O).collapsed?null:r.default.createElement(r.default.Fragment,null,e.children)}function V(e){return r.default.useContext(O).collapsed?r.default.createElement(r.default.Fragment,null,e.children):null}const $=function(t={}){var a,s,l,o,c,u;const d=L(t),{icons:f}=d;(a=d.props).key||(a.key="activity"),(s=d.props).className||(s.className="panel activity"),(l=d.props).initialPicked||(l.initialPicked=e.ActivityGroup.Active),n.isUndefined(d.props.initialCollapsed)&&(d.props.initialCollapsed=!0),(o=d.header).content||(o.content=[f.activity,r.default.createElement(F,{key:"not-collapsed"},r.default.createElement(i,{key:"view"})),r.default.createElement(V,{key:"collapsed"},r.default.createElement(I,{key:"progress",className:"progress"})),r.default.createElement(z,{key:"collapse-control"},r.default.createElement(F,{key:"not-collapsed",children:f.collapse}),r.default.createElement(V,{key:"collapsed",children:f.collapsed}))]),(c=d.content).children||(c.children=r.default.createElement(N,{className:"item",collapsed:!0},r.default.createElement(z,{key:"collapse-control"},r.default.createElement(F,{key:"not-collapsed",children:f.collapse}),r.default.createElement(V,{key:"collapsed",children:f.collapsed})),r.default.createElement(w,{key:"label",className:"label"}),r.default.createElement(R,{key:"active",id:"active"},r.default.createElement(I,{key:"progress"})),r.default.createElement(R,{key:"error",id:"error",children:f.error}),r.default.createElement(R,{key:"complete",id:"complete",children:f.complete}))),(u=d.footer).content||(u.content=[r.default.createElement(M,{key:"active",id:"active",className:n.ClassButton,children:f.active}),r.default.createElement(M,{key:"error",id:"error",className:n.ClassButton,children:f.error}),r.default.createElement(M,{key:"complete",id:"complete",className:n.ClassButton,children:f.complete})]);const p=r.default.createElement(r.default.Fragment,null,r.default.createElement(B,Object.assign({},d.header)),r.default.createElement(P,Object.assign({},d.content.props),d.content.children),r.default.createElement(G,Object.assign({},d.footer)));return Object.assign(Object.assign({},d.props),{children:p})},H={enabled:!1,servers:{},endpointPromise:()=>Promise.resolve({})},q=r.default.createContext(H);function U(e){const t=r.default.useContext(q),{enabled:n}=t;return n?r.default.createElement(r.default.Fragment,null,e.children):null}const W={width:0,height:0,videoRate:0,streaming:!1,updating:!1,preloading:!1,setPreloading:()=>{},setStreaming:()=>{},setWidth:()=>{},setHeight:()=>{},setVideoRate:()=>{},setUpdating:()=>{},setId:()=>{},id:"",setUrl:()=>{},url:""},Z=r.default.createContext(W);const J={error:"",processing:!1,progress:0,setError:()=>{},setProcessing:()=>{},setProgress:()=>{},setStatus:()=>{},status:""},X=r.default.createContext(J);const _=()=>r.default.useContext(j).editor;const K={addPicker:n.EmptyMethod,definitions:[],pick:n.EmptyMethod,picked:"",removePicker:n.EmptyMethod},Y=r.default.createContext(K),Q=n.EventType.Added,ee=(e=[])=>{const t=r.default.useContext(j),{editor:a}=t;n.assertDefined(a);const s=r.default.useRef({}),{eventTarget:l}=a,o=e=>{const{type:t}=e;if(n.isEventType(t)&&e instanceof CustomEvent){const{detail:t}=e,{definitionTypes:a}=t;if(n.isPopulatedArray(a)){const e=a,{current:t}=s,n=Object.keys(t).filter((t=>e.some((e=>t.includes(e)))));n.forEach((e=>delete t[e]))}}},i=r.default.useSyncExternalStore((e=>(l.addEventListener(Q,e),()=>{l.removeEventListener(Q,e)})),(()=>{var t;const a=e.join("-")||"empty";return(t=s.current)[a]||(t[a]=(()=>{const t=e.map((e=>n.Defined.byType(e)));return 1===t.length?t[0]:t.flat()})())})),c=()=>(l.addEventListener(Q,o),()=>{l.removeEventListener(Q,o)});return r.default.useEffect((()=>c()),[]),[a,i]},te="api-definitions",ne="disabled",ae="empty",se=(e=[])=>{const t=r.default.useContext(q),a=r.default.useContext(j),{enabled:s,servers:l,endpointPromise:o}=t,{editor:i}=a;n.assertDefined(i);const c=r.default.useRef({}),{eventTarget:u}=i,d=t=>{switch(t){case ae:case ne:break;default:(t=>{const a={types:e};console.debug("DataDefinitionRetrieveRequest",n.Endpoints.data.definition.retrieve,a),o(n.Endpoints.data.definition.retrieve,a).then((e=>{console.debug("DataDefinitionRetrieveResponse",n.Endpoints.data.definition.retrieve,e);const{definitions:a}=e;c.current[t].push(...a.map((e=>n.DefinitionBase.fromObject(e)))),u.dispatchEvent(new CustomEvent(te))}))})(t)}return[]};return[i,r.default.useSyncExternalStore((e=>(u.addEventListener(te,e),()=>{u.removeEventListener(te,e)})),(()=>{const t=s&&l[n.ServerType.Data]?e.length?e.join("-"):ae:ne,a=c.current[t];return a||(c.current[t]=d(t))}))]};function re(e){const{initialPicked:t="container"}=e,a=l(e,["initialPicked"]),[s,o]=r.default.useState({}),c=r.default.useContext(j),{changeDefinition:u}=c,[d,f]=r.default.useState(t),[p,m]=((e=[])=>{const[t,n]=ee(e),[a,s]=se(e),r=s.filter((e=>!n.some((t=>t.id===e.id))));return[t,[...n,...r]]})(s[d]),g={value:{definitions:m,picked:d,pick:e=>{n.assertPopulatedString(e),u(),f(e)},addPicker:(e,t)=>{o((n=>Object.assign(Object.assign({},n),{[e]:t})))},removePicker:e=>{o((t=>Object.assign(Object.assign({},t),{[e]:[]})))}},children:r.default.createElement(i,Object.assign({},a))};return r.default.createElement(Y.Provider,Object.assign({},g))}const le={},oe=r.default.createContext(le),ie="/x-moviemasher",ce=e=>n.isObject(e)&&"offset"in e;const ue=e=>ce(e)&&"definitionObject"in e;function de(e){ue(e)||n.throwError(e,"DragDefinitionObject")}var fe;e.DragType=void 0,(fe=e.DragType||(e.DragType={})).Mash="mash",fe.Layer="layer",fe.Track="track";const pe=Object.values(e.DragType),me=e=>n.isString(e)&&pe.includes(e),ge="Files",ye=e=>n.isString(e)&&e.endsWith(ie),he=e=>{if(e)return e.types.find(ye)},Ee=e=>{const[t]=e.split("/");return n.assertDefinitionType(t),t},ve=e=>{const t=he(e);if(!t)return;const[a]=t.split("/");return me(a)||n.isDefinitionType(a)?a:void 0},be=e=>{const{types:t}=e;return t.filter((e=>e===ge||ye(e)))},Ce=(e,t)=>{const n=t?`${t}${ie}`:be(e).find(ye);if(!n)return{};const a=e.getData(n);return a?JSON.parse(a):{}},Oe=e=>e.getBoundingClientRect(),Te=(e,t)=>{const n=t instanceof Element?Oe(t):t,{x:a,y:s}=n,{clientY:r,clientX:l}=e;return{x:l-a,y:r-s}},je=(e,t={})=>{const a=[],{length:s}=e;if(!s)return a;const r=n.isPopulatedObject(t),{extensions:l={},uploadLimits:o={}}=t,i=l,c=o;for(let t=0;t<s;t++){const s=e.item(t);if(!s)continue;const{name:l,size:o,type:u}=s,d=u.split("/").shift();if(!n.isUploadType(d)){a.push({label:l,value:d,error:"import.type"});continue}const f=c[d];if(r&&!(n.isAboveZero(f)&&1024*f*1024>o)){a.push({label:l,value:`${f}MB`,error:"import.bytes"});continue}const p=l.toLowerCase().split(".").pop(),m=n.isPopulatedString(p),g=i[d];!r&&m||m&&n.isArray(g)&&g.includes(p)?a.push(s):a.push({label:l,value:p,error:"import.extension"})}return a},ke=e=>{if(n.isUndefined(e))return"";switch(e){case n.DroppingPosition.After:return n.ClassDroppingAfter;case n.DroppingPosition.Before:return n.ClassDroppingBefore;case n.DroppingPosition.None:return""}return n.ClassDropping};function Se(e){const[t,a]=r.default.useState(!1),{className:s,children:o}=e,c=l(e,["className","children"]),u=r.default.useContext(j),d=r.default.useContext(Y).definitions||[],{drop:f}=u,p=e=>!!e&&be(e).includes(ge),m=e=>{n.eventStop(e),a(!1)},g=[];s&&g.push(s),t&&g.push(n.ClassDropping);const y=r.default.Children.only(o);n.assertTrue(r.default.isValidElement(y));const h=Object.assign(Object.assign({},c),{className:g.join(" "),key:"browser-content",children:(()=>{const e=y.props;return d.map((t=>{const n=Object.assign(Object.assign({},e),{key:t.id}),a={children:r.default.cloneElement(y,n),value:{definition:t},key:t.id};return r.default.createElement(oe.Provider,Object.assign({},a))}))})(),onDrop:e=>{m(e);const{dataTransfer:t}=e;p(t)&&f(t.files)},onDragOver:e=>{n.eventStop(e),a(p(e.dataTransfer))},onDragLeave:m});return r.default.createElement(i,Object.assign({},h))}const De=(e,t,a)=>e?[e]:t?n.isString(t)?t.split(",").map((e=>e.trim())):t:a?a.map((e=>e.name)):[],xe=(e,t,a)=>{const s=De(e,t);a&&!s.length&&s.push(a);return s.filter((e=>n.isDefinitionType(e))).map((e=>e))},Pe=(e,t,a)=>{const s=De(e,t);a&&!s.length&&s.push(a);return s.filter((e=>n.isSelectType(e))).map((e=>e))};function Ne(e){const{children:t,type:a,types:s,className:o,id:i}=e,c=l(e,["children","type","types","className","id"]);n.assertPopulatedString(i);const u=r.default.useContext(Y),{pick:d,picked:f,addPicker:p,removePicker:m}=u,g=[];o&&g.push(o),f===i&&g.push(n.ClassSelected),r.default.useEffect((()=>(p(i,xe(a,s,i)),()=>{m(i)})),[]);const y=Object.assign(Object.assign({},c),{className:g.join(" "),key:`browser-picker-${i}`,onClick:()=>{d(i)}}),h=r.default.Children.only(t);return n.assertTrue(r.default.isValidElement(h),A.child),r.default.cloneElement(h,y)}const we="upload-control-id";function Ae(e){const{children:t}=e,a=l(e,["children"]),s=r.default.useRef(null),o=r.default.useContext(q),i=r.default.useContext(j),{servers:c}=o,{drop:u}=i,{file:d={}}=c,{extensions:f=Object.fromEntries(n.UploadTypes.map((e=>[e,[]])))}=d;n.assertObject(f);const p=Object.entries(f).flatMap((([e,t])=>[`${e}/*`,...t.map((e=>`.${e}`))])).join(","),m=Object.assign({accept:p,id:we,onChange:e=>{const{files:t}=e.currentTarget;t&&u(t)},type:"file",key:"browser-control-input",ref:s},a),g=r.default.createElement("input",Object.assign({},m));if(!r.default.isValidElement(t))return g;const y={children:[r.default.Children.only(t),g],key:"browser-control",htmlFor:we};return r.default.createElement("label",Object.assign({},y))}const Re=()=>r.default.useContext(oe).definition;function Me(e){const{className:t,iconRatio:a}=e,s=l(e,["className","iconRatio"]),c=a||.25,u=r.default.useRef(null),d=r.default.useRef(null),f=r.default.useContext(j),{editor:p,definition:m,changeDefinition:g}=f;n.assertTrue(p);const y=Re(),{id:h,label:E,type:v}=y,b=()=>o(this,void 0,void 0,(function*(){const{rect:e,preloader:t}=p,{current:a}=u;if(!a||!n.sizeAboveZero(e))return;const s=n.sizeCeil(n.sizeScale(n.sizeCopy(e),c,c)),r=yield y.definitionIcon(t,s);r&&a.replaceChildren(r)}));r.default.useEffect((()=>{b()}),[]),u.current&&b();const C=e=>{e.stopPropagation(),g(y)},O=e=>{C(e);const t=d.current.getBoundingClientRect(),{left:n}=t,{clientX:a}=e,s={offset:a-n,definitionObject:y},r=JSON.stringify(s),{dataTransfer:l}=e;l&&(l.effectAllowed="copy",l.setData(y.type+ie,r))},T=Object.assign(Object.assign({},s),{className:t,children:(()=>{const e=[r.default.createElement(i,{key:"icon",ref:u})];return E&&e.unshift(r.default.createElement("label",{key:"label"},E)),e})(),ref:d,key:h});return e.draggable&&(T.onDragStart=O,T.onPointerDown=C,T.className=(()=>{const e=[];return t&&e.push(t),(null==m?void 0:m.id)===h&&e.push(n.ClassSelected),e.join(" ")})()),r.default.createElement(i,Object.assign({},T))}const Ie=function(e={}){var t,a,s,l,o,i,c,u;const d=L(e),{icons:f}=d;(t=d.props).key||(t.key="browser"),(a=d.props).className||(a.className="panel browser"),(s=d.props).initialPicked||(s.initialPicked="container"),(l=d.header).content||(l.content=[f.browser]),(o=d.footer).content||(o.content=[r.default.createElement(Ne,{key:"effect",id:"effect",className:n.ClassButton,children:f.browserEffect}),r.default.createElement(Ne,{key:"container",id:"container",className:n.ClassButton,children:f.container}),r.default.createElement(Ne,{key:"content",id:"content",className:n.ClassButton,children:f.content})]),(i=d.footer).before||(i.before=[r.default.createElement(Ne,{key:"video",id:"video",types:"video,videosequence",className:n.ClassButton,children:f.browserVideo}),r.default.createElement(Ne,{key:"audio",id:"audio",className:n.ClassButton,children:f.browserAudio}),r.default.createElement(Ne,{key:"image",id:"image",className:n.ClassButton,children:f.browserImage})]),(c=d.footer).after||(c.after=[r.default.createElement(Ae,{key:"import",children:f.import})]),(u=d.content).children||(u.children=r.default.createElement(Me,{draggable:!0,className:"definition preview"}));const p=r.default.createElement(r.default.Fragment,null,r.default.createElement(B,Object.assign({},d.header)),r.default.createElement(Se,Object.assign({},d.content.props),d.content.children),r.default.createElement(B,Object.assign({},d.footer)));return Object.assign(Object.assign({},d.props),{children:p})},Be={prevClipEnd:0},Le=r.default.createContext(Be),Ge={},ze=r.default.createContext(Ge),Fe={dragTypeValid:()=>!1,frame:0,frames:0,onDragLeave:n.EmptyMethod,onDrop:n.EmptyMethod,rect:n.RectZero,refreshed:0,refresh:n.EmptyMethod,scale:0,scroll:{x:0,y:0},setDroppingClip:n.EmptyMethod,setDroppingPosition:n.EmptyMethod,setDroppingTrack:n.EmptyMethod,setRect:n.EmptyMethod,setScroll:n.EmptyMethod,setZoom:n.EmptyMethod,zoom:1},Ve=r.default.createContext(Fe),$e={depth:0},He=r.default.createContext($e),qe=()=>r.default.useContext(He).layer,Ue=(e,t)=>{const n=r.default.useContext(j),{editor:a}=n,s=t||a.eventTarget,l=t=>{const{type:n}=t,a=e[n];a&&a(t)},o=()=>(Object.keys(e).forEach((e=>{s.addEventListener(e,l)})),()=>{Object.keys(e).forEach((e=>{s.removeEventListener(e,l)}))});r.default.useEffect((()=>o()),[])};function We(e){const{className:t}=e,a=l(e,["className"]),s=r.default.useRef(null),o=r.default.useRef(null),c=_(),u=r.default.useContext(ze),d=r.default.useContext(Ve),[f,p]=r.default.useState(0),m=()=>{p((new Date).valueOf())},g=r.default.useRef({}),{current:y}=g,h=r.default.useContext(Le),{droppingPosition:E,droppingClip:v,scale:b,selectedClip:C,onDrop:O,dragTypeValid:T,setDroppingPosition:j,setDroppingClip:k,setDroppingTrack:S,onDragLeave:D}=d,{track:x}=u,{clip:P,prevClipEnd:N}=h;n.assertTrue(P);const w=()=>{const{current:e}=s,t=null==e?void 0:e.parentNode;return t instanceof HTMLDivElement?t.offsetHeight:0},[A,R]=r.default.useState(w),{label:M,type:I,frame:B,frames:L}=P,G=()=>{if(!n.isAboveZero(b)||!n.isAboveZero(L))return 0;const e=n.pixelFromFrame(L,b,"floor"),{width:t}=y;return e&&e!==t&&(y.width=e,m()),e},z=G();Ue({[n.EventType.Action]:e=>{if(y.redraw)return;const{type:t}=e;if(!n.isEventType(t))return;if(!(e instanceof CustomEvent))return;if(t!==n.EventType.Action)return;const{detail:a}=e;if(!a)return;const{action:s}=a;if(!s)return;const{target:r}=s;if(n.isObject(r)){switch(r){case P:case P.container:case P.content:break;default:if("color"===s.property)break;return}m()}},[n.EventType.Save]:m});const F=()=>{const{width:e,redraw:t}=y;delete y.timeout,delete y.redraw;const{current:a}=s,{edited:r}=c,l=a&&r&&e&&e===G();if((t||!l)&&(m(),!l))return Promise.resolve();const o=(()=>{const{rect:e}=c,t={width:A*(e.width/e.height),height:A};return n.sizeCeil(t)})(),i=(e=>{const{width:t,height:n}=e;return{width:Math.max(t,z),height:n}})(o),u=P.clipIcon(i,d.scale,2);return u?u.then((t=>{const s=G();t&&e>=s&&a.replaceChildren(((e,t,a)=>{const s=n.colorToRgb(e),r=n.colorRgbDifference(s),l=n.colorFromRgb(r),o=n.svgPolygonElement(t,"",e),i={x:t.width,y:0,width:a,height:t.height},c=n.svgPolygonElement(i,"",l),u={width:t.width+a,height:t.height},f=n.idGenerate("pattern"),p=[o,c],m=n.svgPatternElement(u,f,p),g=n.svgDefsElement([m]),y={width:d.rect.width,height:A},h=n.svgPolygonElement(y,"",n.svgUrl(f));return n.svgElement(y,[g,h])})(r.color,o,2),t)})):Promise.resolve()};r.default.useEffect((()=>{if(!A)return R(w);const{current:e}=s,{edited:t}=c;e&&t&&(y.timeout?y.redraw||(y.redraw=!0):y.timeout=setTimeout(F,500))}),[f,b,A]);const V=e=>{e.stopPropagation(),c.selection.set(P)},$={width:z};N>-1&&($.marginLeft=n.pixelFromFrame(B-N,b,"floor"));const H=Object.assign(Object.assign({},a),{style:$,className:(()=>{const e=P===C,a=[];return t&&a.push(t),e&&a.push(n.ClassSelected),v===P&&a.push(ke(E)),a.join(" ")})(),onPointerDown:V,onDragStart:e=>{V(e);const{dataTransfer:t,clientX:n}=e,{current:a}=o;if(!t||!a)return;const s=a.getBoundingClientRect(),{left:r}=s,l={offset:n-r},i=JSON.stringify(l);t.effectAllowed="move",t.setData(I+ie,i)},onDragEnd:e=>{n.eventStop(e);const{dataTransfer:t}=e;if(!t)return;const{dropEffect:a}=t;"none"===a&&c.removeClip(P)},onDragOver:e=>{n.eventStop(e);const{dataTransfer:t}=e;if(!t)return;const a=T(t,P),s=a?n.DroppingPosition.At:n.DroppingPosition.None;S(a?x:void 0),k(a?P:void 0),j(s)},onDragLeave:D,onDrop:O,onClick:e=>e.stopPropagation(),draggable:!0,ref:o,children:(()=>{const e={key:"clip-previews",ref:s},t={width:z,height:A};if(n.sizeAboveZero(t)){const{width:n,height:a}=t;e.width=n,e.height=a,e.viewBox=`0 0 ${n} ${a}`}const a=[r.default.createElement("svg",Object.assign({},e))];return M&&a.unshift(r.default.createElement("label",{key:"label"},M)),a})()});return r.default.createElement(i,Object.assign({},H))}const Ze={refreshed:0,refresh:n.EmptyMethod,validDragType:()=>{},droppingPosition:n.DroppingPosition.None,setDroppingPosition:n.EmptyMethod,onDrop:n.EmptyMethod,setDroppingLayer:n.EmptyMethod,onDragLeave:n.EmptyMethod},Je=r.default.createContext(Ze);function Xe(t){const a=r.default.useContext(j),[s,l]=r.default.useState(void 0),[o,c]=r.default.useState(void 0),[u,d]=r.default.useState(0),[f,p]=r.default.useState(n.DroppingPosition.None),{editor:m,draggable:g,drop:y}=a,h=()=>{d((e=>e+1))};if(Ue({[n.EventType.Selection]:()=>{l(m.selection.layer)},[n.EventType.Cast]:h}),!m)return null;const E=t=>{if(!t)return;const n=ve(t);return me(n)&&[e.DragType.Mash,e.DragType.Layer].includes(n)?n:void 0},v={refreshed:u,refresh:h,selectedLayer:s,validDragType:E,droppingPosition:f,setDroppingPosition:p,onDrop:t=>{t.preventDefault(),p(n.DroppingPosition.None),h();const{dataTransfer:a}=t;n.assertObject(a);if(be(a).includes(ge)){const e={};return void y(a.files,e)}const s=E(a);if(!s)return;const r={layer:o,position:f};switch(s){case e.DragType.Layer:n.isLayer(g)&&m.moveLayer(g,r);break;case e.DragType.Mash:{const e={mashObject:{},definitionObjects:[]};m.addMash(e,r);break}default:g&&y(g)}},droppingLayer:o,setDroppingLayer:c,onDragLeave:()=>{p(n.DroppingPosition.None),c(void 0)}},b={children:r.default.createElement(i,Object.assign({},t)),value:v};return r.default.createElement(Je.Provider,Object.assign({},b))}function _e(e){const t=r.default.useRef(null);r.default.useContext(j);const a=r.default.useContext(Je),s=r.default.useContext(He),{validDragType:o,droppingPosition:c,setDroppingPosition:u,onDrop:d,droppingLayer:f,setDroppingLayer:p,onDragLeave:m}=a,g=_(),{layer:y}=s;if(!y)return null;const{className:h="layer"}=e,E=l(e,["className"]),v=e=>{e.stopPropagation(),g.selection.set(y)},b=r.default.useMemo((()=>{const e=y===g.selection.layer,t=[h];return e&&t.push(n.ClassSelected),f===y&&t.push(ke(c)),t.join(" ")}),[c,f,g.selection.layer]),C=Object.assign(Object.assign({},E),{className:b,ref:t,onMouseDown:v,onDragStart:e=>{const a=Te(e,t.current);v(e);const{dataTransfer:s}=e;n.isObject(s)&&(s.effectAllowed="move",s.setData(`layer${ie}`,JSON.stringify(a)))},onDragEnd:e=>{const{dataTransfer:t}=e;if(!t)return;const{dropEffect:n}=t;"none"===n&&g.removeLayer(y)},onClick:e=>{e.stopPropagation(),g.selection.set(y)},onDragLeave:m,onDragOver:e=>{const a=(e=>{const{dataTransfer:a}=e,{current:s}=t;if(!s||!o(a))return n.DroppingPosition.None;const r=Oe(t.current),l=Te(e,r),i=Math.ceil(r.height/4),c=n.isLayerFolder(y);return l.y<i*(c?1:2)?n.DroppingPosition.Before:!c||l.y>3*i?n.DroppingPosition.After:n.DroppingPosition.At})(e);u(a),p(y),n.eventStop(e)},onDrop:d,draggable:!0});return r.default.createElement(i,Object.assign({},C))}function Ke(e){const t=r.default.useContext(Je),{droppingLayer:a,setDroppingLayer:s,droppingPosition:o,setDroppingPosition:c,onDrop:u,onDragLeave:d}=t,f=_(),{className:p="content",children:m}=e,g=l(e,["className","children"]),y=r.default.Children.only(m);n.assertTrue(r.default.isValidElement(y));const h=(e,t=0)=>e.flatMap((n=>n?E(n,t):(console.trace("layersArray no layer",t,e),[]))),E=(e,t)=>{const a={layer:e,depth:t},s={key:`layer-${e.id}`,value:a,children:r.default.createElement(_e,Object.assign({},y.props))},l=[r.default.createElement(He.Provider,Object.assign({},s))];return n.isLayerFolder(e)&&!e.collapsed&&l.push(...h(e.layers,t+1)),l},v=r.default.useMemo((()=>{var e;return h((null===(e=f.selection.cast)||void 0===e?void 0:e.layers)||[])}),[t.refreshed,t.selectedLayer]),b=r.default.useMemo((()=>{const e=[p];return o===n.DroppingPosition.None||a||e.push(n.ClassDropping),e.join(" ")}),[o,a,f.selection.layer]),C=Object.assign(Object.assign({},g),{children:v,key:"composer-view",onClick:()=>{f.selection.unset(n.SelectType.Layer)},onDragLeave:d,onDragOver:e=>{e.preventDefault();const{dataTransfer:t}=e;(e=>!!e&&(!!be(e).includes(ge)||!!ve(e)))(t)&&(c(v.length),s())},onDrop:u,className:b});return r.default.createElement(i,Object.assign({},C))}function Ye(e){const t=r.default.useContext(He),{depth:n}=t,a=r.default.Children.only(e.children);if(!r.default.isValidElement(a))throw A.child;const s=new Array(n).fill(!0).map(((e,t)=>{const n=Object.assign(Object.assign({},a.props),{key:`depth-${t}`});return r.default.cloneElement(a,n)}));return r.default.createElement(r.default.Fragment,null,s)}function Qe(e){const t=r.default.useContext(Je),a=qe();if(a.type!==n.LayerType.Folder)return null;const s=a;if(s.collapsed)return null;const{children:o}=e,i=l(e,["children"]),c=r.default.Children.only(o);if(!r.default.isValidElement(c))throw A.child;const u=Object.assign(Object.assign({},i),{onClick:()=>{s.collapsed=!0,t.refresh()}});return r.default.cloneElement(c,u)}function et(e){const{children:t}=e,a=l(e,["children"]),s=r.default.Children.only(t);if(!r.default.isValidElement(s))throw A.child;const o=r.default.useContext(Je),i=qe();if(i.type!==n.LayerType.Folder)return null;const c=i;if(!c.collapsed)return null;const u=Object.assign(Object.assign({},a),{onClick:()=>{c.collapsed=!1,o.refresh()}});return r.default.cloneElement(s,u)}function tt(e){return qe().type!==n.LayerType.Folder?null:r.default.createElement(r.default.Fragment,null,e.children)}function nt(e){const t=qe(),[a,s]=r.default.useState(t.label);Ue({[n.EventType.Action]:e=>{if(!n.isActionEvent(e))return;const{action:a}=e.detail;n.isChangeAction(a)&&t===a.target&&s(t.label)}});const l=Object.assign(Object.assign({},e),{children:a});return r.default.createElement("label",Object.assign({},l))}function at(e){return qe().type!==n.LayerType.Mash?null:r.default.createElement(r.default.Fragment,null,e.children)}function st(e){const{useView:t,selected:a}=e,s=l(e,["useView","selected"]);if(!t)return r.default.createElement("button",Object.assign({},s));const{disabled:o,className:c}=s,u=l(s,["disabled","className"]),d=[n.ClassButton];c&&d.push(c),o?d.push(n.ClassDisabled):a&&d.push(n.ClassSelected);const f=Object.assign(Object.assign({},u),{className:d.join(" ")});return r.default.createElement(i,Object.assign({},f))}function rt(e){const t=_(),n=r.default.useContext(Je),{children:a}=e,s=l(e,["children"]),o=r.default.Children.only(a);if(!r.default.isValidElement(o))throw A.child;const i=Object.assign(Object.assign({},s),{onClick:()=>{t.addFolder(),n.refresh()}});return r.default.cloneElement(o,i)}function lt(e){const t=_(),n=r.default.useContext(Je),{children:a}=e,s=l(e,["children"]),o=r.default.Children.only(a);if(!r.default.isValidElement(o))throw A.child;const i=Object.assign(Object.assign({},s),{onClick:()=>{t.addMash(),n.refresh()}});return r.default.cloneElement(o,i)}const ot=function(e={}){var t,a,s,l,o,i;const c=L(e),{icons:u}=c;(t=c.props).key||(t.key="composer"),(a=c.props).className||(a.className="panel composer"),(s=c.props).initialPicked||(s.initialPicked="container"),(l=c.header).content||(l.content=[u.composer]),(o=c.footer).content||(o.content=[r.default.createElement(lt,null,r.default.createElement(st,null,u.add,u.mmWide)),r.default.createElement(rt,null,r.default.createElement(st,null,u.add,u.folder))]),(i=c.content).children||(i.children=r.default.createElement("div",{key:"layer",className:"layer"},r.default.createElement("div",{key:"icons"},r.default.createElement(Ye,{key:"depth"},r.default.createElement("div",{className:"depth"})),r.default.createElement(tt,{key:"layer-folder"},r.default.createElement(et,{key:"folder-open"},r.default.createElement("div",{className:n.ClassButton},u.folder)),r.default.createElement(Qe,{key:"folder-close"},r.default.createElement("div",{className:n.ClassButton},u.folderOpen))),r.default.createElement(at,{key:"layer-mash"},r.default.createElement("div",{key:"mash-icon",className:n.ClassButton},u.mmTube))),r.default.createElement(nt,{key:"label"}),r.default.createElement("div",{key:"play-button",className:n.ClassButton},u.playerPlay)));const d=r.default.createElement(r.default.Fragment,null,r.default.createElement(B,Object.assign({},c.header)),r.default.createElement(Ke,Object.assign({},c.content.props),c.content.children),r.default.createElement(B,Object.assign({},c.footer)));return Object.assign(Object.assign({},c.props),{children:d})};function it(e){const{children:t}=e,a=l(e,["children"]),s=_(),o=()=>s.can(n.MasherAction.Save),[i,c]=r.default.useState(o),u=()=>{c(o())};Ue({[n.EventType.Action]:u,[n.EventType.Mash]:u,[n.EventType.Cast]:u,[n.EventType.Save]:u});const d=Object.assign(Object.assign({},a),{onClick:()=>{i||s.create()},disabled:i});return r.default.cloneElement(r.default.Children.only(t),d)}function ct(e){const[t,a]=r.default.useState(!0),s=_();Ue({[n.EventType.Action]:()=>{a(!s.can(n.MasherAction.Redo))}});const{children:o}=e,i=l(e,["children"]),c=Object.assign(Object.assign({},i),{onClick:()=>{s.redo()},disabled:t});return r.default.cloneElement(r.default.Children.only(o),c)}function ut(e){const{children:t,type:a}=e,s=l(e,["children","type"]),o=a||n.SelectType.Clip;n.assertSelectType(o);const i=_(),[c,u]=r.default.useState(!i.selection[o]);Ue({[n.EventType.Selection]:()=>{u(!i.selection[o])}});const d=r.default.Children.only(t),f=Object.assign(Object.assign(Object.assign({},s),d.props),{onClick:()=>{if(c)return;const e=i.selection[o];n.isEffect(e)?i.removeEffect(e):n.isClip(e)?i.removeClip(e):n.isTrack(e)&&i.removeTrack(e)},disabled:c});return r.default.cloneElement(d,f)}function dt(e){const t=_(),[a,s]=r.default.useState(!0);Ue({[n.EventType.Action]:()=>{s(!t.can(n.MasherAction.Undo))}});const{children:o}=e,i=l(e,["children"]),c=Object.assign(Object.assign({},i),{onClick:()=>{t.undo()},disabled:a});return r.default.cloneElement(r.default.Children.only(o),c)}function ft(e){const t=r.default.useContext(X),a=r.default.useContext(q),{children:s}=e,o=l(e,["children"]),{processing:i,setProcessing:c,setError:u}=t,{endpointPromise:d}=a,f=_(),p=()=>!f.can(n.MasherAction.Render),[m,g]=r.default.useState(p),y=()=>g(p());Ue({[n.EventType.Save]:y,[n.EventType.Mash]:y,[n.EventType.Action]:y});const h=(e,t)=>{setTimeout((()=>{console.debug("handleApiCallback request",e),n.fetchCallback(e).then((a=>{console.debug("handleApiCallback response",a);const{apiCallback:s,error:r}=a;if(r)E(e.endpoint.prefix,e.request,a,r);else if(s){const{request:e,endpoint:a}=s;if(a.prefix===n.Endpoints.data.mash.put){const n=e.body,{rendering:a}=n.mash;a&&(t.rendering=a)}h(s,t)}else c(!1)}))}),2e3)},E=(e,t,n,a)=>{c(!1),u(a),console.error(e,t,n,a)},v=Object.assign(Object.assign({},o),{onClick:()=>{if(m||i)return;const{edited:e}=f;n.assertMash(e),c(!0);const t={mash:e.toJSON(),definitions:f.definitions.map((e=>e.toJSON())),outputs:[{outputType:n.OutputType.Video}]};console.debug("RenderingStartRequest",n.Endpoints.rendering.start,t),d(n.Endpoints.rendering.start,t).then((a=>{console.debug("RenderingStartResponse",n.Endpoints.rendering.start,a);const{apiCallback:s,error:r}=a;r?E(n.Endpoints.rendering.start,t,a,r):h(s,e)}))},disabled:m||i});return r.default.cloneElement(r.default.Children.only(s),v)}function pt(e){const t=_(),a=r.default.useContext(j),{save:s}=a,o=()=>!t.can(n.MasherAction.Save),[i,c]=r.default.useState(o),u=()=>{c(o())};Ue({[n.EventType.Action]:u,[n.EventType.Save]:u});const{children:d}=e,f=l(e,["children"]),p=Object.assign(Object.assign({},f),{onClick:()=>{i||(c(!0),s())},disabled:i});return r.default.cloneElement(r.default.Children.only(d),p)}const mt={actionCount:0,selectedInfo:{tweenDefined:{},tweenSelected:{},selectedType:n.SelectType.None,selectTypes:[]},selectedItems:[],changeSelected:n.EmptyMethod,changeTweening:n.EmptyMethod},gt=r.default.createContext(mt);function yt(e){var t,a;const s=_(),[o,c]=r.default.useState(!1),[u,d]=r.default.useState((()=>[])),[f,g]=r.default.useState((null===(t=s.edited)||void 0===t?void 0:t.id)||""),y=r.default.useContext(q),h=r.default.useContext(gt),{selectedInfo:E}=h,{selectedType:v}=E,[b,C]=r.default.useState((null===(a=s.edited)||void 0===a?void 0:a.label)||""),O=()=>s.can(n.MasherAction.Save),[T,j]=r.default.useState(O),{enabled:k,servers:S,endpointPromise:D}=y,x=()=>{j(O())},P=e=>{const{type:t}=e;if(!n.isEventType(t)||!n.isSelectType(t))return;if(t!==v)return;const{edited:a}=s;n.assertObject(a);const{id:r,label:l}=a;d((e=>{const t=e.filter((e=>n.isPopulatedString(e.label))),s=t.findIndex((e=>e.id===r));return n.isPositive(s)?t.splice(s,1,a):t.push(a),g(r),C(l),t}))};Ue({[n.EventType.Action]:()=>{const{edited:e}=s;n.assertObject(e);const{label:t}=e;b!==t&&(d((e=>[...e])),C(t)),x()},[n.EventType.Mash]:P,[n.EventType.Cast]:P,[n.EventType.Save]:x},s.eventTarget);if(r.default.useEffect((()=>{if(!k||!S[n.ServerType.Data])return;if(o)return;c(!0);const e={partial:!0},t=n.Endpoints.data[s.editType].retrieve;console.debug("RetrieveRequest",t,e),D(t,e).then((e=>{console.debug("RetrieveResponse",t,e);const{described:a,error:s}=e;s?console.error("RetrieveResponse",t,s):d((e=>{const t=[...e];return a.forEach((e=>{const{id:a,label:s}=e,r=t.find((e=>e.id===a));!r&&n.isPopulatedString(s)&&t.push(e)})),t}))}))}),[S,k]),u.length<2)return null;const{children:N}=e,w=l(e,["children"]),A=r.default.Children.only(N);n.assertTrue(r.default.isValidElement(A));const R={key:"edited-select",onChange:e=>{if(T)return;const{selectedIndex:t}=e.target,a=u[t];n.assertObject(a);const{id:r}=a,l={id:r},{editType:o}=s,i=n.Endpoints.data[o].get;console.debug("GetRequest",i,l),D(i,l).then((e=>{console.debug("GetResponse",i,e);const{error:t}=e;if(!t)return s.load(e);console.error("GetResponse",i,t)}))},disabled:T,children:(()=>{const{editType:e,edited:t}=s,a=[r.default.createElement("optgroup",{key:"group",label:p("open")})];if(!t)return a;const{id:l,label:o}=t;return a.push(...u.map((t=>{const{label:a,id:s}=t,i=s===l?o:a,c={children:n.isPopulatedString(i)?i:m("unlabeled",{type:e}),value:s,key:s};return r.default.createElement("option",Object.assign({},c))}))),a})(),value:f},M=Object.assign(Object.assign({},w),{children:[A,r.default.createElement("select",Object.assign({},R))]});return r.default.createElement(i,Object.assign({},M))}function ht(e){const t=_(),a=()=>{const{edited:e}=t;if(!n.isMash(e))return!0;const{rendering:a}=e;return!a},[s,o]=r.default.useState(a),i=()=>o(a());Ue({[n.EventType.Render]:i,[n.EventType.Mash]:i});const{children:c}=e,u=l(e,["children"]),d=Object.assign(Object.assign({},u),{onClick:()=>{if(s)return;const{edited:e}=t;n.assertMash(e);const a=n.urlForEndpoint(t.preloader.endpoint,e.rendering);window.open(a)},disabled:s});return r.default.cloneElement(r.default.Children.only(c),d)}const Et=r.default.createElement((function(e){return null}),{key:"empty"}),vt={[n.DataType.Frame]:Et,[n.DataType.Number]:Et,[n.DataType.Rgb]:Et,[n.DataType.String]:Et,[n.DataType.DefinitionId]:Et,[n.DataType.FontId]:Et,[n.DataType.Percent]:Et,[n.DataType.ContainerId]:Et,[n.DataType.ContentId]:Et,[n.DataType.Boolean]:Et,[n.DataType.Timing]:Et,[n.DataType.Sizing]:Et},bt={value:"",name:"",property:{type:n.DataType.String,name:"",defaultValue:""}},Ct=r.default.createContext(bt);function Ot(){const e=r.default.useContext(Ct),{changeHandler:t,property:n,value:a,name:s}=e;if(!n)return null;const l={type:"checkbox",name:s,checked:!!a};return t?l.onChange=e=>{t(s,e.target.checked)}:l.disabled=!0,r.default.createElement("input",Object.assign({},l))}function Tt(e){const{type:t,types:a,children:s,className:c}=e,u=l(e,["type","types","children","className"]),d=r.default.Children.only(s);n.assertTrue(r.default.isValidElement(d));const[f,p]=r.default.useState(!1),m=r.default.useContext(Ct),g=r.default.useContext(j),{drop:y}=g,{changeHandler:h,value:E,name:v}=m;n.assertTrue(h);const b=xe(t,a),C=e=>{const{dataTransfer:t}=e;n.assertTrue(t);if(be(t).includes(ge))return!0;const a=ve(t);return!!n.isDefinitionType(a)&&b.includes(a)},O=r.default.useMemo((()=>{const e=[];return c&&e.push(c),f&&e.push(n.ClassDropping),e.join(" ")}),[f]),T=Object.assign(Object.assign({},u),{className:O,children:(()=>{if(!E)return null;n.assertPopulatedString(E);const e=n.Defined.fromId(E);n.assertDefinition(e);const t={definition:e,key:e.id},a={children:r.default.cloneElement(d,t),value:{definition:e}};return r.default.createElement(oe.Provider,Object.assign({},a))})(),onDragLeave:()=>{p(!1)},onDragOver:e=>{const t=C(e);p(t),t&&e.preventDefault()},onDrop:e=>o(this,void 0,void 0,(function*(){if(n.eventStop(e),p(!1),!C(e))return;const{dataTransfer:t}=e;n.assertTrue(t);if(be(t).includes(ge))return void(yield y(t.files).then((e=>{if(!e.length)return;const t="containerId"===v?e.filter(n.isContainerDefinition):e,[a]=t;a&&(n.assertTrue(n.Defined.installed(a.id),`${a.type} installed`),h(v,a.id))})));const a=he(t),s=t.getData(a),r=JSON.parse(s),{definitionObject:l}=r,[o]=n.Defined.define(l);("containerId"!==v||n.isContainerDefinition(o))&&h(v,l.id)})),value:String(E),key:`${v}-drop`});return r.default.createElement(i,Object.assign({},T))}function jt(){const e=r.default.useContext(Ct),{changeHandler:t,value:a,name:s}=e;n.assertTrue(t);const l={children:n.Defined.byType(n.DefinitionType.Font).map((e=>{const{id:t,label:n}=e,a={value:t,children:n,key:t};return r.default.createElement("option",Object.assign({},a))})),name:s,onChange:e=>{t(s,e.target.value)},value:String(a),key:`${s}-select`};return r.default.createElement("select",Object.assign({},l))}function kt(){const e=r.default.useContext(Ct),t=_(),{changeHandler:a,property:s,value:l,name:i,time:c}=e;if(!s)return null;const{min:u,max:d,step:f}=s,p={type:"number",name:i,value:String(l)};return n.isDefined(u)&&(p.min=u),n.isDefined(d)&&(p.max=d),n.isDefined(f)&&(p.step=f),a?p.onChange=e=>o(this,void 0,void 0,(function*(){const{value:n}=e.target;c&&(yield t.goToTime(c)),a(i,n)})):p.disabled=!0,r.default.createElement("input",Object.assign({},p))}function St(e){const{className:t,onChange:n}=e,a=Object.assign({},e),s=["slider"];if(t&&s.push(t),a.className=s.join(" "),n){const e=e=>{n(e,e.currentTarget.valueAsNumber)};a.onChange=e}return r.default.createElement("input",Object.assign({type:"range"},a))}function Dt(){const e=_(),t=r.default.useContext(Ct),{changeHandler:a,property:s,value:l,name:i,time:c,defaultValue:u}=t;if(!s)return null;const{max:d,min:f,step:p,defaultValue:m}=s,g={value:n.isDefined(l)?l:n.isDefined(u)?u:m,min:n.isNumber(f)?f:0,max:n.isNumber(d)?d:1,step:n.isNumber(p)?p:.01,name:i};if(a){const t=(t,s)=>o(this,void 0,void 0,(function*(){const t=n.isArray(s)?s[0]:s;c&&(yield e.goToTime(c)),a(i,t)}));g.onChange=t}else g.disabled=!0;return r.default.createElement(St,Object.assign({className:"slider"},g))}function xt(){r.default.useContext(j);const e=r.default.useContext(Ct),t=_(),{changeHandler:a,property:s,value:l,name:i,time:c,defaultValue:u}=e;if(!s)return null;const{defaultValue:d}=s,f=n.isDefined(l)?l:n.isDefined(u)?u:d,p={type:"color",name:i,value:String(f)};return a?p.onChange=e=>o(this,void 0,void 0,(function*(){const{value:n}=e.target;c&&(yield t.goToTime(c)),a(i,n)})):p.disabled=!0,r.default.createElement("input",Object.assign({},p))}function Pt(){const e=r.default.useContext(Ct),{changeHandler:t,property:a,value:s,name:l}=e;if(!a)return null;const o={children:n.Sizings.map((e=>{const t={value:e,children:e,key:e};return r.default.createElement("option",Object.assign({},t))})),name:l,value:String(s),key:`${l}-select`};return t?o.onChange=e=>{t(l,e.target.value)}:o.disabled=!0,r.default.createElement("select",Object.assign({},o))}function Nt(){const e=r.default.useContext(Ct),{changeHandler:t,property:n,value:a,name:s}=e;if(!n)return null;const l={name:s,type:"text",value:String(a)};return t?l.onChange=e=>{t(s,e.target.value)}:l.disabled=!0,r.default.createElement("input",Object.assign({},l))}function wt(){const e=r.default.useContext(Ct),{changeHandler:t,property:a,value:s,name:l}=e;if(!a)return null;const o={children:n.Timings.map((e=>{const t={value:e,children:e,key:e};return r.default.createElement("option",Object.assign({},t))})),name:l,value:String(s),key:`${l}-select`};return t?o.onChange=e=>{t(l,e.target.value)}:o.disabled=!0,r.default.createElement("select",Object.assign({},o))}vt[n.DataType.Boolean]=r.default.createElement(Ot,null),vt[n.DataType.ContainerId]=r.default.createElement(Tt,{types:n.ContainerTypes,className:"definition-drop"},r.default.createElement(Me,{className:"definition preview"})),vt[n.DataType.ContentId]=r.default.createElement(Tt,{types:n.ContentTypes,className:"definition-drop"},r.default.createElement(Me,{className:"definition preview"})),vt[n.DataType.FontId]=r.default.createElement(jt,null),vt[n.DataType.Number]=r.default.createElement(kt,null),vt[n.DataType.Frame]=r.default.createElement(kt,null),vt[n.DataType.Percent]=r.default.createElement(Dt,null),vt[n.DataType.Rgb]=r.default.createElement(xt,null),vt[n.DataType.Sizing]=r.default.createElement(Pt,null),vt[n.DataType.String]=r.default.createElement(Nt,null),vt[n.DataType.Timing]=r.default.createElement(wt,null);const At={[n.DataGroup.Size]:Et,[n.DataGroup.Sizing]:Et,[n.DataGroup.Point]:Et,[n.DataGroup.Opacity]:Et,[n.DataGroup.Color]:Et,[n.DataGroup.Effects]:Et,[n.DataGroup.Timing]:Et};function Rt(e){const t=r.default.useContext(j),{icons:a}=t,s=_(),{selectType:o}=e,c=l(e,["selectType"]);n.assertSelectType(o);const u=r.default.useContext(gt),{selectedItems:d,changeTweening:f,selectedInfo:p}=u,{tweenDefined:m,tweenSelected:g,onEdge:y,time:h,nearStart:E,timeRange:v}=p;n.assertTimeRange(v),n.assertTime(h);const b=m[n.DataGroup.Color],C=g[n.DataGroup.Color],O=n.selectedPropertyObject(d,n.DataGroup.Color,o),{color:T,[`color${n.PropertyTweenSuffix}`]:k}=O,S=C?k:T,{property:D,changeHandler:x,value:P,name:N}=S,{type:w,name:A}=D,R=N||A,M=vt[w],I={property:D,value:P,name:R,changeHandler:x};I.time=n.tweenInputTime(v,y,E,b,C),C&&(I.defaultValue=T.value);const B=[n.ClassSelected,n.ClassButton].join(" "),L={children:a.start,className:C?n.ClassButton:B,key:"start",onClick:()=>{s.goToTime(v.startTime),f(n.DataGroup.Color,!1)}},G={key:"end",className:C?B:n.ClassButton,children:b?a.end:a.endUndefined,onClick:()=>{s.goToTime(v.lastTime),f(n.DataGroup.Color,!0)}},z={key:"context",value:I,children:M},F=Object.assign(Object.assign({},c),{key:`inspector-${o}-${R}`,children:[a.color,r.default.createElement(Ct.Provider,Object.assign({},z)),r.default.createElement(i,{className:"start-end",key:"start-end"},r.default.createElement(i,Object.assign({},L)),r.default.createElement(i,Object.assign({},G)))]});return r.default.createElement(i,Object.assign({},F))}At[n.DataGroup.Color]=r.default.createElement(Rt,{className:"color tween row",key:"color-group-input"});const Mt=(e,t)=>{if(!t||!e)return;const{width:n,height:a}=t;e.style.setProperty("--preview-width",`${n}px`),e.style.setProperty("--preview-height",`${a}px`)},It=r.default.forwardRef(((e,t)=>r.default.createElement("video",Object.assign({},e,{ref:t}))));function Bt(e){const{className:t,removeHandler:a,index:s,effect:o,selectedEffect:c,setSelectedEffect:u}=e,d=l(e,["className","removeHandler","index","effect","selectedEffect","setSelectedEffect"]),f=c===o,p=()=>{f||u(o)},m=[t||"effect"];f&&m.push(n.ClassSelected);const g=Object.assign(Object.assign({},d),{children:o.label,className:m.join(" "),onMouseDown:p,onDragStart:e=>{f||p();const t={index:s},n=JSON.stringify(t),{dataTransfer:a}=e;a&&(a.effectAllowed="move",a.setData(`effect${ie}`,n))},onDragEnd:e=>{const{dataTransfer:t}=e;if(!t)return;const{dropEffect:n}=t;"none"===n&&a(o)},onClick:e=>e.stopPropagation(),draggable:!0});return r.default.createElement(i,Object.assign({},g))}function Lt(e){const{defaultValue:t,changeHandler:a,time:s,property:l,value:o,name:i}=e,{type:c,defaultValue:u}=l,d={key:"context",value:{property:l,value:o,changeHandler:a,name:i,time:s,defaultValue:n.isDefined(t)?t:u},children:vt[c]};return r.default.createElement(Ct.Provider,Object.assign({},d))}function Gt(e){const t=r.default.useContext(j),{icons:a}=t,s=r.default.useContext(gt),{selectedItems:l}=e,{selectedItems:o}=s,c=l||o,u=[],d=[],f={},p=new Set;return c.forEach((t=>{if(n.isSelectedProperty(t)){const{property:n,changeHandler:s,selectType:l,value:o,name:c}=t,{name:m,group:g}=n;if(g){const e=[g,l].join("-");return void(f[e]||(f[e]=!0,d.push(r.default.cloneElement(At[g],{selectType:l}))))}const y=c||m;p.add(l);const h=Object.assign({key:`inspector-${l}-${y}`,property:n,value:o,changeHandler:s,name:y},e),E=a[y],v=r.default.createElement(Lt,Object.assign({},h));if(E){const e=[v];e.unshift(E);const t={children:e,className:"row",key:`icon-${l}-${y}`};u.push(r.default.createElement(i,Object.assign({},t)))}else u.push(v)}else{const e={key:"inspector-effects",selectedEffects:t};d.push(r.default.cloneElement(At.effects,e))}})),p.has(n.SelectType.Clip)&&u.push(),r.default.createElement(r.default.Fragment,null,u,d)}function zt(e){const t=r.default.useContext(j),{icons:a}=t,{selectedEffects:s}=e,o=l(e,["selectedEffects"]),c=r.default.useRef(null),[u,d]=r.default.useState(!1),[f,p]=r.default.useState(null),m=_(),{actions:g}=m;n.assertTrue(s);const{value:y,addHandler:h,removeHandler:E,moveHandler:v}=s,b=f&&y.includes(f)?f:null;b!==f&&p(b);const C=e=>{const{dataTransfer:t}=e;return ve(t)===n.DefinitionType.Effect},O=r.default.useMemo((()=>{const e=["list"];return u&&e.push(n.ClassDropping),e.join(" ")}),[u]),T={children:y.map(((e,t)=>{const n={key:e.id,selectedEffect:b,setSelectedEffect:p,effect:e,index:t,removeHandler:E};return r.default.createElement(Bt,Object.assign({},n))})),ref:c,onDragLeave:()=>{d(!1)},onDragOver:e=>{const t=C(e);d(t),t&&e.preventDefault()},onDrop:e=>{if(d(!1),!C(e))return;e.preventDefault();const{dataTransfer:t}=e;if(!t)return;const a=he(t),s=t.getData(a),r=JSON.parse(s),{definitionObject:l,index:o}=r,i=(e=>{const{target:t}=e;if(t&&t instanceof HTMLDivElement){const e=t.getAttribute("index");if(e)return Number(e)}return y.length})(e);if(n.isObject(l)){const e=n.Defined.fromObject(l);if(n.isEffectDefinition(e)){const t=e.instanceFromObject();h(t,i)}}else{if(i===o)return;n.assertEffect(b),v(b,i)}},onClick:()=>{p(null)},key:"view",className:O},k=Object.assign(Object.assign({},o),{key:"effects",children:[a.browserEffect,r.default.createElement(i,Object.assign({},T))]}),S=r.default.createElement(i,Object.assign({},k));return b?r.default.createElement(r.default.Fragment,null,S,r.default.createElement(Gt,{selectedItems:b.selectedItems(g)})):S}function Ft(e){const t=r.default.useContext(j),{icons:a}=t,s=_(),{selectType:o}=e,c=l(e,["selectType"]);n.assertSelectType(o);const u=r.default.useContext(gt),{selectedItems:d,changeTweening:f,selectedInfo:p}=u,{tweenDefined:m,tweenSelected:g,onEdge:y,time:h,nearStart:E,timeRange:v}=p;n.assertTimeRange(v),n.assertTime(h);const b=m[n.DataGroup.Opacity],C=g[n.DataGroup.Opacity],O=n.selectedPropertyObject(d,n.DataGroup.Opacity,o),{opacity:T,[`opacity${n.PropertyTweenSuffix}`]:k}=O,S=C?k:T,{property:D,changeHandler:x,value:P,name:N}=S,{type:w,name:A}=D,R=N||A,M=vt[w],I={property:D,value:P,name:R,changeHandler:x};I.time=n.tweenInputTime(v,y,E,b,C),C&&(I.defaultValue=T.value);const B=[n.ClassSelected,n.ClassButton].join(" "),L={children:a.start,className:C?n.ClassButton:B,key:"start",onClick:()=>{s.goToTime(v.startTime),f(n.DataGroup.Opacity,!1)}},G={key:"end",className:C?B:n.ClassButton,children:b?a.end:a.endUndefined,onClick:()=>{s.goToTime(v.lastTime),f(n.DataGroup.Opacity,!0)}},z={key:"context",value:I,children:M},F=Object.assign(Object.assign({},c),{key:`inspector-${o}-${R}`,children:[a.opacity,r.default.createElement(Ct.Provider,Object.assign({},z)),r.default.createElement(i,{className:"start-end",key:"start-end"},r.default.createElement(i,Object.assign({},L)),r.default.createElement(i,Object.assign({},G)))]});return r.default.createElement(i,Object.assign({},F))}function Vt(e){const t=r.default.useContext(j),{icons:a}=t,s=_(),{selectType:l}=e;n.assertSelectType(l);const o=r.default.useContext(gt),{selectedItems:c,changeTweening:u,selectedInfo:d}=o,{tweenDefined:f,tweenSelected:p,onEdge:m,time:g,nearStart:y,timeRange:h}=d;n.assertTimeRange(h),n.assertTime(g);const E=f[n.DataGroup.Point],v=p[n.DataGroup.Point],b=n.selectedPropertyObject(c,n.DataGroup.Point,l),C=n.selectedPropertiesScalarObject(b),{offE:O,offW:T,offN:k,offS:S,x:D,y:x,[`x${n.PropertyTweenSuffix}`]:P,[`y${n.PropertyTweenSuffix}`]:N}=b,w=v?P:D,A=v?N:x,{offE:R,offW:M,offN:I,offS:B}=C,L={},G=[w,A],z=n.tweenInputTime(h,m,y,E,v);G.forEach((e=>{if(!e)return void console.error("PointInput",w,A);const{property:t,changeHandler:a,value:s,name:o}=e,{type:i,name:c}=t,u=o||c,d=u.replace(n.PropertyTweenSuffix,""),f=vt[i],p=`inspector-${l}-${u}`,m={property:t,value:s,name:u,changeHandler:a,time:z};v&&(m.defaultValue=C[d]);const g={key:p,value:m,children:f};L[d]=r.default.createElement(Ct.Provider,Object.assign({},g))}));const F=[n.ClassSelected,n.ClassButton].join(" "),V={children:a.start,className:v?n.ClassButton:F,key:"start",onClick:()=>{s.goToTime(h.startTime),u(n.DataGroup.Point,!1)}},$={key:"end",className:v?F:n.ClassButton,children:E?a.end:a.endUndefined,onClick:()=>{s.goToTime(h.lastTime),u(n.DataGroup.Point,!0)}},H=[a.point,r.default.createElement(i,{className:"start-end",key:`${l}-point-start-end`},r.default.createElement(i,Object.assign({},V)),r.default.createElement(i,Object.assign({},$)))],q=[r.default.createElement(i,{key:"horz-icon",children:a.horz,className:n.ClassButton})],U=[r.default.createElement(i,{key:"vert-icon",children:a.vert,className:n.ClassButton})];if(O){const e={key:"lock-east",className:n.ClassButton,children:R?a.unlock:a.lock,onClick:()=>{O.changeHandler("offE",!R)}},t=r.default.createElement(i,Object.assign({},e));q.push(t)}if(q.push(L.x),T){const e={key:"lock-west",className:n.ClassButton,children:M?a.unlock:a.lock,onClick:()=>{T.changeHandler("offW",!M)}},t=r.default.createElement(i,Object.assign({},e));q.push(t)}if(k){const e={key:"lock-north",className:n.ClassButton,children:I?a.unlock:a.lock,onClick:()=>{k.changeHandler("offN",!I)}},t=r.default.createElement(i,Object.assign({},e));U.push(t)}if(U.push(L.y),S){const e={key:"lock-south",className:n.ClassButton,children:B?a.unlock:a.lock,onClick:()=>{S.changeHandler("offS",!B)}},t=r.default.createElement(i,Object.assign({},e));U.push(t)}const W=[r.default.createElement(i,{key:"x",children:q}),r.default.createElement(i,{key:"y",children:U})];return r.default.createElement("fieldset",null,r.default.createElement("legend",{key:"legend"},r.default.createElement(i,null,H)),W)}At[n.DataGroup.Effects]=r.default.createElement(zt,{className:"effects row",key:"effects-group-input"}),At[n.DataGroup.Opacity]=r.default.createElement(Ft,{className:"opacity tween row",key:"opacity-group-input"}),At[n.DataGroup.Point]=r.default.createElement(Vt,{key:"point-input"});const $t={[n.Orientation.H]:"width",[n.Orientation.V]:"height"};function Ht(e){const t=r.default.useContext(j),{icons:a}=t,s=_(),{selectType:l}=e;n.assertSelectType(l,"selectType");const o=r.default.useContext(gt),{selectedItems:c,selectedInfo:u,changeTweening:d}=o,{tweenDefined:f,tweenSelected:p,onEdge:m,time:g,nearStart:y,timeRange:h}=u;n.assertTimeRange(h),n.assertTime(g);const E=f[n.DataGroup.Size],v=p[n.DataGroup.Size],b=n.selectedPropertyObject(c,n.DataGroup.Size,l),{lock:C,width:O,height:T,[`width${n.PropertyTweenSuffix}`]:k,[`height${n.PropertyTweenSuffix}`]:S}=b,D=v?k:O,x=v?S:T,P=n.selectedPropertiesScalarObject(b),{lock:N}=P;n.assertString(N,"lockValue");const w=n.isOrientation(N)?N:void 0,A={},R=[D,x],M=n.tweenInputTime(h,m,y,E,v);R.forEach((e=>{const{property:t,changeHandler:a,value:s,name:o}=e,{type:i,name:c}=t,u=o||c,d=u.replace(n.PropertyTweenSuffix,""),f=vt[i],p=`inspector-${l}-${u}`,m={property:t,value:s,name:u,time:M};v&&(m.defaultValue=P[d]),w&&d===$t[w]||(m.changeHandler=a);const g={key:p,value:m,children:f};A[d]=r.default.createElement(Ct.Provider,Object.assign({},g))}));const I={key:"lock-width",className:n.ClassButton,children:w===n.Orientation.H?a.lock:a.unlock,onClick:()=>{const e=w===n.Orientation.H?"":n.Orientation.H;C.changeHandler("lock",e)}},B=r.default.createElement(i,Object.assign({},I)),L={key:"lock-height",className:n.ClassButton,children:w===n.Orientation.V?a.lock:a.unlock,onClick:()=>{const e=w===n.Orientation.V?"":n.Orientation.V;C.changeHandler("lock",e)}},G=[n.ClassSelected,n.ClassButton].join(" "),z=r.default.createElement(i,Object.assign({},L)),F={children:a.start,className:v?n.ClassButton:G,key:"start",onClick:()=>{s.goToTime(h.startTime),d(n.DataGroup.Size,!1)}},V={key:"end",className:v?G:n.ClassButton,children:E?a.end:a.endUndefined,onClick:()=>{s.goToTime(h.lastTime),d(n.DataGroup.Size,!0)}},$=[a.size,r.default.createElement(i,{className:"start-end",key:`${l}-size-start-end`},r.default.createElement(i,Object.assign({},F)),r.default.createElement(i,Object.assign({},V)))],H=[r.default.createElement(i,{key:"width-icon",children:a.width,className:n.ClassButton}),A.width,B],q=[r.default.createElement(i,{key:"height-icon",children:a.height,className:n.ClassButton}),A.height,z],U=[r.default.createElement(i,{key:"width",children:H}),r.default.createElement(i,{key:"height",children:q})];return r.default.createElement("fieldset",null,r.default.createElement("legend",{key:"legend"},r.default.createElement(i,null,$)),U)}function qt(e){const{selectType:t}=e;n.assertSelectType(t);const a=r.default.useContext(gt),{selectedItems:s}=a,l=n.selectedPropertyObject(s,n.DataGroup.Sizing,t),o=Object.fromEntries(Object.entries(l).map((([t,n])=>{const{property:a,changeHandler:s,selectType:l,value:o,name:i}=n,{name:c}=a,u=i||c,d=Object.assign({key:`inspector-${l}-group-${u}`,property:a,value:o,changeHandler:s,name:u},e);return[t,r.default.createElement(Lt,Object.assign({},d))]})));return r.default.createElement(i,null,Object.values(o))}function Ut(e){const t=r.default.useContext(j),{icons:a}=t,{selectType:s}=e;n.assertSelectType(s);const o=r.default.useContext(gt),{selectedItems:c}=o,u=n.selectedPropertyObject(c,n.DataGroup.Timing,s),d=Object.fromEntries(Object.entries(u).map((([t,n])=>{const{property:a,changeHandler:s,selectType:l,value:o,name:i}=n,{name:c}=a,u=i||c,d=Object.assign({key:`inspector-${l}-group-${u}`,property:a,value:o,changeHandler:s,name:u},e);return[t,r.default.createElement(Lt,Object.assign({},d))]}))),{timing:f}=d,p=l(d,["timing"]);if(!n.isPopulatedObject(p)){const e={key:"timing",children:[a.timing,f],className:"row"};return r.default.createElement(i,Object.assign({},e))}const m=[a.timing];f&&m.push(f);const g=Object.entries(p).map((([e,t])=>{const s=a[e],l=[t];s&&l.unshift(r.default.createElement(i,{key:`${e}-icon`,children:s,className:n.ClassButton}));const o={key:`${e}-view`,children:l};return r.default.createElement(i,Object.assign({},o))}));return r.default.createElement("fieldset",null,r.default.createElement("legend",{key:"legend"},r.default.createElement(i,null,m)),g)}function Wt(e){const t=_(),[a,s]=r.default.useState((()=>0)),l=r.default.useRef({tweenDefined:{},tweenSelected:{},selectedType:n.SelectType.None,selectTypes:[]}),[o,c]=r.default.useState((()=>n.SelectTypes)),[u,d]=r.default.useState((()=>[])),f=()=>{s((e=>e+1))},p=()=>{const{selection:e}=t,{selectTypes:a,clip:s,mash:r}=e,{current:i}=l,{selectedType:c,selectTypes:u}=i,p=o.find((e=>a.includes(e)));n.assertSelectType(p),p!==c&&(i.selectedType=p),n.arraySet(u,a);const m=t.selection.selectedItems([p]),g={};if(s&&r){const e=m.filter((e=>{if(!n.isSelectedProperty(e))return;const{property:t,name:a}=e,{tweenable:s,group:r}=t;return s&&r&&a?a.endsWith(n.PropertyTweenSuffix):void 0}));if(e.forEach((e=>{const{property:t,value:a}=e,{group:s}=t;n.assertDataGroup(s),g[s]=n.isDefined(a)})),e.length){const{time:e,quantize:t}=r,a=s.timeRange(t);i.time=e,i.timeRange=a;const l=a.frame+Math.round(a.frames/2),o=n.timeFromArgs(l,t),[c,u]=n.timeEqualizeRates(o,e);i.nearStart=c.frame>u.frame;const d=i.nearStart?a.startTime:a.lastTime;i.onEdge=e.equalsTime(d)}}i.tweenDefined=g,d(m),f()};Ue({[n.EventType.Action]:f,[n.EventType.Selection]:p});const m=r.default.useCallback((e=>{n.assertSelectType(e),c((t=>{const a=t.indexOf(e);n.assertPositive(a);const s=[e];return a&&s.push(...t.slice(0,a)),a<t.length-1&&s.push(...t.slice(a+1)),n.assertTrue(s.length===t.length,"type lengths match"),n.arraySet(t,s),p(),t})),l.current.selectedType=e,d(t.selection.selectedItems([e]))}),[]),g=Object.assign(Object.assign({},mt),{actionCount:a,selectedItems:u,changeSelected:m,changeTweening:(e,t)=>{l.current.tweenSelected[e]=t,p()},selectedInfo:l.current});return r.default.createElement(gt.Provider,{value:g},r.default.createElement(i,Object.assign({},e)))}function Zt(e){return r.default.createElement(i,Object.assign({},e))}function Jt(e){const t=r.default.useContext(gt),{selectedInfo:a}=t,{selectedType:s}=a,{type:l,types:o,children:i}=e,c=Pe(l,o);return n.assertPopulatedArray(c),c.includes(s)?r.default.createElement(r.default.Fragment,null,i):null}function Xt(e){const{id:t,children:a,className:s}=e;n.assertSelectType(t);const l=r.default.useContext(gt),{changeSelected:o,selectedInfo:c}=l,{selectTypes:u,selectedType:d}=c;if(!u.includes(t))return null;const f=[];n.isPopulatedString(s)&&f.push(s),d===t&&f.push(n.ClassSelected);const p={children:a,onClick:()=>{o(t)},className:f.join(" ")};return r.default.createElement(i,Object.assign({},p))}At[n.DataGroup.Size]=r.default.createElement(Ht,{key:"size-group-input"}),At[n.DataGroup.Sizing]=r.default.createElement(qt,{key:"sizing-group-input"}),At[n.DataGroup.Timing]=r.default.createElement(Ut,{key:"timing-group-input"});const _t=function(e={}){var t,a,s,l,o;const c=L(e),{icons:u}=c;(t=c.props).key||(t.key="inspector"),(a=c.props).className||(a.className="panel inspector"),(s=c.header).content||(s.content=[u.inspector,r.default.createElement(dt,{key:"undo"},r.default.createElement(st,null,u.undo,p("undo"))),r.default.createElement(ct,{key:"redo"},r.default.createElement(st,null,u.redo,p("redo")))]),(l=c.footer).content||(l.content=[r.default.createElement(Xt,{key:"mash",className:n.ClassButton,id:"mash"},u.document),r.default.createElement(Xt,{key:"cast",className:n.ClassButton,id:"cast"},u.document),r.default.createElement(Xt,{key:"layer",className:n.ClassButton,id:"layer"},u.composer),r.default.createElement(Xt,{key:"clip",className:n.ClassButton,id:"clip"},u.clip),r.default.createElement(Xt,{key:"container",className:n.ClassButton,id:"container"},u.container),r.default.createElement(Xt,{key:"content",className:n.ClassButton,id:"content"},u.content)]);const d=[r.default.createElement(Gt,{key:"properties"})],f=[n.SelectType.Clip,n.SelectType.Track,n.SelectType.Layer];d.push(r.default.createElement(U,{key:"api-enabled"},r.default.createElement(Jt,{type:"mash",key:"inspector-mash"},r.default.createElement(i,null,r.default.createElement(ft,{key:"render-process"},r.default.createElement(st,null,p("render"),u.render)),r.default.createElement(ht,{key:"view-control"},r.default.createElement(st,null,p("view"),u.view)))),r.default.createElement(Jt,{types:"mash,cast",key:"inspector-document"},r.default.createElement(yt,{key:"select-edited",className:"row",children:u.document}),r.default.createElement(i,{key:"view"},r.default.createElement(pt,{key:"save-process"},r.default.createElement(st,{key:"button"},p("update"),u.document)),r.default.createElement(it,{key:"create-edited"},r.default.createElement(st,null,p("create"),u.document)))))),f.forEach((e=>{d.push(r.default.createElement(Jt,{key:`${e}-delete`,type:e},r.default.createElement(ut,{type:e},r.default.createElement(st,null,m("delete",{type:e}),u.remove))))})),(o=c.content).children||(o.children=r.default.createElement(r.default.Fragment,null,d));const g=r.default.createElement(r.default.Fragment,null,r.default.createElement(B,Object.assign({},c.header)),r.default.createElement(Zt,Object.assign({},c.content.props),c.content.children),r.default.createElement(B,Object.assign({},c.footer)));return Object.assign(Object.assign({},c.props),{children:g})};const Kt={paused:!1,changePaused:n.EmptyMethod,changeVolume:n.EmptyMethod,volume:0},Yt=r.default.createContext(Kt);function Qt(e){const{children:t,className:a}=e,s=l(e,["children","className"]),o=_(),[c,u]=r.default.useState((()=>n.rectCopy(o.rect))),d=r.default.useRef(null),f=r.default.useRef(null),p=r.default.useContext(j),[m,g]=r.default.useState(!1),y=r.default.useContext(Yt),{disabled:h}=y,{drop:E}=p,v=r.default.useRef({}),{current:b}=v,[C]=r.default.useState(new ResizeObserver((()=>{const{current:e}=f;if(!e)return;const t=n.rectRound(e.getBoundingClientRect());u((()=>(o.rect=t,n.rectCopy(t))))})));r.default.useEffect((()=>{const{current:e}=f;return e&&C.observe(e),()=>{C.disconnect()}}),[]);const O=()=>{const{redraw:e}=b;return delete b.timeout,delete b.redraw,o.previewItems(!h).then((t=>{(e=>{const{current:t}=d;t&&t.replaceChildren(...e)})(t),e&&k()}))},T=()=>{O().then(n.EmptyMethod)},k=()=>{const{current:e}=d,{rect:t}=o;e&&n.sizeAboveZero(t)&&(b.timeout?b.redraw=!0:b.timeout=setTimeout(T,10))};Ue({[n.EventType.Draw]:k,[n.EventType.Selection]:k});const S=e=>{if(!e)return!1;return!!be(e).includes(ge)||n.isDefinitionType(ve(e))},D=e=>{n.eventStop(e),g(!1)},x=[];a&&x.push(a),m&&x.push(n.ClassDropping);const P=Object.assign(Object.assign({},s),{ref:f,className:x.join(" "),key:"player-content",onDragOver:e=>{n.eventStop(e),g(S(e.dataTransfer))},onDrop:e=>{D(e);const{dataTransfer:t}=e;if(!S(t))return;const{edited:a}=o;n.assertObject(a);const s={clip:o.time.scale(a.quantize).frame,track:-1};if(be(t).includes(ge))E(t.files,s);else{const e=ve(t);n.assertDefinitionType(e);const a=Ce(t,e);de(a),E(a.definitionObject,s)}},onDragLeave:D,onPointerDown:()=>{o.selection.unset(n.SelectType.Clip)}});if(n.sizeAboveZero(c)){const e={ref:d,key:"svg",className:"svgs"},n=[r.default.createElement("div",Object.assign({},e))];if(t){const e=r.default.Children.only(t);r.default.isValidElement(e)&&n.push(e)}P.children=n}return r.default.createElement(i,Object.assign({},P))}function en(e){const t=r.default.useContext(Yt),{paused:n,changePaused:a}=t,s=Object.assign(Object.assign({},e),{key:"player-button",onClick:()=>{a(!n)}});return r.default.createElement(i,Object.assign({},s))}function tn(e){const t=_(),a=()=>t.timeRange.timeRange,[s,l]=r.default.useState(a),o=()=>{l(a())};Ue({[n.EventType.Time]:o,[n.EventType.Duration]:o},t.eventTarget);const i=Object.assign({value:s.frame,min:0,max:s.frames,step:1,onChange:(e,a)=>{const r=n.isArray(a)?a[0]:a;t.time=n.timeFromArgs(r,s.fps)},className:"frame slider"},e);return r.default.createElement(St,Object.assign({},i))}function nn(e){return r.default.useContext(Yt).paused?null:e.children}function an(e){return r.default.useContext(Yt).paused?e.children:null}function sn(e){const t=_(),a=()=>t.timeRange,[s,l]=r.default.useState(a),o=()=>{l(a())};Ue({[n.EventType.Time]:o,[n.EventType.Duration]:o},t.eventTarget);const{seconds:c,fps:u,lengthSeconds:d}=s,f=[n.stringSeconds(c,u,d),"/",n.stringSeconds(d,u,d)],p=Object.assign(Object.assign({},e),{key:"player-time",children:f});return r.default.createElement(i,Object.assign({},p))}const rn=function(e={}){var t,a,s,l,o;const c=L(e),{icons:u}=c;(t=c.props).key||(t.key="player"),(a=c.props).className||(a.className="panel player"),(s=c.content).children||(s.children=r.default.createElement(Qt,Object.assign({},c.content.props),r.default.createElement(i,{key:"drop-box",className:"drop-box"}))),(l=c.header).content||(l.content=[u.app]),(o=c.footer).content||(o.content=[r.default.createElement(en,{key:"play-button",className:n.ClassButton},r.default.createElement(nn,{key:"playing"},u.playerPause),r.default.createElement(an,{key:"not-playing"},u.playerPlay)),r.default.createElement(tn,{key:"time-slider"}),r.default.createElement(sn,{key:"time",className:"time"})]);const d=r.default.createElement(r.default.Fragment,null,r.default.createElement(B,Object.assign({},c.header)),c.content.children,r.default.createElement(B,Object.assign({},c.footer)));return Object.assign(Object.assign({},c.props),{children:d})};function ln(e){const t=r.default.useContext(Ve),{scale:a,frame:s}=t,l=r.default.useMemo((()=>Object.assign(Object.assign({},e),{style:{left:n.pixelFromFrame(s,a)}})),[s,a]);return r.default.createElement(i,Object.assign({},l))}function on(e){const t=_(),{selection:a}=t,{mash:s}=a,{className:o,children:c}=e,u=l(e,["className","children"]),d=r.default.Children.only(c);n.assertTrue(r.default.isValidElement(d));const f=r.default.useContext(ze),p=r.default.useContext(Ve),{track:m}=f,{dragTypeValid:g,onDragLeave:y,onDrop:h,droppingTrack:E,setDroppingTrack:v,droppingPosition:b,setDroppingPosition:C,setDroppingClip:O,selectedTrack:T}=p,j=r.default.useMemo((()=>{const e=m===T,t=[];return o&&t.push(o),e&&t.push(n.ClassSelected),E===m&&t.push(ke(b)),t.join(" ")}),[b,E,T]);if(!s||!m)return null;const{clips:k,dense:S,index:D}=m,x=Object.assign(Object.assign({},u),{className:j,children:(()=>{let e=S?-1:0;const t=d.props;return k.map((n=>{const a=Object.assign(Object.assign({},t),{key:n.id}),s={children:r.default.cloneElement(d,a),value:{clip:n,prevClipEnd:e},key:n.id},l=r.default.createElement(Le.Provider,Object.assign({},s));return S||(e=n.frames+n.frame),l}))})(),onDragLeave:y,onDragOver:e=>{n.eventStop(e);const{dataTransfer:t}=e;if(!t)return;const a=g(t),s=a?n.DroppingPosition.At:n.DroppingPosition.None;O(),v(a?m:void 0),C(s)},onDrop:h,key:`track-${D}`});return r.default.createElement(i,Object.assign({},x))}function cn(e){const t=r.default.useRef(null),n=r.default.useContext(Ve),[a]=r.default.useState(new ResizeObserver((()=>{const{setRect:e}=n;e(t.current.getBoundingClientRect())})));r.default.useEffect((()=>{const{current:e}=t;return e&&a.observe(e),()=>{a.disconnect()}}),[t.current]);const s=Object.assign(Object.assign({},e),{ref:t});return r.default.createElement(i,Object.assign({},s))}function un(e){const t=_(),a=r.default.useContext(Ve),s=()=>!t.selection.mash,[l,o]=r.default.useState(s);Ue({[n.EventType.Selection]:()=>{o(s())}});const i=Object.assign({disabled:l,key:"time-slider",value:a.zoom,min:0,max:1,step:.01,onChange:(e,t)=>{const s=n.isArray(t)?t[0]:t;a.zoom!==s&&a.setZoom(s)}},e);return r.default.createElement(St,Object.assign({className:"zoom slider"},i))}function dn(e){const[t,a]=r.default.useState((()=>0)),s=()=>{a((e=>e+1))},l=_();Ue({[n.EventType.Mash]:s,[n.EventType.Track]:s});const{children:o}=e,i={key:"track-content",children:r.default.useMemo((()=>{const{mash:e}=l.selection;if(!e)return[];const{tracks:t}=e;return n.arrayReversed(t).map(((e,t)=>{const{identifier:n,index:a}=e,s={children:r.default.Children.map(o,(e=>{if(!r.default.isValidElement(e))throw"TimelineTracks";return r.default.cloneElement(e,{key:`track-clone-${t}-${a}-${n}`})})),value:{track:e},key:`track-context-${t}-${a}-${n}`};return r.default.createElement(ze.Provider,Object.assign({},s))}))}),[t])};return r.default.createElement(r.default.Fragment,Object.assign({},i))}function fn(e){const t=_(),a=r.default.useRef(-1),s=r.default.useRef(null),o=r.default.useContext(Ve),{frames:c,scale:u,rect:d}=o,{className:f,inactive:p,styleHeight:m,styleWidth:g}=e,y=l(e,["className","inactive","styleHeight","styleWidth"]),h=()=>!t.selection.mash,[E,v]=r.default.useState(h);Ue({[n.EventType.Selection]:()=>{v(h())}});const b=()=>{const{window:e}=globalThis,r=e=>{n.eventStop(e);const{current:r}=s;if(!r||!t.selection.mash)return;const{clientX:l}=e;if(a.current===l)return;a.current=l;const o=r.getBoundingClientRect(),i=Math.max(0,Math.min(o.width,l-o.x)),c=n.pixelToFrame(i,u,"floor");t.time=n.timeFromArgs(c,t.selection.mash.quantize)},l=t=>{r(t),e.removeEventListener("pointermove",r),e.removeEventListener("pointerup",l)};return t=>{t.stopPropagation(),a.current=-1,e.addEventListener("pointermove",r),e.addEventListener("pointerup",l),r(t)}},{width:C,height:O}=d,T=r.default.useMemo((()=>{const e=[];f&&e.push(f),E&&e.push(n.ClassDisabled);const t=Object.assign(Object.assign({},y),{ref:s,className:e.join(" ")});if(g||m){const e={};if(m&&(e.minHeight=O),g){const t=n.pixelFromFrame(c,u,"ceil");e.minWidth=Math.max(t,t)}t.style=e}return p||E||(t.onPointerDown=b()),t}),[c,u,C,O,E]);return r.default.createElement(i,Object.assign({},T))}function pn(e){const{className:t}=e,a=l(e,["className"]),s=r.default.useContext(Ve),{dragTypeValid:o,onDrop:c,setScroll:u,setDroppingClip:d,setDroppingTrack:f,setDroppingPosition:p}=s,m=r.default.useRef(null),[g,y]=r.default.useState(!1),h=_();Ue({[n.EventType.Mash]:()=>{var e;null===(e=m.current)||void 0===e||e.scrollTo(0,0)}});const E=e=>{n.eventStop(e),y(!1)},v=[];t&&v.push(t),g&&v.push(n.ClassDropping);const b=Object.assign(Object.assign({className:v.join(" ")},a),{onPointerDown:e=>{h.selection.unset(n.SelectType.Track)},onScroll:()=>{const{current:e}=m;if(!e)return;const{scrollLeft:t,scrollTop:n}=e;u({x:t,y:n})},onDragOver:e=>{n.eventStop(e);const{dataTransfer:t}=e;if(!t)return;const a=o(t),s=a?n.DroppingPosition.At:n.DroppingPosition.None;d(),f(),p(s),y(a)},onDragLeave:E,onDrop:e=>{E(e),c(e)},ref:m});return r.default.createElement(i,Object.assign({},b))}function mn(e){const t=_(),a=()=>!t.selection.mash,[s,o]=r.default.useState(a);Ue({[n.EventType.Selection]:()=>{o(a())}});const{children:i}=e,c=l(e,["children"]),u=Object.assign(Object.assign({},c),{disabled:s});return u.onClick=()=>{t.addTrack()},r.default.cloneElement(r.default.Children.only(i),u)}function gn(e){const{className:t,icons:a}=e,s=l(e,["className","icons"]),o=r.default.useContext(Ve),c=r.default.useContext(ze),{droppingTrack:u,droppingPosition:d,selectedTrack:f}=o,{track:p}=c,m=r.default.useMemo((()=>{const e=[];return t&&e.push(t),p===f&&e.push(n.ClassSelected),p===u&&e.push(ke(d)),e.join(" ")}),[d,u,f]);if(!p)return null;const{dense:g,index:y}=p,h=g?a.trackDense:a.track,E=Object.assign(Object.assign({},s),{className:m,children:h,key:`track-icon-${y}`});return r.default.createElement(i,Object.assign({},E))}function yn(e){const t=_(),{zoom:a,children:s}=e,o=l(e,["zoom","children"]),i=r.default.useContext(Ve),c=()=>!t.selection.mash,[u,d]=r.default.useState(c);Ue({[n.EventType.Selection]:()=>{d(c())}});const f=Object.assign(Object.assign({},o),{onClick:()=>{i.setZoom(a)},disabled:u});return r.default.cloneElement(r.default.Children.only(s),f)}function hn(e){const t=_(),a=r.default.useContext(j),{definition:s,drop:o}=a,i=()=>!t.selection.mash,[c,u]=r.default.useState(i);Ue({[n.EventType.Selection]:()=>{u(i())}});const{children:d}=e,f=l(e,["children"]),p=Object.assign(Object.assign({},f),{disabled:c});return p.onClick=()=>{const{selection:e,edited:a}=t,{clip:r,track:l}=e,i=(null==s?void 0:s.toJSON())||{id:n.DefaultContentId},c={clip:0,track:-1};r&&l?(c.clip=l.dense?l.clips.indexOf(r):r.endFrame,c.track=l.index):c.clip=t.time.scale(a.quantize).frame,o(i,c)},r.default.cloneElement(r.default.Children.only(d),p)}const En=function(e={}){var t,n,a,s,l;const o=L(e),{icons:i}=o;(t=o.props).key||(t.key="timeline"),(n=o.props).className||(n.className="panel timeline"),(a=o.header).content||(a.content=[i.timeline]),(s=o.footer).content||(s.content=[r.default.createElement(hn,{key:"add-clip"},r.default.createElement(st,{children:i.add})),r.default.createElement(mn,{key:"add-track"},r.default.createElement(st,{children:[i.add,i.trackDense]})),r.default.createElement(yn,{key:"zoom-out",zoom:0},r.default.createElement(st,{useView:!0},i.zoomLess)),r.default.createElement(un,{key:"zoomer"}),r.default.createElement(yn,{key:"zoom-in",zoom:1},r.default.createElement(st,{useView:!0},i.zoomMore))]),(l=o.content).children||(l.children=r.default.createElement(r.default.Fragment,null,r.default.createElement(fn,{styleWidth:!0,inactive:!0,styleHeight:!0,className:"scrubber-bar"},r.default.createElement(ln,{className:"scrubber-element-bar"})),r.default.createElement(fn,{styleWidth:!0,className:"scrubber-icon"},r.default.createElement(ln,{className:"scrubber-element-icon"})),r.default.createElement(dn,null,r.default.createElement(gn,{className:"track-icon",icons:i}),r.default.createElement(on,{className:"track"},r.default.createElement(We,{className:"clip preview"}))),r.default.createElement(cn,{className:"drop-box"})));const c=r.default.createElement(r.default.Fragment,null,r.default.createElement(B,Object.assign({},o.header)),r.default.createElement(pn,Object.assign({},o.content.props),o.content.children),r.default.createElement(B,Object.assign({},o.footer)));return Object.assign(Object.assign({},o.props),{children:c})};function vn(e){const{disabled:t}=e,a=l(e,["disabled"]),s=_(),[o,c]=r.default.useState(s.paused),[u,d]=r.default.useState(s.volume),f=()=>{c(s.paused)};Ue({[n.EventType.Pause]:f,[n.EventType.Play]:f,[n.EventType.Volume]:()=>{d(s.volume)}});const p={value:{paused:o,disabled:t,volume:u,changePaused:e=>{s.paused=e},changeVolume:e=>{s.volume=e}},children:r.default.createElement(i,Object.assign({},a))};return r.default.createElement(Yt.Provider,Object.assign({},p))}function bn(e){const t=_(),a=r.default.useContext(j),{drop:s}=a,l=()=>{var e;return(null===(e=t.selection.mash)||void 0===e?void 0:e.frame)||0},o=()=>{var e;return(null===(e=t.selection.mash)||void 0===e?void 0:e.frames)||0},[c,u]=r.default.useState(o),[d,f]=r.default.useState(l),[p,m]=r.default.useState(n.DroppingPosition.None),[g,y]=r.default.useState(),[h,E]=r.default.useState(),[v,b]=r.default.useState(),[C,O]=r.default.useState(0),[T,k]=r.default.useState(),[S,D]=r.default.useState(1),[x,P]=r.default.useState(n.RectZero),[N,w]=r.default.useState(n.RectZero),A=()=>{O((e=>e+1))};Ue({[n.EventType.Mash]:()=>{D(1)},[n.EventType.Action]:A,[n.EventType.Selection]:()=>{k(t.selection.clip),b(t.selection.track)},[n.EventType.Time]:()=>{f(l())},[n.EventType.Duration]:()=>{u(o())}},t.eventTarget);const R=(e,t)=>{const a=be(e);if(a.includes(ge))return!0;const s=a.find(ye);if(!s)return!1;if(t)return!0;return Ee(s)!==n.DefinitionType.Effect},M=e=>{n.eventStop(e),m(n.DroppingPosition.None),y(void 0),E(void 0)},{width:I}=x,B=r.default.useMemo((()=>I?n.pixelPerFrame(c,I,S):0),[S,I,c]),L={scroll:N,setScroll:w,scale:B,refreshed:C,refresh:A,zoom:S,setZoom:D,rect:x,setRect:P,droppingTrack:g,setDroppingTrack:y,droppingClip:h,setDroppingClip:E,droppingPosition:p,setDroppingPosition:m,onDragLeave:M,onDrop:e=>{n.eventStop(e);const{dataTransfer:a,clientX:r}=e;if(!a||!R(a,h))return void console.log("Timeline onDrop invalid",null==a?void 0:a.types,!!h);const l=be(a).includes(ge),o=!!(null==g?void 0:g.dense),i=g?g.index:-1,c=(null==g?void 0:g.clips)||[],u=l?{}:Ce(a),d=!l&&ce(u),f=d?u.offset:0;let m=((e,t)=>{if(!e)return-1;if(!h)return 0;const a=t.indexOf(h);return p===n.DroppingPosition.After?a+1:a})(o,c);if(!n.isPositive(m)){const e=r-x.x,t=n.pixelToFrame(Math.max(0,N.x+(e-f)),B);m=o?((e,t)=>{const{length:n}=t;if(!n)return 0;const a=t.findIndex((t=>e<t.frame+t.frames));return a>-1?a:n})(t,c):t}const y={clip:m,track:i};if(l)s(a.files,y);else if(d)if(ue(u)){const{definitionObject:e}=u;s(e,y)}else{const{clip:e}=t.selection;n.assertClip(e),t.moveClip(e,y)}M(e)},dragTypeValid:R,selectedClip:T,selectedTrack:v,frame:d,frames:c},G={children:r.default.createElement(i,Object.assign({},e)),value:L};return r.default.createElement(Ve.Provider,Object.assign({},G))}function Cn(e){return r.default.createElement(i,Object.assign({},e))}const On=function(e={}){e.className||(e.className="editor masher"),e.icons||(e.icons=a.Icons);const{panels:t={}}=e,s=l(e,["panels"]),{player:o={},browser:i={},timeline:c={},inspector:u={},activity:d={}}=t,f=[];if(o&&(o.icons||(o.icons=e.icons),f.push(r.default.createElement(vn,Object.assign({},rn(o))))),i&&(i.icons||(i.icons=e.icons),f.push(r.default.createElement(re,Object.assign({},Ie(i))))),u||d){const t=[];u&&(u.icons||(u.icons=e.icons),t.push(r.default.createElement(Wt,Object.assign({},_t(u))))),d&&(d.icons||(d.icons=e.icons),t.push(r.default.createElement(S,Object.assign({},$(d)))));const n={children:t,key:"panels",className:"panels"};f.push(r.default.createElement(Cn,Object.assign({},n)))}return c&&(c.icons||(c.icons=e.icons),f.push(r.default.createElement(bn,Object.assign({},En(c))))),Object.assign(Object.assign({className:"editor masher"},s),{editType:n.EditType.Mash,children:f})};function Tn(e){const t=r.default.useContext(X),{processing:n,error:a}=t;return n||a?r.default.createElement(r.default.Fragment,null,e.children):r.default.createElement(i,null)}function jn(e){return r.default.useContext(X).processing?null:r.default.createElement(r.default.Fragment,null,e.children)}const kn={devices:[]},Sn=r.default.createContext(kn);const Dn={setClient:()=>{}},xn=r.default.createContext(Dn);class Pn{constructor(e,t){this.setStatus=t,this.endpointPromise=e}beforeAnswer(e){return o(this,void 0,void 0,(function*(){const t=window.navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((e=>e)).catch((e=>{console.error("beforeAnswer",e)}));if(this.localStream=yield t,!this.localStream)return;this.localStream.getTracks().forEach((t=>{this.localStream&&e.addTrack(t,this.localStream)}));const{close:n}=e;e.close=(...t)=>{if(this.localStream)return this.localStream.getTracks().forEach((e=>{e.stop()})),n.apply(e,t)}}))}closeConnection(){var e;null===(e=this.localPeerConnection)||void 0===e||e.close()}createConnection(e={}){const{stereo:t}=e;return this.endpointPromise(n.Endpoints.streaming.webrtc,{}).then((e=>{const{id:a,localDescription:s}=e,r=new RTCPeerConnection({});this.localPeerConnection=r,r.close=()=>{const e={id:a};return this.endpointPromise(n.Endpoints.streaming.delete,e).then((e=>{})),RTCPeerConnection.prototype.close.apply(r)};try{r.setRemoteDescription(s).then((()=>{this.beforeAnswer(r).then((()=>(r.createAnswer().then((e=>{const s=new RTCSessionDescription({type:"answer",sdp:t?(l=e.sdp,l.replace(/a=fmtp:111/,"a=fmtp:111 stereo=1\r\na=fmtp:111")):e.sdp});var l;console.debug(this.constructor.name,"createConnection setLocalDescription"),r.setLocalDescription(s).then((()=>{const{localDescription:e}=r;if(!e)throw n.Errors.invalid.object+"localDescription";const t={id:a,localDescription:e};console.debug("StreamingRemoteRequest",n.Endpoints.streaming.remote,t),this.endpointPromise(n.Endpoints.streaming.remote,t).then((e=>{console.debug("StreamingRemoteResponse",n.Endpoints.streaming.remote,e)}))}))})),r)))}))}catch(e){throw console.trace(this.constructor.name,"createConnection",e),this.localPeerConnection.close(),e}}))}}function Nn(e){const t=r.default.useContext(xn),n=r.default.useContext(X),a=r.default.useContext(q),{setStatus:s,processing:l,setProcessing:o}=n,{endpointPromise:c}=a,{client:u,setClient:d}=t,f=Object.assign(Object.assign({},e),{onClick:()=>{if(u)s("Closing WebRTC connection"),u.closeConnection(),o(!1),d(void 0);else{const e=new Pn(c,s);s("Opening WebRTC connection..."),e.createConnection().then((()=>{s("Opened WebRTC connection"),o(!0),d(e)}))}}});return r.default.createElement(i,Object.assign({},f))}function wn(e){const t=r.default.useRef(null),n=r.default.useContext(xn),a=r.default.useContext(X),{client:s}=n,{processing:o}=a,{current:i}=t;i&&(i.srcObject=o&&(null==s?void 0:s.localStream)||null),r.default.useEffect((()=>()=>{}),[]);const c=l(e,["children"]),u=Object.assign(Object.assign({},c),{ref:t,autoPlay:!0,muted:!0});return r.default.createElement(It,Object.assign({},u))}function An(e){const[t,a]=r.default.useState(),s=r.default.useContext(q),{enabled:l,servers:o}=s;if(!l||!o[n.ServerType.Streaming])return null;const c={client:t,setClient:a};return r.default.createElement(xn.Provider,{value:c},r.default.createElement(i,Object.assign({},e)))}const Rn=r.default.createElement(An,{className:"panel webrtc"},r.default.createElement("div",{className:"head"},r.default.createElement(Nn,null,r.default.createElement(Tn,null,r.default.createElement(st,null,"Stop Broadcasting")),r.default.createElement(jn,null,r.default.createElement(st,null,"Start Broadcasting")))),r.default.createElement(wn,{className:"content"}),r.default.createElement("div",{className:"foot"}));e.Activity=S,e.ActivityContent=P,e.ActivityContentContext=x,e.ActivityContentContextDefault=D,e.ActivityContext=C,e.ActivityContextDefault=b,e.ActivityGroups=h,e.ActivityItem=N,e.ActivityLabel=w,e.ActivityPicked=R,e.ActivityPicker=M,e.ActivityProgress=I,e.ActivityPropsDefault=$,e.ApiClient=function(e){const{endpoint:t,children:a,path:s}=e,l=t||n.urlEndpoint({prefix:s||n.Endpoints.api.callbacks}),[o,i]=r.default.useState((()=>({[n.Endpoints.api.callbacks]:{endpoint:l}}))),[c,u]=r.default.useState((()=>({}))),d=(e,t)=>f(e).then((e=>(n.isPopulatedObject(t)&&(e.request||(e.request={}),e.request.body=Object.assign({version:n.ApiVersion},t)),n.fetchCallback(e)))),f=e=>{const t=o[e];if(t)return Promise.resolve(t);const a={id:e,version:n.ApiVersion},s={endpoint:l,request:{body:a}};return n.fetchCallback(s).then((t=>{const{apiCallbacks:n}=t;return i((e=>Object.assign(Object.assign({},e),n))),n[e]}))};r.default.useEffect((()=>{d(n.Endpoints.api.servers,{}).then((e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.temporaryIdPrefix)&&n.idPrefixSet(e.data.temporaryIdPrefix),u(e)}))}),[]);const p={enabled:!0,endpointPromise:d,servers:c};return r.default.createElement(q.Provider,{value:p},a)},e.ApiContext=q,e.ApiContextDefault=H,e.ApiEnabled=U,e.Bar=B,e.BooleanTypeInput=Ot,e.Broadcaster=function(e){const[t,n]=r.default.useState(!1),[a,s]=r.default.useState(!1),[l,o]=r.default.useState(!1),[c,u]=r.default.useState(""),[d,f]=r.default.useState(""),[p,m]=r.default.useState(0),[g,y]=r.default.useState(0),[h,E]=r.default.useState(0),v={updating:l,setUpdating:o,videoRate:h,setVideoRate:E,height:g,setHeight:y,width:p,setWidth:m,url:d,setUrl:f,streaming:t,setStreaming:n,preloading:a,setPreloading:s,id:c,setId:u};return r.default.createElement(Z.Provider,{value:v},r.default.createElement(i,Object.assign({},e)))},e.BroadcasterContent=function(e){const t=r.default.useContext(Z),a=_(),{rect:s}=a,{url:l,streaming:o}=t;if(!o||!l)return r.default.createElement(i,Object.assign({},e));const c=Object.assign(Object.assign(Object.assign({},n.sizeCopy(s)),e),{autoPlay:!0});return r.default.createElement("video",Object.assign({src:l},c))},e.BroadcasterControl=function(e){const t=r.default.useContext(X),a=r.default.useContext(q),s=r.default.useContext(Z),{setProcessing:l,processing:o,setStatus:c}=t,[u,d]=r.default.useState(o),{endpointPromise:f}=a,{setStreaming:p,setId:m,setUrl:g,setWidth:y,setHeight:h,setVideoRate:E}=s,v=Object.assign(Object.assign({},e),{onClick:()=>{u||(d(!0),(()=>{const e={};console.debug("StreamingStartRequest",n.Endpoints.streaming.start,e),f(n.Endpoints.streaming.start,e).then((e=>{console.debug("StreamingStartResponse",n.Endpoints.streaming.start,e),c("Started stream");const{id:t,readySeconds:a,width:s,height:r,videoRate:o}=e;m(t),y(s),h(r),E(o);const i=()=>{setTimeout((()=>{const e={id:t};console.debug("StreamingStatusRequest",n.Endpoints.streaming.status,e),f(n.Endpoints.streaming.status,e).then((e=>{console.debug("StreamingStatusResponse",n.Endpoints.streaming.status,e);const{streamUrl:t}=e;t?(g(t),p(!0),l(!0),c("Streaming")):i()}))}),1e3*a)};i()}))})())},disabled:u});return r.default.createElement(i,Object.assign({},v))},e.BroadcasterPreloadControl=function(e){const t=r.default.useContext(X),a=r.default.useContext(q),s=r.default.useContext(Z),{id:l,setPreloading:o,preloading:c,updating:u,streaming:d}=s,{setStatus:f}=t,{endpointPromise:p}=a,m=c||u||!d,g=Object.assign(Object.assign({},e),{onClick:()=>{m||(o(!0),(()=>{const e={files:[],id:l};f("Preloading..."),console.debug("StreamingPreloadRequest",n.Endpoints.streaming.preload,e),p(n.Endpoints.streaming.preload,e).then((e=>{console.debug("StreamingPreloadResponse",n.Endpoints.streaming.preload,e),f("Preloaded"),o(!1)}))})())},disabled:m});return r.default.createElement(i,Object.assign({},g))},e.BroadcasterUpdateControl=function(e){const t=_(),a=r.default.useContext(X),s=r.default.useContext(q),l=r.default.useContext(Z),{updating:o,setUpdating:c,streaming:u,preloading:d,id:f}=l,{setStatus:p}=a,{endpointPromise:m}=s,g=o||d||!u,y=Object.assign(Object.assign({},e),{onClick:()=>{g||(c(!0),(()=>{const{edited:e,definitions:a}=t;n.assertCast(e);const{mashes:s}=e,r={definitionObjects:a.map((e=>e.toJSON())),mashObjects:s.map((e=>e.toJSON())),id:f};console.debug("StreamingCutRequest",n.Endpoints.streaming.cut,r),p("Updating stream"),m(n.Endpoints.streaming.cut,r).then((e=>{console.debug("StreamingCutResponse",n.Endpoints.streaming.cut,e),p("Updated stream"),c(!1)}))})())},disabled:g});return r.default.createElement(i,Object.assign({},y))},e.Browser=re,e.BrowserContent=Se,e.BrowserContext=Y,e.BrowserContextDefault=K,e.BrowserControl=Ae,e.BrowserPicker=Ne,e.BrowserPropsDefault=Ie,e.Button=st,e.ClipContext=Le,e.ClipContextDefault=Be,e.ClipItem=We,e.ColorGroupInput=Rt,e.Composer=Xe,e.ComposerContent=Ke,e.ComposerContext=Je,e.ComposerContextDefault=Ze,e.ComposerDepth=Ye,e.ComposerFolderClose=Qe,e.ComposerFolderOpen=et,e.ComposerLayer=_e,e.ComposerLayerFolder=tt,e.ComposerLayerLabel=nt,e.ComposerLayerMash=at,e.CreateEditedControl=it,e.DataGroupInputs=At,e.DataTypeInputs=vt,e.DefaultComposerProps=ot,e.DefaultPlayerProps=rn,e.DefaultStreamerProps=e=>({className:"editor caster",children:Rn}),e.DefaultTimelineProps=En,e.DefinitionContext=oe,e.DefinitionContextDefault=le,e.DefinitionDrop=Tt,e.DefinitionItem=Me,e.DefinitionSelect=jt,e.DragElementPoint=Te,e.DragElementRect=Oe,e.DragSuffix=ie,e.DragTypes=pe,e.EditorRedoButton=ct,e.EditorRemoveButton=ut,e.EditorUndoButton=dt,e.EffectsGroupInput=zt,e.EmptyElement=Et,e.InputContext=Ct,e.InputContextDefault=bt,e.Inspector=Wt,e.InspectorContent=Zt,e.InspectorContext=gt,e.InspectorContextDefault=mt,e.InspectorEffect=Bt,e.InspectorPicked=Jt,e.InspectorPicker=Xt,e.InspectorProperties=Gt,e.InspectorProperty=Lt,e.InspectorPropsDefault=_t,e.LayerContext=He,e.LayerContextDefault=$e,e.Masher=function(e){const{editType:t=n.EditType.Mash,previewSize:a,icons:s={},edited:c}=e,u=l(e,["editType","previewSize","icons","edited"]),d=r.default.useRef({}),f=r.default.useRef(null),{current:p}=d,[m,g]=r.default.useState(),y=r.default.useRef(null),h=r.default.useContext(q),[E]=r.default.useState((()=>n.editorInstance({editType:t}))),[v,b]=r.default.useState(!1),[C,O]=r.default.useState(),{enabled:T,endpointPromise:k,servers:S}=h;r.default.useEffect((()=>{Mt(y.current,a)}),[a]);const D=e=>{const s=e||c||{[t]:{},definitions:[]},{previewSize:r=a}=s,o=l(s,["previewSize"]),{current:i}=f,{current:u}=y;n.assertObject(i),n.sizeAboveZero(r)&&Mt(u,r),E.svgElement=i,E.load(o)};r.default.useEffect((()=>{if(T){if(!v&&S[n.ServerType.Data]){b(!0);const e={};k(n.Endpoints.data[t].default,e).then((e=>{var a;console.debug("DataDefaultResponse",n.Endpoints.data[t].default,e),l(e,["previewSize"]),(null===(a=S.file)||void 0===a?void 0:a.prefix)&&(E.preloader.endpoint.prefix=String(S.file.prefix)),D(e)}))}}else D()}),[S]);const x=(e,t,a)=>{console.debug("handleApiCallback request",a);const{eventTarget:s}=E;return n.fetchCallback(a).then((r=>{console.debug("handleApiCallback response",r);const{apiCallback:l,error:o}=r;if(o)return P(a.endpoint.prefix,o,e);if(l){const{request:o,endpoint:i}=l;if(i.prefix===n.Endpoints.data.definition.put){n.assertObject(o);const{body:e}=o;n.assertObject(e);const a=e,{definition:s}=a;E.updateDefinition(s,t)}if(a.endpoint.prefix===n.Endpoints.rendering.status){const t=r;let a=0,l=0;n.OutputTypes.forEach((e=>{const n=t[e];n&&(a+=n.total,l+=n.completed)})),a&&s.emit(n.EventType.Active,{id:e,step:l,steps:a,type:n.ActivityType.Render})}return new Promise((e=>{setTimeout(e,2e3)})).then((()=>x(e,t,l)))}s.emit(n.EventType.Active,{id:e,type:n.ActivityType.Complete})}))},P=(e,t,a)=>(E.eventTarget.emit(n.EventType.Active,{id:a,type:n.ActivityType.Error,error:"import.render",value:t}),console.error(e,t),Promise.reject(t)),N=e=>{g(e)},w={editor:E,draggable:C,setDraggable:O,save:()=>o(this,void 0,void 0,(function*(){const{definitionsUnsaved:e}=E,t=(e=>{let t=Promise.resolve();const{eventTarget:a}=E;return e.forEach((e=>{n.assertPreloadableDefinition(e);const{label:s,type:r,source:l}=e,o=n.idGenerate("activity");a.emit(n.EventType.Active,{id:o,label:s,type:n.ActivityType.Render});const{rendering:i}=n.Endpoints,c=fetch(l).then((e=>e.blob())).then((e=>new File([e],s))).then((t=>{const a={type:r,name:s,size:t.size};return console.debug("RenderingUploadRequest",i.upload,a),k(i.upload,a).then((a=>{console.debug("RenderingUploadResponse",i.upload,a);const{error:s,fileApiCallback:r,apiCallback:l,fileProperty:c}=a;return s?P(i.upload,s,o):r&&r.request?(c?r.request.body[c]=t:r.request.body=t,n.fetchCallback(r).then((t=>{console.debug("FileStoreResponse",t);const{error:a}=t;return a?P(r.endpoint.prefix,a,o):(n.assertObject(l),x(o,e,l))}))):(n.assertObject(l),x(o,e,l))}))}));t=t.then((()=>c))})),t})(e),a=t.then((()=>E.dataPutRequest())).then((e=>{const{editType:t}=E;console.debug("DataPutRequest",n.Endpoints.data[t].put,JSON.parse(JSON.stringify(e))),k(n.Endpoints.data[t].put,e).then((e=>{console.debug("DataPutResponse",n.Endpoints.data[t].put,e);const{error:a,temporaryIdLookup:s}=e;a?console.error(n.Endpoints.data[t].put,a):E.saved(s)}))}));yield a})),editorIndex:p,drop:(e,t)=>e?n.isClip(e)||n.isEffect(e)||n.isLayer(e)?Promise.resolve([]):n.isDefinitionObject(e)?((e,t)=>E.add(e,t))(e,t):n.isMashAndDefinitionsObject(e)?Promise.resolve([]):((e,t)=>{const a=je(e,S.file);if(a.length){const e=[],s=[],{eventTarget:r}=E;if(a.forEach((t=>{t instanceof File?s.push(t):e.push(t)})),e.length&&e.forEach((e=>{const t=n.idGenerate("activity-error"),a=Object.assign({id:t,type:n.ActivityType.Error},e);r.emit(n.EventType.Active,a)})),s.length)return E.addFiles(s,t)}return Promise.resolve([])})(e,t).then((e=>{const[t]=e;return n.isDefinition(t)&&N(t),e})):Promise.resolve([]),definition:m,changeDefinition:N,icons:s},A=Object.assign(Object.assign({},u),{onDrop:n.eventStop,ref:y});return r.default.createElement(j.Provider,{value:w},r.default.createElement(i,Object.assign({},A)),r.default.createElement("svg",{style:{display:"none"},ref:f}))},e.MasherCastProps=function(e={}){e.className||(e.className="editor caster");const t=On(e),{panels:a={}}=e,{composer:s={}}=a;if(!s)return t;s.icons||(s.icons=e.icons);const l=r.default.createElement(r.default.Fragment,null,t.children,r.default.createElement(Xe,Object.assign({},ot(s))));return Object.assign(Object.assign({},t),{children:l,editType:n.EditType.Cast})},e.MasherContext=j,e.MasherContextDefault=T,e.MasherDefaultProps=On,e.NumericTypeInput=kt,e.OpacityGroupInput=Ft,e.Panel=function(e){const{children:t,className:n,collapsed:a}=e,[s,l]=r.default.useState(!!a),o=[];n&&o.push(n),s&&o.push("collapsed");const c={children:t,className:o.join(" ")},u={collapsed:s,changeCollapsed:l};return r.default.createElement(O.Provider,{value:u},r.default.createElement(i,Object.assign({},c)))},e.PanelContent=function(e){const{children:t,className:n}=e;if(!t)return null;const a={className:n,children:t};return r.default.createElement(i,Object.assign({},a))},e.PanelFoot=G,e.PanelHead=function(e){const{children:t,className:n}=e;if(!t)return null;const a={className:n,children:t};return r.default.createElement(i,Object.assign({},a))},e.Panels=Cn,e.PercentTypeInput=Dt,e.Player=vn,e.PlayerButton=en,e.PlayerContent=Qt,e.PlayerContext=Yt,e.PlayerContextDefault=Kt,e.PlayerNotPlaying=an,e.PlayerPlaying=nn,e.PlayerTime=sn,e.PlayerTimeControl=tn,e.PointGroupInput=Vt,e.Problems=A,e.Process=function(e){const t=r.default.useContext(q),[a,s]=r.default.useState(!1),[l,o]=r.default.useState(0),[i,c]=r.default.useState(""),[u,d]=r.default.useState(""),{children:f,id:p}=e,{enabled:m,servers:g}=t;if(!n.ServerTypes.map(String).includes(p))return null;if(!m||!g[p])return null;const y={processing:a,setProcessing:s,status:i,setStatus:c,progress:l,setProgress:o,error:u,setError:d};return r.default.createElement(X.Provider,{value:y},f)},e.ProcessActive=Tn,e.ProcessContext=X,e.ProcessContextDefault=J,e.ProcessInactive=jn,e.ProcessProgress=function(e){const t=r.default.useContext(X),{progress:n,processing:a}=t;if(!a)return r.default.createElement(i,{className:"progress-holder"});const s={value:n,max:1,children:`${Math.round(100*n)}%`};return r.default.createElement("progress",Object.assign({},s))},e.ProcessStatus=function(e){const{className:t}=e,n=l(e,["className"]),a=r.default.useContext(X),{status:s,error:o,setError:c}=a,u=["process-status"];t&&u.push(t),o&&u.push("error");const d=Object.assign(Object.assign({},n),{onClick:()=>{o&&c("")},key:"process-status",className:u.join(" "),children:o||s});return r.default.createElement(i,Object.assign({},d))},e.RenderControl=ft,e.RgbTypeInput=xt,e.SaveControl=pt,e.SelectEditedControl=yt,e.Shooter=function(e){const[t,n]=r.default.useState([]);r.default.useEffect((()=>{navigator.mediaDevices.enumerateDevices().then(n)}),[]);const a={devices:t},s={children:t.map((e=>r.default.createElement(i,null,JSON.stringify(e))))};return r.default.createElement(Sn.Provider,{value:a},r.default.createElement(i,Object.assign({},s)))},e.ShooterContext=Sn,e.ShooterContextDefault=kn,e.SizeGroupInput=Ht,e.SizingGroupInput=qt,e.SizingTypeInput=Pt,e.Slider=St,e.Streamer=function(e){return r.default.createElement(i,Object.assign({},e))},e.Streamers=function(e){return r.default.createElement(i,Object.assign({},e))},e.StreamersCreateControl=function(e){return r.default.createElement(i,Object.assign({},e))},e.TextTypeInput=Nt,e.Timeline=bn,e.TimelineAddClipControl=hn,e.TimelineAddTrackControl=mn,e.TimelineContent=pn,e.TimelineContext=Ve,e.TimelineContextDefault=Fe,e.TimelineDefaultZoom=1,e.TimelineScrubber=fn,e.TimelineScrubberElement=ln,e.TimelineSizer=cn,e.TimelineTrack=on,e.TimelineTrackIcon=gn,e.TimelineTracks=dn,e.TimelineZoom=yn,e.TimelineZoomer=un,e.TimingGroupInput=Ut,e.TimingTypeInput=wt,e.TrackContext=ze,e.TrackContextDefault=Ge,e.TransferTypeFiles=ge,e.TweenInputKey="tween-input-key",e.VideoView=It,e.View=i,e.ViewControl=ht,e.ViewerContext=Z,e.ViewerContextDefault=W,e.Webrtc=An,e.WebrtcButton=Nn,e.WebrtcClient=Pn,e.WebrtcContent=wn,e.WebrtcContext=xn,e.WebrtcContextDefault=Dn,e.activityLabel=g,e.assertActivityGroup=v,e.assertDragDefinitionObject=de,e.assertDragOffsetObject=function(e){ce(e)||n.throwError(e,"DragOffsetObject")},e.dragData=Ce,e.dragDefinitionType=Ee,e.dragType=ve,e.dragTypes=be,e.dropFilesFromList=je,e.dropType=he,e.droppingPositionClass=ke,e.elementSetPreviewSize=Mt,e.isActivityGroup=E,e.isDragDefinitionObject=ue,e.isDragOffsetObject=ce,e.isDragType=me,e.isTransferType=ye,e.labelInterpolate=m,e.labelLookup=f,e.labelObjects=u,e.labelTranslate=p,e.labels=d,e.panelOptionsStrict=L,e.propsDefinitionTypes=xe,e.propsSelectTypes=Pe,e.sessionGet=e=>globalThis.window.sessionStorage.getItem(e)||"",e.sessionSet=(e,t)=>{globalThis.window.sessionStorage.setItem(e,String(t))},e.useApiDefinitions=se,e.useClip=()=>r.default.useContext(Le).clip,e.useDefinition=Re,e.useEditor=_,e.useEditorActivity=k,e.useEditorDefinitions=ee,e.useLayer=qe,e.useListeners=Ue,Object.defineProperty(e,"__esModule",{value:!0})}));
