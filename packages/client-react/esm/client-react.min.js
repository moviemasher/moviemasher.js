import e from"react";import{EmptyMethod as t,DroppingPosition as n,SelectType as s,DataType as r,ContainerTypes as c,ContentTypes as o,DataGroup as i,Orientation as a,isObject as l,isPopulatedString as d,throwError as u,EventType as m,assertTrue as p,isPopulatedArray as g,isPositive as f,isAboveZero as h,assertObject as b,assertPopulatedObject as y,isUndefined as E,ClassButton as v,urlEndpoint as O,Endpoints as j,idPrefixSet as k,sizeCopy as C,assertPopulatedString as S,isString as x,assertDefinitionType as N,isDefinitionType as w,isPopulatedObject as T,isUploadType as P,isArray as D,ClassDroppingBefore as R,ClassDroppingAfter as A,ClassDropping as $,isSelectType as z,UploadTypes as I,RectZero as L,pixelFromFrame as H,LayerType as V,MasherAction as F,assertSelectType as M,ServerType as q,Defined as U,DefinitionType as B,isDefined as W,isNumber as J,Sizings as G,Timings as X,assertTimeRange as Z,assertTime as Y,selectedPropertyObject as _,tweenInputTime as K,isSelectedProperty as Q,selectedPropertiesScalarObject as ee,PropertyTweenSuffix as te,assertString as ne,isOrientation as se,SelectTypes as re,assertPositive as ce,arraySet as oe,assertPopulatedArray as ie,EditType as ae,editorInstance as le,eventStop as de,rectCopy as ue,sizeAboveZero as me,stringSeconds as pe,assertMash as ge,assertTrack as fe,DefaultContentId as he,ServerTypes as be,Errors as ye,isEventType as Ee,ActivityType as ve,ClassCollapsed as Oe,ClassSelected as je,ApiVersion as ke,fetchCallback as Ce,sizeCeil as Se,sizeScale as xe,isLayerFolder as Ne,isActionEvent as we,isChangeAction as Te,ClassDisabled as Pe,isEffect as De,isClip as Re,isTrack as Ae,OutputType as $e,isMash as ze,urlForEndpoint as Ie,assertDefinition as Le,isContainerDefinition as He,assertEffect as Ve,isEffectDefinition as Fe,assertDataGroup as Me,timeFromArgs as qe,timeEqualizeRates as Ue,rectRound as Be,arrayReversed as We,pixelPerFrame as Je,assertCast as Ge,isLayer as Xe,isDefinitionObject as Ze,isMashAndDefinitionsObject as Ye,isDefinition as _e,pixelToFrame as Ke,assertClip as Qe,DefinitionBase as et,colorToRgb as tt,colorRgbDifference as nt,colorFromRgb as st,svgPolygonElement as rt,idGenerate as ct,svgPatternElement as ot,svgDefsElement as it,svgUrl as at,svgElement as lt,assertPreloadableDefinition as dt,OutputTypes as ut}from"@moviemasher/moviemasher.js";import{Icons as mt}from"@moviemasher/theme-default";function pt(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]])}return n}function gt(e,t,n,s){return new(n||(n=Promise))((function(r,c){function o(e){try{a(s.next(e))}catch(e){c(e)}}function i(e){try{a(s.throw(e))}catch(e){c(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}a((s=s.apply(e,t||[])).next())}))}const ft=e.forwardRef(((t,n)=>e.createElement("div",Object.assign({ref:n},t)))),ht=/{{([a-z0-9_]*)}}/,bt={import:{bytes:"Size above {{value}}",extension:"Extension {{value}}",type:"Type {{value}}",size:"Dimensions {{value}}",duration:"Duration {{value}}",render:"{{value}}",displaySize:"{{width}}x{{height}}"}},yt={audible:"Audible",clip:"Clip",update:"Save",delete:"Remove {{type}}",unlabeled:"Unlabeled {{type}}",analyze:"Analyzing...",load:"Loading...",complete:"Completed",layer:"Layer",create:"New",render:"Render",view:"View",open:"Open...",undo:"Undo",redo:"Redo",cast:"Cast",mash:"Mash"},Et=e=>{const[t,n]=e.split(".");return bt[t][n]},vt=e=>e.includes(".")?Et(e):yt[e]||e,Ot=(e,t)=>{let n=vt(e);const s=n.match(ht);return s?(s.forEach(((e,s)=>{if(!s)return;const r=`{{${e}}}`,c=vt(t[e]);n=n.replace(r,c)})),n):n},jt=e=>{if(!l(e))return"";const{label:t,error:n,type:s,value:r}=e;return n?r?Ot(n,{value:r}):vt(n):vt(s)};var kt;!function(e){e.Active="active",e.Error="error",e.Complete="complete"}(kt||(kt={}));const Ct=Object.values(kt),St=e=>d(e)&&Ct.includes(e);function xt(e,t){St(e)||u(e,"ActivityGroup",t)}const Nt={label:"",activities:[],allActivities:[],picked:kt.Active,pick:t},wt=e.createContext(Nt),Tt={changeDefinition:t,drop:()=>Promise.resolve([]),editorIndex:{},icons:{},save:t,setDraggable:t},Pt=e.createContext(Tt),Dt=(t,n)=>{const s=e.useContext(Pt),{editor:r}=s,c=n||r.eventTarget,o=e=>{const{type:n}=e,s=t[n];s&&s(e)},i=()=>(Object.keys(t).forEach((e=>{c.addEventListener(e,o)})),()=>{Object.keys(t).forEach((e=>{c.removeEventListener(e,o)}))});e.useEffect((()=>i()),[])},Rt=e.createContext({collapsed:!1,changeCollapsed:()=>{}});function At(t){const{initialPicked:n=kt.Active,collapsed:s,className:r}=t,c=pt(t,["initialPicked","collapsed","className"]),[o,i]=e.useState(!!s);xt(n);const a=e.useRef([]),{current:l}=a,[d,u]=e.useState((()=>[])),[p,g]=e.useState((()=>n||kt.Active)),[f,h]=e.useState(""),b=e=>a.current.filter((t=>t.activityGroup===e));Dt({[m.Activity]:e=>{const{type:t}=e;if(Ee(t)&&e instanceof CustomEvent){const t=e.detail,{id:n,type:s}=t,r=l.find((e=>e.id===n)),c=r||{id:n,activityGroup:kt.Active,infos:[]};c.infos.unshift(t),o&&h(jt(t)),s===ve.Complete?c.activityGroup=kt.Complete:s===ve.Error&&(c.activityGroup=kt.Error),r||l.unshift(c),u(b(p))}}});const y={activities:d,picked:p,pick:e=>{u((()=>b(e))),g((()=>e))},allActivities:l,label:f},E={collapsed:o,changeCollapsed:e=>{h(""),i(e)}},v=[];r&&v.push(r),o&&v.push(Oe);const O=Object.assign(Object.assign({},c),{className:v.join(" ")});return e.createElement(wt.Provider,{value:y},e.createElement(Rt.Provider,{value:E},e.createElement(ft,Object.assign({},O))))}const $t={infos:[],activityGroup:kt.Active,id:""},zt=e.createContext($t);function It(t){const n=e.useContext(wt),s=e.useContext(Rt),{collapsed:r}=s,{activities:c}=n;if(r)return null;const{children:o}=t,i=pt(t,["children"]),a=e.Children.only(o);p(e.isValidElement(a));const l=c.map((t=>{const n={children:e.cloneElement(a),value:t,key:t.id};return e.createElement(zt.Provider,Object.assign({},n))})),d=Object.assign(Object.assign({},i),{children:l});return e.createElement(ft,Object.assign({},d))}function Lt(t){const{collapsed:n}=t,s=pt(t,["collapsed"]),[r,c]=e.useState(!!n),o={collapsed:r,changeCollapsed:c};return e.createElement(Rt.Provider,{value:o},e.createElement(ft,Object.assign({},s)))}function Ht(t){const n=e.useContext(Rt),{collapsed:s}=n,r=e.useContext(zt),{infos:c}=r,[o]=c,i=(c.find((e=>e.label))||{label:""}).label||o.type,a=Object.assign({},t);if(s)a.children=i;else{const t=[i,...c.map((e=>jt(e)))];a.children=t.map(((t,n)=>e.createElement(ft,{key:n,children:t})))}return e.createElement(ft,Object.assign({},a))}const Vt={child:"single child element expected"};function Ft(t){const n=e.useContext(wt),{id:s,children:r}=t;xt(s);const{picked:c}=n;if(s!==c)return null;const o=e.Children.only(r);return p(e.isValidElement(o),Vt.child),o}function Mt(t){const{id:n,className:s,children:r}=t,c=pt(t,["id","className","children"]);xt(n);const o=e.Children.only(r);p(e.isValidElement(o),Vt.child);const i=e.useContext(wt),{picked:a,pick:l}=i,d=[];s&&d.push(s),n===a&&d.push(je);const u=Object.assign(Object.assign({},c),{className:d.join(" "),key:`activity-picker-${n}`,onClick:()=>l(n)});return e.cloneElement(o,u)}function qt(t){const n=e.useContext(wt),s=e.useContext(zt),{infos:r,id:c}=s,o=[];let i=0,a=0;if(g(r)){const[e]=r,{step:t,steps:n}=e;f(t)&&h(n)&&(a=t,i=n)}else{const{allActivities:t,label:s}=n;d(s)&&o.push(e.createElement("label",{key:"label"},s));const r=t.filter((e=>e.activityGroup===kt.Active));r.length&&r.forEach((e=>{const{infos:t}=e,[n]=t;b(n);const{step:s,steps:r}=n;f(r)&&(i+=r),f(s)&&(a+=s)}))}if(i){const t=a/i,n={value:t,max:1,children:`${Math.round(100*t)}%`,key:"progress"};o.push(e.createElement("progress",Object.assign({},n)))}const l=Object.assign(Object.assign({},t),{key:"activity-progress",children:o});return e.createElement(ft,Object.assign({},l))}function Ut(t){const{before:n,content:s,after:r,props:c={}}=t;if(!(n||s||r))return null;const o=[n,s,r].filter(Boolean);return c.children=o,e.createElement(ft,Object.assign({},c))}const Bt=e=>{var t,n,s,r,c,o,i,a,l;return e.header||(e.header={}),(t=e.header).props||(t.props={}),(n=e.header.props).key||(n.key="header"),(s=e.header.props).className||(s.className="head"),e.content||(e.content={}),(r=e.content).props||(r.props={}),(c=e.content.props).key||(c.key="content"),(o=e.content.props).className||(o.className="content"),e.footer||(e.footer={}),(i=e.footer).props||(i.props={}),(a=e.footer.props).key||(a.key="footer"),(l=e.footer.props).className||(l.className="foot"),e.props||(e.props={}),y(e.icons),e};function Wt(t){const{children:n,className:s,collapsed:r}=t,[c,o]=e.useState(!!r),i=[];s&&i.push(s),c&&i.push("collapsed");const a={children:n,className:i.join(" ")},l={collapsed:c,changeCollapsed:o};return e.createElement(Rt.Provider,{value:l},e.createElement(ft,Object.assign({},a)))}function Jt(t){const n=e.useContext(Rt),{collapsed:s}=n;if(s)return null;const{before:r,content:c,after:o,props:i={}}=t;if(!(r||c||o))return null;const a=[r,c,o].filter(Boolean);return i.children=a,e.createElement(ft,Object.assign({},i))}function Gt(t){const n=e.useContext(Rt),{collapsed:s,changeCollapsed:r}=n,c=Object.assign(Object.assign({},t),{onClick:()=>{r(!s)}});return e.createElement(ft,Object.assign({},c))}function Xt(t){return e.useContext(Rt).collapsed?null:e.createElement(e.Fragment,null,t.children)}function Zt(t){return e.useContext(Rt).collapsed?e.createElement(e.Fragment,null,t.children):null}const Yt=function(t={}){var n,s,r,c,o,i;const a=Bt(t),{icons:l}=a;(n=a.props).key||(n.key="activity"),(s=a.props).className||(s.className="panel activity"),(r=a.props).initialPicked||(r.initialPicked=kt.Active),E(a.props.collapsed)&&(a.props.collapsed=!0),(c=a.header).content||(c.content=[l.activity,e.createElement(Xt,{key:"not-collapsed"},e.createElement(ft,{key:"view"})),e.createElement(Zt,{key:"collapsed"},e.createElement(qt,{key:"progress",className:"progress"})),e.createElement(Gt,{key:"collapse-control"},e.createElement(Xt,{key:"not-collapsed",children:l.collapse}),e.createElement(Zt,{key:"collapsed",children:l.collapsed}))]),(o=a.content).children||(o.children=e.createElement(Lt,{className:"item",collapsed:!0},e.createElement(Gt,{key:"collapse-control"},e.createElement(Xt,{key:"not-collapsed",children:l.collapse}),e.createElement(Zt,{key:"collapsed",children:l.collapsed})),e.createElement(Ht,{key:"label",className:"label"}),e.createElement(Ft,{key:"active",id:"active"},e.createElement(qt,{key:"progress"})),e.createElement(Ft,{key:"error",id:"error",children:l.error}),e.createElement(Ft,{key:"complete",id:"complete",children:l.complete}))),(i=a.footer).content||(i.content=[e.createElement(Mt,{key:"active",id:"active",className:v,children:l.active}),e.createElement(Mt,{key:"error",id:"error",className:v,children:l.error}),e.createElement(Mt,{key:"complete",id:"complete",className:v,children:l.complete})]);const d=e.createElement(e.Fragment,null,e.createElement(Ut,Object.assign({},a.header)),e.createElement(It,Object.assign({},a.content.props),a.content.children),e.createElement(Jt,Object.assign({},a.footer)));return Object.assign(Object.assign({},a.props),{children:d})},_t={enabled:!1,servers:{},endpointPromise:()=>Promise.resolve({})},Kt=e.createContext(_t);function Qt(t){const{endpoint:n,children:s,path:r}=t,c=n||O({prefix:r||j.api.callbacks}),[o,i]=e.useState((()=>({[j.api.callbacks]:{endpoint:c}}))),[a,l]=e.useState((()=>({}))),d=(e,t)=>u(e).then((e=>(T(t)&&(e.request||(e.request={}),e.request.body=Object.assign({version:ke},t)),Ce(e)))),u=e=>{const t=o[e];if(t)return Promise.resolve(t);return Ce({endpoint:c,request:{body:{id:e,version:ke}}}).then((t=>{const{apiCallbacks:n}=t;return i((e=>Object.assign(Object.assign({},e),n))),n[e]}))};e.useEffect((()=>{d(j.api.servers,{}).then((e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.temporaryIdPrefix)&&k(e.data.temporaryIdPrefix),l(e)}))}),[]);const m={enabled:!0,endpointPromise:d,servers:a};return e.createElement(Kt.Provider,{value:m},s)}function en(t){const n=e.useContext(Kt),{enabled:s}=n;return s?e.createElement(e.Fragment,null,t.children):null}const tn={width:0,height:0,videoRate:0,streaming:!1,updating:!1,preloading:!1,setPreloading:()=>{},setStreaming:()=>{},setWidth:()=>{},setHeight:()=>{},setVideoRate:()=>{},setUpdating:()=>{},setId:()=>{},id:"",setUrl:()=>{},url:""},nn=e.createContext(tn);function sn(t){const[n,s]=e.useState(!1),[r,c]=e.useState(!1),[o,i]=e.useState(!1),[a,l]=e.useState(""),[d,u]=e.useState(""),[m,p]=e.useState(0),[g,f]=e.useState(0),[h,b]=e.useState(0),y={updating:o,setUpdating:i,videoRate:h,setVideoRate:b,height:g,setHeight:f,width:m,setWidth:p,url:d,setUrl:u,streaming:n,setStreaming:s,preloading:r,setPreloading:c,id:a,setId:l};return e.createElement(nn.Provider,{value:y},e.createElement(ft,Object.assign({},t)))}const rn={error:"",processing:!1,progress:0,setError:()=>{},setProcessing:()=>{},setProgress:()=>{},setStatus:()=>{},status:""},cn=e.createContext(rn);function on(t){const n=e.useContext(cn),s=e.useContext(Kt),r=e.useContext(nn),{setProcessing:c,processing:o,setStatus:i}=n,[a,l]=e.useState(o),{endpointPromise:d}=s,{setStreaming:u,setId:m,setUrl:p,setWidth:g,setHeight:f,setVideoRate:h}=r,b=Object.assign(Object.assign({},t),{onClick:()=>{a||(l(!0),(()=>{const e={};console.debug("StreamingStartRequest",j.streaming.start,e),d(j.streaming.start,e).then((e=>{console.debug("StreamingStartResponse",j.streaming.start,e),i("Started stream");const{id:t,readySeconds:n,width:s,height:r,videoRate:o}=e;m(t),g(s),f(r),h(o);const a=()=>{setTimeout((()=>{const e={id:t};console.debug("StreamingStatusRequest",j.streaming.status,e),d(j.streaming.status,e).then((e=>{console.debug("StreamingStatusResponse",j.streaming.status,e);const{streamUrl:t}=e;t?(p(t),u(!0),c(!0),i("Streaming")):a()}))}),1e3*n)};a()}))})())},disabled:a});return e.createElement(ft,Object.assign({},b))}const an=()=>e.useContext(Pt).editor;function ln(t){const n=e.useContext(nn),s=an(),{rect:r}=s,{url:c,streaming:o}=n;if(!o||!c)return e.createElement(ft,Object.assign({},t));const i=Object.assign(Object.assign(Object.assign({},C(r)),t),{autoPlay:!0});return e.createElement("video",Object.assign({src:c},i))}function dn(t){const n=e.useContext(cn),s=e.useContext(Kt),r=e.useContext(nn),{id:c,setPreloading:o,preloading:i,updating:a,streaming:l}=r,{setStatus:d}=n,{endpointPromise:u}=s,m=i||a||!l,p=Object.assign(Object.assign({},t),{onClick:()=>{m||(o(!0),(()=>{const e={files:[],id:c};d("Preloading..."),console.debug("StreamingPreloadRequest",j.streaming.preload,e),u(j.streaming.preload,e).then((e=>{console.debug("StreamingPreloadResponse",j.streaming.preload,e),d("Preloaded"),o(!1)}))})())},disabled:m});return e.createElement(ft,Object.assign({},p))}function un(t){const n=an(),s=e.useContext(cn),r=e.useContext(Kt),c=e.useContext(nn),{updating:o,setUpdating:i,streaming:a,preloading:l,id:d}=c,{setStatus:u}=s,{endpointPromise:m}=r,p=o||l||!a,g=Object.assign(Object.assign({},t),{onClick:()=>{p||(i(!0),(()=>{const{edited:e,definitions:t}=n;Ge(e);const{mashes:s}=e,r={definitionObjects:t.map((e=>e.toJSON())),mashObjects:s.map((e=>e.toJSON())),id:d};console.debug("StreamingCutRequest",j.streaming.cut,r),u("Updating stream"),m(j.streaming.cut,r).then((e=>{console.debug("StreamingCutResponse",j.streaming.cut,e),u("Updated stream"),i(!1)}))})())},disabled:p});return e.createElement(ft,Object.assign({},g))}const mn={addPicker:t,definitions:[],pick:t,picked:"",removePicker:t},pn=e.createContext(mn);function gn(t){const{initialPicked:n="container"}=t,s=pt(t,["initialPicked"]);S(n);const[r,c]=e.useState({}),o=e.useContext(Kt),i=e.useContext(Pt),{changeDefinition:a}=i,[l,u]=e.useState([]),[p,f]=e.useState(n),{enabled:h,servers:b,endpointPromise:y}=o,E=e=>{const t=(e=>{const t=e.map((e=>U.byType(e)));return 1===t.length?t[0]:t.flat()})(e);if(!h||!b[q.Data])return Promise.resolve(t);const n={types:e};return y(j.data.definition.retrieve,n).then((e=>{console.debug("DataDefinitionRetrieveResponse",j.data.definition.retrieve,e);const{definitions:n}=e,s=n.filter((e=>{const{id:n}=e;return!t.some((e=>e.id===n))}));return[...t,...s.map((e=>et.fromObject(e)))]}))},v=e=>gt(this,void 0,void 0,(function*(){a(),u(yield E(e))})),O=e=>gt(this,void 0,void 0,(function*(){const t=d(e)&&r[e]||[];yield v(t)})),k=e=>gt(this,void 0,void 0,(function*(){S(e),f(e),yield O(e)}));Dt({[m.Added]:e=>gt(this,void 0,void 0,(function*(){const{type:t}=e;if(Ee(t)&&e instanceof CustomEvent){const{detail:t}=e,{definitionTypes:n}=t;if(g(n)){const e=n,t=Object.keys(r).filter((t=>{const n=r[t];return ie(n),n.some((t=>e.includes(t)))}));if(!g(t))return;const s=t.includes(p)?p:t.shift();S(s),yield k(s)}}})),[m.Resize]:()=>{O().then((()=>{O(p)}))}});const C={value:{definitions:l,picked:p,pick:k,addPicker:(e,t)=>gt(this,void 0,void 0,(function*(){c((n=>(n[e]=t,n))),e===p&&(yield v(t))})),removePicker:e=>{c((t=>(delete t[e],t)))}},children:e.createElement(ft,Object.assign({},s))};return e.createElement(pn.Provider,Object.assign({},C))}const fn={},hn=e.createContext(fn),bn="/x-moviemasher",yn=e=>l(e)&&"offset"in e;function En(e){yn(e)||u(e,"DragOffsetObject")}const vn=e=>yn(e)&&"definitionObject"in e;function On(e){vn(e)||u(e,"DragDefinitionObject")}var jn;!function(e){e.Mash="mash",e.Layer="layer",e.Track="track"}(jn||(jn={}));const kn=Object.values(jn),Cn=e=>x(e)&&kn.includes(e),Sn="Files",xn=e=>x(e)&&e.endsWith(bn),Nn=e=>{if(e)return e.types.find(xn)},wn=e=>{const[t]=e.split("/");return N(t),t},Tn=e=>{const t=Nn(e);if(!t)return;const[n]=t.split("/");return Cn(n)||w(n)?n:void 0},Pn=e=>{const{types:t}=e;return t.filter((e=>"Files"===e||xn(e)))},Dn=(e,t)=>{const n=t?`${t}${bn}`:Pn(e).find(xn);if(!n)return{};const s=e.getData(n);return s?JSON.parse(s):{}},Rn=e=>e.getBoundingClientRect(),An=(e,t)=>{const n=t instanceof Element?Rn(t):t,{x:s,y:r}=n,{clientY:c,clientX:o}=e;return{x:o-s,y:c-r}},$n=(e,t={})=>{const n=[],{length:s}=e;if(!s)return n;const r=T(t),{extensions:c={},uploadLimits:o={}}=t,i=c,a=o;for(let t=0;t<s;t++){const s=e.item(t);if(!s)continue;const{name:c,size:o,type:l}=s,u=l.split("/").shift();if(!P(u)){n.push({label:c,value:u,error:"import.type"});continue}const m=a[u];if(r&&!(h(m)&&1024*m*1024>o)){n.push({label:c,value:`${m}MB`,error:"import.bytes"});continue}const p=c.toLowerCase().split(".").pop(),g=d(p),f=i[u];!r&&g||g&&D(f)&&f.includes(p)?n.push(s):n.push({label:c,value:p,error:"import.extension"})}return n},zn=e=>{if(E(e))return"";switch(e){case n.After:return A;case n.Before:return R;case n.None:return""}return $};function In(t){const[n,s]=e.useState(!1),{className:r,children:c}=t,o=pt(t,["className","children"]),i=e.Children.only(c);p(e.isValidElement(i));const a=e.useContext(Pt),l=e.useContext(pn).definitions||[],{drop:d}=a,u=e=>!!e&&Pn(e).includes("Files"),m=e=>{de(e),s(!1)},g=[];r&&g.push(r),n&&g.push($);const f=Object.assign(Object.assign({},o),{className:g.join(" "),key:"browser-content",children:(()=>{const t=i.props;return l.map((n=>{const s=Object.assign(Object.assign({},t),{key:n.id}),r={children:e.cloneElement(i,s),value:{definition:n},key:n.id};return e.createElement(hn.Provider,Object.assign({},r))}))})(),onDrop:e=>{m(e);const{dataTransfer:t}=e;u(t)&&d(t.files)},onDragOver:e=>{de(e),s(u(e.dataTransfer))},onDragLeave:m});return e.createElement(ft,Object.assign({},f))}const Ln=(e,t,n)=>e?[e]:t?x(t)?t.split(",").map((e=>e.trim())):t:n?n.map((e=>e.name)):[],Hn=(e,t,n)=>{const s=Ln(e,t);n&&!s.length&&s.push(n);return s.filter((e=>w(e))).map((e=>e))},Vn=(e,t,n)=>{const s=Ln(e,t);n&&!s.length&&s.push(n);return s.filter((e=>z(e))).map((e=>e))};function Fn(t){const{children:n,type:s,types:r,className:c,id:o}=t,i=pt(t,["children","type","types","className","id"]);S(o);const a=e.Children.only(n);p(e.isValidElement(a),Vt.child);const l=e.useContext(pn),{pick:d,picked:u,addPicker:m,removePicker:g}=l,f=[];c&&f.push(c),u===o&&f.push(je);e.useEffect((()=>(m(o,Hn(s,r,o)),()=>{g(o)})),[]);const h=Object.assign(Object.assign({},i),{className:f.join(" "),key:`browser-picker-${o}`,onClick:()=>{d(o)}});return e.cloneElement(a,h)}function Mn(t){const n=e.useRef(null),s=e.useContext(Kt),r=e.useContext(Pt),{servers:c}=s,{drop:o}=r,{children:i}=t,a=pt(t,["children"]),{file:l={}}=c,{extensions:d=Object.fromEntries(I.map((e=>[e,[]])))}=l;b(d);const u=Object.entries(d).flatMap((([e,t])=>[`${e}/*`,...t.map((e=>`.${e}`))])).join(","),m=Object.assign({accept:u,id:"upload-control-id",onChange:e=>{const{files:t}=e.currentTarget;t&&o(t)},type:"file",key:"browser-control-input",ref:n},a),p=e.createElement("input",Object.assign({},m));if(!e.isValidElement(i))return p;const g={children:[e.Children.only(i),p],key:"browser-control",htmlFor:"upload-control-id"};return e.createElement("label",Object.assign({},g))}const qn=()=>e.useContext(hn).definition;function Un(t){const{className:n,iconRatio:s}=t,r=pt(t,["className","iconRatio"]),c=s||.25,o=e.useRef(null),i=e.useRef(null),a=e.useContext(Pt),{editor:l,definition:d,changeDefinition:u}=a;p(l);const m=qn(),{id:g,label:f}=m,h=()=>gt(this,void 0,void 0,(function*(){const{rect:e,preloader:t}=l,{current:n}=o;if(!n||!me(e))return;const s=Se(xe(C(e),c,c)),r=yield m.definitionIcon(t,s);r&&n.replaceChildren(r)}));e.useEffect((()=>{h()}),[]),o.current&&h();const b=e=>{e.stopPropagation(),u(m)},y=e=>{b(e);const t=i.current.getBoundingClientRect(),{left:n}=t,{clientX:s}=e,r={offset:s-n,definitionObject:m},c=JSON.stringify(r),{dataTransfer:o}=e;o&&(o.effectAllowed="copy",o.setData(m.type+bn,c))},E=Object.assign(Object.assign({},r),{className:n,children:(()=>{const t=[e.createElement(ft,{key:"icon",ref:o})];return f&&t.unshift(e.createElement("label",{key:"label"},f)),t})(),ref:i,key:g});return t.draggable&&(E.onDragStart=y,E.onPointerDown=b,E.className=(()=>{const e=[];return n&&e.push(n),(null==d?void 0:d.id)===g&&e.push(je),e.join(" ")})()),e.createElement(ft,Object.assign({},E))}const Bn=function(t={}){var n,s,r,c,o,i,a,l;const d=Bt(t),{icons:u}=d;(n=d.props).key||(n.key="browser"),(s=d.props).className||(s.className="panel browser"),(r=d.props).initialPicked||(r.initialPicked="container"),(c=d.header).content||(c.content=[u.browser]),(o=d.footer).content||(o.content=[e.createElement(Fn,{key:"effect",id:"effect",className:v,children:u.browserEffect}),e.createElement(Fn,{key:"container",id:"container",className:v,children:u.container}),e.createElement(Fn,{key:"content",id:"content",className:v,children:u.content})]),(i=d.footer).before||(i.before=[e.createElement(Fn,{key:"video",id:"video",types:"video,videosequence",className:v,children:u.browserVideo}),e.createElement(Fn,{key:"audio",id:"audio",className:v,children:u.browserAudio}),e.createElement(Fn,{key:"image",id:"image",className:v,children:u.browserImage})]),(a=d.footer).after||(a.after=[e.createElement(Mn,{key:"import",children:u.import})]),(l=d.content).children||(l.children=e.createElement(Un,{draggable:!0,className:"definition preview"}));const m=e.createElement(e.Fragment,null,e.createElement(Ut,Object.assign({},d.header)),e.createElement(In,Object.assign({},d.content.props),d.content.children),e.createElement(Ut,Object.assign({},d.footer)));return Object.assign(Object.assign({},d.props),{children:m})},Wn={prevClipEnd:0},Jn=e.createContext(Wn),Gn={},Xn=e.createContext(Gn),Zn={dragTypeValid:()=>!1,frame:0,frames:0,onDragLeave:t,onDrop:t,rect:L,refreshed:0,refresh:t,scale:0,scroll:{x:0,y:0},setDroppingClip:t,setDroppingPosition:t,setDroppingTrack:t,setRect:t,setScroll:t,setZoom:t,zoom:1},Yn=e.createContext(Zn),_n={depth:0},Kn=e.createContext(_n),Qn=()=>e.useContext(Kn).layer;function es(t){const{className:s}=t,r=pt(t,["className"]),c=e.useRef(null),o=e.useRef(null),i=an(),a=e.useContext(Xn),d=e.useContext(Yn),[u,g]=e.useState(0),f=()=>{g((new Date).valueOf())},b=e.useRef({}),{current:y}=b,E=e.useContext(Jn),{droppingPosition:v,droppingClip:O,scale:j,selectedClip:k,onDrop:C,dragTypeValid:S,setDroppingPosition:x,setDroppingClip:N,setDroppingTrack:w,onDragLeave:T}=d,{track:P}=a,{clip:D,prevClipEnd:R}=E;p(D);const A=()=>{const{current:e}=c,t=null==e?void 0:e.parentNode;return t instanceof HTMLDivElement?t.getBoundingClientRect().height:0},[$,z]=e.useState(A),{label:I,type:L,frame:V,frames:F}=D,M=()=>{if(!h(j)||!h(F))return 0;const e=H(F,j,"floor"),{width:t}=y;return e&&e!==t&&(y.width=e,f()),e},q=M();Dt({[m.Action]:e=>{if(y.redraw)return;const{type:t}=e;if(!Ee(t))return;if(!(e instanceof CustomEvent))return;if(t!==m.Action)return;const{detail:n}=e;if(!n)return;const{action:s}=n;if(!s)return;const{target:r}=s;if(l(r)){switch(r){case D:case D.container:case D.content:break;default:if("color"===s.property)break;return}f()}},[m.Save]:f});const U=()=>{const{width:e,redraw:t}=y;delete y.timeout,delete y.redraw;const{current:n}=c,{edited:s}=i,r=n&&s&&e&&e===M();if((t||!r)&&(f(),!r))return Promise.resolve();const o=(()=>{const{rect:e}=i,t={width:$*(e.width/e.height),height:$};return Se(t)})(),a=(e=>{const{width:t,height:n}=e;return{width:Math.max(t,q),height:n}})(o),l=D.clipIcon(a,d.scale,2);return l?l.then((t=>{const r=M();t&&e>=r&&n.replaceChildren(((e,t,n)=>{const s=tt(e),r=nt(s),c=st(r),o=rt(t,"",e),i={x:t.width,y:0,width:n,height:t.height},a=rt(i,"",c),l={width:t.width+n,height:t.height},u=ct("pattern"),m=ot(l,u,[o,a]),p=it([m]),g={width:d.rect.width,height:$},f=rt(g,"",at(u));return lt(g,[p,f])})(s.color,o,2),t)})):Promise.resolve()};e.useEffect((()=>{if(!$)return z(A);const{current:e}=c,{edited:t}=i;e&&t&&(y.timeout?y.redraw||(y.redraw=!0):y.timeout=setTimeout(U,500))}),[u,j,$]);const B=e=>{e.stopPropagation(),i.selection.set(D)},W={width:q};R>-1&&(W.marginLeft=H(V-R,j,"floor"));const J=Object.assign(Object.assign({},r),{style:W,className:(()=>{const e=D===k,t=[];return s&&t.push(s),e&&t.push(je),O===D&&t.push(zn(v)),t.join(" ")})(),onPointerDown:B,onDragStart:e=>{B(e);const{dataTransfer:t,clientX:n}=e,{current:s}=o;if(!t||!s)return;const r=s.getBoundingClientRect(),{left:c}=r,i={offset:n-c},a=JSON.stringify(i);t.effectAllowed="move",t.setData(L+bn,a)},onDragEnd:e=>{de(e);const{dataTransfer:t}=e;if(!t)return;const{dropEffect:n}=t;"none"===n&&i.removeClip(D)},onDragOver:e=>{de(e);const{dataTransfer:t}=e;if(!t)return;const s=S(t,D),r=s?n.At:n.None;w(s?P:void 0),N(s?D:void 0),x(r)},onDragLeave:T,onDrop:C,onClick:e=>e.stopPropagation(),draggable:!0,ref:o,children:(()=>{const t={key:"clip-previews",ref:c},n={width:q,height:$};if(me(n)){const{width:e,height:s}=n;t.width=e,t.height=s,t.viewBox=`0 0 ${e} ${s}`}const s=[e.createElement("svg",Object.assign({},t))];return I&&s.unshift(e.createElement("label",{key:"label"},I)),s})()});return e.createElement(ft,Object.assign({},J))}const ts=()=>e.useContext(Jn).clip,ns={refreshed:0,refresh:t,validDragType:()=>{},droppingPosition:n.None,setDroppingPosition:t,onDrop:t,setDroppingLayer:t,onDragLeave:t},ss=e.createContext(ns);function rs(t){const s=e.useContext(Pt),[r,c]=e.useState(void 0),[o,i]=e.useState(void 0),[a,l]=e.useState(0),[d,u]=e.useState(n.None),{editor:p,draggable:g,drop:f}=s,h=()=>{l((e=>e+1))};if(Dt({[m.Selection]:()=>{c(p.selection.layer)},[m.Cast]:h}),!p)return null;const y=e=>{if(!e)return;const t=Tn(e);return Cn(t)&&[jn.Mash,jn.Layer].includes(t)?t:void 0},E={refreshed:a,refresh:h,selectedLayer:r,validDragType:y,droppingPosition:d,setDroppingPosition:u,onDrop:e=>{e.preventDefault(),u(n.None),h();const{dataTransfer:t}=e;b(t);if(Pn(t).includes("Files")){const e={};return void f(t.files,e)}const s=y(t);if(!s)return;const r={layer:o,position:d};switch(s){case jn.Layer:Xe(g)&&p.moveLayer(g,r);break;case jn.Mash:{const e={mashObject:{},definitionObjects:[]};p.addMash(e,r);break}default:g&&f(g)}},droppingLayer:o,setDroppingLayer:i,onDragLeave:()=>{u(n.None),i(void 0)}},v={children:e.createElement(ft,Object.assign({},t)),value:E};return e.createElement(ss.Provider,Object.assign({},v))}function cs(t){const s=e.useRef(null);e.useContext(Pt);const r=e.useContext(ss),c=e.useContext(Kn),{validDragType:o,droppingPosition:i,setDroppingPosition:a,onDrop:d,droppingLayer:u,setDroppingLayer:m,onDragLeave:p}=r,g=an(),{layer:f}=c;if(!f)return null;const{className:h="layer"}=t,b=pt(t,["className"]),y=e=>{e.stopPropagation(),g.selection.set(f)},E=e.useMemo((()=>{const e=f===g.selection.layer,t=[h];return e&&t.push(je),u===f&&t.push(zn(i)),t.join(" ")}),[i,u,g.selection.layer]),v=Object.assign(Object.assign({},b),{className:E,ref:s,onMouseDown:y,onDragStart:e=>{const t=An(e,s.current);y(e);const{dataTransfer:n}=e;l(n)&&(n.effectAllowed="move",n.setData(`layer${bn}`,JSON.stringify(t)))},onDragEnd:e=>{const{dataTransfer:t}=e;if(!t)return;const{dropEffect:n}=t;"none"===n&&g.removeLayer(f)},onClick:e=>{e.stopPropagation(),g.selection.set(f)},onDragLeave:p,onDragOver:e=>{const t=(e=>{const{dataTransfer:t}=e,{current:r}=s;if(!r||!o(t))return n.None;const c=Rn(s.current),i=An(e,c),a=Math.ceil(c.height/4),l=Ne(f);return i.y<a*(l?1:2)?n.Before:!l||i.y>3*a?n.After:n.At})(e);a(t),m(f),de(e)},onDrop:d,draggable:!0});return e.createElement(ft,Object.assign({},v))}function os(t){const r=e.useContext(ss),{droppingLayer:c,setDroppingLayer:o,droppingPosition:i,setDroppingPosition:a,onDrop:l,onDragLeave:d}=r,u=an(),{className:m="content",children:g}=t,f=pt(t,["className","children"]),h=e.Children.only(g);p(e.isValidElement(h));const b=(e,t=0)=>e.flatMap((n=>n?y(n,t):(console.trace("layersArray no layer",t,e),[]))),y=(t,n)=>{const s={layer:t,depth:n},r={key:`layer-${t.id}`,value:s,children:e.createElement(cs,Object.assign({},h.props))},c=[e.createElement(Kn.Provider,Object.assign({},r))];return Ne(t)&&!t.collapsed&&c.push(...b(t.layers,n+1)),c},E=e.useMemo((()=>{var e;return b((null===(e=u.selection.cast)||void 0===e?void 0:e.layers)||[])}),[r.refreshed,r.selectedLayer]),v=e.useMemo((()=>{const e=[m];return i===n.None||c||e.push($),e.join(" ")}),[i,c,u.selection.layer]),O=Object.assign(Object.assign({},f),{children:E,key:"composer-view",onClick:()=>{u.selection.unset(s.Layer)},onDragLeave:d,onDragOver:e=>{e.preventDefault();const{dataTransfer:t}=e;(e=>!!e&&(!!Pn(e).includes("Files")||!!Tn(e)))(t)&&(a(E.length),o())},onDrop:l,className:v});return e.createElement(ft,Object.assign({},O))}function is(t){const n=e.useContext(Kn),{depth:s}=n,r=e.Children.only(t.children);if(!e.isValidElement(r))throw Vt.child;const c=new Array(s).fill(!0).map(((t,n)=>{const s=Object.assign(Object.assign({},r.props),{key:`depth-${n}`});return e.cloneElement(r,s)}));return e.createElement(e.Fragment,null,c)}function as(t){const n=e.useContext(ss),s=Qn();if(s.type!==V.Folder)return null;const r=s;if(r.collapsed)return null;const{children:c}=t,o=pt(t,["children"]),i=e.Children.only(c);if(!e.isValidElement(i))throw Vt.child;const a=Object.assign(Object.assign({},o),{onClick:()=>{r.collapsed=!0,n.refresh()}});return e.cloneElement(i,a)}function ls(t){const{children:n}=t,s=pt(t,["children"]),r=e.Children.only(n);if(!e.isValidElement(r))throw Vt.child;const c=e.useContext(ss),o=Qn();if(o.type!==V.Folder)return null;const i=o;if(!i.collapsed)return null;const a=Object.assign(Object.assign({},s),{onClick:()=>{i.collapsed=!1,c.refresh()}});return e.cloneElement(r,a)}function ds(t){return Qn().type!==V.Folder?null:e.createElement(e.Fragment,null,t.children)}function us(t){const n=Qn(),[s,r]=e.useState(n.label);Dt({[m.Action]:e=>{if(!we(e))return;const{action:t}=e.detail;Te(t)&&n===t.target&&r(n.label)}});const c=Object.assign(Object.assign({},t),{children:s});return e.createElement("label",Object.assign({},c))}function ms(t){return Qn().type!==V.Mash?null:e.createElement(e.Fragment,null,t.children)}function ps(t){const{useView:n,selected:s}=t,r=pt(t,["useView","selected"]);if(!n)return e.createElement("button",Object.assign({},r));const{disabled:c,className:o}=r,i=pt(r,["disabled","className"]),a=[v];o&&a.push(o),c?a.push(Pe):s&&a.push(je);const l=Object.assign(Object.assign({},i),{className:a.join(" ")});return e.createElement(ft,Object.assign({},l))}function gs(t){const n=an(),s=e.useContext(ss),{children:r}=t,c=pt(t,["children"]),o=e.Children.only(r);if(!e.isValidElement(o))throw Vt.child;const i=Object.assign(Object.assign({},c),{onClick:()=>{n.addFolder(),s.refresh()}});return e.cloneElement(o,i)}function fs(t){const n=an(),s=e.useContext(ss),{children:r}=t,c=pt(t,["children"]),o=e.Children.only(r);if(!e.isValidElement(o))throw Vt.child;const i=Object.assign(Object.assign({},c),{onClick:()=>{n.addMash(),s.refresh()}});return e.cloneElement(o,i)}const hs=function(t={}){var n,s,r,c,o,i;const a=Bt(t),{icons:l}=a;(n=a.props).key||(n.key="composer"),(s=a.props).className||(s.className="panel composer"),(r=a.props).initialPicked||(r.initialPicked="container"),(c=a.header).content||(c.content=[l.composer]),(o=a.footer).content||(o.content=[e.createElement(fs,null,e.createElement(ps,null,l.add,l.mmWide)),e.createElement(gs,null,e.createElement(ps,null,l.add,l.folder))]),(i=a.content).children||(i.children=e.createElement("div",{key:"layer",className:"layer"},e.createElement("div",{key:"icons"},e.createElement(is,{key:"depth"},e.createElement("div",{className:"depth"})),e.createElement(ds,{key:"layer-folder"},e.createElement(ls,{key:"folder-open"},e.createElement("div",{className:v},l.folder)),e.createElement(as,{key:"folder-close"},e.createElement("div",{className:v},l.folderOpen))),e.createElement(ms,{key:"layer-mash"},e.createElement("div",{key:"mash-icon",className:v},l.mmTube))),e.createElement(us,{key:"label"}),e.createElement("div",{key:"play-button",className:v},l.playerPlay)));const d=e.createElement(e.Fragment,null,e.createElement(Ut,Object.assign({},a.header)),e.createElement(os,Object.assign({},a.content.props),a.content.children),e.createElement(Ut,Object.assign({},a.footer)));return Object.assign(Object.assign({},a.props),{children:d})};function bs(t){const{children:n}=t,s=pt(t,["children"]),r=an(),c=()=>r.can(F.Save),[o,i]=e.useState(c),a=()=>{i(c())};Dt({[m.Action]:a,[m.Mash]:a,[m.Cast]:a,[m.Save]:a});const l=Object.assign(Object.assign({},s),{onClick:()=>{o||r.create()},disabled:o});return e.cloneElement(e.Children.only(n),l)}function ys(t){const[n,s]=e.useState(!0),r=an();Dt({[m.Action]:()=>{s(!r.can(F.Redo))}});const{children:c}=t,o=pt(t,["children"]),i=Object.assign(Object.assign({},o),{onClick:()=>{r.redo()},disabled:n});return e.cloneElement(e.Children.only(c),i)}function Es(t){const{children:n,type:r}=t,c=pt(t,["children","type"]),o=r||s.Clip;M(o);const i=an(),[a,l]=e.useState(!i.selection[o]);Dt({[m.Selection]:()=>{l(!i.selection[o])}});const d=e.Children.only(n),u=Object.assign(Object.assign(Object.assign({},c),d.props),{onClick:()=>{if(a)return;const e=i.selection[o];De(e)?i.removeEffect(e):Re(e)?i.removeClip(e):Ae(e)&&i.removeTrack(e)},disabled:a});return e.cloneElement(d,u)}function vs(t){const n=an(),[s,r]=e.useState(!0);Dt({[m.Action]:()=>{r(!n.can(F.Undo))}});const{children:c}=t,o=pt(t,["children"]),i=Object.assign(Object.assign({},o),{onClick:()=>{n.undo()},disabled:s});return e.cloneElement(e.Children.only(c),i)}function Os(t){const n=e.useContext(cn),s=e.useContext(Kt),{children:r}=t,c=pt(t,["children"]),{processing:o,setProcessing:i,setError:a}=n,{endpointPromise:l}=s,d=an(),u=()=>!d.can(F.Render),[p,g]=e.useState(u),f=()=>g(u());Dt({[m.Save]:f,[m.Mash]:f,[m.Action]:f});const h=(e,t)=>{setTimeout((()=>{console.debug("handleApiCallback request",e),Ce(e).then((n=>{console.debug("handleApiCallback response",n);const{apiCallback:s,error:r}=n;if(r)b(e.endpoint.prefix,e.request,n,r);else if(s){const{request:e,endpoint:n}=s;if(n.prefix===j.data.mash.put){const n=e.body,{rendering:s}=n.mash;s&&(t.rendering=s)}h(s,t)}else i(!1)}))}),2e3)},b=(e,t,n,s)=>{i(!1),a(s),console.error(e,t,n,s)},y=Object.assign(Object.assign({},c),{onClick:()=>{if(p||o)return;const{edited:e}=d;ge(e),i(!0);const t={mash:e.toJSON(),definitions:d.definitions.map((e=>e.toJSON())),outputs:[{outputType:$e.Video}]};console.debug("RenderingStartRequest",j.rendering.start,t),l(j.rendering.start,t).then((n=>{console.debug("RenderingStartResponse",j.rendering.start,n);const{apiCallback:s,error:r}=n;r?b(j.rendering.start,t,n,r):h(s,e)}))},disabled:p||o});return e.cloneElement(e.Children.only(r),y)}function js(t){const n=an(),s=e.useContext(Pt),{save:r}=s,c=()=>!n.can(F.Save),[o,i]=e.useState(c),a=()=>{i(c())};Dt({[m.Action]:a,[m.Save]:a});const{children:l}=t,d=pt(t,["children"]),u=Object.assign(Object.assign({},d),{onClick:()=>{o||(i(!0),r())},disabled:o});return e.cloneElement(e.Children.only(l),u)}const ks={actionCount:0,selectedInfo:{tweenDefined:{},tweenSelected:{},selectedType:s.None,selectTypes:[]},selectedItems:[],changeSelected:t,changeTweening:t},Cs=e.createContext(ks);function Ss(t){var n,s;const r=an(),[c,o]=e.useState(!1),[i,a]=e.useState((()=>[])),[l,u]=e.useState((null===(n=r.edited)||void 0===n?void 0:n.id)||""),p=e.useContext(Kt),g=e.useContext(Cs),{selectedInfo:h}=g,{selectedType:y}=h,[E,v]=e.useState((null===(s=r.edited)||void 0===s?void 0:s.label)||""),O=()=>r.can(F.Save),[k,C]=e.useState(O),{enabled:S,servers:x,endpointPromise:N}=p,w=()=>{C(O())},T=e=>{const{type:t}=e;if(!Ee(t)||!z(t))return;if(t!==y)return;const{edited:n}=r;b(n);const{id:s,label:c}=n;a((e=>{const t=e.filter((e=>d(e.label))),r=t.findIndex((e=>e.id===s));return f(r)?t.splice(r,1,n):t.push(n),u(s),v(c),t}))};Dt({[m.Action]:()=>{const{edited:e}=r;b(e);const{label:t}=e;E!==t&&(a((e=>[...e])),v(t)),w()},[m.Mash]:T,[m.Cast]:T,[m.Save]:w},r.eventTarget);e.useEffect((()=>{if(!S||!x[q.Data])return;if(c)return;o(!0);const e={partial:!0},t=j.data[r.editType].retrieve;console.debug("RetrieveRequest",t,e),N(t,e).then((e=>{console.debug("RetrieveResponse",t,e);const{described:n,error:s}=e;s?console.error("RetrieveResponse",t,s):a((e=>{const t=[...e];return n.forEach((e=>{const{id:n}=e,s=t.find((e=>e.id===n));s||t.push(e)})),t}))}))}),[x,S]);const P=Object.assign(Object.assign({},t),{onChange:e=>{if(k)return;const{selectedIndex:t}=e.target,n=i[t];b(n);const{id:s}=n,c={id:s},{editType:o}=r,a=j.data[o].get;console.debug("GetRequest",a,c),N(a,c).then((e=>{console.debug("GetResponse",a,e);const{error:t}=e;if(!t)return r.load(e);console.error("GetResponse",a,t)}))},disabled:k,children:(()=>{const{editType:t,edited:n}=r,s=[e.createElement("optgroup",{key:"group",label:vt("open")})];if(!n)return s;const{id:c,label:o}=n;return s.push(...i.map((n=>{const{label:s,id:r}=n,i=r===c?o:s,a={children:d(i)?i:Ot("unlabeled",{type:t}),value:r,key:r};return e.createElement("option",Object.assign({},a))}))),s})(),value:l});return e.createElement("select",Object.assign({},P))}function xs(t){const n=an(),s=()=>{const{edited:e}=n;if(!ze(e))return!0;const{rendering:t}=e;return!t},[r,c]=e.useState(s),o=()=>c(s());Dt({[m.Render]:o,[m.Mash]:o});const{children:i}=t,a=pt(t,["children"]),l=Object.assign(Object.assign({},a),{onClick:()=>{if(r)return;const{edited:e}=n;ge(e);const t=Ie(n.preloader.endpoint,e.rendering);window.open(t)},disabled:r});return e.cloneElement(e.Children.only(i),l)}const Ns=e.createElement((function(e){return null}),{key:"empty"}),ws="tween-input-key",Ts={[r.Frame]:Ns,[r.Number]:Ns,[r.Rgb]:Ns,[r.String]:Ns,[r.DefinitionId]:Ns,[r.FontId]:Ns,[r.Percent]:Ns,[r.ContainerId]:Ns,[r.ContentId]:Ns,[r.Boolean]:Ns,[r.Timing]:Ns,[r.Sizing]:Ns},Ps={value:"",name:"",property:{type:r.String,name:"",defaultValue:""}},Ds=e.createContext(Ps);function Rs(){const t=e.useContext(Ds),{changeHandler:n,property:s,value:r,name:c}=t;if(!s)return null;const o={type:"checkbox",name:c,checked:!!r};return n?o.onChange=e=>{n(c,e.target.checked)}:o.disabled=!0,e.createElement("input",Object.assign({},o))}function As(t){const{type:n,types:s,children:r,className:c}=t,o=pt(t,["type","types","children","className"]),i=e.Children.only(r);p(e.isValidElement(i));const[a,l]=e.useState(!1),d=e.useContext(Ds),u=e.useContext(Pt),{drop:m}=u,{changeHandler:g,value:f,name:h}=d;p(g);const b=Hn(n,s),y=e=>{const{dataTransfer:t}=e;p(t);if(Pn(t).includes("Files"))return!0;const n=Tn(t);return!!w(n)&&b.includes(n)},E=e.useMemo((()=>{const e=[];return c&&e.push(c),a&&e.push($),e.join(" ")}),[a]),v=Object.assign(Object.assign({},o),{className:E,children:(()=>{if(!f)return null;S(f);const t=U.fromId(f);Le(t);const n={definition:t,key:t.id},s={children:e.cloneElement(i,n),value:{definition:t}};return e.createElement(hn.Provider,Object.assign({},s))})(),onDragLeave:()=>{l(!1)},onDragOver:e=>{const t=y(e);l(t),t&&e.preventDefault()},onDrop:e=>gt(this,void 0,void 0,(function*(){if(de(e),l(!1),!y(e))return;const{dataTransfer:t}=e;p(t);if(Pn(t).includes("Files"))return void(yield m(t.files).then((e=>{if(!e.length)return;const t=e.filter((e=>"containerId"!==h||He(e))),[n]=t;n&&(p(U.installed(n.id),`${n.type} installed`),g(h,n.id))})));const n=Nn(t),s=t.getData(n),r=JSON.parse(s),{definitionObject:c}=r,[o]=U.define(c);("containerId"!==h||He(o))&&g(h,c.id)})),value:String(f),key:`${h}-drop`});return e.createElement(ft,Object.assign({},v))}function $s(){const t=e.useContext(Ds),{changeHandler:n,value:s,name:r}=t;p(n);const c={children:U.byType(B.Font).map((t=>{const{id:n,label:s}=t,r={value:n,children:s,key:n};return e.createElement("option",Object.assign({},r))})),name:r,onChange:e=>{n(r,e.target.value)},value:String(s),key:`${r}-select`};return e.createElement("select",Object.assign({},c))}function zs(){const t=e.useContext(Ds),n=an(),{changeHandler:s,property:r,value:c,name:o,time:i}=t;if(!r)return null;const{min:a,max:l,step:d}=r,u={type:"number",name:o,value:String(c)};return W(a)&&(u.min=a),W(l)&&(u.max=l),W(d)&&(u.step=d),s?u.onChange=e=>gt(this,void 0,void 0,(function*(){const{value:t}=e.target;i&&(yield n.goToTime(i)),s(o,t)})):u.disabled=!0,e.createElement("input",Object.assign({},u))}function Is(t){const{className:n,onChange:s}=t,r=Object.assign({},t),c=["slider"];if(n&&c.push(n),r.className=c.join(" "),s){const e=e=>{s(e,e.currentTarget.valueAsNumber)};r.onChange=e}return e.createElement("input",Object.assign({type:"range"},r))}function Ls(){const t=an(),n=e.useContext(Ds),{changeHandler:s,property:r,value:c,name:o,time:i,defaultValue:a}=n;if(!r)return null;const{max:l,min:d,step:u,defaultValue:m}=r,p={value:W(c)?c:W(a)?a:m,min:J(d)?d:0,max:J(l)?l:1,step:J(u)?u:.01,name:o};if(s){const e=(e,n)=>gt(this,void 0,void 0,(function*(){const e=D(n)?n[0]:n;i&&(yield t.goToTime(i)),s(o,e)}));p.onChange=e}else p.disabled=!0;return e.createElement(Is,Object.assign({className:"slider"},p))}function Hs(){e.useContext(Pt);const t=e.useContext(Ds),n=an(),{changeHandler:s,property:r,value:c,name:o,time:i,defaultValue:a}=t;if(!r)return null;const{defaultValue:l}=r,d=W(c)?c:W(a)?a:l,u={type:"color",name:o,value:String(d)};return s?u.onChange=e=>gt(this,void 0,void 0,(function*(){const{value:t}=e.target;i&&(yield n.goToTime(i)),s(o,t)})):u.disabled=!0,e.createElement("input",Object.assign({},u))}function Vs(){const t=e.useContext(Ds),{changeHandler:n,property:s,value:r,name:c}=t;if(!s)return null;const o={children:G.map((t=>{const n={value:t,children:t,key:t};return e.createElement("option",Object.assign({},n))})),name:c,value:String(r),key:`${c}-select`};return n?o.onChange=e=>{n(c,e.target.value)}:o.disabled=!0,e.createElement("select",Object.assign({},o))}function Fs(){const t=e.useContext(Ds),{changeHandler:n,property:s,value:r,name:c}=t;if(!s)return null;const o={name:c,type:"text",value:String(r)};return n?o.onChange=e=>{n(c,e.target.value)}:o.disabled=!0,e.createElement("input",Object.assign({},o))}function Ms(){const t=e.useContext(Ds),{changeHandler:n,property:s,value:r,name:c}=t;if(!s)return null;const o={children:X.map((t=>{const n={value:t,children:t,key:t};return e.createElement("option",Object.assign({},n))})),name:c,value:String(r),key:`${c}-select`};return n?o.onChange=e=>{n(c,e.target.value)}:o.disabled=!0,e.createElement("select",Object.assign({},o))}Ts[r.Boolean]=e.createElement(Rs,null),Ts[r.ContainerId]=e.createElement(As,{types:c,className:"definition-drop"},e.createElement(Un,{className:"definition preview"})),Ts[r.ContentId]=e.createElement(As,{types:o,className:"definition-drop"},e.createElement(Un,{className:"definition preview"})),Ts[r.FontId]=e.createElement($s,null),Ts[r.Number]=e.createElement(zs,null),Ts[r.Frame]=e.createElement(zs,null),Ts[r.Percent]=e.createElement(Ls,null),Ts[r.Rgb]=e.createElement(Hs,null),Ts[r.Sizing]=e.createElement(Vs,null),Ts[r.String]=e.createElement(Fs,null),Ts[r.Timing]=e.createElement(Ms,null);const qs={[i.Size]:Ns,[i.Sizing]:Ns,[i.Point]:Ns,[i.Opacity]:Ns,[i.Color]:Ns,[i.Effects]:Ns,[i.Timing]:Ns};function Us(t){const n=e.useContext(Pt),{icons:s}=n,r=an(),{selectType:c}=t,o=pt(t,["selectType"]);M(c);const a=e.useContext(Cs),{selectedItems:l,changeTweening:d,selectedInfo:u}=a,{tweenDefined:m,tweenSelected:p,onEdge:g,time:f,nearStart:h,timeRange:b}=u;Z(b),Y(f);const y=m[i.Color],E=p[i.Color],O=_(l,i.Color,c),{color:j,[`color${te}`]:k}=O,C=E?k:j,{property:S,changeHandler:x,value:N,name:w}=C,{type:T,name:P}=S,D=w||P,R=Ts[T],A={property:S,value:N,name:D,changeHandler:x};A.time=K(b,g,h,y,E),E&&(A.defaultValue=j.value);const $=[je,v].join(" "),z={children:s.start,className:E?v:$,key:"start",onClick:()=>{r.goToTime(b.startTime),d(i.Color,!1)}},I={key:"end",className:E?$:v,children:y?s.end:s.endUndefined,onClick:()=>{r.goToTime(b.lastTime),d(i.Color,!0)}},L={key:"context",value:A,children:R},H=Object.assign(Object.assign({},o),{key:`inspector-${c}-${D}`,children:[s.color,e.createElement(Ds.Provider,Object.assign({},L)),e.createElement(ft,{className:"start-end",key:"start-end"},e.createElement(ft,Object.assign({},z)),e.createElement(ft,Object.assign({},I)))]});return e.createElement(ft,Object.assign({},H))}qs[i.Color]=e.createElement(Us,{className:"color tween row",key:"color-group-input"});const Bs=(e,t)=>{if(!t||!e)return;const{width:n,height:s}=t;e.style.setProperty("--preview-width",`${n}px`),e.style.setProperty("--preview-height",`${s}px`)},Ws=e=>globalThis.window.sessionStorage.getItem(e)||"",Js=(e,t)=>{globalThis.window.sessionStorage.setItem(e,String(t))},Gs=e.forwardRef(((t,n)=>e.createElement("video",Object.assign({},t,{ref:n}))));function Xs(t){const{className:n,removeHandler:s,index:r,effect:c,selectedEffect:o,setSelectedEffect:i}=t,a=pt(t,["className","removeHandler","index","effect","selectedEffect","setSelectedEffect"]),l=o===c,d=()=>{l||i(c)},u=[n||"effect"];l&&u.push(je);const m=Object.assign(Object.assign({},a),{children:c.label,className:u.join(" "),onMouseDown:d,onDragStart:e=>{l||d();const t={index:r},n=JSON.stringify(t),{dataTransfer:s}=e;s&&(s.effectAllowed="move",s.setData(`effect${bn}`,n))},onDragEnd:e=>{const{dataTransfer:t}=e;if(!t)return;const{dropEffect:n}=t;"none"===n&&s(c)},onClick:e=>e.stopPropagation(),draggable:!0});return e.createElement(ft,Object.assign({},m))}function Zs(t){const{defaultValue:n,changeHandler:s,time:r,property:c,value:o,name:i}=t,{type:a,defaultValue:l}=c,d={key:"context",value:{property:c,value:o,changeHandler:s,name:i,time:r,defaultValue:W(n)?n:l},children:Ts[a]};return e.createElement(Ds.Provider,Object.assign({},d))}function Ys(t){const n=e.useContext(Pt),{icons:r}=n,c=e.useContext(Cs),{selectedItems:o}=t,{selectedItems:i}=c,a=o||i,l=[],d=[],u={},m=new Set;return a.forEach((n=>{if(Q(n)){const{property:s,changeHandler:c,selectType:o,value:i,name:a}=n,{name:p,group:g}=s;if(g){const t=[g,o].join("-");return void(u[t]||(u[t]=!0,d.push(e.cloneElement(qs[g],{selectType:o}))))}const f=a||p;m.add(o);const h=Object.assign({key:`inspector-${o}-${f}`,property:s,value:i,changeHandler:c,name:f},t),b=r[f],y=e.createElement(Zs,Object.assign({},h));if(b){const t=[y];t.unshift(b);const n={children:t,className:"row",key:`icon-${o}-${f}`};l.push(e.createElement(ft,Object.assign({},n)))}else l.push(y)}else{const t={key:"inspector-effects",selectedEffects:n};d.push(e.cloneElement(qs.effects,t))}})),m.has(s.Clip)&&l.push(),e.createElement(e.Fragment,null,l,d)}function _s(t){const n=e.useContext(Pt),{icons:s}=n,{selectedEffects:r}=t,c=pt(t,["selectedEffects"]),o=e.useRef(null),[i,a]=e.useState(!1),[d,u]=e.useState(null),m=an(),{actions:g}=m;p(r);const{value:f,addHandler:h,removeHandler:b,moveHandler:y}=r,E=d&&f.includes(d)?d:null;E!==d&&u(E);const v=e=>{const{dataTransfer:t}=e;return Tn(t)===B.Effect},O=e.useMemo((()=>{const e=["list"];return i&&e.push($),e.join(" ")}),[i]),j={children:f.map(((t,n)=>{const s={key:t.id,selectedEffect:E,setSelectedEffect:u,effect:t,index:n,removeHandler:b};return e.createElement(Xs,Object.assign({},s))})),ref:o,onDragLeave:()=>{a(!1)},onDragOver:e=>{const t=v(e);a(t),t&&e.preventDefault()},onDrop:e=>{if(a(!1),!v(e))return;e.preventDefault();const{dataTransfer:t}=e;if(!t)return;const n=Nn(t),s=t.getData(n),r=JSON.parse(s),{definitionObject:c,index:o}=r,i=(e=>{const{target:t}=e;if(t&&t instanceof HTMLDivElement){const e=t.getAttribute("index");if(e)return Number(e)}return f.length})(e);if(l(c)){const e=U.fromObject(c);if(Fe(e)){const t=e.instanceFromObject();h(t,i)}}else{if(i===o)return;Ve(E),y(E,i)}},onClick:()=>{u(null)},key:"view",className:O},k=Object.assign(Object.assign({},c),{key:"effects",children:[s.browserEffect,e.createElement(ft,Object.assign({},j))]}),C=e.createElement(ft,Object.assign({},k));return E?e.createElement(e.Fragment,null,C,e.createElement(Ys,{selectedItems:E.selectedItems(g)})):C}function Ks(t){const n=e.useContext(Pt),{icons:s}=n,r=an(),{selectType:c}=t,o=pt(t,["selectType"]);M(c);const a=e.useContext(Cs),{selectedItems:l,changeTweening:d,selectedInfo:u}=a,{tweenDefined:m,tweenSelected:p,onEdge:g,time:f,nearStart:h,timeRange:b}=u;Z(b),Y(f);const y=m[i.Opacity],E=p[i.Opacity],O=_(l,i.Opacity,c),{opacity:j,[`opacity${te}`]:k}=O,C=E?k:j,{property:S,changeHandler:x,value:N,name:w}=C,{type:T,name:P}=S,D=w||P,R=Ts[T],A={property:S,value:N,name:D,changeHandler:x};A.time=K(b,g,h,y,E),E&&(A.defaultValue=j.value);const $=[je,v].join(" "),z={children:s.start,className:E?v:$,key:"start",onClick:()=>{r.goToTime(b.startTime),d(i.Opacity,!1)}},I={key:"end",className:E?$:v,children:y?s.end:s.endUndefined,onClick:()=>{r.goToTime(b.lastTime),d(i.Opacity,!0)}},L={key:"context",value:A,children:R},H=Object.assign(Object.assign({},o),{key:`inspector-${c}-${D}`,children:[s.opacity,e.createElement(Ds.Provider,Object.assign({},L)),e.createElement(ft,{className:"start-end",key:"start-end"},e.createElement(ft,Object.assign({},z)),e.createElement(ft,Object.assign({},I)))]});return e.createElement(ft,Object.assign({},H))}function Qs(t){const n=e.useContext(Pt),{icons:s}=n,r=an(),{selectType:c}=t;M(c);const o=e.useContext(Cs),{selectedItems:a,changeTweening:l,selectedInfo:d}=o,{tweenDefined:u,tweenSelected:m,onEdge:p,time:g,nearStart:f,timeRange:h}=d;Z(h),Y(g);const b=u[i.Point],y=m[i.Point],E=_(a,i.Point,c),O=ee(E),{offE:j,offW:k,offN:C,offS:S,x:x,y:N,[`x${te}`]:w,[`y${te}`]:T}=E,P=y?w:x,D=y?T:N,{offE:R,offW:A,offN:$,offS:z}=O,I={},L=[P,D],H=K(h,p,f,b,y);L.forEach((t=>{if(!t)return void console.error("PointInput",P,D);const{property:n,changeHandler:s,value:r,name:o}=t,{type:i,name:a}=n,l=o||a,d=l.replace(te,""),u=Ts[i],m=`inspector-${c}-${l}`,p={property:n,value:r,name:l,changeHandler:s,time:H};y&&(p.defaultValue=O[d]);const g={key:m,value:p,children:u};I[d]=e.createElement(Ds.Provider,Object.assign({},g))}));const V=[je,v].join(" "),F={children:s.start,className:y?v:V,key:"start",onClick:()=>{r.goToTime(h.startTime),l(i.Point,!1)}},q={key:"end",className:y?V:v,children:b?s.end:s.endUndefined,onClick:()=>{r.goToTime(h.lastTime),l(i.Point,!0)}},U=[s.point,e.createElement(ft,{className:"start-end",key:`${c}-point-start-end`},e.createElement(ft,Object.assign({},F)),e.createElement(ft,Object.assign({},q)))],B={key:"lock-east",className:v,children:R?s.unlock:s.lock,onClick:()=>{j.changeHandler("offE",!R)}},W=e.createElement(ft,Object.assign({},B)),J={key:"lock-west",className:v,children:A?s.unlock:s.lock,onClick:()=>{k.changeHandler("offW",!A)}},G=e.createElement(ft,Object.assign({},J)),X={key:"lock-north",className:v,children:$?s.unlock:s.lock,onClick:()=>{C.changeHandler("offN",!$)}},Q=e.createElement(ft,Object.assign({},X)),ne={key:"lock-south",className:v,children:z?s.unlock:s.lock,onClick:()=>{S.changeHandler("offS",!z)}},se=e.createElement(ft,Object.assign({},ne)),re=[e.createElement(ft,{key:"x",className:"point",children:[s.horz,W,I.x,G]}),e.createElement(ft,{key:"y",className:"point",children:[s.vert,Q,I.y,se]})];return e.createElement("fieldset",null,e.createElement("legend",{key:"legend"},e.createElement(ft,null,U)),re)}qs[i.Effects]=e.createElement(_s,{className:"effects row",key:"effects-group-input"}),qs[i.Opacity]=e.createElement(Ks,{className:"opacity tween row",key:"opacity-group-input"}),qs[i.Point]=e.createElement(Qs,{key:"point-input"});const er={[a.H]:"width",[a.V]:"height"};function tr(t){const n=e.useContext(Pt),{icons:s}=n,r=an(),{selectType:c}=t;M(c);const o=e.useContext(Cs),{selectedItems:l,selectedInfo:d,changeTweening:u}=o,{tweenDefined:m,tweenSelected:p,onEdge:g,time:f,nearStart:h,timeRange:b}=d;Z(b),Y(f);const y=m[i.Size],E=p[i.Size],O=_(l,i.Size,c),{lock:j,width:k,height:C,[`width${te}`]:S,[`height${te}`]:x}=O,N=E?S:k,w=E?x:C,T=ee(O),{lock:P}=T;ne(P);const D=se(P)?P:void 0,R={},A=[N,w],$=K(b,g,h,y,E);A.forEach((t=>{const{property:n,changeHandler:s,value:r,name:o}=t,{type:i,name:a}=n,l=o||a,d=l.replace(te,""),u=Ts[i],m=`inspector-${c}-${l}`,p={property:n,value:r,name:l,time:$};E&&(p.defaultValue=T[d]),D&&d===er[D]||(p.changeHandler=s);const g={key:m,value:p,children:u};R[d]=e.createElement(Ds.Provider,Object.assign({},g))}));const z={key:"lock-width",className:v,children:D===a.H?s.lock:s.unlock,onClick:()=>{const e=D===a.H?"":a.H;j.changeHandler("lock",e)}},I=e.createElement(ft,Object.assign({},z)),L={key:"lock-height",className:v,children:D===a.V?s.lock:s.unlock,onClick:()=>{const e=D===a.V?"":a.V;j.changeHandler("lock",e)}},H=[je,v].join(" "),V=e.createElement(ft,Object.assign({},L)),F={children:s.start,className:E?v:H,key:"start",onClick:()=>{r.goToTime(b.startTime),u(i.Size,!1)}},q={key:"end",className:E?H:v,children:y?s.end:s.endUndefined,onClick:()=>{r.goToTime(b.lastTime),u(i.Size,!0)}},U=[s.size,e.createElement(ft,{className:"start-end",key:`${c}-size-start-end`},e.createElement(ft,Object.assign({},F)),e.createElement(ft,Object.assign({},q)))],B=[e.createElement(ft,{key:"width",className:"size",children:[s.width,R.width,I]}),e.createElement(ft,{key:"height",className:"size",children:[s.height,R.height,V]})];return e.createElement("fieldset",null,e.createElement("legend",{key:"legend"},e.createElement(ft,null,U)),B)}function nr(t){const{selectType:n}=t;M(n);const s=e.useContext(Cs),{selectedItems:r}=s,c=_(r,i.Sizing,n),o=Object.fromEntries(Object.entries(c).map((([n,s])=>{const{property:r,changeHandler:c,selectType:o,value:i,name:a}=s,{name:l}=r,d=a||l,u=Object.assign({key:`inspector-${o}-group-${d}`,property:r,value:i,changeHandler:c,name:d},t);return[n,e.createElement(Zs,Object.assign({},u))]})));return e.createElement(ft,null,Object.values(o))}function sr(t){const n=e.useContext(Pt),{icons:s}=n,{selectType:r}=t;M(r);const c=e.useContext(Cs),{selectedItems:o}=c,a=_(o,i.Timing,r),l=Object.fromEntries(Object.entries(a).map((([n,s])=>{const{property:r,changeHandler:c,selectType:o,value:i,name:a}=s,{name:l}=r,d=a||l,u=Object.assign({key:`inspector-${o}-group-${d}`,property:r,value:i,changeHandler:c,name:d},t);return[n,e.createElement(Zs,Object.assign({},u))]}))),{timing:d}=l,u=pt(l,["timing"]);if(!T(u)){const t={key:"timing",children:[s.timing,d],className:"row"};return e.createElement(ft,Object.assign({},t))}const m=[s.timing];d&&m.push(d);const p=Object.entries(u).map((([t,n])=>{const r=s[t],c=[n];r&&c.unshift(r);const o={className:"timing",key:"timing",children:c};return e.createElement(ft,Object.assign({},o))}));return e.createElement("fieldset",null,e.createElement("legend",{key:"legend"},e.createElement(ft,null,m)),p)}function rr(t){const n=an(),[r,c]=e.useState((()=>0)),o=e.useRef({tweenDefined:{},tweenSelected:{},selectedType:s.None,selectTypes:[]}),[i,a]=e.useState((()=>re)),[l,d]=e.useState((()=>[])),u=()=>{c((e=>e+1))},g=()=>{const{selection:e}=n,{selectTypes:t,clip:s,mash:r}=e,{current:c}=o,{selectedType:a,selectTypes:l}=c,m=i.find((e=>t.includes(e)));M(m),m!==a&&(c.selectedType=m),oe(l,t);const p=n.selection.selectedItems([m]),g={};if(s&&r){const e=p.filter((e=>{if(!Q(e))return;const{property:t,name:n}=e,{tweenable:s,group:r}=t;return s&&r&&n?n.endsWith(te):void 0}));if(e.forEach((e=>{const{property:t,value:n}=e,{group:s}=t;Me(s),g[s]=W(n)})),e.length){const{time:e,quantize:t}=r,n=s.timeRange(t);c.time=e,c.timeRange=n;const o=n.frame+Math.round(n.frames/2),i=qe(o,t),[a,l]=Ue(i,e);c.nearStart=a.frame>l.frame;const d=c.nearStart?n.startTime:n.lastTime;c.onEdge=e.equalsTime(d)}}c.tweenDefined=g,d(p),u()};Dt({[m.Action]:u,[m.Selection]:g});const f=e.useCallback((e=>{M(e),a((t=>{const n=t.indexOf(e);ce(n);const s=[e];return n&&s.push(...t.slice(0,n)),n<t.length-1&&s.push(...t.slice(n+1)),p(s.length===t.length,"type lengths match"),oe(t,s),g(),t})),o.current.selectedType=e,d(n.selection.selectedItems([e]))}),[]),h=Object.assign(Object.assign({},ks),{actionCount:r,selectedItems:l,changeSelected:f,changeTweening:(e,t)=>{o.current.tweenSelected[e]=t,g()},selectedInfo:o.current});return e.createElement(Cs.Provider,{value:h},e.createElement(ft,Object.assign({},t)))}function cr(t){return e.createElement(ft,Object.assign({},t))}function or(t){const n=e.useContext(Cs),{selectedInfo:s}=n,{selectedType:r}=s,{type:c,types:o,children:i}=t,a=Vn(c,o);return ie(a),a.includes(r)?e.createElement(e.Fragment,null,i):null}function ir(t){const{id:n,children:s,className:r}=t;M(n);const c=e.useContext(Cs),{changeSelected:o,selectedInfo:i}=c,{selectTypes:a,selectedType:l}=i;if(!a.includes(n))return null;const u=[];d(r)&&u.push(r),l===n&&u.push(je);const m={children:s,onClick:()=>{o(n)},className:u.join(" ")};return e.createElement(ft,Object.assign({},m))}qs[i.Size]=e.createElement(tr,{key:"size-group-input"}),qs[i.Sizing]=e.createElement(nr,{key:"sizing-group-input"}),qs[i.Timing]=e.createElement(sr,{key:"timing-group-input"});const ar=function(t={}){var n,r,c,o,i;const a=Bt(t),{icons:l}=a;(n=a.props).key||(n.key="inspector"),(r=a.props).className||(r.className="panel inspector"),(c=a.header).content||(c.content=[l.inspector]),(o=a.footer).content||(o.content=[e.createElement(ir,{key:"mash",className:v,id:"mash"},l.document),e.createElement(ir,{key:"cast",className:v,id:"cast"},l.document),e.createElement(ir,{key:"layer",className:v,id:"layer"},l.composer),e.createElement(ir,{key:"clip",className:v,id:"clip"},l.clip),e.createElement(ir,{key:"container",className:v,id:"container"},l.container),e.createElement(ir,{key:"content",className:v,id:"content"},l.content)]);const d=[e.createElement(Ys,{key:"properties"})],u=[s.Clip,s.Track,s.Layer];d.push(e.createElement(en,{key:"api-enabled"},e.createElement(or,{type:"mash",key:"inspector-mash"},e.createElement(ft,null,e.createElement(Os,{key:"render-process"},e.createElement(ps,null,vt("render"),l.render)),e.createElement(xs,{key:"view-control"},e.createElement(ps,null,vt("view"),l.view)))),e.createElement(or,{types:"mash,cast",key:"inspector-document"},e.createElement(Ss,{key:"select-edited"}),e.createElement(ft,{key:"view"},e.createElement(js,{key:"save-process"},e.createElement(ps,{key:"button"},vt("update"),l.document)),e.createElement(bs,{key:"create-edited"},e.createElement(ps,null,vt("create"),l.document)))))),u.forEach((t=>{d.push(e.createElement(or,{key:`${t}-delete`,type:t},e.createElement(Es,{type:t},e.createElement(ps,null,Ot("delete",{type:t}),l.remove))))})),(i=a.content).children||(i.children=e.createElement(e.Fragment,null,d));const m=e.createElement(e.Fragment,null,e.createElement(Ut,Object.assign({},a.header)),e.createElement(cr,Object.assign({},a.content.props),a.content.children),e.createElement(Ut,Object.assign({},a.footer)));return Object.assign(Object.assign({},a.props),{children:m})};function lr(t){const{editType:n=ae.Mash,previewSize:s,icons:r={},edited:c}=t,o=pt(t,["editType","previewSize","icons","edited"]),i=e.useRef({}),a=e.useRef(null),{current:l}=i,[d,u]=e.useState(),p=e.useRef(null),g=e.useContext(Kt),[f]=e.useState((()=>le({editType:n}))),[h,y]=e.useState(!1),[E,v]=e.useState(),{enabled:O,endpointPromise:k,servers:C}=g;e.useEffect((()=>{Bs(p.current,s)}),[s]);const S=e=>{const t=e||c||{[n]:{},definitions:[]},{previewSize:r=s}=t,o=pt(t,["previewSize"]),{current:i}=a,{current:l}=p;b(i),me(r)&&Bs(l,r),f.svgElement=i,f.load(o)};e.useEffect((()=>{if(O){if(!h&&C[q.Data]){y(!0);const e={};k(j.data[n].default,e).then((e=>{var t;console.debug("DataDefaultResponse",j.data[n].default,e),pt(e,["previewSize"]),(null===(t=C.file)||void 0===t?void 0:t.prefix)&&(f.preloader.endpoint.prefix=String(C.file.prefix)),S(e)}))}}else S()}),[C]);const x=(e,t,n)=>{console.debug("handleApiCallback request",n);const{eventTarget:s}=f;return Ce(n).then((r=>{console.debug("handleApiCallback response",r);const{apiCallback:c,error:o}=r;if(o)return N(n.endpoint.prefix,o,e);if(c){const{request:o,endpoint:i}=c;if(i.prefix===j.data.definition.put){b(o);const{body:e}=o;b(e);const n=e,{definition:s}=n;console.debug("handleApiCallback calling updateDefinition",s),f.updateDefinition(s,t)}if(n.endpoint.prefix===j.rendering.status){const t=r;let n=0,c=0;ut.forEach((e=>{const s=t[e];s&&(n+=s.total,c+=s.completed)})),n&&s.emit(m.Activity,{id:e,step:c,steps:n,type:ve.Render})}return new Promise((e=>{setTimeout(e,2e3)})).then((()=>x(e,t,c)))}s.emit(m.Activity,{id:e,type:ve.Complete})}))},N=(e,t,n)=>(f.eventTarget.emit(m.Activity,{id:n,type:ve.Error,error:"import.render",value:t}),console.error(e,t),Promise.reject(t)),w=e=>{u(e)},T={editor:f,draggable:E,setDraggable:v,save:()=>gt(this,void 0,void 0,(function*(){const{definitionsUnsaved:e}=f,t=(e=>{let t=Promise.resolve();const{eventTarget:n}=f;return e.forEach((e=>{dt(e);const{label:s,type:r,source:c}=e,o=ct("activity");n.emit(m.Activity,{id:o,label:s,type:ve.Render});const{rendering:i}=j,a=fetch(c).then((e=>e.blob())).then((e=>new File([e],s))).then((t=>{const n={type:r,name:s,size:t.size};return console.debug("RenderingUploadRequest",i.upload,n),k(i.upload,n).then((n=>{console.debug("RenderingUploadResponse",i.upload,n);const{error:s,fileApiCallback:r,apiCallback:c,fileProperty:a}=n;return s?N(i.upload,s,o):r&&r.request?(a?r.request.body[a]=t:r.request.body=t,Ce(r).then((t=>{console.debug("FileStoreResponse",t);const{error:n}=t;return n?N(r.endpoint.prefix,n,o):(b(c),x(o,e,c))}))):(b(c),x(o,e,c))}))}));t=t.then((()=>a))})),t})(e),n=t.then((()=>f.dataPutRequest())).then((e=>{const{editType:t}=f;console.debug("DataPutRequest",j.data[t].put,JSON.parse(JSON.stringify(e))),k(j.data[t].put,e).then((e=>{console.debug("DataPutResponse",j.data[t].put,e);const{error:n,temporaryIdLookup:s}=e;n?console.error(j.data[t].put,n):f.saved(s)}))}));yield n})),editorIndex:l,drop:(e,t)=>e?Re(e)||De(e)||Xe(e)?Promise.resolve([]):Ze(e)?((e,t)=>f.add(e,t))(e,t):Ye(e)?Promise.resolve([]):((e,t)=>{const n=$n(e,C.file);if(n.length){const e=[],s=[],{eventTarget:r}=f;if(n.forEach((t=>{t instanceof File?s.push(t):e.push(t)})),e.length&&e.forEach((e=>{const t=ct("activity-error"),n=Object.assign({id:t,type:ve.Error},e);r.emit(m.Activity,n)})),s.length)return f.addFiles(s,t)}return Promise.resolve([])})(e,t).then((e=>{const[t]=e;return _e(t)&&w(t),e})):Promise.resolve([]),definition:d,changeDefinition:w,icons:r},P=Object.assign(Object.assign({},o),{onDrop:de,ref:p});return e.createElement(Pt.Provider,{value:T},e.createElement(ft,Object.assign({},P)),e.createElement("svg",{style:{display:"none"},ref:a}))}const dr={paused:!1,changePaused:t,changeVolume:t,volume:0},ur=e.createContext(dr);function mr(n){const{children:r,className:c}=n,o=pt(n,["children","className"]),i=an(),[a,l]=e.useState((()=>ue(i.rect))),d=e.useRef(null),u=e.useRef(null),p=e.useContext(Pt),[g,f]=e.useState(!1),h=e.useContext(ur),{disabled:y}=h,{drop:E}=p,v=e.useRef({}),{current:O}=v,[j]=e.useState(new ResizeObserver((()=>{const{current:e}=u;if(!e)return;const t=Be(e.getBoundingClientRect());l((()=>(i.rect=t,ue(t))))})));e.useEffect((()=>{const{current:e}=u;return e&&j.observe(e),()=>{j.disconnect()}}),[]);const k=()=>{const{redraw:e}=O;return delete O.timeout,delete O.redraw,i.svgItems(!y).then((t=>{(e=>{const{current:t}=d;b(t),t.replaceChildren(...e)})(t),e&&S()}))},C=()=>{k().then(t)},S=()=>{const{current:e}=d,{rect:t}=i;e&&me(t)&&(O.timeout?O.redraw=!0:O.timeout=setTimeout(C,10))};Dt({[m.Draw]:S,[m.Selection]:S});const x=e=>{if(!e)return!1;return!!Pn(e).includes("Files")||w(Tn(e))},T=e=>{de(e),f(!1)},P=[];c&&P.push(c),g&&P.push($);const D=Object.assign(Object.assign({},o),{ref:u,className:P.join(" "),key:"player-content",onDragOver:e=>{de(e),f(x(e.dataTransfer))},onDrop:e=>{T(e);const{dataTransfer:t}=e;if(!x(t))return;const{edited:n}=i;b(n);const s={clip:i.time.scale(n.quantize).frame,track:-1};if(Pn(t).includes("Files"))E(t.files,s);else{const e=Tn(t);N(e);const n=Dn(t,e);On(n),E(n.definitionObject,s)}},onDragLeave:T,onPointerDown:()=>{i.selection.unset(s.Clip)}});if(me(a)){const t={ref:d,key:"svg",className:"svgs"},n=[e.createElement("div",Object.assign({},t))];if(r){const t=e.Children.only(r);e.isValidElement(t)&&n.push(t)}D.children=n}return e.createElement(ft,Object.assign({},D))}function pr(t){const n=e.useContext(ur),{paused:s,changePaused:r}=n,c=Object.assign(Object.assign({},t),{key:"player-button",onClick:()=>{r(!s)}});return e.createElement(ft,Object.assign({},c))}function gr(t){const n=an(),s=()=>n.timeRange.timeRange,[r,c]=e.useState(s),o=()=>{c(s())};Dt({[m.Time]:o,[m.Duration]:o},n.eventTarget);const i=Object.assign({value:r.frame,min:0,max:r.frames,step:1,onChange:(e,t)=>{const s=D(t)?t[0]:t;n.time=qe(s,r.fps)},className:"frame slider"},t);return e.createElement(Is,Object.assign({},i))}function fr(t){return e.useContext(ur).paused?null:t.children}function hr(t){return e.useContext(ur).paused?t.children:null}function br(t){const n=an(),s=()=>n.timeRange,[r,c]=e.useState(s),o=()=>{c(s())};Dt({[m.Time]:o,[m.Duration]:o},n.eventTarget);const{seconds:i,fps:a,lengthSeconds:l}=r,d=[pe(i,a,l),"/",pe(l,a,l)],u=Object.assign(Object.assign({},t),{key:"player-time",children:d});return e.createElement(ft,Object.assign({},u))}const yr=function(t={}){var n,s,r,c,o;const i=Bt(t),{icons:a}=i;(n=i.props).key||(n.key="player"),(s=i.props).className||(s.className="panel player"),(r=i.content).children||(r.children=e.createElement(mr,Object.assign({},i.content.props),e.createElement(ft,{key:"drop-box",className:"drop-box"}))),(c=i.header).content||(c.content=[a.app,e.createElement(vs,{key:"undo"},e.createElement(ps,null,a.undo,vt("undo"))),e.createElement(ys,{key:"redo"},e.createElement(ps,null,a.redo,vt("redo")))]),(o=i.footer).content||(o.content=[e.createElement(pr,{key:"play-button",className:v},e.createElement(fr,{key:"playing"},a.playerPause),e.createElement(hr,{key:"not-playing"},a.playerPlay)),e.createElement(gr,{key:"time-slider"}),e.createElement(br,{key:"time",className:"time"})]);const l=e.createElement(e.Fragment,null,e.createElement(Ut,Object.assign({},i.header)),i.content.children,e.createElement(Ut,Object.assign({},i.footer)));return Object.assign(Object.assign({},i.props),{children:l})};function Er(t){const n=e.useContext(Yn),{scale:s,frame:r}=n,c=e.useMemo((()=>Object.assign(Object.assign({},t),{style:{left:H(r,s)}})),[r,s]);return e.createElement(ft,Object.assign({},c))}function vr(t){const s=an(),{selection:r}=s,{mash:c}=r,{className:o,children:i}=t,a=pt(t,["className","children"]),l=e.Children.only(i);p(e.isValidElement(l));const d=e.useContext(Xn),u=e.useContext(Yn),{track:m}=d;ge(c),fe(m);const{clips:g,dense:f,index:h}=m,{dragTypeValid:b,onDragLeave:y,onDrop:E,droppingTrack:v,setDroppingTrack:O,droppingPosition:j,setDroppingPosition:k,setDroppingClip:C,selectedTrack:S}=u,x=e.useMemo((()=>{const e=m===S,t=[];return o&&t.push(o),e&&t.push(je),v===m&&t.push(zn(j)),t.join(" ")}),[j,v,S]),N=Object.assign(Object.assign({},a),{className:x,children:(()=>{let t=f?-1:0;const n=l.props;return g.map((s=>{const r=Object.assign(Object.assign({},n),{key:s.id}),c={children:e.cloneElement(l,r),value:{clip:s,prevClipEnd:t},key:s.id},o=e.createElement(Jn.Provider,Object.assign({},c));return f||(t=s.frames+s.frame),o}))})(),onDragLeave:y,onDragOver:e=>{de(e);const{dataTransfer:t}=e;if(!t)return;const s=b(t),r=s?n.At:n.None;C(),O(s?m:void 0),k(r)},onDrop:E,key:`track-${h}`});return e.createElement(ft,Object.assign({},N))}function Or(t){const n=e.useRef(null),s=e.useContext(Yn),[r]=e.useState(new ResizeObserver((()=>{const{setRect:e}=s;e(n.current.getBoundingClientRect())})));e.useEffect((()=>{const{current:e}=n;return e&&r.observe(e),()=>{r.disconnect()}}),[n.current]);const c=Object.assign(Object.assign({},t),{ref:n});return e.createElement(ft,Object.assign({},c))}function jr(t){const n=an(),s=e.useContext(Yn),r=()=>!n.selection.mash,[c,o]=e.useState(r);Dt({[m.Selection]:()=>{o(r())}});const i=Object.assign({disabled:c,key:"time-slider",value:s.zoom,min:0,max:1,step:.01,onChange:(e,t)=>{const n=D(t)?t[0]:t;s.zoom!==n&&s.setZoom(n)}},t);return e.createElement(Is,Object.assign({className:"zoom slider"},i))}function kr(t){const[n,s]=e.useState((()=>0)),r=()=>{s((e=>e+1))},c=an();Dt({[m.Mash]:r,[m.Track]:r});const{children:o}=t,i={key:"track-content",children:e.useMemo((()=>{const{mash:t}=c.selection;if(!t)return[];const{tracks:n}=t;return We(n).map(((t,n)=>{const{identifier:s,index:r}=t,c={children:e.Children.map(o,(t=>{if(!e.isValidElement(t))throw"TimelineTracks";return e.cloneElement(t,{key:`track-clone-${n}-${r}-${s}`})})),value:{track:t},key:`track-context-${n}-${r}-${s}`};return e.createElement(Xn.Provider,Object.assign({},c))}))}),[n])};return e.createElement(e.Fragment,Object.assign({},i))}function Cr(t){const n=an(),s=e.useRef(-1),r=e.useRef(null),c=e.useContext(Yn),{frames:o,scale:i,rect:a}=c,{className:l,inactive:d,styleHeight:u,styleWidth:p}=t,g=pt(t,["className","inactive","styleHeight","styleWidth"]),f=()=>!n.selection.mash,[h,b]=e.useState(f);Dt({[m.Selection]:()=>{b(f())}});const y=()=>{const{window:e}=globalThis,t=e=>{de(e);const{current:t}=r;if(!t||!n.selection.mash)return;const{clientX:c}=e;if(s.current===c)return;s.current=c;const o=t.getBoundingClientRect(),a=Math.max(0,Math.min(o.width,c-o.x)),l=Ke(a,i,"floor");n.time=qe(l,n.selection.mash.quantize)},c=n=>{t(n),e.removeEventListener("pointermove",t),e.removeEventListener("pointerup",c)};return n=>{n.stopPropagation(),s.current=-1,e.addEventListener("pointermove",t),e.addEventListener("pointerup",c),t(n)}},{width:E,height:v}=a,O=e.useMemo((()=>{const e=[];l&&e.push(l),h&&e.push(Pe);const t=Object.assign(Object.assign({},g),{ref:r,className:e.join(" ")});if(p||u){const e={};if(u&&(e.minHeight=v),p){const t=H(o,i,"ceil");e.minWidth=Math.max(t,t)}t.style=e}return d||h||(t.onPointerDown=y()),t}),[o,i,E,v,h]);return e.createElement(ft,Object.assign({},O))}function Sr(t){const{className:r}=t,c=pt(t,["className"]),o=e.useContext(Yn),{dragTypeValid:i,onDrop:a,setScroll:l,setDroppingClip:d,setDroppingTrack:u,setDroppingPosition:p}=o,g=e.useRef(null),[f,h]=e.useState(!1),b=an();Dt({[m.Mash]:()=>{var e;null===(e=g.current)||void 0===e||e.scrollTo(0,0)}});const y=e=>{de(e),h(!1)},E=[];r&&E.push(r),f&&E.push($);const v=Object.assign(Object.assign({className:E.join(" ")},c),{onPointerDown:e=>{b.selection.unset(s.Track)},onScroll:()=>{const{current:e}=g;if(!e)return;const{scrollLeft:t,scrollTop:n}=e;l({x:t,y:n})},onDragOver:e=>{de(e);const{dataTransfer:t}=e;if(!t)return;const s=i(t),r=s?n.At:n.None;d(),u(),p(r),h(s)},onDragLeave:y,onDrop:e=>{y(e),a(e)},ref:g});return e.createElement(ft,Object.assign({},v))}function xr(t){const n=an(),s=()=>!n.selection.mash,[r,c]=e.useState(s);Dt({[m.Selection]:()=>{c(s())}});const{children:o}=t,i=pt(t,["children"]),a=Object.assign(Object.assign({},i),{disabled:r});return a.onClick=()=>{n.addTrack()},e.cloneElement(e.Children.only(o),a)}function Nr(t){const{className:n,icons:s}=t,r=pt(t,["className","icons"]),c=e.useContext(Yn),o=e.useContext(Xn),{droppingTrack:i,droppingPosition:a,selectedTrack:l}=c,{track:d}=o,u=e.useMemo((()=>{const e=[];return n&&e.push(n),d===l&&e.push(je),d===i&&e.push(zn(a)),e.join(" ")}),[a,i,l]);if(!d)return null;const{dense:m,index:p}=d,g=m?s.trackDense:s.track,f=Object.assign(Object.assign({},r),{className:u,children:g,key:`track-icon-${p}`});return e.createElement(ft,Object.assign({},f))}function wr(t){const n=an(),{zoom:s,children:r}=t,c=pt(t,["zoom","children"]),o=e.useContext(Yn),i=()=>!n.selection.mash,[a,l]=e.useState(i);Dt({[m.Selection]:()=>{l(i())}});const d=Object.assign(Object.assign({},c),{onClick:()=>{o.setZoom(s)},disabled:a});return e.cloneElement(e.Children.only(r),d)}function Tr(t){const n=an(),s=e.useContext(Pt),{definition:r,drop:c}=s,o=()=>!n.selection.mash,[i,a]=e.useState(o);Dt({[m.Selection]:()=>{a(o())}});const{children:l}=t,d=pt(t,["children"]),u=Object.assign(Object.assign({},d),{disabled:i});return u.onClick=()=>{const{selection:e,edited:t}=n,{clip:s,track:o}=e,i=(null==r?void 0:r.toJSON())||{id:he},a={clip:0,track:-1};s&&o?(a.clip=o.dense?o.clips.indexOf(s):s.endFrame,a.track=o.index):a.clip=n.time.scale(t.quantize).frame,c(i,a)},e.cloneElement(e.Children.only(l),u)}const Pr=function(t={}){var n,s,r,c,o;const i=Bt(t),{icons:a}=i;(n=i.props).key||(n.key="timeline"),(s=i.props).className||(s.className="panel timeline"),(r=i.header).content||(r.content=[a.timeline]),(c=i.footer).content||(c.content=[e.createElement(Tr,{key:"add-clip"},e.createElement(ps,{children:a.add})),e.createElement(xr,{key:"add-track"},e.createElement(ps,{children:[a.add,a.trackDense]})),e.createElement(wr,{key:"zoom-out",zoom:0},e.createElement(ps,{useView:!0},a.zoomLess)),e.createElement(jr,{key:"zoomer"}),e.createElement(wr,{key:"zoom-in",zoom:1},e.createElement(ps,{useView:!0},a.zoomMore))]),(o=i.content).children||(o.children=e.createElement(e.Fragment,null,e.createElement(Cr,{styleWidth:!0,inactive:!0,styleHeight:!0,className:"scrubber-bar"},e.createElement(Er,{className:"scrubber-element-bar"})),e.createElement(Cr,{styleWidth:!0,className:"scrubber-icon"},e.createElement(Er,{className:"scrubber-element-icon"})),e.createElement(kr,null,e.createElement(Nr,{className:"track-icon",icons:a}),e.createElement(vr,{className:"track"},e.createElement(es,{className:"clip preview"}))),e.createElement(Or,{className:"drop-box"})));const l=e.createElement(e.Fragment,null,e.createElement(Ut,Object.assign({},i.header)),e.createElement(Sr,Object.assign({},i.content.props),i.content.children),e.createElement(Ut,Object.assign({},i.footer)));return Object.assign(Object.assign({},i.props),{children:l})};function Dr(t){const{disabled:n}=t,s=pt(t,["disabled"]),r=an(),[c,o]=e.useState(r.paused),[i,a]=e.useState(r.volume),l=()=>{o(r.paused)};Dt({[m.Pause]:l,[m.Play]:l,[m.Volume]:()=>{a(r.volume)}});const d={value:{paused:c,disabled:n,volume:i,changePaused:e=>{r.paused=e},changeVolume:e=>{r.volume=e}},children:e.createElement(ft,Object.assign({},s))};return e.createElement(ur.Provider,Object.assign({},d))}const Rr=1;function Ar(t){const s=an(),r=e.useContext(Pt),{drop:c}=r,o=()=>{var e;return(null===(e=s.selection.mash)||void 0===e?void 0:e.frame)||0},i=()=>{var e;return(null===(e=s.selection.mash)||void 0===e?void 0:e.frames)||0},[a,l]=e.useState(i),[d,u]=e.useState(o),[p,g]=e.useState(n.None),[h,b]=e.useState(),[y,E]=e.useState(),[v,O]=e.useState(),[j,k]=e.useState(0),[C,S]=e.useState(),[x,N]=e.useState(1),[w,T]=e.useState(L),[P,D]=e.useState(L),R=()=>{k((e=>e+1))};Dt({[m.Mash]:()=>{N(1)},[m.Action]:R,[m.Selection]:()=>{S(s.selection.clip),O(s.selection.track)},[m.Time]:()=>{u(o())},[m.Duration]:()=>{l(i())}},s.eventTarget);const A=(e,t)=>{const n=Pn(e);if(n.includes("Files"))return!0;const s=n.find(xn);if(!s)return!1;if(t)return!0;return wn(s)!==B.Effect},$=e=>{de(e),g(n.None),b(void 0),E(void 0)},{width:z}=w,I=e.useMemo((()=>z?Je(a,z,x):0),[x,z,a]),H={scroll:P,setScroll:D,scale:I,refreshed:j,refresh:R,zoom:x,setZoom:N,rect:w,setRect:T,droppingTrack:h,setDroppingTrack:b,droppingClip:y,setDroppingClip:E,droppingPosition:p,setDroppingPosition:g,onDragLeave:$,onDrop:e=>{de(e);const{dataTransfer:t,clientX:r}=e;if(!t||!A(t,y))return void console.log("Timeline onDrop invalid",null==t?void 0:t.types,!!y);const o=Pn(t).includes("Files"),i=!!(null==h?void 0:h.dense),a=h?h.index:-1,l=(null==h?void 0:h.clips)||[],d=o?{}:Dn(t),u=!o&&yn(d),m=u?d.offset:0;let g=((e,t)=>{if(!e)return-1;if(!y)return 0;const s=t.indexOf(y);return p===n.After?s+1:s})(i,l);if(!f(g)){const e=r-w.x,t=Ke(Math.max(0,P.x+(e-m)),I);g=i?((e,t)=>{const{length:n}=t;if(!n)return 0;const s=t.findIndex((t=>e<t.frame+t.frames));return s>-1?s:n})(t,l):t}const b={clip:g,track:a};if(o)c(t.files,b);else if(u)if(vn(d)){const{definitionObject:e}=d;c(e,b)}else{const{clip:e}=s.selection;Qe(e),s.moveClip(e,b)}$(e)},dragTypeValid:A,selectedClip:C,selectedTrack:v,frame:d,frames:a},V={children:e.createElement(ft,Object.assign({},t)),value:H};return e.createElement(Yn.Provider,Object.assign({},V))}function $r(t){return e.createElement(ft,Object.assign({},t))}const zr=function(t={}){t.className||(t.className="editor masher"),t.icons||(t.icons=mt);const{panels:n={}}=t,s=pt(t,["panels"]),{player:r={},browser:c={},timeline:o={},inspector:i={},activity:a={}}=n,l=[];if(r&&(r.icons||(r.icons=t.icons),l.push(e.createElement(Dr,Object.assign({},yr(r))))),c&&(c.icons||(c.icons=t.icons),l.push(e.createElement(gn,Object.assign({},Bn(c))))),i||a){const n=[];i&&(i.icons||(i.icons=t.icons),n.push(e.createElement(rr,Object.assign({},ar(i))))),a&&(a.icons||(a.icons=t.icons),n.push(e.createElement(At,Object.assign({},Yt(a)))));const s={children:n,key:"panels",className:"panels"};l.push(e.createElement($r,Object.assign({},s)))}return o&&(o.icons||(o.icons=t.icons),l.push(e.createElement(Ar,Object.assign({},Pr(o))))),Object.assign(Object.assign({className:"editor masher"},s),{editType:ae.Mash,children:l})},Ir=function(t={}){t.className||(t.className="editor caster");const n=zr(t),{panels:s={}}=t,{composer:r={}}=s;if(!r)return n;r.icons||(r.icons=t.icons);const c=e.createElement(e.Fragment,null,n.children,e.createElement(rs,Object.assign({},hs(r))));return Object.assign(Object.assign({},n),{children:c,editType:ae.Cast})};function Lr(t){const{children:n,className:s}=t;if(!n)return null;const r={className:s,children:n};return e.createElement(ft,Object.assign({},r))}function Hr(t){const{children:n,className:s}=t;if(!n)return null;const r={className:s,children:n};return e.createElement(ft,Object.assign({},r))}function Vr(t){const n=e.useContext(Kt),[s,r]=e.useState(!1),[c,o]=e.useState(0),[i,a]=e.useState(""),[l,d]=e.useState(""),{children:u,id:m}=t,{enabled:p,servers:g}=n;if(!be.map(String).includes(m))return null;if(!p||!g[m])return null;const f={processing:s,setProcessing:r,status:i,setStatus:a,progress:c,setProgress:o,error:l,setError:d};return e.createElement(cn.Provider,{value:f},u)}function Fr(t){const n=e.useContext(cn),{processing:s,error:r}=n;return s||r?e.createElement(e.Fragment,null,t.children):e.createElement(ft,null)}function Mr(t){return e.useContext(cn).processing?null:e.createElement(e.Fragment,null,t.children)}function qr(t){const{className:n}=t,s=pt(t,["className"]),r=e.useContext(cn),{status:c,error:o,setError:i}=r,a=["process-status"];n&&a.push(n),o&&a.push("error");const l=Object.assign(Object.assign({},s),{onClick:()=>{o&&i("")},key:"process-status",className:a.join(" "),children:o||c});return e.createElement(ft,Object.assign({},l))}function Ur(t){const n=e.useContext(cn),{progress:s,processing:r}=n;if(!r)return e.createElement(ft,{className:"progress-holder"});const c={value:s,max:1,children:`${Math.round(100*s)}%`};return e.createElement("progress",Object.assign({},c))}const Br={devices:[]},Wr=e.createContext(Br);function Jr(t){const[n,s]=e.useState([]);e.useEffect((()=>{navigator.mediaDevices.enumerateDevices().then(s)}),[]);const r={devices:n},c={children:n.map((t=>e.createElement(ft,null,JSON.stringify(t))))};return e.createElement(Wr.Provider,{value:r},e.createElement(ft,Object.assign({},c)))}function Gr(t){return e.createElement(ft,Object.assign({},t))}function Xr(t){return e.createElement(ft,Object.assign({},t))}function Zr(t){return e.createElement(ft,Object.assign({},t))}const Yr={setClient:()=>{}},_r=e.createContext(Yr);class Kr{constructor(e,t){this.setStatus=t,this.endpointPromise=e}beforeAnswer(e){return gt(this,void 0,void 0,(function*(){const t=window.navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((e=>e)).catch((e=>{console.error("beforeAnswer",e)}));if(this.localStream=yield t,!this.localStream)return;this.localStream.getTracks().forEach((t=>{this.localStream&&e.addTrack(t,this.localStream)}));const{close:n}=e;e.close=(...t)=>{if(this.localStream)return this.localStream.getTracks().forEach((e=>{e.stop()})),n.apply(e,t)}}))}closeConnection(){var e;null===(e=this.localPeerConnection)||void 0===e||e.close()}createConnection(e={}){const{stereo:t}=e;return this.endpointPromise(j.streaming.webrtc,{}).then((e=>{const{id:n,localDescription:s}=e,r=new RTCPeerConnection({});this.localPeerConnection=r,r.close=()=>{const e={id:n};return this.endpointPromise(j.streaming.delete,e).then((e=>{})),RTCPeerConnection.prototype.close.apply(r)};try{r.setRemoteDescription(s).then((()=>{this.beforeAnswer(r).then((()=>(r.createAnswer().then((e=>{const s=new RTCSessionDescription({type:"answer",sdp:t?(c=e.sdp,c.replace(/a=fmtp:111/,"a=fmtp:111 stereo=1\r\na=fmtp:111")):e.sdp});var c;console.debug(this.constructor.name,"createConnection setLocalDescription"),r.setLocalDescription(s).then((()=>{const{localDescription:e}=r;if(!e)throw ye.invalid.object+"localDescription";const t={id:n,localDescription:e};console.debug("StreamingRemoteRequest",j.streaming.remote,t),this.endpointPromise(j.streaming.remote,t).then((e=>{console.debug("StreamingRemoteResponse",j.streaming.remote,e)}))}))})),r)))}))}catch(e){throw console.trace(this.constructor.name,"createConnection",e),this.localPeerConnection.close(),e}}))}}function Qr(t){const n=e.useContext(_r),s=e.useContext(cn),r=e.useContext(Kt),{setStatus:c,processing:o,setProcessing:i}=s,{endpointPromise:a}=r,{client:l,setClient:d}=n,u=Object.assign(Object.assign({},t),{onClick:()=>{if(l)c("Closing WebRTC connection"),l.closeConnection(),i(!1),d(void 0);else{const e=new Kr(a,c);c("Opening WebRTC connection..."),e.createConnection().then((()=>{c("Opened WebRTC connection"),i(!0),d(e)}))}}});return e.createElement(ft,Object.assign({},u))}function ec(t){const n=e.useRef(null),s=e.useContext(_r),r=e.useContext(cn),{client:c}=s,{processing:o}=r,{current:i}=n;i&&(i.srcObject=o&&(null==c?void 0:c.localStream)||null),e.useEffect((()=>()=>{}),[]);const a=pt(t,["children"]),l=Object.assign(Object.assign({},a),{ref:n,autoPlay:!0,muted:!0});return e.createElement(Gs,Object.assign({},l))}function tc(t){const[n,s]=e.useState(),r=e.useContext(Kt),{enabled:c,servers:o}=r;if(!c||!o[q.Streaming])return null;const i={client:n,setClient:s};return e.createElement(_r.Provider,{value:i},e.createElement(ft,Object.assign({},t)))}const nc=e.createElement(tc,{className:"panel webrtc"},e.createElement("div",{className:"head"},e.createElement(Qr,null,e.createElement(Fr,null,e.createElement(ps,null,"Stop Broadcasting")),e.createElement(Mr,null,e.createElement(ps,null,"Start Broadcasting")))),e.createElement(ec,{className:"content"}),e.createElement("div",{className:"foot"})),sc=e=>({className:"editor caster",children:nc});export{At as Activity,It as ActivityContent,zt as ActivityContentContext,$t as ActivityContentContextDefault,wt as ActivityContext,Nt as ActivityContextDefault,kt as ActivityGroup,Ct as ActivityGroups,Lt as ActivityItem,Ht as ActivityLabel,Ft as ActivityPicked,Mt as ActivityPicker,qt as ActivityProgress,Yt as ActivityPropsDefault,Qt as ApiClient,Kt as ApiContext,_t as ApiContextDefault,en as ApiEnabled,Ut as Bar,Rs as BooleanTypeInput,sn as Broadcaster,ln as BroadcasterContent,on as BroadcasterControl,dn as BroadcasterPreloadControl,un as BroadcasterUpdateControl,gn as Browser,In as BrowserContent,pn as BrowserContext,mn as BrowserContextDefault,Mn as BrowserControl,Fn as BrowserPicker,Bn as BrowserPropsDefault,ps as Button,Jn as ClipContext,Wn as ClipContextDefault,es as ClipItem,Us as ColorGroupInput,rs as Composer,os as ComposerContent,ss as ComposerContext,ns as ComposerContextDefault,is as ComposerDepth,as as ComposerFolderClose,ls as ComposerFolderOpen,cs as ComposerLayer,ds as ComposerLayerFolder,us as ComposerLayerLabel,ms as ComposerLayerMash,bs as CreateEditedControl,qs as DataGroupInputs,Ts as DataTypeInputs,hs as DefaultComposerProps,yr as DefaultPlayerProps,sc as DefaultStreamerProps,Pr as DefaultTimelineProps,hn as DefinitionContext,fn as DefinitionContextDefault,As as DefinitionDrop,Un as DefinitionItem,$s as DefinitionSelect,An as DragElementPoint,Rn as DragElementRect,bn as DragSuffix,jn as DragType,kn as DragTypes,ys as EditorRedoButton,Es as EditorRemoveButton,vs as EditorUndoButton,_s as EffectsGroupInput,Ns as EmptyElement,Ds as InputContext,Ps as InputContextDefault,rr as Inspector,cr as InspectorContent,Cs as InspectorContext,ks as InspectorContextDefault,Xs as InspectorEffect,or as InspectorPicked,ir as InspectorPicker,Ys as InspectorProperties,Zs as InspectorProperty,ar as InspectorPropsDefault,Kn as LayerContext,_n as LayerContextDefault,lr as Masher,Ir as MasherCastProps,Pt as MasherContext,Tt as MasherContextDefault,zr as MasherDefaultProps,zs as NumericTypeInput,Ks as OpacityGroupInput,Wt as Panel,Lr as PanelContent,Jt as PanelFoot,Hr as PanelHead,$r as Panels,Ls as PercentTypeInput,Dr as Player,pr as PlayerButton,mr as PlayerContent,ur as PlayerContext,dr as PlayerContextDefault,hr as PlayerNotPlaying,fr as PlayerPlaying,br as PlayerTime,gr as PlayerTimeControl,Qs as PointGroupInput,Vt as Problems,Vr as Process,Fr as ProcessActive,cn as ProcessContext,rn as ProcessContextDefault,Mr as ProcessInactive,Ur as ProcessProgress,qr as ProcessStatus,Os as RenderControl,Hs as RgbTypeInput,js as SaveControl,Ss as SelectEditedControl,Jr as Shooter,Wr as ShooterContext,Br as ShooterContextDefault,tr as SizeGroupInput,nr as SizingGroupInput,Vs as SizingTypeInput,Is as Slider,Gr as Streamer,Xr as Streamers,Zr as StreamersCreateControl,Fs as TextTypeInput,Ar as Timeline,Tr as TimelineAddClipControl,xr as TimelineAddTrackControl,Sr as TimelineContent,Yn as TimelineContext,Zn as TimelineContextDefault,Rr as TimelineDefaultZoom,Cr as TimelineScrubber,Er as TimelineScrubberElement,Or as TimelineSizer,vr as TimelineTrack,Nr as TimelineTrackIcon,kr as TimelineTracks,wr as TimelineZoom,jr as TimelineZoomer,sr as TimingGroupInput,Ms as TimingTypeInput,Xn as TrackContext,Gn as TrackContextDefault,Sn as TransferTypeFiles,ws as TweenInputKey,Gs as VideoView,ft as View,xs as ViewControl,nn as ViewerContext,tn as ViewerContextDefault,tc as Webrtc,Qr as WebrtcButton,Kr as WebrtcClient,ec as WebrtcContent,_r as WebrtcContext,Yr as WebrtcContextDefault,jt as activityLabel,xt as assertActivityGroup,On as assertDragDefinitionObject,En as assertDragOffsetObject,Dn as dragData,wn as dragDefinitionType,Tn as dragType,Pn as dragTypes,$n as dropFilesFromList,Nn as dropType,zn as droppingPositionClass,Bs as elementSetPreviewSize,St as isActivityGroup,vn as isDragDefinitionObject,yn as isDragOffsetObject,Cn as isDragType,xn as isTransferType,Ot as labelInterpolate,Et as labelLookup,bt as labelObjects,vt as labelTranslate,yt as labels,Bt as panelOptionsStrict,Hn as propsDefinitionTypes,Vn as propsSelectTypes,Ws as sessionGet,Js as sessionSet,ts as useClip,qn as useDefinition,an as useEditor,Qn as useLayer,Dt as useListeners};
