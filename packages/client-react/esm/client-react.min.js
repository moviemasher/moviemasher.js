import e from"react";import{EmptyMethod as t,EventType as n,DroppingPosition as s,SelectType as r,DataType as c,ContainerTypes as o,ContentTypes as i,DataGroup as a,Orientation as l,isObject as d,isPopulatedString as u,throwError as m,assertDefined as p,assertTrue as g,isPopulatedArray as f,isPositive as h,isAboveZero as b,assertObject as y,assertPopulatedObject as E,isUndefined as v,ClassButton as O,urlEndpoint as j,Endpoints as k,idPrefixSet as C,sizeCopy as S,isString as x,assertDefinitionType as N,isDefinitionType as w,isPopulatedObject as T,isUploadType as D,isArray as P,ClassDroppingBefore as R,ClassDroppingAfter as L,ClassDropping as A,isSelectType as $,assertPopulatedString as z,UploadTypes as I,RectZero as V,pixelFromFrame as H,LayerType as F,MasherAction as M,assertSelectType as q,ServerType as U,Defined as W,DefinitionType as B,isDefined as J,isNumber as G,Sizings as X,Timings as Z,assertTimeRange as Y,assertTime as _,selectedPropertyObject as K,tweenInputTime as Q,isSelectedProperty as ee,selectedPropertiesScalarObject as te,PropertyTweenSuffix as ne,assertString as se,isOrientation as re,SelectTypes as ce,assertPositive as oe,arraySet as ie,assertPopulatedArray as ae,EditType as le,editorInstance as de,eventStop as ue,rectCopy as me,sizeAboveZero as pe,stringSeconds as ge,DefaultContentId as fe,ServerTypes as he,Errors as be,ClassCollapsed as ye,ClassSelected as Ee,ApiVersion as ve,fetchCallback as Oe,sizeCeil as je,sizeScale as ke,isEventType as Ce,isLayerFolder as Se,isActionEvent as xe,isChangeAction as Ne,ClassDisabled as we,isEffect as Te,isClip as De,isTrack as Pe,assertMash as Re,OutputType as Le,isMash as Ae,urlForEndpoint as $e,assertDefinition as ze,isContainerDefinition as Ie,assertEffect as Ve,isEffectDefinition as He,assertDataGroup as Fe,timeFromArgs as Me,timeEqualizeRates as qe,rectRound as Ue,arrayReversed as We,pixelPerFrame as Be,ActivityType as Je,assertCast as Ge,isLayer as Xe,isDefinitionObject as Ze,isMashAndDefinitionsObject as Ye,isDefinition as _e,pixelToFrame as Ke,assertClip as Qe,DefinitionBase as et,colorToRgb as tt,colorRgbDifference as nt,colorFromRgb as st,svgPolygonElement as rt,idGenerate as ct,svgPatternElement as ot,svgDefsElement as it,svgUrl as at,svgElement as lt,assertPreloadableDefinition as dt,OutputTypes as ut}from"@moviemasher/moviemasher.js";import{Icons as mt}from"@moviemasher/theme-default";function pt(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]])}return n}function gt(e,t,n,s){return new(n||(n=Promise))((function(r,c){function o(e){try{a(s.next(e))}catch(e){c(e)}}function i(e){try{a(s.throw(e))}catch(e){c(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}a((s=s.apply(e,t||[])).next())}))}const ft=e.forwardRef(((t,n)=>e.createElement("div",Object.assign({ref:n},t)))),ht=/{{([a-z0-9_]*)}}/,bt={import:{bytes:"Size above {{value}}",extension:"Extension {{value}}",type:"Type {{value}}",size:"Dimensions {{value}}",duration:"Duration {{value}}",render:"{{value}}",displaySize:"{{width}}x{{height}}"}},yt={audible:"Audible",clip:"Clip",update:"Save",delete:"Remove {{type}}",unlabeled:"Unlabeled {{type}}",analyze:"Analyzing...",load:"Loading...",complete:"Completed",layer:"Layer",create:"New",render:"Render",view:"View",open:"Open...",undo:"Undo",redo:"Redo",cast:"Cast",mash:"Mash"},Et=e=>{const[t,n]=e.split(".");return bt[t][n]},vt=e=>e.includes(".")?Et(e):yt[e]||e,Ot=(e,t)=>{let n=vt(e);const s=n.match(ht);return s?(s.forEach(((e,s)=>{if(!s)return;const r=`{{${e}}}`,c=vt(t[e]);n=n.replace(r,c)})),n):n},jt=e=>{if(!d(e))return"";const{label:t,error:n,type:s,value:r}=e;return n?r?Ot(n,{value:r}):vt(n):vt(s)};var kt;!function(e){e.Active="active",e.Error="error",e.Complete="complete"}(kt||(kt={}));const Ct=Object.values(kt),St=e=>u(e)&&Ct.includes(e);function xt(e,t){St(e)||m(e,"ActivityGroup",t)}const Nt={label:"",activities:[],allActivities:[],picked:kt.Active,pick:t},wt=e.createContext(Nt),Tt=e.createContext({collapsed:!1,changeCollapsed:()=>{}}),Dt={changeDefinition:t,drop:()=>Promise.resolve([]),editorIndex:{},icons:{},save:t,setDraggable:t},Pt=e.createContext(Dt),Rt=()=>{const t=e.useContext(Pt),{editor:s}=t;p(s);const r=e.useRef([]),{eventTarget:c}=s,o=e=>{const{type:t}=e;if(Ce(t)&&e instanceof CustomEvent){const t=e.detail,{id:n,type:s}=t,{current:c}=r,o=c.find((e=>e.id===n)),i=o||{id:n,activityGroup:kt.Active,infos:[]};i.infos.unshift(t),s===Je.Complete?i.activityGroup=kt.Complete:s===Je.Error&&(i.activityGroup=kt.Error),o||c.unshift(i)}},i=e.useSyncExternalStore((e=>(c.addEventListener(n.Active,e),()=>{c.removeEventListener(n.Active,e)})),(()=>r.current)),a=()=>(c.addEventListener(n.Active,o),()=>{c.removeEventListener(n.Active,o)});return e.useEffect((()=>a()),[]),[s,i]};function Lt(t){const{initialPicked:n=kt.Active,initialCollapsed:s=!1,className:r}=t,c=pt(t,["initialPicked","initialCollapsed","className"]);xt(n);const[o,i]=e.useState(s),[a,l]=e.useState(""),[d,u]=Rt(),[m,p]=e.useState(n),g={activities:e.useMemo((()=>u.filter((e=>e.activityGroup===m))),[m,u.length]),allActivities:u,picked:m,pick:p,label:a},f={collapsed:o,changeCollapsed:i},h=[];r&&h.push(r),o&&h.push(ye);const b=Object.assign(Object.assign({},c),{className:h.join(" ")});return e.createElement(wt.Provider,{value:g},e.createElement(Tt.Provider,{value:f},e.createElement(ft,Object.assign({},b))))}const At={infos:[],activityGroup:kt.Active,id:""},$t=e.createContext(At);function zt(t){const n=e.useContext(wt),s=e.useContext(Tt),{collapsed:r}=s,{activities:c}=n;if(r)return null;const{children:o}=t,i=pt(t,["children"]),a=e.Children.only(o);g(e.isValidElement(a));const l=c.map((t=>{const n={children:e.cloneElement(a),value:t,key:t.id};return e.createElement($t.Provider,Object.assign({},n))})),d=Object.assign(Object.assign({},i),{children:l});return e.createElement(ft,Object.assign({},d))}function It(t){const{collapsed:n}=t,s=pt(t,["collapsed"]),[r,c]=e.useState(!!n),o={collapsed:r,changeCollapsed:c};return e.createElement(Tt.Provider,{value:o},e.createElement(ft,Object.assign({},s)))}function Vt(t){const n=e.useContext(Tt),{collapsed:s}=n,r=e.useContext($t),{infos:c}=r,[o]=c,i=(c.find((e=>e.label))||{label:""}).label||o.type,a=Object.assign({},t);if(s)a.children=i;else{const t=[i,...c.map((e=>jt(e)))];a.children=t.map(((t,n)=>e.createElement(ft,{key:n,children:t})))}return e.createElement(ft,Object.assign({},a))}const Ht={child:"single child element expected"};function Ft(t){const n=e.useContext(wt),{id:s,children:r}=t;xt(s);const{picked:c}=n;if(s!==c)return null;const o=e.Children.only(r);return g(e.isValidElement(o),Ht.child),o}function Mt(t){const{id:n,className:s,children:r}=t,c=pt(t,["id","className","children"]);xt(n);const o=e.Children.only(r);g(e.isValidElement(o),Ht.child);const i=e.useContext(wt),{picked:a,pick:l}=i,d=[];s&&d.push(s),n===a&&d.push(Ee);const u=Object.assign(Object.assign({},c),{className:d.join(" "),key:`activity-picker-${n}`,onClick:()=>l(n)});return e.cloneElement(o,u)}function qt(t){const n=e.useContext(wt),s=e.useContext($t),{infos:r,id:c}=s,o=[];let i=0,a=0;if(f(r)){const[e]=r,{step:t,steps:n}=e;h(t)&&b(n)&&(a=t,i=n)}else{const{allActivities:t,label:s}=n;u(s)&&o.push(e.createElement("label",{key:"label"},s));const r=t.filter((e=>e.activityGroup===kt.Active));r.length&&r.forEach((e=>{const{infos:t}=e,[n]=t;y(n);const{step:s,steps:r}=n;h(r)&&(i+=r),h(s)&&(a+=s)}))}if(i){const t=a/i,n={value:t,max:1,children:`${Math.round(100*t)}%`,key:"progress"};o.push(e.createElement("progress",Object.assign({},n)))}const l=Object.assign(Object.assign({},t),{key:"activity-progress",children:o});return e.createElement(ft,Object.assign({},l))}function Ut(t){const{before:n,content:s,after:r,props:c={}}=t;if(!(n||s||r))return null;const o=[n,s,r].filter(Boolean);return c.children=o,e.createElement(ft,Object.assign({},c))}const Wt=e=>{var t,n,s,r,c,o,i,a,l;return e.header||(e.header={}),(t=e.header).props||(t.props={}),(n=e.header.props).key||(n.key="header"),(s=e.header.props).className||(s.className="head"),e.content||(e.content={}),(r=e.content).props||(r.props={}),(c=e.content.props).key||(c.key="content"),(o=e.content.props).className||(o.className="content"),e.footer||(e.footer={}),(i=e.footer).props||(i.props={}),(a=e.footer.props).key||(a.key="footer"),(l=e.footer.props).className||(l.className="foot"),e.props||(e.props={}),E(e.icons),e};function Bt(t){const{children:n,className:s,collapsed:r}=t,[c,o]=e.useState(!!r),i=[];s&&i.push(s),c&&i.push("collapsed");const a={children:n,className:i.join(" ")},l={collapsed:c,changeCollapsed:o};return e.createElement(Tt.Provider,{value:l},e.createElement(ft,Object.assign({},a)))}function Jt(t){const n=e.useContext(Tt),{collapsed:s}=n;if(s)return null;const{before:r,content:c,after:o,props:i={}}=t;if(!(r||c||o))return null;const a=[r,c,o].filter(Boolean);return i.children=a,e.createElement(ft,Object.assign({},i))}function Gt(t){const n=e.useContext(Tt),{collapsed:s,changeCollapsed:r}=n,c=Object.assign(Object.assign({},t),{onClick:()=>{r(!s)}});return e.createElement(ft,Object.assign({},c))}function Xt(t){return e.useContext(Tt).collapsed?null:e.createElement(e.Fragment,null,t.children)}function Zt(t){return e.useContext(Tt).collapsed?e.createElement(e.Fragment,null,t.children):null}const Yt=function(t={}){var n,s,r,c,o,i;const a=Wt(t),{icons:l}=a;(n=a.props).key||(n.key="activity"),(s=a.props).className||(s.className="panel activity"),(r=a.props).initialPicked||(r.initialPicked=kt.Active),v(a.props.initialCollapsed)&&(a.props.initialCollapsed=!0),(c=a.header).content||(c.content=[l.activity,e.createElement(Xt,{key:"not-collapsed"},e.createElement(ft,{key:"view"})),e.createElement(Zt,{key:"collapsed"},e.createElement(qt,{key:"progress",className:"progress"})),e.createElement(Gt,{key:"collapse-control"},e.createElement(Xt,{key:"not-collapsed",children:l.collapse}),e.createElement(Zt,{key:"collapsed",children:l.collapsed}))]),(o=a.content).children||(o.children=e.createElement(It,{className:"item",collapsed:!0},e.createElement(Gt,{key:"collapse-control"},e.createElement(Xt,{key:"not-collapsed",children:l.collapse}),e.createElement(Zt,{key:"collapsed",children:l.collapsed})),e.createElement(Vt,{key:"label",className:"label"}),e.createElement(Ft,{key:"active",id:"active"},e.createElement(qt,{key:"progress"})),e.createElement(Ft,{key:"error",id:"error",children:l.error}),e.createElement(Ft,{key:"complete",id:"complete",children:l.complete}))),(i=a.footer).content||(i.content=[e.createElement(Mt,{key:"active",id:"active",className:O,children:l.active}),e.createElement(Mt,{key:"error",id:"error",className:O,children:l.error}),e.createElement(Mt,{key:"complete",id:"complete",className:O,children:l.complete})]);const d=e.createElement(e.Fragment,null,e.createElement(Ut,Object.assign({},a.header)),e.createElement(zt,Object.assign({},a.content.props),a.content.children),e.createElement(Jt,Object.assign({},a.footer)));return Object.assign(Object.assign({},a.props),{children:d})},_t={enabled:!1,servers:{},endpointPromise:()=>Promise.resolve({})},Kt=e.createContext(_t);function Qt(t){const{endpoint:n,children:s,path:r}=t,c=n||j({prefix:r||k.api.callbacks}),[o,i]=e.useState((()=>({[k.api.callbacks]:{endpoint:c}}))),[a,l]=e.useState((()=>({}))),d=(e,t)=>u(e).then((e=>(T(t)&&(e.request||(e.request={}),e.request.body=Object.assign({version:ve},t)),Oe(e)))),u=e=>{const t=o[e];if(t)return Promise.resolve(t);return Oe({endpoint:c,request:{body:{id:e,version:ve}}}).then((t=>{const{apiCallbacks:n}=t;return i((e=>Object.assign(Object.assign({},e),n))),n[e]}))};e.useEffect((()=>{d(k.api.servers,{}).then((e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.temporaryIdPrefix)&&C(e.data.temporaryIdPrefix),l(e)}))}),[]);const m={enabled:!0,endpointPromise:d,servers:a};return e.createElement(Kt.Provider,{value:m},s)}function en(t){const n=e.useContext(Kt),{enabled:s}=n;return s?e.createElement(e.Fragment,null,t.children):null}const tn={width:0,height:0,videoRate:0,streaming:!1,updating:!1,preloading:!1,setPreloading:()=>{},setStreaming:()=>{},setWidth:()=>{},setHeight:()=>{},setVideoRate:()=>{},setUpdating:()=>{},setId:()=>{},id:"",setUrl:()=>{},url:""},nn=e.createContext(tn);function sn(t){const[n,s]=e.useState(!1),[r,c]=e.useState(!1),[o,i]=e.useState(!1),[a,l]=e.useState(""),[d,u]=e.useState(""),[m,p]=e.useState(0),[g,f]=e.useState(0),[h,b]=e.useState(0),y={updating:o,setUpdating:i,videoRate:h,setVideoRate:b,height:g,setHeight:f,width:m,setWidth:p,url:d,setUrl:u,streaming:n,setStreaming:s,preloading:r,setPreloading:c,id:a,setId:l};return e.createElement(nn.Provider,{value:y},e.createElement(ft,Object.assign({},t)))}const rn={error:"",processing:!1,progress:0,setError:()=>{},setProcessing:()=>{},setProgress:()=>{},setStatus:()=>{},status:""},cn=e.createContext(rn);function on(t){const n=e.useContext(cn),s=e.useContext(Kt),r=e.useContext(nn),{setProcessing:c,processing:o,setStatus:i}=n,[a,l]=e.useState(o),{endpointPromise:d}=s,{setStreaming:u,setId:m,setUrl:p,setWidth:g,setHeight:f,setVideoRate:h}=r,b=Object.assign(Object.assign({},t),{onClick:()=>{a||(l(!0),(()=>{const e={};console.debug("StreamingStartRequest",k.streaming.start,e),d(k.streaming.start,e).then((e=>{console.debug("StreamingStartResponse",k.streaming.start,e),i("Started stream");const{id:t,readySeconds:n,width:s,height:r,videoRate:o}=e;m(t),g(s),f(r),h(o);const a=()=>{setTimeout((()=>{const e={id:t};console.debug("StreamingStatusRequest",k.streaming.status,e),d(k.streaming.status,e).then((e=>{console.debug("StreamingStatusResponse",k.streaming.status,e);const{streamUrl:t}=e;t?(p(t),u(!0),c(!0),i("Streaming")):a()}))}),1e3*n)};a()}))})())},disabled:a});return e.createElement(ft,Object.assign({},b))}const an=()=>e.useContext(Pt).editor;function ln(t){const n=e.useContext(nn),s=an(),{rect:r}=s,{url:c,streaming:o}=n;if(!o||!c)return e.createElement(ft,Object.assign({},t));const i=Object.assign(Object.assign(Object.assign({},S(r)),t),{autoPlay:!0});return e.createElement("video",Object.assign({src:c},i))}function dn(t){const n=e.useContext(cn),s=e.useContext(Kt),r=e.useContext(nn),{id:c,setPreloading:o,preloading:i,updating:a,streaming:l}=r,{setStatus:d}=n,{endpointPromise:u}=s,m=i||a||!l,p=Object.assign(Object.assign({},t),{onClick:()=>{m||(o(!0),(()=>{const e={files:[],id:c};d("Preloading..."),console.debug("StreamingPreloadRequest",k.streaming.preload,e),u(k.streaming.preload,e).then((e=>{console.debug("StreamingPreloadResponse",k.streaming.preload,e),d("Preloaded"),o(!1)}))})())},disabled:m});return e.createElement(ft,Object.assign({},p))}function un(t){const n=an(),s=e.useContext(cn),r=e.useContext(Kt),c=e.useContext(nn),{updating:o,setUpdating:i,streaming:a,preloading:l,id:d}=c,{setStatus:u}=s,{endpointPromise:m}=r,p=o||l||!a,g=Object.assign(Object.assign({},t),{onClick:()=>{p||(i(!0),(()=>{const{edited:e,definitions:t}=n;Ge(e);const{mashes:s}=e,r={definitionObjects:t.map((e=>e.toJSON())),mashObjects:s.map((e=>e.toJSON())),id:d};console.debug("StreamingCutRequest",k.streaming.cut,r),u("Updating stream"),m(k.streaming.cut,r).then((e=>{console.debug("StreamingCutResponse",k.streaming.cut,e),u("Updated stream"),i(!1)}))})())},disabled:p});return e.createElement(ft,Object.assign({},g))}const mn={addPicker:t,definitions:[],pick:t,picked:"",removePicker:t},pn=e.createContext(mn),gn=n.Added,fn=(t=[])=>{const n=e.useContext(Pt),{editor:s}=n;p(s);const r=e.useRef({}),{eventTarget:c}=s,o=e=>{const{type:t}=e;if(Ce(t)&&e instanceof CustomEvent){const{detail:t}=e,{definitionTypes:n}=t;if(f(n)){const e=n,{current:t}=r,s=Object.keys(t).filter((t=>e.some((e=>t.includes(e)))));s.forEach((e=>delete t[e]))}}},i=e.useSyncExternalStore((e=>(c.addEventListener(gn,e),()=>{c.removeEventListener(gn,e)})),(()=>{var e;const n=t.join("-")||"empty";return(e=r.current)[n]||(e[n]=(()=>{const e=t.map((e=>W.byType(e)));return 1===e.length?e[0]:e.flat()})())})),a=()=>(c.addEventListener(gn,o),()=>{c.removeEventListener(gn,o)});return e.useEffect((()=>a()),[]),[s,i]},hn=(t=[])=>{const n=e.useContext(Kt),s=e.useContext(Pt),{enabled:r,servers:c,endpointPromise:o}=n,{editor:i}=s;p(i);const a=e.useRef({}),{eventTarget:l}=i,d=e=>{switch(e){case"empty":case"disabled":break;default:(e=>{const n={types:t};console.debug("DataDefinitionRetrieveRequest",k.data.definition.retrieve,n),o(k.data.definition.retrieve,n).then((t=>{console.debug("DataDefinitionRetrieveResponse",k.data.definition.retrieve,t);const{definitions:n}=t;a.current[e].push(...n.map((e=>et.fromObject(e)))),l.dispatchEvent(new CustomEvent("api-definitions"))}))})(e)}return[]};return[i,e.useSyncExternalStore((e=>(l.addEventListener("api-definitions",e),()=>{l.removeEventListener("api-definitions",e)})),(()=>{const e=r&&c[U.Data]?t.length?t.join("-"):"empty":"disabled",n=a.current[e];return n||(a.current[e]=d(e))}))]};function bn(t){const{initialPicked:n="container"}=t,s=pt(t,["initialPicked"]),[r,c]=e.useState({}),o=e.useContext(Pt),{changeDefinition:i}=o,[a,l]=e.useState(n),[d,u]=((e=[])=>{const[t,n]=fn(e),[s,r]=hn(e),c=r.filter((e=>!n.some((t=>t.id===e.id))));return[t,[...n,...c]]})(r[a]),m={value:{definitions:u,picked:a,pick:e=>{z(e),i(),l(e)},addPicker:(e,t)=>{c((n=>Object.assign(Object.assign({},n),{[e]:t})))},removePicker:e=>{c((t=>Object.assign(Object.assign({},t),{[e]:[]})))}},children:e.createElement(ft,Object.assign({},s))};return e.createElement(pn.Provider,Object.assign({},m))}const yn={},En=e.createContext(yn),vn="/x-moviemasher",On=e=>d(e)&&"offset"in e;function jn(e){On(e)||m(e,"DragOffsetObject")}const kn=e=>On(e)&&"definitionObject"in e;function Cn(e){kn(e)||m(e,"DragDefinitionObject")}var Sn;!function(e){e.Mash="mash",e.Layer="layer",e.Track="track"}(Sn||(Sn={}));const xn=Object.values(Sn),Nn=e=>x(e)&&xn.includes(e),wn="Files",Tn=e=>x(e)&&e.endsWith(vn),Dn=e=>{if(e)return e.types.find(Tn)},Pn=e=>{const[t]=e.split("/");return N(t),t},Rn=e=>{const t=Dn(e);if(!t)return;const[n]=t.split("/");return Nn(n)||w(n)?n:void 0},Ln=e=>{const{types:t}=e;return t.filter((e=>"Files"===e||Tn(e)))},An=(e,t)=>{const n=t?`${t}${vn}`:Ln(e).find(Tn);if(!n)return{};const s=e.getData(n);return s?JSON.parse(s):{}},$n=e=>e.getBoundingClientRect(),zn=(e,t)=>{const n=t instanceof Element?$n(t):t,{x:s,y:r}=n,{clientY:c,clientX:o}=e;return{x:o-s,y:c-r}},In=(e,t={})=>{const n=[],{length:s}=e;if(!s)return n;const r=T(t),{extensions:c={},uploadLimits:o={}}=t,i=c,a=o;for(let t=0;t<s;t++){const s=e.item(t);if(!s)continue;const{name:c,size:o,type:l}=s,d=l.split("/").shift();if(!D(d)){n.push({label:c,value:d,error:"import.type"});continue}const m=a[d];if(r&&!(b(m)&&1024*m*1024>o)){n.push({label:c,value:`${m}MB`,error:"import.bytes"});continue}const p=c.toLowerCase().split(".").pop(),g=u(p),f=i[d];!r&&g||g&&P(f)&&f.includes(p)?n.push(s):n.push({label:c,value:p,error:"import.extension"})}return n},Vn=e=>{if(v(e))return"";switch(e){case s.After:return L;case s.Before:return R;case s.None:return""}return A};function Hn(t){const[n,s]=e.useState(!1),{className:r,children:c}=t,o=pt(t,["className","children"]),i=e.useContext(Pt),a=e.useContext(pn).definitions||[],{drop:l}=i,d=e=>!!e&&Ln(e).includes("Files"),u=e=>{ue(e),s(!1)},m=[];r&&m.push(r),n&&m.push(A);const p=e.Children.only(c);g(e.isValidElement(p));const f=Object.assign(Object.assign({},o),{className:m.join(" "),key:"browser-content",children:(()=>{const t=p.props;return a.map((n=>{const s=Object.assign(Object.assign({},t),{key:n.id}),r={children:e.cloneElement(p,s),value:{definition:n},key:n.id};return e.createElement(En.Provider,Object.assign({},r))}))})(),onDrop:e=>{u(e);const{dataTransfer:t}=e;d(t)&&l(t.files)},onDragOver:e=>{ue(e),s(d(e.dataTransfer))},onDragLeave:u});return e.createElement(ft,Object.assign({},f))}const Fn=(e,t,n)=>e?[e]:t?x(t)?t.split(",").map((e=>e.trim())):t:n?n.map((e=>e.name)):[],Mn=(e,t,n)=>{const s=Fn(e,t);n&&!s.length&&s.push(n);return s.filter((e=>w(e))).map((e=>e))},qn=(e,t,n)=>{const s=Fn(e,t);n&&!s.length&&s.push(n);return s.filter((e=>$(e))).map((e=>e))};function Un(t){const{children:n,type:s,types:r,className:c,id:o}=t,i=pt(t,["children","type","types","className","id"]);z(o);const a=e.useContext(pn),{pick:l,picked:d,addPicker:u,removePicker:m}=a,p=[];c&&p.push(c),d===o&&p.push(Ee),e.useEffect((()=>(u(o,Mn(s,r,o)),()=>{m(o)})),[]);const f=Object.assign(Object.assign({},i),{className:p.join(" "),key:`browser-picker-${o}`,onClick:()=>{l(o)}}),h=e.Children.only(n);return g(e.isValidElement(h),Ht.child),e.cloneElement(h,f)}function Wn(t){const{children:n}=t,s=pt(t,["children"]),r=e.useRef(null),c=e.useContext(Kt),o=e.useContext(Pt),{servers:i}=c,{drop:a}=o,{file:l={}}=i,{extensions:d=Object.fromEntries(I.map((e=>[e,[]])))}=l;y(d);const u=Object.entries(d).flatMap((([e,t])=>[`${e}/*`,...t.map((e=>`.${e}`))])).join(","),m=Object.assign({accept:u,id:"upload-control-id",onChange:e=>{const{files:t}=e.currentTarget;t&&a(t)},type:"file",key:"browser-control-input",ref:r},s),p=e.createElement("input",Object.assign({},m));if(!e.isValidElement(n))return p;const g={children:[e.Children.only(n),p],key:"browser-control",htmlFor:"upload-control-id"};return e.createElement("label",Object.assign({},g))}const Bn=()=>e.useContext(En).definition;function Jn(t){const{className:n,iconRatio:s}=t,r=pt(t,["className","iconRatio"]),c=s||.25,o=e.useRef(null),i=e.useRef(null),a=e.useContext(Pt),{editor:l,definition:d,changeDefinition:u}=a;g(l);const m=Bn(),{id:p,label:f,type:h}=m,b=()=>gt(this,void 0,void 0,(function*(){const{rect:e,preloader:t}=l,{current:n}=o;if(!n||!pe(e))return;const s=je(ke(S(e),c,c)),r=yield m.definitionIcon(t,s);r&&n.replaceChildren(r)}));e.useEffect((()=>{b()}),[]),o.current&&b();const y=e=>{e.stopPropagation(),u(m)},E=e=>{y(e);const t=i.current.getBoundingClientRect(),{left:n}=t,{clientX:s}=e,r={offset:s-n,definitionObject:m},c=JSON.stringify(r),{dataTransfer:o}=e;o&&(o.effectAllowed="copy",o.setData(m.type+vn,c))},v=Object.assign(Object.assign({},r),{className:n,children:(()=>{const t=[e.createElement(ft,{key:"icon",ref:o})];return f&&t.unshift(e.createElement("label",{key:"label"},f)),t})(),ref:i,key:p});return t.draggable&&(v.onDragStart=E,v.onPointerDown=y,v.className=(()=>{const e=[];return n&&e.push(n),(null==d?void 0:d.id)===p&&e.push(Ee),e.join(" ")})()),e.createElement(ft,Object.assign({},v))}const Gn=function(t={}){var n,s,r,c,o,i,a,l;const d=Wt(t),{icons:u}=d;(n=d.props).key||(n.key="browser"),(s=d.props).className||(s.className="panel browser"),(r=d.props).initialPicked||(r.initialPicked="container"),(c=d.header).content||(c.content=[u.browser]),(o=d.footer).content||(o.content=[e.createElement(Un,{key:"effect",id:"effect",className:O,children:u.browserEffect}),e.createElement(Un,{key:"container",id:"container",className:O,children:u.container}),e.createElement(Un,{key:"content",id:"content",className:O,children:u.content})]),(i=d.footer).before||(i.before=[e.createElement(Un,{key:"video",id:"video",types:"video,videosequence",className:O,children:u.browserVideo}),e.createElement(Un,{key:"audio",id:"audio",className:O,children:u.browserAudio}),e.createElement(Un,{key:"image",id:"image",className:O,children:u.browserImage})]),(a=d.footer).after||(a.after=[e.createElement(Wn,{key:"import",children:u.import})]),(l=d.content).children||(l.children=e.createElement(Jn,{draggable:!0,className:"definition preview"}));const m=e.createElement(e.Fragment,null,e.createElement(Ut,Object.assign({},d.header)),e.createElement(Hn,Object.assign({},d.content.props),d.content.children),e.createElement(Ut,Object.assign({},d.footer)));return Object.assign(Object.assign({},d.props),{children:m})},Xn={prevClipEnd:0},Zn=e.createContext(Xn),Yn={},_n=e.createContext(Yn),Kn={dragTypeValid:()=>!1,frame:0,frames:0,onDragLeave:t,onDrop:t,rect:V,refreshed:0,refresh:t,scale:0,scroll:{x:0,y:0},setDroppingClip:t,setDroppingPosition:t,setDroppingTrack:t,setRect:t,setScroll:t,setZoom:t,zoom:1},Qn=e.createContext(Kn),es={depth:0},ts=e.createContext(es),ns=()=>e.useContext(ts).layer,ss=(t,n)=>{const s=e.useContext(Pt),{editor:r}=s,c=n||r.eventTarget,o=e=>{const{type:n}=e,s=t[n];s&&s(e)},i=()=>(Object.keys(t).forEach((e=>{c.addEventListener(e,o)})),()=>{Object.keys(t).forEach((e=>{c.removeEventListener(e,o)}))});e.useEffect((()=>i()),[])};function rs(t){const{className:r}=t,c=pt(t,["className"]),o=e.useRef(null),i=e.useRef(null),a=an(),l=e.useContext(_n),u=e.useContext(Qn),[m,p]=e.useState(0),f=()=>{p((new Date).valueOf())},h=e.useRef({}),{current:y}=h,E=e.useContext(Zn),{droppingPosition:v,droppingClip:O,scale:j,selectedClip:k,onDrop:C,dragTypeValid:S,setDroppingPosition:x,setDroppingClip:N,setDroppingTrack:w,onDragLeave:T}=u,{track:D}=l,{clip:P,prevClipEnd:R}=E;g(P);const L=()=>{const{current:e}=o,t=null==e?void 0:e.parentNode;return t instanceof HTMLDivElement?t.offsetHeight:0},[A,$]=e.useState(L),{label:z,type:I,frame:V,frames:F}=P,M=()=>{if(!b(j)||!b(F))return 0;const e=H(F,j,"floor"),{width:t}=y;return e&&e!==t&&(y.width=e,f()),e},q=M();ss({[n.Action]:e=>{if(y.redraw)return;const{type:t}=e;if(!Ce(t))return;if(!(e instanceof CustomEvent))return;if(t!==n.Action)return;const{detail:s}=e;if(!s)return;const{action:r}=s;if(!r)return;const{target:c}=r;if(d(c)){switch(c){case P:case P.container:case P.content:break;default:if("color"===r.property)break;return}f()}},[n.Save]:f});const U=()=>{const{width:e,redraw:t}=y;delete y.timeout,delete y.redraw;const{current:n}=o,{edited:s}=a,r=n&&s&&e&&e===M();if((t||!r)&&(f(),!r))return Promise.resolve();const c=(()=>{const{rect:e}=a,t={width:A*(e.width/e.height),height:A};return je(t)})(),i=(e=>{const{width:t,height:n}=e;return{width:Math.max(t,q),height:n}})(c),l=P.clipIcon(i,u.scale,2);return l?l.then((t=>{const r=M();t&&e>=r&&n.replaceChildren(((e,t,n)=>{const s=tt(e),r=nt(s),c=st(r),o=rt(t,"",e),i={x:t.width,y:0,width:n,height:t.height},a=rt(i,"",c),l={width:t.width+n,height:t.height},d=ct("pattern"),m=ot(l,d,[o,a]),p=it([m]),g={width:u.rect.width,height:A},f=rt(g,"",at(d));return lt(g,[p,f])})(s.color,c,2),t)})):Promise.resolve()};e.useEffect((()=>{if(!A)return $(L);const{current:e}=o,{edited:t}=a;e&&t&&(y.timeout?y.redraw||(y.redraw=!0):y.timeout=setTimeout(U,500))}),[m,j,A]);const W=e=>{e.stopPropagation(),a.selection.set(P)},B={width:q};R>-1&&(B.marginLeft=H(V-R,j,"floor"));const J=Object.assign(Object.assign({},c),{style:B,className:(()=>{const e=P===k,t=[];return r&&t.push(r),e&&t.push(Ee),O===P&&t.push(Vn(v)),t.join(" ")})(),onPointerDown:W,onDragStart:e=>{W(e);const{dataTransfer:t,clientX:n}=e,{current:s}=i;if(!t||!s)return;const r=s.getBoundingClientRect(),{left:c}=r,o={offset:n-c},a=JSON.stringify(o);t.effectAllowed="move",t.setData(I+vn,a)},onDragEnd:e=>{ue(e);const{dataTransfer:t}=e;if(!t)return;const{dropEffect:n}=t;"none"===n&&a.removeClip(P)},onDragOver:e=>{ue(e);const{dataTransfer:t}=e;if(!t)return;const n=S(t,P),r=n?s.At:s.None;w(n?D:void 0),N(n?P:void 0),x(r)},onDragLeave:T,onDrop:C,onClick:e=>e.stopPropagation(),draggable:!0,ref:i,children:(()=>{const t={key:"clip-previews",ref:o},n={width:q,height:A};if(pe(n)){const{width:e,height:s}=n;t.width=e,t.height=s,t.viewBox=`0 0 ${e} ${s}`}const s=[e.createElement("svg",Object.assign({},t))];return z&&s.unshift(e.createElement("label",{key:"label"},z)),s})()});return e.createElement(ft,Object.assign({},J))}const cs=()=>e.useContext(Zn).clip,os={refreshed:0,refresh:t,validDragType:()=>{},droppingPosition:s.None,setDroppingPosition:t,onDrop:t,setDroppingLayer:t,onDragLeave:t},is=e.createContext(os);function as(t){const r=e.useContext(Pt),[c,o]=e.useState(void 0),[i,a]=e.useState(void 0),[l,d]=e.useState(0),[u,m]=e.useState(s.None),{editor:p,draggable:g,drop:f}=r,h=()=>{d((e=>e+1))};if(ss({[n.Selection]:()=>{o(p.selection.layer)},[n.Cast]:h}),!p)return null;const b=e=>{if(!e)return;const t=Rn(e);return Nn(t)&&[Sn.Mash,Sn.Layer].includes(t)?t:void 0},E={refreshed:l,refresh:h,selectedLayer:c,validDragType:b,droppingPosition:u,setDroppingPosition:m,onDrop:e=>{e.preventDefault(),m(s.None),h();const{dataTransfer:t}=e;y(t);if(Ln(t).includes("Files")){const e={};return void f(t.files,e)}const n=b(t);if(!n)return;const r={layer:i,position:u};switch(n){case Sn.Layer:Xe(g)&&p.moveLayer(g,r);break;case Sn.Mash:{const e={mashObject:{},definitionObjects:[]};p.addMash(e,r);break}default:g&&f(g)}},droppingLayer:i,setDroppingLayer:a,onDragLeave:()=>{m(s.None),a(void 0)}},v={children:e.createElement(ft,Object.assign({},t)),value:E};return e.createElement(is.Provider,Object.assign({},v))}function ls(t){const n=e.useRef(null);e.useContext(Pt);const r=e.useContext(is),c=e.useContext(ts),{validDragType:o,droppingPosition:i,setDroppingPosition:a,onDrop:l,droppingLayer:u,setDroppingLayer:m,onDragLeave:p}=r,g=an(),{layer:f}=c;if(!f)return null;const{className:h="layer"}=t,b=pt(t,["className"]),y=e=>{e.stopPropagation(),g.selection.set(f)},E=e.useMemo((()=>{const e=f===g.selection.layer,t=[h];return e&&t.push(Ee),u===f&&t.push(Vn(i)),t.join(" ")}),[i,u,g.selection.layer]),v=Object.assign(Object.assign({},b),{className:E,ref:n,onMouseDown:y,onDragStart:e=>{const t=zn(e,n.current);y(e);const{dataTransfer:s}=e;d(s)&&(s.effectAllowed="move",s.setData(`layer${vn}`,JSON.stringify(t)))},onDragEnd:e=>{const{dataTransfer:t}=e;if(!t)return;const{dropEffect:n}=t;"none"===n&&g.removeLayer(f)},onClick:e=>{e.stopPropagation(),g.selection.set(f)},onDragLeave:p,onDragOver:e=>{const t=(e=>{const{dataTransfer:t}=e,{current:r}=n;if(!r||!o(t))return s.None;const c=$n(n.current),i=zn(e,c),a=Math.ceil(c.height/4),l=Se(f);return i.y<a*(l?1:2)?s.Before:!l||i.y>3*a?s.After:s.At})(e);a(t),m(f),ue(e)},onDrop:l,draggable:!0});return e.createElement(ft,Object.assign({},v))}function ds(t){const n=e.useContext(is),{droppingLayer:c,setDroppingLayer:o,droppingPosition:i,setDroppingPosition:a,onDrop:l,onDragLeave:d}=n,u=an(),{className:m="content",children:p}=t,f=pt(t,["className","children"]),h=e.Children.only(p);g(e.isValidElement(h));const b=(e,t=0)=>e.flatMap((n=>n?y(n,t):(console.trace("layersArray no layer",t,e),[]))),y=(t,n)=>{const s={layer:t,depth:n},r={key:`layer-${t.id}`,value:s,children:e.createElement(ls,Object.assign({},h.props))},c=[e.createElement(ts.Provider,Object.assign({},r))];return Se(t)&&!t.collapsed&&c.push(...b(t.layers,n+1)),c},E=e.useMemo((()=>{var e;return b((null===(e=u.selection.cast)||void 0===e?void 0:e.layers)||[])}),[n.refreshed,n.selectedLayer]),v=e.useMemo((()=>{const e=[m];return i===s.None||c||e.push(A),e.join(" ")}),[i,c,u.selection.layer]),O=Object.assign(Object.assign({},f),{children:E,key:"composer-view",onClick:()=>{u.selection.unset(r.Layer)},onDragLeave:d,onDragOver:e=>{e.preventDefault();const{dataTransfer:t}=e;(e=>!!e&&(!!Ln(e).includes("Files")||!!Rn(e)))(t)&&(a(E.length),o())},onDrop:l,className:v});return e.createElement(ft,Object.assign({},O))}function us(t){const n=e.useContext(ts),{depth:s}=n,r=e.Children.only(t.children);if(!e.isValidElement(r))throw Ht.child;const c=new Array(s).fill(!0).map(((t,n)=>{const s=Object.assign(Object.assign({},r.props),{key:`depth-${n}`});return e.cloneElement(r,s)}));return e.createElement(e.Fragment,null,c)}function ms(t){const n=e.useContext(is),s=ns();if(s.type!==F.Folder)return null;const r=s;if(r.collapsed)return null;const{children:c}=t,o=pt(t,["children"]),i=e.Children.only(c);if(!e.isValidElement(i))throw Ht.child;const a=Object.assign(Object.assign({},o),{onClick:()=>{r.collapsed=!0,n.refresh()}});return e.cloneElement(i,a)}function ps(t){const{children:n}=t,s=pt(t,["children"]),r=e.Children.only(n);if(!e.isValidElement(r))throw Ht.child;const c=e.useContext(is),o=ns();if(o.type!==F.Folder)return null;const i=o;if(!i.collapsed)return null;const a=Object.assign(Object.assign({},s),{onClick:()=>{i.collapsed=!1,c.refresh()}});return e.cloneElement(r,a)}function gs(t){return ns().type!==F.Folder?null:e.createElement(e.Fragment,null,t.children)}function fs(t){const s=ns(),[r,c]=e.useState(s.label);ss({[n.Action]:e=>{if(!xe(e))return;const{action:t}=e.detail;Ne(t)&&s===t.target&&c(s.label)}});const o=Object.assign(Object.assign({},t),{children:r});return e.createElement("label",Object.assign({},o))}function hs(t){return ns().type!==F.Mash?null:e.createElement(e.Fragment,null,t.children)}function bs(t){const{useView:n,selected:s}=t,r=pt(t,["useView","selected"]);if(!n)return e.createElement("button",Object.assign({},r));const{disabled:c,className:o}=r,i=pt(r,["disabled","className"]),a=[O];o&&a.push(o),c?a.push(we):s&&a.push(Ee);const l=Object.assign(Object.assign({},i),{className:a.join(" ")});return e.createElement(ft,Object.assign({},l))}function ys(t){const n=an(),s=e.useContext(is),{children:r}=t,c=pt(t,["children"]),o=e.Children.only(r);if(!e.isValidElement(o))throw Ht.child;const i=Object.assign(Object.assign({},c),{onClick:()=>{n.addFolder(),s.refresh()}});return e.cloneElement(o,i)}function Es(t){const n=an(),s=e.useContext(is),{children:r}=t,c=pt(t,["children"]),o=e.Children.only(r);if(!e.isValidElement(o))throw Ht.child;const i=Object.assign(Object.assign({},c),{onClick:()=>{n.addMash(),s.refresh()}});return e.cloneElement(o,i)}const vs=function(t={}){var n,s,r,c,o,i;const a=Wt(t),{icons:l}=a;(n=a.props).key||(n.key="composer"),(s=a.props).className||(s.className="panel composer"),(r=a.props).initialPicked||(r.initialPicked="container"),(c=a.header).content||(c.content=[l.composer]),(o=a.footer).content||(o.content=[e.createElement(Es,null,e.createElement(bs,null,l.add,l.mmWide)),e.createElement(ys,null,e.createElement(bs,null,l.add,l.folder))]),(i=a.content).children||(i.children=e.createElement("div",{key:"layer",className:"layer"},e.createElement("div",{key:"icons"},e.createElement(us,{key:"depth"},e.createElement("div",{className:"depth"})),e.createElement(gs,{key:"layer-folder"},e.createElement(ps,{key:"folder-open"},e.createElement("div",{className:O},l.folder)),e.createElement(ms,{key:"folder-close"},e.createElement("div",{className:O},l.folderOpen))),e.createElement(hs,{key:"layer-mash"},e.createElement("div",{key:"mash-icon",className:O},l.mmTube))),e.createElement(fs,{key:"label"}),e.createElement("div",{key:"play-button",className:O},l.playerPlay)));const d=e.createElement(e.Fragment,null,e.createElement(Ut,Object.assign({},a.header)),e.createElement(ds,Object.assign({},a.content.props),a.content.children),e.createElement(Ut,Object.assign({},a.footer)));return Object.assign(Object.assign({},a.props),{children:d})};function Os(t){const{children:s}=t,r=pt(t,["children"]),c=an(),o=()=>c.can(M.Save),[i,a]=e.useState(o),l=()=>{a(o())};ss({[n.Action]:l,[n.Mash]:l,[n.Cast]:l,[n.Save]:l});const d=Object.assign(Object.assign({},r),{onClick:()=>{i||c.create()},disabled:i});return e.cloneElement(e.Children.only(s),d)}function js(t){const[s,r]=e.useState(!0),c=an();ss({[n.Action]:()=>{r(!c.can(M.Redo))}});const{children:o}=t,i=pt(t,["children"]),a=Object.assign(Object.assign({},i),{onClick:()=>{c.redo()},disabled:s});return e.cloneElement(e.Children.only(o),a)}function ks(t){const{children:s,type:c}=t,o=pt(t,["children","type"]),i=c||r.Clip;q(i);const a=an(),[l,d]=e.useState(!a.selection[i]);ss({[n.Selection]:()=>{d(!a.selection[i])}});const u=e.Children.only(s),m=Object.assign(Object.assign(Object.assign({},o),u.props),{onClick:()=>{if(l)return;const e=a.selection[i];Te(e)?a.removeEffect(e):De(e)?a.removeClip(e):Pe(e)&&a.removeTrack(e)},disabled:l});return e.cloneElement(u,m)}function Cs(t){const s=an(),[r,c]=e.useState(!0);ss({[n.Action]:()=>{c(!s.can(M.Undo))}});const{children:o}=t,i=pt(t,["children"]),a=Object.assign(Object.assign({},i),{onClick:()=>{s.undo()},disabled:r});return e.cloneElement(e.Children.only(o),a)}function Ss(t){const s=e.useContext(cn),r=e.useContext(Kt),{children:c}=t,o=pt(t,["children"]),{processing:i,setProcessing:a,setError:l}=s,{endpointPromise:d}=r,u=an(),m=()=>!u.can(M.Render),[p,g]=e.useState(m),f=()=>g(m());ss({[n.Save]:f,[n.Mash]:f,[n.Action]:f});const h=(e,t)=>{setTimeout((()=>{console.debug("handleApiCallback request",e),Oe(e).then((n=>{console.debug("handleApiCallback response",n);const{apiCallback:s,error:r}=n;if(r)b(e.endpoint.prefix,e.request,n,r);else if(s){const{request:e,endpoint:n}=s;if(n.prefix===k.data.mash.put){const n=e.body,{rendering:s}=n.mash;s&&(t.rendering=s)}h(s,t)}else a(!1)}))}),2e3)},b=(e,t,n,s)=>{a(!1),l(s),console.error(e,t,n,s)},y=Object.assign(Object.assign({},o),{onClick:()=>{if(p||i)return;const{edited:e}=u;Re(e),a(!0);const t={mash:e.toJSON(),definitions:u.definitions.map((e=>e.toJSON())),outputs:[{outputType:Le.Video}]};console.debug("RenderingStartRequest",k.rendering.start,t),d(k.rendering.start,t).then((n=>{console.debug("RenderingStartResponse",k.rendering.start,n);const{apiCallback:s,error:r}=n;r?b(k.rendering.start,t,n,r):h(s,e)}))},disabled:p||i});return e.cloneElement(e.Children.only(c),y)}function xs(t){const s=an(),r=e.useContext(Pt),{save:c}=r,o=()=>!s.can(M.Save),[i,a]=e.useState(o),l=()=>{a(o())};ss({[n.Action]:l,[n.Save]:l});const{children:d}=t,u=pt(t,["children"]),m=Object.assign(Object.assign({},u),{onClick:()=>{i||(a(!0),c())},disabled:i});return e.cloneElement(e.Children.only(d),m)}const Ns={actionCount:0,selectedInfo:{tweenDefined:{},tweenSelected:{},selectedType:r.None,selectTypes:[]},selectedItems:[],changeSelected:t,changeTweening:t},ws=e.createContext(Ns);function Ts(t){var s,r;const c=an(),[o,i]=e.useState(!1),[a,l]=e.useState((()=>[])),[d,m]=e.useState((null===(s=c.edited)||void 0===s?void 0:s.id)||""),p=e.useContext(Kt),f=e.useContext(ws),{selectedInfo:b}=f,{selectedType:E}=b,[v,O]=e.useState((null===(r=c.edited)||void 0===r?void 0:r.label)||""),j=()=>c.can(M.Save),[C,S]=e.useState(j),{enabled:x,servers:N,endpointPromise:w}=p,T=()=>{S(j())},D=e=>{const{type:t}=e;if(!Ce(t)||!$(t))return;if(t!==E)return;const{edited:n}=c;y(n);const{id:s,label:r}=n;l((e=>{const t=e.filter((e=>u(e.label))),c=t.findIndex((e=>e.id===s));return h(c)?t.splice(c,1,n):t.push(n),m(s),O(r),t}))};ss({[n.Action]:()=>{const{edited:e}=c;y(e);const{label:t}=e;v!==t&&(l((e=>[...e])),O(t)),T()},[n.Mash]:D,[n.Cast]:D,[n.Save]:T},c.eventTarget);if(e.useEffect((()=>{if(!x||!N[U.Data])return;if(o)return;i(!0);const e={partial:!0},t=k.data[c.editType].retrieve;console.debug("RetrieveRequest",t,e),w(t,e).then((e=>{console.debug("RetrieveResponse",t,e);const{described:n,error:s}=e;s?console.error("RetrieveResponse",t,s):l((e=>{const t=[...e];return n.forEach((e=>{const{id:n,label:s}=e,r=t.find((e=>e.id===n));!r&&u(s)&&t.push(e)})),t}))}))}),[N,x]),a.length<2)return null;const{children:P}=t,R=pt(t,["children"]),L=e.Children.only(P);g(e.isValidElement(L));const A={key:"edited-select",onChange:e=>{if(C)return;const{selectedIndex:t}=e.target,n=a[t];y(n);const{id:s}=n,r={id:s},{editType:o}=c,i=k.data[o].get;console.debug("GetRequest",i,r),w(i,r).then((e=>{console.debug("GetResponse",i,e);const{error:t}=e;if(!t)return c.load(e);console.error("GetResponse",i,t)}))},disabled:C,children:(()=>{const{editType:t,edited:n}=c,s=[e.createElement("optgroup",{key:"group",label:vt("open")})];if(!n)return s;const{id:r,label:o}=n;return s.push(...a.map((n=>{const{label:s,id:c}=n,i=c===r?o:s,a={children:u(i)?i:Ot("unlabeled",{type:t}),value:c,key:c};return e.createElement("option",Object.assign({},a))}))),s})(),value:d},z=Object.assign(Object.assign({},R),{children:[L,e.createElement("select",Object.assign({},A))]});return e.createElement(ft,Object.assign({},z))}function Ds(t){const s=an(),r=()=>{const{edited:e}=s;if(!Ae(e))return!0;const{rendering:t}=e;return!t},[c,o]=e.useState(r),i=()=>o(r());ss({[n.Render]:i,[n.Mash]:i});const{children:a}=t,l=pt(t,["children"]),d=Object.assign(Object.assign({},l),{onClick:()=>{if(c)return;const{edited:e}=s;Re(e);const t=$e(s.preloader.endpoint,e.rendering);window.open(t)},disabled:c});return e.cloneElement(e.Children.only(a),d)}const Ps=e.createElement((function(e){return null}),{key:"empty"}),Rs="tween-input-key",Ls={[c.Frame]:Ps,[c.Number]:Ps,[c.Rgb]:Ps,[c.String]:Ps,[c.DefinitionId]:Ps,[c.FontId]:Ps,[c.Percent]:Ps,[c.ContainerId]:Ps,[c.ContentId]:Ps,[c.Boolean]:Ps,[c.Timing]:Ps,[c.Sizing]:Ps},As={value:"",name:"",property:{type:c.String,name:"",defaultValue:""}},$s=e.createContext(As);function zs(){const t=e.useContext($s),{changeHandler:n,property:s,value:r,name:c}=t;if(!s)return null;const o={type:"checkbox",name:c,checked:!!r};return n?o.onChange=e=>{n(c,e.target.checked)}:o.disabled=!0,e.createElement("input",Object.assign({},o))}function Is(t){const{type:n,types:s,children:r,className:c}=t,o=pt(t,["type","types","children","className"]),i=e.Children.only(r);g(e.isValidElement(i));const[a,l]=e.useState(!1),d=e.useContext($s),u=e.useContext(Pt),{drop:m}=u,{changeHandler:p,value:f,name:h}=d;g(p);const b=Mn(n,s),y=e=>{const{dataTransfer:t}=e;g(t);if(Ln(t).includes("Files"))return!0;const n=Rn(t);return!!w(n)&&b.includes(n)},E=e.useMemo((()=>{const e=[];return c&&e.push(c),a&&e.push(A),e.join(" ")}),[a]),v=Object.assign(Object.assign({},o),{className:E,children:(()=>{if(!f)return null;z(f);const t=W.fromId(f);ze(t);const n={definition:t,key:t.id},s={children:e.cloneElement(i,n),value:{definition:t}};return e.createElement(En.Provider,Object.assign({},s))})(),onDragLeave:()=>{l(!1)},onDragOver:e=>{const t=y(e);l(t),t&&e.preventDefault()},onDrop:e=>gt(this,void 0,void 0,(function*(){if(ue(e),l(!1),!y(e))return;const{dataTransfer:t}=e;g(t);if(Ln(t).includes("Files"))return void(yield m(t.files).then((e=>{if(!e.length)return;const t="containerId"===h?e.filter(Ie):e,[n]=t;n&&(g(W.installed(n.id),`${n.type} installed`),p(h,n.id))})));const n=Dn(t),s=t.getData(n),r=JSON.parse(s),{definitionObject:c}=r,[o]=W.define(c);("containerId"!==h||Ie(o))&&p(h,c.id)})),value:String(f),key:`${h}-drop`});return e.createElement(ft,Object.assign({},v))}function Vs(){const t=e.useContext($s),{changeHandler:n,value:s,name:r}=t;g(n);const c={children:W.byType(B.Font).map((t=>{const{id:n,label:s}=t,r={value:n,children:s,key:n};return e.createElement("option",Object.assign({},r))})),name:r,onChange:e=>{n(r,e.target.value)},value:String(s),key:`${r}-select`};return e.createElement("select",Object.assign({},c))}function Hs(){const t=e.useContext($s),n=an(),{changeHandler:s,property:r,value:c,name:o,time:i}=t;if(!r)return null;const{min:a,max:l,step:d}=r,u={type:"number",name:o,value:String(c)};return J(a)&&(u.min=a),J(l)&&(u.max=l),J(d)&&(u.step=d),s?u.onChange=e=>gt(this,void 0,void 0,(function*(){const{value:t}=e.target;i&&(yield n.goToTime(i)),s(o,t)})):u.disabled=!0,e.createElement("input",Object.assign({},u))}function Fs(t){const{className:n,onChange:s}=t,r=Object.assign({},t),c=["slider"];if(n&&c.push(n),r.className=c.join(" "),s){const e=e=>{s(e,e.currentTarget.valueAsNumber)};r.onChange=e}return e.createElement("input",Object.assign({type:"range"},r))}function Ms(){const t=an(),n=e.useContext($s),{changeHandler:s,property:r,value:c,name:o,time:i,defaultValue:a}=n;if(!r)return null;const{max:l,min:d,step:u,defaultValue:m}=r,p={value:J(c)?c:J(a)?a:m,min:G(d)?d:0,max:G(l)?l:1,step:G(u)?u:.01,name:o};if(s){const e=(e,n)=>gt(this,void 0,void 0,(function*(){const e=P(n)?n[0]:n;i&&(yield t.goToTime(i)),s(o,e)}));p.onChange=e}else p.disabled=!0;return e.createElement(Fs,Object.assign({className:"slider"},p))}function qs(){e.useContext(Pt);const t=e.useContext($s),n=an(),{changeHandler:s,property:r,value:c,name:o,time:i,defaultValue:a}=t;if(!r)return null;const{defaultValue:l}=r,d=J(c)?c:J(a)?a:l,u={type:"color",name:o,value:String(d)};return s?u.onChange=e=>gt(this,void 0,void 0,(function*(){const{value:t}=e.target;i&&(yield n.goToTime(i)),s(o,t)})):u.disabled=!0,e.createElement("input",Object.assign({},u))}function Us(){const t=e.useContext($s),{changeHandler:n,property:s,value:r,name:c}=t;if(!s)return null;const o={children:X.map((t=>{const n={value:t,children:t,key:t};return e.createElement("option",Object.assign({},n))})),name:c,value:String(r),key:`${c}-select`};return n?o.onChange=e=>{n(c,e.target.value)}:o.disabled=!0,e.createElement("select",Object.assign({},o))}function Ws(){const t=e.useContext($s),{changeHandler:n,property:s,value:r,name:c}=t;if(!s)return null;const o={name:c,type:"text",value:String(r)};return n?o.onChange=e=>{n(c,e.target.value)}:o.disabled=!0,e.createElement("input",Object.assign({},o))}function Bs(){const t=e.useContext($s),{changeHandler:n,property:s,value:r,name:c}=t;if(!s)return null;const o={children:Z.map((t=>{const n={value:t,children:t,key:t};return e.createElement("option",Object.assign({},n))})),name:c,value:String(r),key:`${c}-select`};return n?o.onChange=e=>{n(c,e.target.value)}:o.disabled=!0,e.createElement("select",Object.assign({},o))}Ls[c.Boolean]=e.createElement(zs,null),Ls[c.ContainerId]=e.createElement(Is,{types:o,className:"definition-drop"},e.createElement(Jn,{className:"definition preview"})),Ls[c.ContentId]=e.createElement(Is,{types:i,className:"definition-drop"},e.createElement(Jn,{className:"definition preview"})),Ls[c.FontId]=e.createElement(Vs,null),Ls[c.Number]=e.createElement(Hs,null),Ls[c.Frame]=e.createElement(Hs,null),Ls[c.Percent]=e.createElement(Ms,null),Ls[c.Rgb]=e.createElement(qs,null),Ls[c.Sizing]=e.createElement(Us,null),Ls[c.String]=e.createElement(Ws,null),Ls[c.Timing]=e.createElement(Bs,null);const Js={[a.Size]:Ps,[a.Sizing]:Ps,[a.Point]:Ps,[a.Opacity]:Ps,[a.Color]:Ps,[a.Effects]:Ps,[a.Timing]:Ps};function Gs(t){const n=e.useContext(Pt),{icons:s}=n,r=an(),{selectType:c}=t,o=pt(t,["selectType"]);q(c);const i=e.useContext(ws),{selectedItems:l,changeTweening:d,selectedInfo:u}=i,{tweenDefined:m,tweenSelected:p,onEdge:g,time:f,nearStart:h,timeRange:b}=u;Y(b),_(f);const y=m[a.Color],E=p[a.Color],v=K(l,a.Color,c),{color:j,[`color${ne}`]:k}=v,C=E?k:j,{property:S,changeHandler:x,value:N,name:w}=C,{type:T,name:D}=S,P=w||D,R=Ls[T],L={property:S,value:N,name:P,changeHandler:x};L.time=Q(b,g,h,y,E),E&&(L.defaultValue=j.value);const A=[Ee,O].join(" "),$={children:s.start,className:E?O:A,key:"start",onClick:()=>{r.goToTime(b.startTime),d(a.Color,!1)}},z={key:"end",className:E?A:O,children:y?s.end:s.endUndefined,onClick:()=>{r.goToTime(b.lastTime),d(a.Color,!0)}},I={key:"context",value:L,children:R},V=Object.assign(Object.assign({},o),{key:`inspector-${c}-${P}`,children:[s.color,e.createElement($s.Provider,Object.assign({},I)),e.createElement(ft,{className:"start-end",key:"start-end"},e.createElement(ft,Object.assign({},$)),e.createElement(ft,Object.assign({},z)))]});return e.createElement(ft,Object.assign({},V))}Js[a.Color]=e.createElement(Gs,{className:"color tween row",key:"color-group-input"});const Xs=(e,t)=>{if(!t||!e)return;const{width:n,height:s}=t;e.style.setProperty("--preview-width",`${n}px`),e.style.setProperty("--preview-height",`${s}px`)},Zs=e=>globalThis.window.sessionStorage.getItem(e)||"",Ys=(e,t)=>{globalThis.window.sessionStorage.setItem(e,String(t))},_s=e.forwardRef(((t,n)=>e.createElement("video",Object.assign({},t,{ref:n}))));function Ks(t){const{className:n,removeHandler:s,index:r,effect:c,selectedEffect:o,setSelectedEffect:i}=t,a=pt(t,["className","removeHandler","index","effect","selectedEffect","setSelectedEffect"]),l=o===c,d=()=>{l||i(c)},u=[n||"effect"];l&&u.push(Ee);const m=Object.assign(Object.assign({},a),{children:c.label,className:u.join(" "),onMouseDown:d,onDragStart:e=>{l||d();const t={index:r},n=JSON.stringify(t),{dataTransfer:s}=e;s&&(s.effectAllowed="move",s.setData(`effect${vn}`,n))},onDragEnd:e=>{const{dataTransfer:t}=e;if(!t)return;const{dropEffect:n}=t;"none"===n&&s(c)},onClick:e=>e.stopPropagation(),draggable:!0});return e.createElement(ft,Object.assign({},m))}function Qs(t){const{defaultValue:n,changeHandler:s,time:r,property:c,value:o,name:i}=t,{type:a,defaultValue:l}=c,d={key:"context",value:{property:c,value:o,changeHandler:s,name:i,time:r,defaultValue:J(n)?n:l},children:Ls[a]};return e.createElement($s.Provider,Object.assign({},d))}function er(t){const n=e.useContext(Pt),{icons:s}=n,c=e.useContext(ws),{selectedItems:o}=t,{selectedItems:i}=c,a=o||i,l=[],d=[],u={},m=new Set;return a.forEach((n=>{if(ee(n)){const{property:r,changeHandler:c,selectType:o,value:i,name:a}=n,{name:p,group:g}=r;if(g){const t=[g,o].join("-");return void(u[t]||(u[t]=!0,d.push(e.cloneElement(Js[g],{selectType:o}))))}const f=a||p;m.add(o);const h=Object.assign({key:`inspector-${o}-${f}`,property:r,value:i,changeHandler:c,name:f},t),b=s[f],y=e.createElement(Qs,Object.assign({},h));if(b){const t=[y];t.unshift(b);const n={children:t,className:"row",key:`icon-${o}-${f}`};l.push(e.createElement(ft,Object.assign({},n)))}else l.push(y)}else{const t={key:"inspector-effects",selectedEffects:n};d.push(e.cloneElement(Js.effects,t))}})),m.has(r.Clip)&&l.push(),e.createElement(e.Fragment,null,l,d)}function tr(t){const n=e.useContext(Pt),{icons:s}=n,{selectedEffects:r}=t,c=pt(t,["selectedEffects"]),o=e.useRef(null),[i,a]=e.useState(!1),[l,u]=e.useState(null),m=an(),{actions:p}=m;g(r);const{value:f,addHandler:h,removeHandler:b,moveHandler:y}=r,E=l&&f.includes(l)?l:null;E!==l&&u(E);const v=e=>{const{dataTransfer:t}=e;return Rn(t)===B.Effect},O=e.useMemo((()=>{const e=["list"];return i&&e.push(A),e.join(" ")}),[i]),j={children:f.map(((t,n)=>{const s={key:t.id,selectedEffect:E,setSelectedEffect:u,effect:t,index:n,removeHandler:b};return e.createElement(Ks,Object.assign({},s))})),ref:o,onDragLeave:()=>{a(!1)},onDragOver:e=>{const t=v(e);a(t),t&&e.preventDefault()},onDrop:e=>{if(a(!1),!v(e))return;e.preventDefault();const{dataTransfer:t}=e;if(!t)return;const n=Dn(t),s=t.getData(n),r=JSON.parse(s),{definitionObject:c,index:o}=r,i=(e=>{const{target:t}=e;if(t&&t instanceof HTMLDivElement){const e=t.getAttribute("index");if(e)return Number(e)}return f.length})(e);if(d(c)){const e=W.fromObject(c);if(He(e)){const t=e.instanceFromObject();h(t,i)}}else{if(i===o)return;Ve(E),y(E,i)}},onClick:()=>{u(null)},key:"view",className:O},k=Object.assign(Object.assign({},c),{key:"effects",children:[s.browserEffect,e.createElement(ft,Object.assign({},j))]}),C=e.createElement(ft,Object.assign({},k));return E?e.createElement(e.Fragment,null,C,e.createElement(er,{selectedItems:E.selectedItems(p)})):C}function nr(t){const n=e.useContext(Pt),{icons:s}=n,r=an(),{selectType:c}=t,o=pt(t,["selectType"]);q(c);const i=e.useContext(ws),{selectedItems:l,changeTweening:d,selectedInfo:u}=i,{tweenDefined:m,tweenSelected:p,onEdge:g,time:f,nearStart:h,timeRange:b}=u;Y(b),_(f);const y=m[a.Opacity],E=p[a.Opacity],v=K(l,a.Opacity,c),{opacity:j,[`opacity${ne}`]:k}=v,C=E?k:j,{property:S,changeHandler:x,value:N,name:w}=C,{type:T,name:D}=S,P=w||D,R=Ls[T],L={property:S,value:N,name:P,changeHandler:x};L.time=Q(b,g,h,y,E),E&&(L.defaultValue=j.value);const A=[Ee,O].join(" "),$={children:s.start,className:E?O:A,key:"start",onClick:()=>{r.goToTime(b.startTime),d(a.Opacity,!1)}},z={key:"end",className:E?A:O,children:y?s.end:s.endUndefined,onClick:()=>{r.goToTime(b.lastTime),d(a.Opacity,!0)}},I={key:"context",value:L,children:R},V=Object.assign(Object.assign({},o),{key:`inspector-${c}-${P}`,children:[s.opacity,e.createElement($s.Provider,Object.assign({},I)),e.createElement(ft,{className:"start-end",key:"start-end"},e.createElement(ft,Object.assign({},$)),e.createElement(ft,Object.assign({},z)))]});return e.createElement(ft,Object.assign({},V))}function sr(t){const n=e.useContext(Pt),{icons:s}=n,r=an(),{selectType:c}=t;q(c);const o=e.useContext(ws),{selectedItems:i,changeTweening:l,selectedInfo:d}=o,{tweenDefined:u,tweenSelected:m,onEdge:p,time:g,nearStart:f,timeRange:h}=d;Y(h),_(g);const b=u[a.Point],y=m[a.Point],E=K(i,a.Point,c),v=te(E),{offE:j,offW:k,offN:C,offS:S,x:x,y:N,[`x${ne}`]:w,[`y${ne}`]:T}=E,D=y?w:x,P=y?T:N,{offE:R,offW:L,offN:A,offS:$}=v,z={},I=[D,P],V=Q(h,p,f,b,y);I.forEach((t=>{if(!t)return void console.error("PointInput",D,P);const{property:n,changeHandler:s,value:r,name:o}=t,{type:i,name:a}=n,l=o||a,d=l.replace(ne,""),u=Ls[i],m=`inspector-${c}-${l}`,p={property:n,value:r,name:l,changeHandler:s,time:V};y&&(p.defaultValue=v[d]);const g={key:m,value:p,children:u};z[d]=e.createElement($s.Provider,Object.assign({},g))}));const H=[Ee,O].join(" "),F={children:s.start,className:y?O:H,key:"start",onClick:()=>{r.goToTime(h.startTime),l(a.Point,!1)}},M={key:"end",className:y?H:O,children:b?s.end:s.endUndefined,onClick:()=>{r.goToTime(h.lastTime),l(a.Point,!0)}},U=[s.point,e.createElement(ft,{className:"start-end",key:`${c}-point-start-end`},e.createElement(ft,Object.assign({},F)),e.createElement(ft,Object.assign({},M)))],W=[e.createElement(ft,{key:"horz-icon",children:s.horz,className:O})],B=[e.createElement(ft,{key:"vert-icon",children:s.vert,className:O})];if(j){const t={key:"lock-east",className:O,children:R?s.unlock:s.lock,onClick:()=>{j.changeHandler("offE",!R)}},n=e.createElement(ft,Object.assign({},t));W.push(n)}if(W.push(z.x),k){const t={key:"lock-west",className:O,children:L?s.unlock:s.lock,onClick:()=>{k.changeHandler("offW",!L)}},n=e.createElement(ft,Object.assign({},t));W.push(n)}if(C){const t={key:"lock-north",className:O,children:A?s.unlock:s.lock,onClick:()=>{C.changeHandler("offN",!A)}},n=e.createElement(ft,Object.assign({},t));B.push(n)}if(B.push(z.y),S){const t={key:"lock-south",className:O,children:$?s.unlock:s.lock,onClick:()=>{S.changeHandler("offS",!$)}},n=e.createElement(ft,Object.assign({},t));B.push(n)}const J=[e.createElement(ft,{key:"x",children:W}),e.createElement(ft,{key:"y",children:B})];return e.createElement("fieldset",null,e.createElement("legend",{key:"legend"},e.createElement(ft,null,U)),J)}Js[a.Effects]=e.createElement(tr,{className:"effects row",key:"effects-group-input"}),Js[a.Opacity]=e.createElement(nr,{className:"opacity tween row",key:"opacity-group-input"}),Js[a.Point]=e.createElement(sr,{key:"point-input"});const rr={[l.H]:"width",[l.V]:"height"};function cr(t){const n=e.useContext(Pt),{icons:s}=n,r=an(),{selectType:c}=t;q(c,"selectType");const o=e.useContext(ws),{selectedItems:i,selectedInfo:d,changeTweening:u}=o,{tweenDefined:m,tweenSelected:p,onEdge:g,time:f,nearStart:h,timeRange:b}=d;Y(b),_(f);const y=m[a.Size],E=p[a.Size],v=K(i,a.Size,c),{lock:j,width:k,height:C,[`width${ne}`]:S,[`height${ne}`]:x}=v,N=E?S:k,w=E?x:C,T=te(v),{lock:D}=T;se(D,"lockValue");const P=re(D)?D:void 0,R={},L=[N,w],A=Q(b,g,h,y,E);L.forEach((t=>{const{property:n,changeHandler:s,value:r,name:o}=t,{type:i,name:a}=n,l=o||a,d=l.replace(ne,""),u=Ls[i],m=`inspector-${c}-${l}`,p={property:n,value:r,name:l,time:A};E&&(p.defaultValue=T[d]),P&&d===rr[P]||(p.changeHandler=s);const g={key:m,value:p,children:u};R[d]=e.createElement($s.Provider,Object.assign({},g))}));const $={key:"lock-width",className:O,children:P===l.H?s.lock:s.unlock,onClick:()=>{const e=P===l.H?"":l.H;j.changeHandler("lock",e)}},z=e.createElement(ft,Object.assign({},$)),I={key:"lock-height",className:O,children:P===l.V?s.lock:s.unlock,onClick:()=>{const e=P===l.V?"":l.V;j.changeHandler("lock",e)}},V=[Ee,O].join(" "),H=e.createElement(ft,Object.assign({},I)),F={children:s.start,className:E?O:V,key:"start",onClick:()=>{r.goToTime(b.startTime),u(a.Size,!1)}},M={key:"end",className:E?V:O,children:y?s.end:s.endUndefined,onClick:()=>{r.goToTime(b.lastTime),u(a.Size,!0)}},U=[s.size,e.createElement(ft,{className:"start-end",key:`${c}-size-start-end`},e.createElement(ft,Object.assign({},F)),e.createElement(ft,Object.assign({},M)))],W=[e.createElement(ft,{key:"width-icon",children:s.width,className:O}),R.width,z],B=[e.createElement(ft,{key:"height-icon",children:s.height,className:O}),R.height,H],J=[e.createElement(ft,{key:"width",children:W}),e.createElement(ft,{key:"height",children:B})];return e.createElement("fieldset",null,e.createElement("legend",{key:"legend"},e.createElement(ft,null,U)),J)}function or(t){const{selectType:n}=t;q(n);const s=e.useContext(ws),{selectedItems:r}=s,c=K(r,a.Sizing,n),o=Object.fromEntries(Object.entries(c).map((([n,s])=>{const{property:r,changeHandler:c,selectType:o,value:i,name:a}=s,{name:l}=r,d=a||l,u=Object.assign({key:`inspector-${o}-group-${d}`,property:r,value:i,changeHandler:c,name:d},t);return[n,e.createElement(Qs,Object.assign({},u))]})));return e.createElement(ft,null,Object.values(o))}function ir(t){const n=e.useContext(Pt),{icons:s}=n,{selectType:r}=t;q(r);const c=e.useContext(ws),{selectedItems:o}=c,i=K(o,a.Timing,r),l=Object.fromEntries(Object.entries(i).map((([n,s])=>{const{property:r,changeHandler:c,selectType:o,value:i,name:a}=s,{name:l}=r,d=a||l,u=Object.assign({key:`inspector-${o}-group-${d}`,property:r,value:i,changeHandler:c,name:d},t);return[n,e.createElement(Qs,Object.assign({},u))]}))),{timing:d}=l,u=pt(l,["timing"]);if(!T(u)){const t={key:"timing",children:[s.timing,d],className:"row"};return e.createElement(ft,Object.assign({},t))}const m=[s.timing];d&&m.push(d);const p=Object.entries(u).map((([t,n])=>{const r=s[t],c=[n];r&&c.unshift(e.createElement(ft,{key:`${t}-icon`,children:r,className:O}));const o={key:`${t}-view`,children:c};return e.createElement(ft,Object.assign({},o))}));return e.createElement("fieldset",null,e.createElement("legend",{key:"legend"},e.createElement(ft,null,m)),p)}function ar(t){const s=an(),[c,o]=e.useState((()=>0)),i=e.useRef({tweenDefined:{},tweenSelected:{},selectedType:r.None,selectTypes:[]}),[a,l]=e.useState((()=>ce)),[d,u]=e.useState((()=>[])),m=()=>{o((e=>e+1))},p=()=>{const{selection:e}=s,{selectTypes:t,clip:n,mash:r}=e,{current:c}=i,{selectedType:o,selectTypes:l}=c,d=a.find((e=>t.includes(e)));q(d),d!==o&&(c.selectedType=d),ie(l,t);const p=s.selection.selectedItems([d]),g={};if(n&&r){const e=p.filter((e=>{if(!ee(e))return;const{property:t,name:n}=e,{tweenable:s,group:r}=t;return s&&r&&n?n.endsWith(ne):void 0}));if(e.forEach((e=>{const{property:t,value:n}=e,{group:s}=t;Fe(s),g[s]=J(n)})),e.length){const{time:e,quantize:t}=r,s=n.timeRange(t);c.time=e,c.timeRange=s;const o=s.frame+Math.round(s.frames/2),i=Me(o,t),[a,l]=qe(i,e);c.nearStart=a.frame>l.frame;const d=c.nearStart?s.startTime:s.lastTime;c.onEdge=e.equalsTime(d)}}c.tweenDefined=g,u(p),m()};ss({[n.Action]:m,[n.Selection]:p});const f=e.useCallback((e=>{q(e),l((t=>{const n=t.indexOf(e);oe(n);const s=[e];return n&&s.push(...t.slice(0,n)),n<t.length-1&&s.push(...t.slice(n+1)),g(s.length===t.length,"type lengths match"),ie(t,s),p(),t})),i.current.selectedType=e,u(s.selection.selectedItems([e]))}),[]),h=Object.assign(Object.assign({},Ns),{actionCount:c,selectedItems:d,changeSelected:f,changeTweening:(e,t)=>{i.current.tweenSelected[e]=t,p()},selectedInfo:i.current});return e.createElement(ws.Provider,{value:h},e.createElement(ft,Object.assign({},t)))}function lr(t){return e.createElement(ft,Object.assign({},t))}function dr(t){const n=e.useContext(ws),{selectedInfo:s}=n,{selectedType:r}=s,{type:c,types:o,children:i}=t,a=qn(c,o);return ae(a),a.includes(r)?e.createElement(e.Fragment,null,i):null}function ur(t){const{id:n,children:s,className:r}=t;q(n);const c=e.useContext(ws),{changeSelected:o,selectedInfo:i}=c,{selectTypes:a,selectedType:l}=i;if(!a.includes(n))return null;const d=[];u(r)&&d.push(r),l===n&&d.push(Ee);const m={children:s,onClick:()=>{o(n)},className:d.join(" ")};return e.createElement(ft,Object.assign({},m))}Js[a.Size]=e.createElement(cr,{key:"size-group-input"}),Js[a.Sizing]=e.createElement(or,{key:"sizing-group-input"}),Js[a.Timing]=e.createElement(ir,{key:"timing-group-input"});const mr=function(t={}){var n,s,c,o,i;const a=Wt(t),{icons:l}=a;(n=a.props).key||(n.key="inspector"),(s=a.props).className||(s.className="panel inspector"),(c=a.header).content||(c.content=[l.inspector,e.createElement(Cs,{key:"undo"},e.createElement(bs,null,l.undo,vt("undo"))),e.createElement(js,{key:"redo"},e.createElement(bs,null,l.redo,vt("redo")))]),(o=a.footer).content||(o.content=[e.createElement(ur,{key:"mash",className:O,id:"mash"},l.document),e.createElement(ur,{key:"cast",className:O,id:"cast"},l.document),e.createElement(ur,{key:"layer",className:O,id:"layer"},l.composer),e.createElement(ur,{key:"clip",className:O,id:"clip"},l.clip),e.createElement(ur,{key:"container",className:O,id:"container"},l.container),e.createElement(ur,{key:"content",className:O,id:"content"},l.content)]);const d=[e.createElement(er,{key:"properties"})],u=[r.Clip,r.Track,r.Layer];d.push(e.createElement(en,{key:"api-enabled"},e.createElement(dr,{type:"mash",key:"inspector-mash"},e.createElement(ft,null,e.createElement(Ss,{key:"render-process"},e.createElement(bs,null,vt("render"),l.render)),e.createElement(Ds,{key:"view-control"},e.createElement(bs,null,vt("view"),l.view)))),e.createElement(dr,{types:"mash,cast",key:"inspector-document"},e.createElement(Ts,{key:"select-edited",className:"row",children:l.document}),e.createElement(ft,{key:"view"},e.createElement(xs,{key:"save-process"},e.createElement(bs,{key:"button"},vt("update"),l.document)),e.createElement(Os,{key:"create-edited"},e.createElement(bs,null,vt("create"),l.document)))))),u.forEach((t=>{d.push(e.createElement(dr,{key:`${t}-delete`,type:t},e.createElement(ks,{type:t},e.createElement(bs,null,Ot("delete",{type:t}),l.remove))))})),(i=a.content).children||(i.children=e.createElement(e.Fragment,null,d));const m=e.createElement(e.Fragment,null,e.createElement(Ut,Object.assign({},a.header)),e.createElement(lr,Object.assign({},a.content.props),a.content.children),e.createElement(Ut,Object.assign({},a.footer)));return Object.assign(Object.assign({},a.props),{children:m})};function pr(t){const{editType:s=le.Mash,previewSize:r,icons:c={},edited:o}=t,i=pt(t,["editType","previewSize","icons","edited"]),a=e.useRef({}),l=e.useRef(null),{current:d}=a,[u,m]=e.useState(),p=e.useRef(null),g=e.useContext(Kt),[f]=e.useState((()=>de({editType:s}))),[h,b]=e.useState(!1),[E,v]=e.useState(),{enabled:O,endpointPromise:j,servers:C}=g;e.useEffect((()=>{Xs(p.current,r)}),[r]);const S=e=>{const t=e||o||{[s]:{},definitions:[]},{previewSize:n=r}=t,c=pt(t,["previewSize"]),{current:i}=l,{current:a}=p;y(i),pe(n)&&Xs(a,n),f.svgElement=i,f.load(c)};e.useEffect((()=>{if(O){if(!h&&C[U.Data]){b(!0);const e={};j(k.data[s].default,e).then((e=>{var t;console.debug("DataDefaultResponse",k.data[s].default,e),pt(e,["previewSize"]),(null===(t=C.file)||void 0===t?void 0:t.prefix)&&(f.preloader.endpoint.prefix=String(C.file.prefix)),S(e)}))}}else S()}),[C]);const x=(e,t,s)=>{console.debug("handleApiCallback request",s);const{eventTarget:r}=f;return Oe(s).then((c=>{console.debug("handleApiCallback response",c);const{apiCallback:o,error:i}=c;if(i)return N(s.endpoint.prefix,i,e);if(o){const{request:i,endpoint:a}=o;if(a.prefix===k.data.definition.put){y(i);const{body:e}=i;y(e);const n=e,{definition:s}=n;f.updateDefinition(s,t)}if(s.endpoint.prefix===k.rendering.status){const t=c;let s=0,o=0;ut.forEach((e=>{const n=t[e];n&&(s+=n.total,o+=n.completed)})),s&&r.emit(n.Active,{id:e,step:o,steps:s,type:Je.Render})}return new Promise((e=>{setTimeout(e,2e3)})).then((()=>x(e,t,o)))}r.emit(n.Active,{id:e,type:Je.Complete})}))},N=(e,t,s)=>(f.eventTarget.emit(n.Active,{id:s,type:Je.Error,error:"import.render",value:t}),console.error(e,t),Promise.reject(t)),w=e=>{m(e)},T={editor:f,draggable:E,setDraggable:v,save:()=>gt(this,void 0,void 0,(function*(){const{definitionsUnsaved:e}=f,t=(e=>{let t=Promise.resolve();const{eventTarget:s}=f;return e.forEach((e=>{dt(e);const{label:r,type:c,source:o}=e,i=ct("activity");s.emit(n.Active,{id:i,label:r,type:Je.Render});const{rendering:a}=k,l=fetch(o).then((e=>e.blob())).then((e=>new File([e],r))).then((t=>{const n={type:c,name:r,size:t.size};return console.debug("RenderingUploadRequest",a.upload,n),j(a.upload,n).then((n=>{console.debug("RenderingUploadResponse",a.upload,n);const{error:s,fileApiCallback:r,apiCallback:c,fileProperty:o}=n;return s?N(a.upload,s,i):r&&r.request?(o?r.request.body[o]=t:r.request.body=t,Oe(r).then((t=>{console.debug("FileStoreResponse",t);const{error:n}=t;return n?N(r.endpoint.prefix,n,i):(y(c),x(i,e,c))}))):(y(c),x(i,e,c))}))}));t=t.then((()=>l))})),t})(e),s=t.then((()=>f.dataPutRequest())).then((e=>{const{editType:t}=f;console.debug("DataPutRequest",k.data[t].put,JSON.parse(JSON.stringify(e))),j(k.data[t].put,e).then((e=>{console.debug("DataPutResponse",k.data[t].put,e);const{error:n,temporaryIdLookup:s}=e;n?console.error(k.data[t].put,n):f.saved(s)}))}));yield s})),editorIndex:d,drop:(e,t)=>e?De(e)||Te(e)||Xe(e)?Promise.resolve([]):Ze(e)?((e,t)=>f.add(e,t))(e,t):Ye(e)?Promise.resolve([]):((e,t)=>{const s=In(e,C.file);if(s.length){const e=[],r=[],{eventTarget:c}=f;if(s.forEach((t=>{t instanceof File?r.push(t):e.push(t)})),e.length&&e.forEach((e=>{const t=ct("activity-error"),s=Object.assign({id:t,type:Je.Error},e);c.emit(n.Active,s)})),r.length)return f.addFiles(r,t)}return Promise.resolve([])})(e,t).then((e=>{const[t]=e;return _e(t)&&w(t),e})):Promise.resolve([]),definition:u,changeDefinition:w,icons:c},D=Object.assign(Object.assign({},i),{onDrop:ue,ref:p});return e.createElement(Pt.Provider,{value:T},e.createElement(ft,Object.assign({},D)),e.createElement("svg",{style:{display:"none"},ref:l}))}const gr={paused:!1,changePaused:t,changeVolume:t,volume:0},fr=e.createContext(gr);function hr(s){const{children:c,className:o}=s,i=pt(s,["children","className"]),a=an(),[l,d]=e.useState((()=>me(a.rect))),u=e.useRef(null),m=e.useRef(null),p=e.useContext(Pt),[g,f]=e.useState(!1),h=e.useContext(fr),{disabled:b}=h,{drop:E}=p,v=e.useRef({}),{current:O}=v,[j]=e.useState(new ResizeObserver((()=>{const{current:e}=m;if(!e)return;const t=Ue(e.getBoundingClientRect());d((()=>(a.rect=t,me(t))))})));e.useEffect((()=>{const{current:e}=m;return e&&j.observe(e),()=>{j.disconnect()}}),[]);const k=()=>{const{redraw:e}=O;return delete O.timeout,delete O.redraw,a.previewItems(!b).then((t=>{(e=>{const{current:t}=u;t&&t.replaceChildren(...e)})(t),e&&S()}))},C=()=>{k().then(t)},S=()=>{const{current:e}=u,{rect:t}=a;e&&pe(t)&&(O.timeout?O.redraw=!0:O.timeout=setTimeout(C,10))};ss({[n.Draw]:S,[n.Selection]:S});const x=e=>{if(!e)return!1;return!!Ln(e).includes("Files")||w(Rn(e))},T=e=>{ue(e),f(!1)},D=[];o&&D.push(o),g&&D.push(A);const P=Object.assign(Object.assign({},i),{ref:m,className:D.join(" "),key:"player-content",onDragOver:e=>{ue(e),f(x(e.dataTransfer))},onDrop:e=>{T(e);const{dataTransfer:t}=e;if(!x(t))return;const{edited:n}=a;y(n);const s={clip:a.time.scale(n.quantize).frame,track:-1};if(Ln(t).includes("Files"))E(t.files,s);else{const e=Rn(t);N(e);const n=An(t,e);Cn(n),E(n.definitionObject,s)}},onDragLeave:T,onPointerDown:()=>{a.selection.unset(r.Clip)}});if(pe(l)){const t={ref:u,key:"svg",className:"svgs"},n=[e.createElement("div",Object.assign({},t))];if(c){const t=e.Children.only(c);e.isValidElement(t)&&n.push(t)}P.children=n}return e.createElement(ft,Object.assign({},P))}function br(t){const n=e.useContext(fr),{paused:s,changePaused:r}=n,c=Object.assign(Object.assign({},t),{key:"player-button",onClick:()=>{r(!s)}});return e.createElement(ft,Object.assign({},c))}function yr(t){const s=an(),r=()=>s.timeRange.timeRange,[c,o]=e.useState(r),i=()=>{o(r())};ss({[n.Time]:i,[n.Duration]:i},s.eventTarget);const a=Object.assign({value:c.frame,min:0,max:c.frames,step:1,onChange:(e,t)=>{const n=P(t)?t[0]:t;s.time=Me(n,c.fps)},className:"frame slider"},t);return e.createElement(Fs,Object.assign({},a))}function Er(t){return e.useContext(fr).paused?null:t.children}function vr(t){return e.useContext(fr).paused?t.children:null}function Or(t){const s=an(),r=()=>s.timeRange,[c,o]=e.useState(r),i=()=>{o(r())};ss({[n.Time]:i,[n.Duration]:i},s.eventTarget);const{seconds:a,fps:l,lengthSeconds:d}=c,u=[ge(a,l,d),"/",ge(d,l,d)],m=Object.assign(Object.assign({},t),{key:"player-time",children:u});return e.createElement(ft,Object.assign({},m))}const jr=function(t={}){var n,s,r,c,o;const i=Wt(t),{icons:a}=i;(n=i.props).key||(n.key="player"),(s=i.props).className||(s.className="panel player"),(r=i.content).children||(r.children=e.createElement(hr,Object.assign({},i.content.props),e.createElement(ft,{key:"drop-box",className:"drop-box"}))),(c=i.header).content||(c.content=[a.app]),(o=i.footer).content||(o.content=[e.createElement(br,{key:"play-button",className:O},e.createElement(Er,{key:"playing"},a.playerPause),e.createElement(vr,{key:"not-playing"},a.playerPlay)),e.createElement(yr,{key:"time-slider"}),e.createElement(Or,{key:"time",className:"time"})]);const l=e.createElement(e.Fragment,null,e.createElement(Ut,Object.assign({},i.header)),i.content.children,e.createElement(Ut,Object.assign({},i.footer)));return Object.assign(Object.assign({},i.props),{children:l})};function kr(t){const n=e.useContext(Qn),{scale:s,frame:r}=n,c=e.useMemo((()=>Object.assign(Object.assign({},t),{style:{left:H(r,s)}})),[r,s]);return e.createElement(ft,Object.assign({},c))}function Cr(t){const n=an(),{selection:r}=n,{mash:c}=r,{className:o,children:i}=t,a=pt(t,["className","children"]),l=e.Children.only(i);g(e.isValidElement(l));const d=e.useContext(_n),u=e.useContext(Qn),{track:m}=d,{dragTypeValid:p,onDragLeave:f,onDrop:h,droppingTrack:b,setDroppingTrack:y,droppingPosition:E,setDroppingPosition:v,setDroppingClip:O,selectedTrack:j}=u,k=e.useMemo((()=>{const e=m===j,t=[];return o&&t.push(o),e&&t.push(Ee),b===m&&t.push(Vn(E)),t.join(" ")}),[E,b,j]);if(!c||!m)return null;const{clips:C,dense:S,index:x}=m,N=Object.assign(Object.assign({},a),{className:k,children:(()=>{let t=S?-1:0;const n=l.props;return C.map((s=>{const r=Object.assign(Object.assign({},n),{key:s.id}),c={children:e.cloneElement(l,r),value:{clip:s,prevClipEnd:t},key:s.id},o=e.createElement(Zn.Provider,Object.assign({},c));return S||(t=s.frames+s.frame),o}))})(),onDragLeave:f,onDragOver:e=>{ue(e);const{dataTransfer:t}=e;if(!t)return;const n=p(t),r=n?s.At:s.None;O(),y(n?m:void 0),v(r)},onDrop:h,key:`track-${x}`});return e.createElement(ft,Object.assign({},N))}function Sr(t){const n=e.useRef(null),s=e.useContext(Qn),[r]=e.useState(new ResizeObserver((()=>{const{setRect:e}=s;e(n.current.getBoundingClientRect())})));e.useEffect((()=>{const{current:e}=n;return e&&r.observe(e),()=>{r.disconnect()}}),[n.current]);const c=Object.assign(Object.assign({},t),{ref:n});return e.createElement(ft,Object.assign({},c))}function xr(t){const s=an(),r=e.useContext(Qn),c=()=>!s.selection.mash,[o,i]=e.useState(c);ss({[n.Selection]:()=>{i(c())}});const a=Object.assign({disabled:o,key:"time-slider",value:r.zoom,min:0,max:1,step:.01,onChange:(e,t)=>{const n=P(t)?t[0]:t;r.zoom!==n&&r.setZoom(n)}},t);return e.createElement(Fs,Object.assign({className:"zoom slider"},a))}function Nr(t){const[s,r]=e.useState((()=>0)),c=()=>{r((e=>e+1))},o=an();ss({[n.Mash]:c,[n.Track]:c});const{children:i}=t,a={key:"track-content",children:e.useMemo((()=>{const{mash:t}=o.selection;if(!t)return[];const{tracks:n}=t;return We(n).map(((t,n)=>{const{identifier:s,index:r}=t,c={children:e.Children.map(i,(t=>{if(!e.isValidElement(t))throw"TimelineTracks";return e.cloneElement(t,{key:`track-clone-${n}-${r}-${s}`})})),value:{track:t},key:`track-context-${n}-${r}-${s}`};return e.createElement(_n.Provider,Object.assign({},c))}))}),[s])};return e.createElement(e.Fragment,Object.assign({},a))}function wr(t){const s=an(),r=e.useRef(-1),c=e.useRef(null),o=e.useContext(Qn),{frames:i,scale:a,rect:l}=o,{className:d,inactive:u,styleHeight:m,styleWidth:p}=t,g=pt(t,["className","inactive","styleHeight","styleWidth"]),f=()=>!s.selection.mash,[h,b]=e.useState(f);ss({[n.Selection]:()=>{b(f())}});const y=()=>{const{window:e}=globalThis,t=e=>{ue(e);const{current:t}=c;if(!t||!s.selection.mash)return;const{clientX:n}=e;if(r.current===n)return;r.current=n;const o=t.getBoundingClientRect(),i=Math.max(0,Math.min(o.width,n-o.x)),l=Ke(i,a,"floor");s.time=Me(l,s.selection.mash.quantize)},n=s=>{t(s),e.removeEventListener("pointermove",t),e.removeEventListener("pointerup",n)};return s=>{s.stopPropagation(),r.current=-1,e.addEventListener("pointermove",t),e.addEventListener("pointerup",n),t(s)}},{width:E,height:v}=l,O=e.useMemo((()=>{const e=[];d&&e.push(d),h&&e.push(we);const t=Object.assign(Object.assign({},g),{ref:c,className:e.join(" ")});if(p||m){const e={};if(m&&(e.minHeight=v),p){const t=H(i,a,"ceil");e.minWidth=Math.max(t,t)}t.style=e}return u||h||(t.onPointerDown=y()),t}),[i,a,E,v,h]);return e.createElement(ft,Object.assign({},O))}function Tr(t){const{className:c}=t,o=pt(t,["className"]),i=e.useContext(Qn),{dragTypeValid:a,onDrop:l,setScroll:d,setDroppingClip:u,setDroppingTrack:m,setDroppingPosition:p}=i,g=e.useRef(null),[f,h]=e.useState(!1),b=an();ss({[n.Mash]:()=>{var e;null===(e=g.current)||void 0===e||e.scrollTo(0,0)}});const y=e=>{ue(e),h(!1)},E=[];c&&E.push(c),f&&E.push(A);const v=Object.assign(Object.assign({className:E.join(" ")},o),{onPointerDown:e=>{b.selection.unset(r.Track)},onScroll:()=>{const{current:e}=g;if(!e)return;const{scrollLeft:t,scrollTop:n}=e;d({x:t,y:n})},onDragOver:e=>{ue(e);const{dataTransfer:t}=e;if(!t)return;const n=a(t),r=n?s.At:s.None;u(),m(),p(r),h(n)},onDragLeave:y,onDrop:e=>{y(e),l(e)},ref:g});return e.createElement(ft,Object.assign({},v))}function Dr(t){const s=an(),r=()=>!s.selection.mash,[c,o]=e.useState(r);ss({[n.Selection]:()=>{o(r())}});const{children:i}=t,a=pt(t,["children"]),l=Object.assign(Object.assign({},a),{disabled:c});return l.onClick=()=>{s.addTrack()},e.cloneElement(e.Children.only(i),l)}function Pr(t){const{className:n,icons:s}=t,r=pt(t,["className","icons"]),c=e.useContext(Qn),o=e.useContext(_n),{droppingTrack:i,droppingPosition:a,selectedTrack:l}=c,{track:d}=o,u=e.useMemo((()=>{const e=[];return n&&e.push(n),d===l&&e.push(Ee),d===i&&e.push(Vn(a)),e.join(" ")}),[a,i,l]);if(!d)return null;const{dense:m,index:p}=d,g=m?s.trackDense:s.track,f=Object.assign(Object.assign({},r),{className:u,children:g,key:`track-icon-${p}`});return e.createElement(ft,Object.assign({},f))}function Rr(t){const s=an(),{zoom:r,children:c}=t,o=pt(t,["zoom","children"]),i=e.useContext(Qn),a=()=>!s.selection.mash,[l,d]=e.useState(a);ss({[n.Selection]:()=>{d(a())}});const u=Object.assign(Object.assign({},o),{onClick:()=>{i.setZoom(r)},disabled:l});return e.cloneElement(e.Children.only(c),u)}function Lr(t){const s=an(),r=e.useContext(Pt),{definition:c,drop:o}=r,i=()=>!s.selection.mash,[a,l]=e.useState(i);ss({[n.Selection]:()=>{l(i())}});const{children:d}=t,u=pt(t,["children"]),m=Object.assign(Object.assign({},u),{disabled:a});return m.onClick=()=>{const{selection:e,edited:t}=s,{clip:n,track:r}=e,i=(null==c?void 0:c.toJSON())||{id:fe},a={clip:0,track:-1};n&&r?(a.clip=r.dense?r.clips.indexOf(n):n.endFrame,a.track=r.index):a.clip=s.time.scale(t.quantize).frame,o(i,a)},e.cloneElement(e.Children.only(d),m)}const Ar=function(t={}){var n,s,r,c,o;const i=Wt(t),{icons:a}=i;(n=i.props).key||(n.key="timeline"),(s=i.props).className||(s.className="panel timeline"),(r=i.header).content||(r.content=[a.timeline]),(c=i.footer).content||(c.content=[e.createElement(Lr,{key:"add-clip"},e.createElement(bs,{children:a.add})),e.createElement(Dr,{key:"add-track"},e.createElement(bs,{children:[a.add,a.trackDense]})),e.createElement(Rr,{key:"zoom-out",zoom:0},e.createElement(bs,{useView:!0},a.zoomLess)),e.createElement(xr,{key:"zoomer"}),e.createElement(Rr,{key:"zoom-in",zoom:1},e.createElement(bs,{useView:!0},a.zoomMore))]),(o=i.content).children||(o.children=e.createElement(e.Fragment,null,e.createElement(wr,{styleWidth:!0,inactive:!0,styleHeight:!0,className:"scrubber-bar"},e.createElement(kr,{className:"scrubber-element-bar"})),e.createElement(wr,{styleWidth:!0,className:"scrubber-icon"},e.createElement(kr,{className:"scrubber-element-icon"})),e.createElement(Nr,null,e.createElement(Pr,{className:"track-icon",icons:a}),e.createElement(Cr,{className:"track"},e.createElement(rs,{className:"clip preview"}))),e.createElement(Sr,{className:"drop-box"})));const l=e.createElement(e.Fragment,null,e.createElement(Ut,Object.assign({},i.header)),e.createElement(Tr,Object.assign({},i.content.props),i.content.children),e.createElement(Ut,Object.assign({},i.footer)));return Object.assign(Object.assign({},i.props),{children:l})};function $r(t){const{disabled:s}=t,r=pt(t,["disabled"]),c=an(),[o,i]=e.useState(c.paused),[a,l]=e.useState(c.volume),d=()=>{i(c.paused)};ss({[n.Pause]:d,[n.Play]:d,[n.Volume]:()=>{l(c.volume)}});const u={value:{paused:o,disabled:s,volume:a,changePaused:e=>{c.paused=e},changeVolume:e=>{c.volume=e}},children:e.createElement(ft,Object.assign({},r))};return e.createElement(fr.Provider,Object.assign({},u))}const zr=1;function Ir(t){const r=an(),c=e.useContext(Pt),{drop:o}=c,i=()=>{var e;return(null===(e=r.selection.mash)||void 0===e?void 0:e.frame)||0},a=()=>{var e;return(null===(e=r.selection.mash)||void 0===e?void 0:e.frames)||0},[l,d]=e.useState(a),[u,m]=e.useState(i),[p,g]=e.useState(s.None),[f,b]=e.useState(),[y,E]=e.useState(),[v,O]=e.useState(),[j,k]=e.useState(0),[C,S]=e.useState(),[x,N]=e.useState(1),[w,T]=e.useState(V),[D,P]=e.useState(V),R=()=>{k((e=>e+1))};ss({[n.Mash]:()=>{N(1)},[n.Action]:R,[n.Selection]:()=>{S(r.selection.clip),O(r.selection.track)},[n.Time]:()=>{m(i())},[n.Duration]:()=>{d(a())}},r.eventTarget);const L=(e,t)=>{const n=Ln(e);if(n.includes("Files"))return!0;const s=n.find(Tn);if(!s)return!1;if(t)return!0;return Pn(s)!==B.Effect},A=e=>{ue(e),g(s.None),b(void 0),E(void 0)},{width:$}=w,z=e.useMemo((()=>$?Be(l,$,x):0),[x,$,l]),I={scroll:D,setScroll:P,scale:z,refreshed:j,refresh:R,zoom:x,setZoom:N,rect:w,setRect:T,droppingTrack:f,setDroppingTrack:b,droppingClip:y,setDroppingClip:E,droppingPosition:p,setDroppingPosition:g,onDragLeave:A,onDrop:e=>{ue(e);const{dataTransfer:t,clientX:n}=e;if(!t||!L(t,y))return void console.log("Timeline onDrop invalid",null==t?void 0:t.types,!!y);const c=Ln(t).includes("Files"),i=!!(null==f?void 0:f.dense),a=f?f.index:-1,l=(null==f?void 0:f.clips)||[],d=c?{}:An(t),u=!c&&On(d),m=u?d.offset:0;let g=((e,t)=>{if(!e)return-1;if(!y)return 0;const n=t.indexOf(y);return p===s.After?n+1:n})(i,l);if(!h(g)){const e=n-w.x,t=Ke(Math.max(0,D.x+(e-m)),z);g=i?((e,t)=>{const{length:n}=t;if(!n)return 0;const s=t.findIndex((t=>e<t.frame+t.frames));return s>-1?s:n})(t,l):t}const b={clip:g,track:a};if(c)o(t.files,b);else if(u)if(kn(d)){const{definitionObject:e}=d;o(e,b)}else{const{clip:e}=r.selection;Qe(e),r.moveClip(e,b)}A(e)},dragTypeValid:L,selectedClip:C,selectedTrack:v,frame:u,frames:l},H={children:e.createElement(ft,Object.assign({},t)),value:I};return e.createElement(Qn.Provider,Object.assign({},H))}function Vr(t){return e.createElement(ft,Object.assign({},t))}const Hr=function(t={}){t.className||(t.className="editor masher"),t.icons||(t.icons=mt);const{panels:n={}}=t,s=pt(t,["panels"]),{player:r={},browser:c={},timeline:o={},inspector:i={},activity:a={}}=n,l=[];if(r&&(r.icons||(r.icons=t.icons),l.push(e.createElement($r,Object.assign({},jr(r))))),c&&(c.icons||(c.icons=t.icons),l.push(e.createElement(bn,Object.assign({},Gn(c))))),i||a){const n=[];i&&(i.icons||(i.icons=t.icons),n.push(e.createElement(ar,Object.assign({},mr(i))))),a&&(a.icons||(a.icons=t.icons),n.push(e.createElement(Lt,Object.assign({},Yt(a)))));const s={children:n,key:"panels",className:"panels"};l.push(e.createElement(Vr,Object.assign({},s)))}return o&&(o.icons||(o.icons=t.icons),l.push(e.createElement(Ir,Object.assign({},Ar(o))))),Object.assign(Object.assign({className:"editor masher"},s),{editType:le.Mash,children:l})},Fr=function(t={}){t.className||(t.className="editor caster");const n=Hr(t),{panels:s={}}=t,{composer:r={}}=s;if(!r)return n;r.icons||(r.icons=t.icons);const c=e.createElement(e.Fragment,null,n.children,e.createElement(as,Object.assign({},vs(r))));return Object.assign(Object.assign({},n),{children:c,editType:le.Cast})};function Mr(t){const{children:n,className:s}=t;if(!n)return null;const r={className:s,children:n};return e.createElement(ft,Object.assign({},r))}function qr(t){const{children:n,className:s}=t;if(!n)return null;const r={className:s,children:n};return e.createElement(ft,Object.assign({},r))}function Ur(t){const n=e.useContext(Kt),[s,r]=e.useState(!1),[c,o]=e.useState(0),[i,a]=e.useState(""),[l,d]=e.useState(""),{children:u,id:m}=t,{enabled:p,servers:g}=n;if(!he.map(String).includes(m))return null;if(!p||!g[m])return null;const f={processing:s,setProcessing:r,status:i,setStatus:a,progress:c,setProgress:o,error:l,setError:d};return e.createElement(cn.Provider,{value:f},u)}function Wr(t){const n=e.useContext(cn),{processing:s,error:r}=n;return s||r?e.createElement(e.Fragment,null,t.children):e.createElement(ft,null)}function Br(t){return e.useContext(cn).processing?null:e.createElement(e.Fragment,null,t.children)}function Jr(t){const{className:n}=t,s=pt(t,["className"]),r=e.useContext(cn),{status:c,error:o,setError:i}=r,a=["process-status"];n&&a.push(n),o&&a.push("error");const l=Object.assign(Object.assign({},s),{onClick:()=>{o&&i("")},key:"process-status",className:a.join(" "),children:o||c});return e.createElement(ft,Object.assign({},l))}function Gr(t){const n=e.useContext(cn),{progress:s,processing:r}=n;if(!r)return e.createElement(ft,{className:"progress-holder"});const c={value:s,max:1,children:`${Math.round(100*s)}%`};return e.createElement("progress",Object.assign({},c))}const Xr={devices:[]},Zr=e.createContext(Xr);function Yr(t){const[n,s]=e.useState([]);e.useEffect((()=>{navigator.mediaDevices.enumerateDevices().then(s)}),[]);const r={devices:n},c={children:n.map((t=>e.createElement(ft,null,JSON.stringify(t))))};return e.createElement(Zr.Provider,{value:r},e.createElement(ft,Object.assign({},c)))}function _r(t){return e.createElement(ft,Object.assign({},t))}function Kr(t){return e.createElement(ft,Object.assign({},t))}function Qr(t){return e.createElement(ft,Object.assign({},t))}const ec={setClient:()=>{}},tc=e.createContext(ec);class nc{constructor(e,t){this.setStatus=t,this.endpointPromise=e}beforeAnswer(e){return gt(this,void 0,void 0,(function*(){const t=window.navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((e=>e)).catch((e=>{console.error("beforeAnswer",e)}));if(this.localStream=yield t,!this.localStream)return;this.localStream.getTracks().forEach((t=>{this.localStream&&e.addTrack(t,this.localStream)}));const{close:n}=e;e.close=(...t)=>{if(this.localStream)return this.localStream.getTracks().forEach((e=>{e.stop()})),n.apply(e,t)}}))}closeConnection(){var e;null===(e=this.localPeerConnection)||void 0===e||e.close()}createConnection(e={}){const{stereo:t}=e;return this.endpointPromise(k.streaming.webrtc,{}).then((e=>{const{id:n,localDescription:s}=e,r=new RTCPeerConnection({});this.localPeerConnection=r,r.close=()=>{const e={id:n};return this.endpointPromise(k.streaming.delete,e).then((e=>{})),RTCPeerConnection.prototype.close.apply(r)};try{r.setRemoteDescription(s).then((()=>{this.beforeAnswer(r).then((()=>(r.createAnswer().then((e=>{const s=new RTCSessionDescription({type:"answer",sdp:t?(c=e.sdp,c.replace(/a=fmtp:111/,"a=fmtp:111 stereo=1\r\na=fmtp:111")):e.sdp});var c;console.debug(this.constructor.name,"createConnection setLocalDescription"),r.setLocalDescription(s).then((()=>{const{localDescription:e}=r;if(!e)throw be.invalid.object+"localDescription";const t={id:n,localDescription:e};console.debug("StreamingRemoteRequest",k.streaming.remote,t),this.endpointPromise(k.streaming.remote,t).then((e=>{console.debug("StreamingRemoteResponse",k.streaming.remote,e)}))}))})),r)))}))}catch(e){throw console.trace(this.constructor.name,"createConnection",e),this.localPeerConnection.close(),e}}))}}function sc(t){const n=e.useContext(tc),s=e.useContext(cn),r=e.useContext(Kt),{setStatus:c,processing:o,setProcessing:i}=s,{endpointPromise:a}=r,{client:l,setClient:d}=n,u=Object.assign(Object.assign({},t),{onClick:()=>{if(l)c("Closing WebRTC connection"),l.closeConnection(),i(!1),d(void 0);else{const e=new nc(a,c);c("Opening WebRTC connection..."),e.createConnection().then((()=>{c("Opened WebRTC connection"),i(!0),d(e)}))}}});return e.createElement(ft,Object.assign({},u))}function rc(t){const n=e.useRef(null),s=e.useContext(tc),r=e.useContext(cn),{client:c}=s,{processing:o}=r,{current:i}=n;i&&(i.srcObject=o&&(null==c?void 0:c.localStream)||null),e.useEffect((()=>()=>{}),[]);const a=pt(t,["children"]),l=Object.assign(Object.assign({},a),{ref:n,autoPlay:!0,muted:!0});return e.createElement(_s,Object.assign({},l))}function cc(t){const[n,s]=e.useState(),r=e.useContext(Kt),{enabled:c,servers:o}=r;if(!c||!o[U.Streaming])return null;const i={client:n,setClient:s};return e.createElement(tc.Provider,{value:i},e.createElement(ft,Object.assign({},t)))}const oc=e.createElement(cc,{className:"panel webrtc"},e.createElement("div",{className:"head"},e.createElement(sc,null,e.createElement(Wr,null,e.createElement(bs,null,"Stop Broadcasting")),e.createElement(Br,null,e.createElement(bs,null,"Start Broadcasting")))),e.createElement(rc,{className:"content"}),e.createElement("div",{className:"foot"})),ic=e=>({className:"editor caster",children:oc});export{Lt as Activity,zt as ActivityContent,$t as ActivityContentContext,At as ActivityContentContextDefault,wt as ActivityContext,Nt as ActivityContextDefault,kt as ActivityGroup,Ct as ActivityGroups,It as ActivityItem,Vt as ActivityLabel,Ft as ActivityPicked,Mt as ActivityPicker,qt as ActivityProgress,Yt as ActivityPropsDefault,Qt as ApiClient,Kt as ApiContext,_t as ApiContextDefault,en as ApiEnabled,Ut as Bar,zs as BooleanTypeInput,sn as Broadcaster,ln as BroadcasterContent,on as BroadcasterControl,dn as BroadcasterPreloadControl,un as BroadcasterUpdateControl,bn as Browser,Hn as BrowserContent,pn as BrowserContext,mn as BrowserContextDefault,Wn as BrowserControl,Un as BrowserPicker,Gn as BrowserPropsDefault,bs as Button,Zn as ClipContext,Xn as ClipContextDefault,rs as ClipItem,Gs as ColorGroupInput,as as Composer,ds as ComposerContent,is as ComposerContext,os as ComposerContextDefault,us as ComposerDepth,ms as ComposerFolderClose,ps as ComposerFolderOpen,ls as ComposerLayer,gs as ComposerLayerFolder,fs as ComposerLayerLabel,hs as ComposerLayerMash,Os as CreateEditedControl,Js as DataGroupInputs,Ls as DataTypeInputs,vs as DefaultComposerProps,jr as DefaultPlayerProps,ic as DefaultStreamerProps,Ar as DefaultTimelineProps,En as DefinitionContext,yn as DefinitionContextDefault,Is as DefinitionDrop,Jn as DefinitionItem,Vs as DefinitionSelect,zn as DragElementPoint,$n as DragElementRect,vn as DragSuffix,Sn as DragType,xn as DragTypes,js as EditorRedoButton,ks as EditorRemoveButton,Cs as EditorUndoButton,tr as EffectsGroupInput,Ps as EmptyElement,$s as InputContext,As as InputContextDefault,ar as Inspector,lr as InspectorContent,ws as InspectorContext,Ns as InspectorContextDefault,Ks as InspectorEffect,dr as InspectorPicked,ur as InspectorPicker,er as InspectorProperties,Qs as InspectorProperty,mr as InspectorPropsDefault,ts as LayerContext,es as LayerContextDefault,pr as Masher,Fr as MasherCastProps,Pt as MasherContext,Dt as MasherContextDefault,Hr as MasherDefaultProps,Hs as NumericTypeInput,nr as OpacityGroupInput,Bt as Panel,Mr as PanelContent,Jt as PanelFoot,qr as PanelHead,Vr as Panels,Ms as PercentTypeInput,$r as Player,br as PlayerButton,hr as PlayerContent,fr as PlayerContext,gr as PlayerContextDefault,vr as PlayerNotPlaying,Er as PlayerPlaying,Or as PlayerTime,yr as PlayerTimeControl,sr as PointGroupInput,Ht as Problems,Ur as Process,Wr as ProcessActive,cn as ProcessContext,rn as ProcessContextDefault,Br as ProcessInactive,Gr as ProcessProgress,Jr as ProcessStatus,Ss as RenderControl,qs as RgbTypeInput,xs as SaveControl,Ts as SelectEditedControl,Yr as Shooter,Zr as ShooterContext,Xr as ShooterContextDefault,cr as SizeGroupInput,or as SizingGroupInput,Us as SizingTypeInput,Fs as Slider,_r as Streamer,Kr as Streamers,Qr as StreamersCreateControl,Ws as TextTypeInput,Ir as Timeline,Lr as TimelineAddClipControl,Dr as TimelineAddTrackControl,Tr as TimelineContent,Qn as TimelineContext,Kn as TimelineContextDefault,zr as TimelineDefaultZoom,wr as TimelineScrubber,kr as TimelineScrubberElement,Sr as TimelineSizer,Cr as TimelineTrack,Pr as TimelineTrackIcon,Nr as TimelineTracks,Rr as TimelineZoom,xr as TimelineZoomer,ir as TimingGroupInput,Bs as TimingTypeInput,_n as TrackContext,Yn as TrackContextDefault,wn as TransferTypeFiles,Rs as TweenInputKey,_s as VideoView,ft as View,Ds as ViewControl,nn as ViewerContext,tn as ViewerContextDefault,cc as Webrtc,sc as WebrtcButton,nc as WebrtcClient,rc as WebrtcContent,tc as WebrtcContext,ec as WebrtcContextDefault,jt as activityLabel,xt as assertActivityGroup,Cn as assertDragDefinitionObject,jn as assertDragOffsetObject,An as dragData,Pn as dragDefinitionType,Rn as dragType,Ln as dragTypes,In as dropFilesFromList,Dn as dropType,Vn as droppingPositionClass,Xs as elementSetPreviewSize,St as isActivityGroup,kn as isDragDefinitionObject,On as isDragOffsetObject,Nn as isDragType,Tn as isTransferType,Ot as labelInterpolate,Et as labelLookup,bt as labelObjects,vt as labelTranslate,yt as labels,Wt as panelOptionsStrict,Mn as propsDefinitionTypes,qn as propsSelectTypes,Zs as sessionGet,Ys as sessionSet,hn as useApiDefinitions,cs as useClip,Bn as useDefinition,an as useEditor,Rt as useEditorActivity,fn as useEditorDefinitions,ns as useLayer,ss as useListeners};
