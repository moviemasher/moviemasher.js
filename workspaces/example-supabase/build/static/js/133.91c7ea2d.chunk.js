(self.webpackChunk_moviemasher_example_supabase=self.webpackChunk_moviemasher_example_supabase||[]).push([[133],{3133:function(e,t,i){var n=i(4704).default,r=i(3496).default,a=i(1588).default,o=i(3808).default,s=i(215).default,u=i(6115).default,c=i(1655).default,l=i(6389).default,h=i(6690).default,f=i(9728).default,d=i(861).default,p=i(7424).default,v=i(8416).default,m=i(2122).default,y=["response"],g=["undoSelection","redoSelection","type"],k=["type","name","defaultValue"],T=["filter"],b=["lock"],w=["clip"],F=["contentColors"],S=["contentColors"];!function(e){"use strict";var t,I,C,P,x,A,M,D,z,E,V={Environment:"error.environment",DecodeProbe:"decode.probe",Unknown:"error.unknown",Internal:"error.internal",Type:"error.type",Reference:"error.reference",Range:"error.range",Syntax:"error.syntax",Url:"error.url",Evaluation:"error.evaluation",ClientDisabledDelete:"client.disabled.delete",ClientDisabledGet:"client.disabled.get",ClientDisabledList:"client.disabled.list",ClientDisabledSave:"client.disabled.save",ImportType:"import.type",ImportDuration:"import.duration",ImportSize:"import.size",ImportFile:"import.file",ServerAuthentication:"server.authentication",ServerAuthorization:"server.authorization",FilterId:"filter.id",MediaId:"media.id",Unimplemented:"error.unimplemented",Frame:"error.frame",OutputDuration:"output.duration",OutputDimensions:"output.dimensions"},R=Object.values(V),O={Error:V.Unknown,EvalError:V.Evaluation,InternalError:V.Internal,RangeError:V.Range,ReferenceError:V.Reference,SyntaxError:V.Syntax,TypeError:V.Type,URIError:V.Url},_=function(e){return"string"==typeof e&&R.includes(e)},j=function(e,t){return"string"==typeof t?t:e},N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V.Internal,i=arguments.length>2?arguments[2]:void 0,n=new Error(e);return Object.assign(n,{name:t,cause:i}),n},q=function(e){if(_(e))return B(e);if("string"==typeof e)return N(e);var t=e.message,i=void 0===t?"":t,n=e.name,r=void 0===n?V.Internal:n,a=i||String(r);return N(a,r,e)},B=function(e,t){return{name:e,message:j(e,t)}},U=function(e,t){return{error:B(e,t)}},L=function(e,t){return Promise.resolve(U(e,t))},G=function(e,t,i){var n=t?function(e,t,i){var n=typeof e,r="undefined"!==n,a="object"===n,o=[i||(r?n:"value"),"is"];return o.push(a?e.constructor.name:n),r&&o.push(a?JSON.stringify(e):"'".concat(e,"'")),o.push("instead of",t),N(o.join(" "),V.Type)}(e,t,i):q(e),r=n.message,a=n.name,o=n.cause,s=N(r,a,o);throw console.trace(s.toString()),s},H=function(e){return"object"==typeof e};function W(e,t){H(e)||G(e,"Object",t)}var J=function(e){return"string"==typeof e};function K(e,t){J(e)||G(e,"String",t)}var X=function(e){return void 0===e},Y=function(e){return"number"==typeof e};function Z(e,t){Y(e)||G(e,"Number",t)}var $=function(e){return"boolean"==typeof e},Q=function(e){return"function"==typeof e};function ee(e,t){Q(e)||G(e,"Method",t)}var te=function(e){return!X(e)},ie=function(e){return Y(e)&&Number.isNaN(e)},ne=function(e){return Y(e)&&!Number.isNaN(e)},re=function(e){return Number.isInteger(e)};function ae(e,t){re(e)||G(e,"Integer",t)}var oe=function(e){return ne(e)&&e>=0};function se(e,t){oe(e)||G(e,">= 0",t)}var ue=function(e){return ne(e)&&e<1},ce=function(e){return ne(e)&&e>0};function le(e,t){ce(e)||G(e,"> zero",t)}var he=function(e){return te(Array.isArray)?Array.isArray(e):e instanceof Array};function fe(e,t){he(e)||G(e,"Array",t)}var de=function(e){return!!e.length},pe=function(e){return J(e)&&de(String(e))};function ve(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"value";pe(e)||G(e,"populated string",t)}var me=function(e){return he(e)&&de(e)};function ye(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"value";me(e)||G(e,"populated array",t)}var ge=function(e){return H(e)&&de(Object.keys(e))};function ke(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"value";ge(e)||G(e,"populated array",t)}var Te=function(e){return(ne(e)||pe(e))&&!ie(Number(e))};function be(e){e||G(e,"true",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"value")}var we=function(e){return H(e)&&"r"in e&&"g"in e&&"b"in e},Fe=function(e){return H(e)&&"isRange"in e};function Se(e,t){Fe(e)||G(e,"Time",t)}var Ie=function(e){return Fe(e)&&e.isRange};function Ce(e,t){Ie(e)||G(e,"TimeRange",t)}var Pe=function(e){return ne(e)||J(e)},xe=function(e){return!!Pe(e)&&(Te(e)?!!Number(e):pe(e))},Ae=function(e){return H(e)&&Object.values(e).every((function(e){return Pe(e)}))};function Me(e,t){Ae(e)||G(e,"ValueRecord",t)}var De=function(e){return H(e)&&!("error"in e)},ze=function(e){return he(e)},Ee=function(e){return H(e)&&"error"in e&&H(e.error)},Ve="audio",Re="effect",Oe="font",_e="image",je="mash",Ne="sequence",qe="video",Be="json",Ue="record",Le="records",Ge=[Ve,Re,Oe,_e,je,Ne,qe],He=function(e){return Ge.includes(e)};function We(e,t){He(e)||G(e,"MediaType",t)}var Je=[Oe,_e,qe,Ne],Ke=function(e){return Je.includes(e)};function Xe(e,t){Ke(e)||G(e,"TranscodingType",t)}var Ye=[Re,je],Ze=[Ve,_e,qe],$e=function(e){return J(e)&&Ze.includes(e)},Qe=[].concat(Ze,[Oe,Be]),et=function(e){return Qe.includes(e)};function tt(e,t){et(e)||G(e,"LoadType",t)}var it,nt,rt,at,ot=[Oe,_e,qe,Ne],st=function(e){return ot.includes(e)},ut=[Ve,qe,Ne],ct=function(e){return ut.includes(e)},lt=[Oe,_e,Ne],ht=function(e){return lt.includes(e)},ft=[_e,qe,Ne,Ve],dt=function(e){return ft.includes(e)},pt=[_e,qe,Ne,Ve],vt=function(e){return pt.includes(e)};e.DroppingPosition=void 0,(it=e.DroppingPosition||(e.DroppingPosition={})).At="at",it.After="after",it.Before="before",it.None="none",e.ActionType=void 0,(nt=e.ActionType||(e.ActionType={})).AddClipToTrack="addClipToTrack",nt.AddTrack="addTrack",nt.Change="change",nt.ChangeFrame="changeFrame",nt.ChangeMultiple="changeMultiple",nt.Move="move",nt.MoveClip="moveClip",nt.RemoveClip="removeClip",e.AVType=void 0,(rt=e.AVType||(e.AVType={})).Audio="audio",rt.Both="both",rt.Video="video",e.SelectType=void 0,(at=e.SelectType||(e.SelectType={})).Clip="clip",at.Container="container",at.Content="content",at.Mash="mash",at.None="none",at.Track="track";var mt,yt=Object.values(e.SelectType),gt=function(e){return yt.includes(e)},kt=[e.SelectType.Content,e.SelectType.Container],Tt=function(e){return gt(e)&&kt.includes(e)};e.OutputFormat=void 0,(mt=e.OutputFormat||(e.OutputFormat={})).AudioConcat="wav",mt.Flv="flv",mt.Hls="hls",mt.Jpeg="jpeg",mt.Mdash="mdash",mt.Mp3="mp3",mt.Mp4="mp4",mt.Png="image2",mt.Rtmp="rtmp",mt.VideoConcat="yuv4mpegpipe";var bt,wt=[Ve,_e,qe,Oe];e.FillType=void 0,(bt=e.FillType||(e.FillType={})).Color="color",bt.Fill="fill";var Ft,St=Object.values(e.FillType);e.GraphFileType=void 0,(Ft=e.GraphFileType||(e.GraphFileType={})).Svg="svg",Ft.SvgSequence="svgsequence",Ft.Txt="txt";var It,Ct=Object.values(e.GraphFileType),Pt=function(e){return pe(e)&&Ct.includes(e)};e.DataType=void 0,(It=e.DataType||(e.DataType={})).Boolean="boolean",It.ContainerId="containerid",It.ContentId="contentid",It.DefinitionId="definitionid",It.FontId="fontid",It.Frame="frame",It.Icon="icon",It.Number="number",It.Percent="percent",It.Rgb="rgb",It.String="string",It.Option="option";var xt,At=Object.values(e.DataType),Mt=function(e){return At.includes(e)};function Dt(e,t){Mt(e)||G(e,"DataType",t)}e.Orientation=void 0,(xt=e.Orientation||(e.Orientation={})).H="H",xt.V="V";var zt,Et=Object.values(e.Orientation),Vt=function(e){return pe(e)&&Et.includes(e)};e.Direction=void 0,(zt=e.Direction||(e.Direction={})).E="E",zt.N="N",zt.S="S",zt.W="W";var Rt,Ot=Object.values(e.Direction),_t=function(e){return Ot.includes(e)};function jt(e,t){_t(e)||G(e,"Direction",t)}e.Anchor=void 0,(Rt=e.Anchor||(e.Anchor={})).E="E",Rt.N="N",Rt.NE="NE",Rt.NW="NW",Rt.S="S",Rt.SE="SE",Rt.SW="SW",Rt.W="W";var Nt,qt=Object.values(e.Anchor);e.TriggerType=void 0,(Nt=e.TriggerType||(e.TriggerType={})).Init="init",Nt.Stop="stop",Nt.Start="start";var Bt,Ut,Lt=Object.values(e.TriggerType);e.TransformType=void 0,(Bt=e.TransformType||(e.TransformType={})).Scale="scale",Bt.Translate="translate",e.EventType=void 0,(Ut=e.EventType||(e.EventType={})).Action="action",Ut.Active="active",Ut.Added="added",Ut.Cast="cast",Ut.Draw="draw",Ut.Duration="durationchange",Ut.Ended="ended",Ut.Frame="frame",Ut.Fps="ratechange",Ut.Loaded="loadeddata",Ut.Pause="pause",Ut.Play="play",Ut.Playing="playing",Ut.Render="render",Ut.Resize="resize",Ut.Save="save",Ut.Seeked="seeked",Ut.Seeking="seeking",Ut.Selection="selection",Ut.Time="timeupdate",Ut.Track="track",Ut.Volume="volumechange",Ut.Waiting="waiting";var Gt,Ht,Wt,Jt=Object.values(e.EventType);e.MoveType=void 0,(Gt=e.MoveType||(e.MoveType={})).Audio="audio",Gt.Effect="effect",Gt.Video="video",e.MasherAction=void 0,(Ht=e.MasherAction||(e.MasherAction={})).Redo="redo",Ht.Remove="remove",Ht.Render="render",Ht.Save="save",Ht.Undo="undo",e.ServerType=void 0,(Wt=e.ServerType||(e.ServerType={})).Api="api",Wt.Data="data",Wt.File="file",Wt.Rendering="rendering",Wt.Web="web";var Kt,Xt,Yt=Object.values(e.ServerType);e.Duration=void 0,(Kt=e.Duration||(e.Duration={}))[Kt.Unknown=-1]="Unknown",Kt[Kt.Unlimited=-2]="Unlimited",Kt[Kt.None=0]="None",e.Timing=void 0,(Xt=e.Timing||(e.Timing={})).Custom="custom",Xt.Content="content",Xt.Container="container";var Zt,$t=Object.values(e.Timing);e.Sizing=void 0,(Zt=e.Sizing||(e.Sizing={})).Preview="preview",Zt.Content="content",Zt.Container="container";var Qt,ei=Object.values(e.Sizing);e.Clicking=void 0,(Qt=e.Clicking||(e.Clicking={})).Show="show",Qt.Hide="hide",Qt.Play="play";var ti,ii=Object.values(e.Clicking),ni={start:"",status:"",upload:""},ri={delete:"",get:"",put:"",retrieve:""},ai={cast:m(m({},ri),{},{default:""}),mash:m(m({},ri),{},{default:""}),stream:m({},ri),definition:m({},ri)},oi=(v(M={},e.ServerType.Api,{servers:"",callbacks:""}),v(M,e.ServerType.Data,ai),v(M,e.ServerType.File,{store:""}),v(M,e.ServerType.Rendering,ni),M);Object.entries(oi).forEach((function(e){var t=p(e,2),i=t[0],n=t[1];H(n)&&Object.entries(n).forEach((function(e){var t=p(e,2),r=t[0],a=t[1];J(a)?n[r]="/".concat(i,"/").concat(r):Object.entries(a).forEach((function(e){var t=p(e,2),n=t[0];t[1]||(a[n]="/".concat(i,"/").concat(r,"/").concat(n))}))}))})),e.Component=void 0,(ti=e.Component||(e.Component={})).Browser="browser",ti.Player="player",ti.Inspector="inspector",ti.Timeline="timeline";var si=function(e){return H(e)},ui=function(e){return H(e)&&"id"in e&&pe(e.id)},ci=function(){},li="http://www.w3.org/2000/svg",hi="com.moviemasher.",fi=".default",di=function(e){return e[e.length-1]},pi=function(e,t){return e.splice.apply(e,[0,e.length].concat(d(t))),e},vi=function(e){return d(new Set(e))},mi="",yi=function(){return ki()?mi:G(V.Url)},gi=function(e){if(pe(e))return mi=e;var t=globalThis.document;return mi=(null===t||void 0===t?void 0:t.baseURI)||"http://localhost/"},ki=function(){return Boolean(mi)},Ti=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URL(yi()),i=t.protocol,n=t.hostname,r=t.port,a=t.pathname,o={protocol:i,hostname:n,pathname:Si(a,e.pathname)};return Te(r)&&(o.port=Number(r)),o},bi=function(e){return Boolean(null===e||void 0===e?void 0:e.startsWith("blob"))},wi=function(e){return e.includes(":")},Fi=function(e,t){return(e.endsWith("/")?e.slice(0,-1):e)+"/"+(t.startsWith("/")?t.slice(1):t)},Si=function(e,t){if(!t)return e;var i=p(t,2),n=i[0],r=i[1];if("/"===n)return t;if("."!==n||"/"===r)return Fi(e,t);var a=(e.endsWith("/")?e.slice(0,-1):e).split("/");return t.split("/").forEach((function(e){".."===e?a.pop():a.push(e)})),a.join("/")},Ii=function(e){var t=Ti(e),i=t.port,n=t.pathname,r=t.hostname,a=t.protocol,o=t.search;ve(r),ve(a);var s=[];s.push(a,"//",r),Te(i)&&s.push(":",String(i));var u=s.join("");if(!n)return u;var c=Fi(u,n);return o?[c,o].join(""):c},Ci=function(e){return e?Object.entries(e).map((function(e){return e.join("=")})).join(";"):""},Pi=function(e){return"."===e[0]?e.slice(1):e},xi=function(e){return H(e)};function Ai(e,t){xi(e)||G(e,"Endpoint",t)}var Mi=function(e){var t=Vi(e),i=t.protocol,n=t.hostname,r=t.pathname,a=t.port,o=t.search,s=[i];return bi(i)||s.push("//"),s.push(n),Te(a)&&s.push(":".concat(a)),r&&s.push(r),o&&s.push(o),s.join("")},Di=function(e){var t=new URL(e),i=t.protocol,n=t.hostname,r=t.pathname,a=t.port,o={protocol:i,hostname:n,pathname:r,search:t.search};return Te(a)&&(o.port=Number(a)),o},zi=function(e){if(wi(e))return Di(e);var t=e.split("?"),i=p(t,2),n=i[0],r=i[1],a={pathname:n};return r&&(a.search="?".concat(r)),a},Ei=function(e){var t=e.hostname,i=e.protocol;return bi(i)||pe(t)},Vi=function(e){return Ei(e)?e:Ti(e)},Ri=function(e){return H(e)&&("endpoint"in e&&xi(e.endpoint)||"response"in e&&H(e.response))};function Oi(e,t){Ri(e)||G(e,"Request",t)}var _i=function(e){return ui(e)},ji=function(e){return H(e)&&"request"in e&&Ri(e.request)},Ni=/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/,qi=/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d*(?:\.\d+)?)\)$/,Bi=/^#([A-Fa-f0-9]{3,4}){1,2}$/,Ui=function(e){return e.toLowerCase().replace(/[\s]/g,"")},Li=function(e){return qi.test(e)},Gi=function(e){return Ni.test(e)},Hi=function(e,t){return e.match(new RegExp(".{".concat(t,"}"),"g"))},Wi=function(e){return parseInt(e.repeat(2/e.length),16)},Ji={r:0,g:0,b:0},Ki=m(m({},Ji),{},{a:1}),Xi="rgb".split(""),Yi=[].concat(d(Xi),["a"]),Zi="#00000000",$i="#000000",Qi="#FFFFFF",en="#FFFFFF00",tn="#00000000",nn="#000000FF",rn="#00FF00",an=function(e){var t=e.r.toString(16),i=e.g.toString(16),n=e.b.toString(16);return t.length<2&&(t="0".concat(t)),i.length<2&&(i="0".concat(i)),n.length<2&&(n="0".concat(n)),"#".concat(t).concat(i).concat(n)},on=function(e){var t=e.r.toString(16),i=e.g.toString(16),n=e.b.toString(16),r=Math.round(255*Number(e.a)).toString(16);return t.length<2&&(t="0".concat(t)),i.length<2&&(i="0".concat(i)),n.length<2&&(n="0".concat(n)),r.length<2&&(r="0".concat(r)),"#".concat(t).concat(i).concat(n).concat(r)},sn=function(e){var t=Ui(e);if(un(t)||Li(t)||Gi(t))return!0;var i="function"!=typeof Option?{color:""}:(console.log("colorStyle Option",Option),(new Option).style);i.color=e;var n=i.color;if(n===e)return!1;var r=Ui(n);return!!r&&(!(!Li(t)&&!Gi(t))||r===t)},un=function(e){return Bi.test(e)},cn=function(e){var t=Ui(e);if(un(t))return function(e){if(!un(e))return Ji;var t=Math.floor((e.length-1)/3),i=Hi(e.slice(1),t);if(!i)return Ji;var n=i.map(Wi),r=p(n,3);return{r:r[0],g:r[1],b:r[2]}}(t);var i=t.match(Ni);return i?{r:Number(i[1]),g:Number(i[2]),b:Number(i[3])}:Ji},ln=function(e){if(!sn(e))return Ki;var t=Ui(e);return un(t)?function(e){if(!un(e))return Ki;var t=Math.floor((e.length-1)/3),i=Hi(e.slice(1),t);if(!i)return Ki;var n,r=i.map(Wi),a=p(r,4);return{r:a[0],g:a[1],b:a[2],a:(n=a[3],oe(n)?Math.max(0,Math.min(1,n/255)):1)}}(t):Li(t)?function(e){var t=Ui(e).match(qi);return t?{r:Number(t[1]),g:Number(t[2]),b:Number(t[3]),a:Number(t[4])}:Ki}(t):Gi(t)?m({a:1},cn(t)):Ki};function hn(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Object.fromEntries(Yi.map((function(n){return[n,Math.round(e[n]*i+t[n]*(1-i))]})))}function fn(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Object.fromEntries(Xi.map((function(n){return[n,Math.round(e[n]*(1-i)+t[n]*i)]})))}var dn=[e.DataType.Frame,e.DataType.Percent,e.DataType.Number],pn=function(e){return Mt(e)&&dn.includes(e)},vn=function(t){if(He(t))return"".concat(hi).concat(t).concat(fi);switch(t){case e.DataType.Boolean:return!1;case e.DataType.Rgb:return $i}return pn(t)?0:""},mn=function(t,i){if(He(i))return pe(t);switch(i){case e.DataType.Boolean:return function(e){return!!$(e)||(ne(e)?0===e||1===e:["true","false",""].includes(e))}(t);case e.DataType.Rgb:return sn(String(t));case e.DataType.Frame:case e.DataType.Percent:case e.DataType.Number:return Te(t);case e.DataType.String:return!0;case e.DataType.ContainerId:case e.DataType.ContentId:case e.DataType.FontId:case e.DataType.DefinitionId:default:return pe(t)}return!1},yn=function(t,i){return i===e.DataType.Boolean?$(t)?t:Te(t)?!!Number(t):"true"===t:pn(i)?Te(t)?Number(t):0:String(t)},gn="End",kn=function(){function e(){h(this,e),v(this,"properties",[])}return f(e,[{key:"addProperties",value:function(e){for(var t,i=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];(t=this.properties).push.apply(t,r),r.forEach((function(t){i.propertyTweenSetOrDefault(e,t)}))}},{key:"propertiesInitialize",value:function(e){var t=this;W(e,"propertiesInitialize(object)"),this.properties.forEach((function(i){return t.propertyTweenSetOrDefault(e,i)}))}},{key:"propertyFind",value:function(e){return this.properties.find((function(t){return t.name===e}))}},{key:"propertyName",value:function(e){return e.endsWith(gn)?e.slice(0,-gn.length):e}},{key:"propertySetOrDefault",value:function(e,t,i,n){var r=e[i],a=X(r)?n:r;this.setValue(a,i,t)}},{key:"propertyTweenSetOrDefault",value:function(e,t){var i=t.name,n=t.defaultValue,r=t.tweenable;this.propertySetOrDefault(e,t,i,n),r&&this.propertySetOrDefault(e,t,"".concat(i).concat(gn))}},{key:"setValue",value:function(e,t,i){if(X(e))delete this[t];else{var n=this.propertyName(t),r=i||this.propertyFind(n);be(r,"".concat(this.constructor.name,".").concat(n," in ").concat(this.properties.map((function(e){return e.name})).join(", ")));var a=r.type;if(mn(e,a)){var o=yn(e,a);this[t]=o}else n!==t&&delete this[t]}}},{key:"setValues",value:function(e){var t=this;Object.entries(e).forEach((function(e){var i=p(e,2),n=i[0],r=i[1];t.setValue(r,n)}))}},{key:"toJSON",value:function(){var e=this;return Object.fromEntries(this.properties.flatMap((function(t){var i=t.name,n=t.tweenable,r=[[i,e.value(i)]];if(n){var a="".concat(i).concat(gn);r.push([a,e.value(a)])}return r})))}},{key:"value",value:function(e){return this[e]}}]),e}(),Tn=function(e){c(i,e);var t=l(i);function i(e){var n;h(this,i),n=t.call(this),v(u(n),"createdAt",""),v(u(n),"id",void 0),v(u(n),"kind",""),v(u(n),"relativeRequest",void 0),v(u(n),"request",void 0),v(u(n),"type","");var r=e.id,a=e.type,o=e.kind,s=e.createdAt,c=e.request;return n.id=r,pe(a)&&(n.type=a),pe(s)&&(n.createdAt=s),pe(o)&&(n.kind=o),Oi(c),n.request=c,n.relativeRequest=c,n}return f(i,[{key:"loadType",get:function(){var e=this.type;return console.log(this.constructor.name,"loadType",e),e===Ne?_e:(tt(e),e)}},{key:"toJSON",value:function(){var e=this.id,t=this.type,i=this.kind,n=this.createdAt,r=this.relativeRequest;return r.response,{id:e,request:s(r,y),type:t,kind:i,createdAt:n}}}]),i}(kn),bn=function(e){return ji(e)&&"type"in e&&He(e.type)},wn=function(e){return H(e)&&"definitionIds"in e},Fn=function(e){return _i(e)},Sn=function(e){return bn(e)&&"type"in e&&He(e.type)};function In(e,t){Sn(e)||G(e,"Media",t)}var Cn=function(e){return G(V.Unimplemented)},Pn=(v(D={},Ve,Cn),v(D,Re,Cn),v(D,Oe,Cn),v(D,_e,Cn),v(D,je,Cn),v(D,Ne,Cn),v(D,qe,Cn),D),xn=function(e){var t=e.type;return We(t),Pn[t](e)},An=(v(z={},Ve,[]),v(z,Re,[]),v(z,Oe,[]),v(z,_e,[]),v(z,je,[]),v(z,Ne,[]),v(z,qe,[]),z),Mn={count:0},Dn=function(){function e(){h(this,e),v(this,"id",0),v(this,"byId",new Map),v(this,"mediaArraysByType",new Map),Mn.count++,this.id=Mn.count}return f(e,[{key:"byIdAdd",value:function(e){var t=this;(Array.isArray(e)?e:[e]).forEach((function(e){return t.byId.set(e.id,e)}))}},{key:"byType",value:function(e){var t=this.mediaArraysByType.get(e);if(t)return t;var i=An[e];return this.mediaArraysByType.set(e,i),i}},{key:"define",value:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return i.map((function(t){return e.fromObject(t)}))}},{key:"media",value:function(e){return We(e.type),xn(e)}},{key:"deleteFromArray",value:function(e){var t=e.type,i=e.id,n=this.byType(t),r=n.findIndex((function(e){return i===e.id}));r<0||n.splice(r,1)}},{key:"mediaTypeFromId",value:function(e){var t=e.split(".").slice(-2).shift();return He(t)?t:void 0}},{key:"fromId",value:function(e){if(this.installed(e))return this.byId.get(e);var t=this.mediaTypeFromId(e);We(t,"in MediaCollection.fromId('".concat(e,"')"));var i=this.byType(t).find((function(t){return t.id===e}));return In(i,e),i}},{key:"fromObject",value:function(e){var t=e.id,i=e.type;if(ve(t),this.installed(t)||this.predefined(t))return this.fromId(t);var n=i||this.mediaTypeFromId(t);return We(n,"type"),e.type=n,this.install(this.media(e))}},{key:"ids",get:function(){return d(this.byId.keys())}},{key:"install",value:function(e){var t=e.type,i=e.id;return this.installed(i)?(this.uninstall(e),this.updateDefinition(this.fromId(i),e)):(this.byIdAdd(e),this.byType(t).push(e),e)}},{key:"installed",value:function(e){var t,i=this.byId.has(e);return i||(t=console).trace.apply(t,[this.constructor.name,this.id,"installed FALSE",e].concat(d(this.byId.keys()))),i}},{key:"predefined",value:function(e){if(e.startsWith(hi))return!0;var t=this.mediaTypeFromId(e);return!!t&&this.byType(t).some((function(t){return t.id===e}))}},{key:"undefineAll",value:function(){this.byId=new Map,this.mediaArraysByType=new Map}},{key:"updateDefinition",value:function(e,t){return this.uninstall(e),this.install(t),t}},{key:"updateDefinitionId",value:function(e,t){var i=this.byId.get(e);In(i,"media"),this.byId.delete(e),this.byId.set(t,i)}},{key:"uninstall",value:function(e){this.deleteFromArray(e);var t=e.id;return this.byId.delete(t),e}}]),e}(),zn=function(e){return H(e)&&"type"in e&&pe(e.type)},En=function(e){return H(e)&&e instanceof HTMLVideoElement};function Vn(e,t){En(e)||G(e,"ClientVideo",t)}var Rn=function(e){return H(e)&&e instanceof HTMLImageElement};function On(e,t){Rn(e)||G(e,"ClientImage",t)}var _n=function(e){return H(e)&&e instanceof AudioBuffer};function jn(e,t){_n(e)||G(e,"ClientAudio",t)}var Nn,qn=function(e){return H(e)&&"family"in e},Bn=function(e){return et(e)||Pt(e)},Un=function(e){return _n(e)||qn(e)||Rn(e)||En(e)||De(e)},Ln=function(){function e(){h(this,e),v(this,"_context",void 0),v(this,"sourcesById",new Map)}return f(e,[{key:"addSource",value:function(e,t){this.sourcesById.set(e,t)}},{key:"context",get:function(){if(!this._context){var e=AudioContext||window.webkitAudioContext;ee(e),this._context=new e}return this._context}},{key:"createBuffer",value:function(e){var t=44100*e;return this.context.createBuffer(2,t,44100)}},{key:"createBufferSource",value:function(e){var t=this.context.createBufferSource();return e&&(t.buffer=e),t}},{key:"createGain",value:function(){return this.context.createGain()}},{key:"currentTime",get:function(){return this.context.currentTime}},{key:"decode",value:function(e){var t=this;return new Promise((function(i,n){return t.context.decodeAudioData(e,(function(e){return i(e)}),(function(e){return n(e)}))}))}},{key:"deleteSource",value:function(e){var t=this.getSource(e);if(t){this.sourcesById.delete(e);var i=t.gainSource,n=t.gainNode;n.disconnect(this.destination),i.disconnect(n),i.stop()}}},{key:"destination",get:function(){return this.context.destination}},{key:"getSource",value:function(e){return this.sourcesById.get(e)}},{key:"hasSource",value:function(e){return this.sourcesById.has(e)}},{key:"startAt",value:function(e,t,i,n,r){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=this.createGain();t.loop=a,t.connect(o),o.connect(this.destination),t.start(this.currentTime+i,r,n),this.addSource(e,{gainSource:t,gainNode:o})}}]),e}(),Gn=new Ln,Hn={audible:function(){return new Ln}};e.Frame=void 0,(Nn=e.Frame||(e.Frame={}))[Nn.First=0]="First",Nn[Nn.Last=-1]="Last";var Wn=function(e){return H(e)&&"composition"in e};function Jn(e,t){Wn(e)||G(e,"MashMedia",t)}var Kn=function(){function e(t){h(this,e),v(this,"done",!1),v(this,"redoSelection",void 0),v(this,"type",void 0),v(this,"undoSelection",void 0);var i=t.redoSelection,n=t.type,r=t.undoSelection;this.redoSelection=i,this.type=n,this.undoSelection=r}return f(e,[{key:"mash",get:function(){var e=this.redoSelection.mash;if(Wn(e))return e;var t=this.undoSelection.mash;return Jn(t),t}},{key:"redo",value:function(){this.redoAction(),this.done=!0}},{key:"redoAction",value:function(){return G(V.Unimplemented)}},{key:"selection",get:function(){return this.done?this.redoSelection:this.undoSelection}},{key:"undo",value:function(){this.undoAction(),this.done=!1}},{key:"undoAction",value:function(){return G(V.Unimplemented)}}]),e}(),Xn=function(e){return e instanceof Kn};function Yn(e){if(!Xn(e))throw new Error("expected Action")}var Zn=function(e){c(i,e);var t=l(i);function i(e){var n;h(this,i),n=t.call(this,e),v(u(n),"createTracks",void 0);var r=e.createTracks;return n.createTracks=r,n}return f(i,[{key:"redoAction",value:function(){for(var e=0;e<this.createTracks;e+=1)this.mash.addTrack()}},{key:"undoAction",value:function(){for(var e=0;e<this.createTracks;e+=1)this.mash.removeTrack()}}]),i}(Kn),$n=function(e){c(i,e);var t=l(i);function i(e){var n;h(this,i),n=t.call(this,e),v(u(n),"clips",void 0),v(u(n),"insertIndex",void 0),v(u(n),"trackIndex",void 0),v(u(n),"redoFrame",void 0),v(u(n),"undoFrame",void 0);var r=e.clips,a=e.insertIndex,o=e.trackIndex,s=e.redoFrame,c=e.undoFrame;return n.clips=r,n.insertIndex=a,n.trackIndex=o,n.redoFrame=s,n.undoFrame=c,n}return f(i,[{key:"track",get:function(){return this.mash.tracks[this.trackIndex]}},{key:"redoAction",value:function(){a(o(i.prototype),"redoAction",this).call(this);var e=this.mash,t=this.redoFrame,n=this.trackIndex,r=this.insertIndex,s=this.clips;e.addClipToTrack(s,n,r,t)}},{key:"undoAction",value:function(){var e=this.mash,t=this.clips;e.removeClipFromTrack(t),a(o(i.prototype),"undoAction",this).call(this)}}]),i}(Zn),Qn=function(e){return H(e)&&"target"in e&&"property"in e},er=function(e){c(i,e);var t=l(i);function i(e){var n;h(this,i),n=t.call(this,e),v(u(n),"property",void 0),v(u(n),"redoValue",void 0),v(u(n),"target",void 0),v(u(n),"undoValue",void 0);var r=e.property,a=e.redoValue,o=e.target,s=e.undoValue;return n.property=r,n.redoValue=a,n.target=o,n.undoValue=s,n}return f(i,[{key:"redoValueNumeric",get:function(){return Number(this.redoValue)}},{key:"undoValueNumeric",get:function(){return Number(this.undoValue)}},{key:"redoAction",value:function(){this.target.setValue(this.redoValue,this.property)}},{key:"undoAction",value:function(){this.target.setValue(this.undoValue,this.property)}},{key:"updateAction",value:function(e){var t=e.redoValue;this.redoValue=t,this.redo()}}]),i}(Kn),tr=function(e){return e instanceof er},ir=function(e){c(i,e);var t=l(i);function i(e){return h(this,i),t.call(this,e)}return f(i,[{key:"redoAction",value:function(){this.mash.changeTiming(this.target,this.property,this.redoValueNumeric)}},{key:"undoAction",value:function(){this.mash.changeTiming(this.target,this.property,this.undoValueNumeric)}}]),i}(er),nr=function(e){c(i,e);var t=l(i);function i(e){var n;h(this,i),n=t.call(this,e),v(u(n),"clip",void 0),v(u(n),"insertIndex",void 0),v(u(n),"trackIndex",void 0),v(u(n),"undoTrackIndex",void 0),v(u(n),"undoInsertIndex",void 0),v(u(n),"undoFrame",void 0),v(u(n),"redoFrame",void 0);var r=e.clip,a=e.insertIndex,o=e.redoFrame,s=e.trackIndex,c=e.undoFrame,l=e.undoInsertIndex,f=e.undoTrackIndex;return n.clip=r,n.insertIndex=a,n.redoFrame=o,n.trackIndex=s,n.undoFrame=c,n.undoInsertIndex=l,n.undoTrackIndex=f,n}return f(i,[{key:"addClip",value:function(e,t,i){this.mash.addClipToTrack(this.clip,e,t,i)}},{key:"redoAction",value:function(){a(o(i.prototype),"redoAction",this).call(this),this.addClip(this.trackIndex,this.insertIndex,this.redoFrame)}},{key:"undoAction",value:function(){this.addClip(this.undoTrackIndex,this.undoInsertIndex,this.undoFrame),a(o(i.prototype),"undoAction",this).call(this)}}]),i}(Zn),rr=function(e){c(i,e);var t=l(i);function i(e){var n;h(this,i),n=t.call(this,e),v(u(n),"track",void 0),v(u(n),"clip",void 0),v(u(n),"index",void 0);var r=e.clip,a=e.index,o=e.track;return n.clip=r,n.index=a,n.track=o,n}return f(i,[{key:"trackIndex",get:function(){return this.track.index}},{key:"redoAction",value:function(){this.mash.removeClipFromTrack(this.clip)}},{key:"undoAction",value:function(){this.mash.addClipToTrack(this.clip,this.trackIndex,this.index)}}]),i}(Kn),ar=function(e){c(i,e);var t=l(i);function i(e){var n;h(this,i);var r=e.redoValues,a=e.undoValues;return n=t.call(this,e),v(u(n),"redoValues",void 0),v(u(n),"undoValues",void 0),n.undoValues=a,n.redoValues=r,n}return f(i,[{key:"redoAction",value:function(){var e=this.target,t=this.redoValues;Object.entries(t).forEach((function(t){var i=p(t,2),n=i[0],r=i[1];e.setValue(r,n)}))}},{key:"undoAction",value:function(){var e=this.target,t=this.undoValues;Object.entries(t).forEach((function(t){var i=p(t,2),n=i[0],r=i[1];e.setValue(r,n)}))}},{key:"updateAction",value:function(e){var t=e.redoValues;this.redoValues=t,this.redo()}}]),i}(er),or=function(e){c(i,e);var t=l(i);function i(e){var n;h(this,i),n=t.call(this,e),v(u(n),"objects",void 0),v(u(n),"redoObjects",void 0),v(u(n),"undoObjects",void 0);var r=e.objects,a=e.redoObjects,o=e.undoObjects;return n.objects=r,n.redoObjects=a,n.undoObjects=o,n}return f(i,[{key:"redoAction",value:function(){var e;(e=this.objects).splice.apply(e,[0,this.objects.length].concat(d(this.redoObjects)))}},{key:"undoAction",value:function(){var e;(e=this.objects).splice.apply(e,[0,this.objects.length].concat(d(this.undoObjects)))}}]),i}(Kn),sr=function(e){return e instanceof or},ur=function(t){switch(t.type){case e.ActionType.AddClipToTrack:return new $n(t);case e.ActionType.AddTrack:return new Zn(t);case e.ActionType.Change:return new er(t);case e.ActionType.ChangeFrame:return new ir(t);case e.ActionType.ChangeMultiple:return new ar(t);case e.ActionType.MoveClip:return new nr(t);case e.ActionType.Move:return new or(t);case e.ActionType.RemoveClip:return new rr(t)}},cr={createFromObject:ur},lr=function(){function t(e){h(this,t),v(this,"editor",void 0),v(this,"index",-1),v(this,"instances",[]),this.editor=e}return f(t,[{key:"add",value:function(e){var t=this.instances.length-(this.index+1);oe(t)&&this.instances.splice(this.index+1,t),this.instances.push(e)}},{key:"canRedo",get:function(){return this.index<this.instances.length-1}},{key:"canSave",get:function(){return this.canUndo}},{key:"canUndo",get:function(){return this.index>-1}},{key:"create",value:function(t){var i=this.editor,n=t.undoSelection,r=t.redoSelection,a=t.type,o=void 0===a?e.ActionType.Change:a,u=s(t,g),c=m(m({},u),{},{type:o,undoSelection:n||m({},i.selection.object),redoSelection:r||m({},i.selection.object)});if(Qn(t)&&this.currentActionLast){var l=this.currentAction;if(tr(l)){var h=t.target,f=t.property;if(l.target===h&&l.property===f)return l.updateAction(t),void i.handleAction(l)}}var d=ur(c);this.add(d),i.handleAction(this.redo())}},{key:"currentAction",get:function(){return this.instances[this.index]}},{key:"currentActionLast",get:function(){return this.canUndo&&!this.canRedo}},{key:"destroy",value:function(){this.index=-1,this.instances.splice(0,this.instances.length)}},{key:"redo",value:function(){this.index+=1;var e=this.currentAction;return Yn(e),e.redo(),e}},{key:"reusableChangeAction",value:function(e,t){if(this.currentActionLast){var i=this.currentAction;return tr(i)&&i.target===e&&i.property===t?i:void 0}}},{key:"save",value:function(){this.instances.splice(0,this.index+1),this.index=-1}},{key:"selection",get:function(){return this.editor.selection}},{key:"undo",value:function(){var e=this.currentAction;return Yn(e),this.index-=1,e.undo(),e}}]),t}(),hr=function(e){return H(e)&&"width"in e&&"height"in e&&ne(e.width)&&ne(e.height)};function fr(e,t){hr(e)||G(e,"Size",t)}var dr=function(e,t){return!!hr(t)&&e.width===t.width&&e.height===t.height},pr={width:0,height:0},vr=function(e){return 2*Math.max(1,Math.ceil(e/2))},mr=function(e){var t=e.width,i=e.height;return{width:vr(t),height:vr(i)}},yr=function(e){var t=e.width,i=e.height;return{width:Math.round(t),height:Math.round(i)}},gr=function(e){var t=e.width,i=e.height;return{width:Math.max(2,Math.ceil(t)),height:Math.max(2,Math.ceil(i))}},kr=function(e,t,i){return{width:e.width*t,height:e.height*i}},Tr=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];wr(e,"sizeCover.inSize"),fr(t,"sizeCover.outSize");var n=e.width,r=e.height,a=t.width/n,o=t.height/r;return gr(m(m({},t),{},(i?a<o:a>o)?{height:r*a}:{width:n*o}))},br=function(e){if(!hr(e))return!1;var t=e.width,i=e.height;return ce(t)&&ce(i)};function wr(e,t){br(e)||G(e,"SizeAboveZero",t)}var Fr={width:1920,height:1080},Sr=kr(Fr,.25,.25),Ir=kr(Sr,.5,.5),Cr=function(e){var t=e.width,i=void 0===t?0:t,n=e.height;return{width:i,height:void 0===n?0:n}},Pr=function(t,i){var n=Cr(t);switch(i){case e.Orientation.H:n.width=n.height;break;case e.Orientation.V:n.height=n.width}return n},xr=function(e){var t=e.width,i=e.height;return"width=".concat(t,";height=").concat(i)},Ar=function(t,i){wr(t,"sizeLockNegative");var n=Cr(t);return i&&(i===e.Orientation.V?n.height=-1:n.width=-1),n},Mr=function(e){c(i,e);var t=l(i);function i(){var e;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),v(u(e),"queue",new Map),v(u(e),"trapped",new Map),e}return f(i,[{key:"dispatch",value:function(e,t){this.dispatchEvent(this.event(e,t))}},{key:"emit",value:function(e,t){if(this.trapped.has(e)){var i=this.trapped.get(e);i&&i(this.event(e,t))}else this.dispatch(e,t)}},{key:"enqueue",value:function(e){}},{key:"event",value:function(e,t){return new CustomEvent(e,t?{detail:t}:void 0)}},{key:"trap",value:function(e,t){this.trapped.has(e)||this.trapped.set(e,t||null)}}]),i}(r(EventTarget)),Dr=function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:""){case"ceil":return Math.ceil;case"floor":return Math.floor;default:return Math.round}},zr=function(e){return Dr(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"")(e)},Er=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(e.fps===t.fps)return[e,t];var n,r,a=(n=e.fps)*(r=t.fps)/function(e,t){for(var i=e,n=t,r=0;0!==n;)r=n,n=i%n,i=r;return i}(n,r);return[e.scale(a,i),t.scale(a,i)]},Vr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;h(this,e),v(this,"fps",void 0),v(this,"frame",void 0),v(this,"isRange",!1),se(t),ae(t),le(i),this.frame=t,this.fps=i}return f(e,[{key:"add",value:function(t){var i=Er(this,t),n=p(i,2),r=n[0],a=n[1];return new e(r.frame+a.frame,r.fps)}},{key:"addFrame",value:function(e){var t=this.copy;return t.frame+=e,t}},{key:"closest",value:function(t){var i=new e(t.frame+Math.round(t.frames/2),t.fps),n=Er(i,this),r=p(n,2),a=r[0],o=r[1];return a.frame<o.frame?t.lastTime:t.startTime}},{key:"copy",get:function(){return new e(this.frame,this.fps)}},{key:"description",get:function(){return"".concat(this.frame,"@").concat(this.fps)}},{key:"divide",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return le(e),1===e?this:this.withFrame(zr(this.frame/e,t))}},{key:"equalsTime",value:function(e){var t=Er(this,e),i=p(t,2),n=i[0],r=i[1];return n.frame===r.frame}},{key:"durationFrames",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)||this.fps,i=[],n=Math.floor(t*e)-2,r=Math.min(n,this.scale(t,"floor").frame);if(this.isRange)for(var a=this.timeRange.endTime.scale(t,"ceil").frame,o=Math.min(n+1,a),s=r;s<o;s+=1)i.push(s);else i.push(r);return i}},{key:"lengthSeconds",get:function(){return 0}},{key:"min",value:function(t){var i=Er(this,t),n=p(i,2),r=n[0],a=n[1];return new e(Math.min(r.frame,a.frame),r.fps)}},{key:"scale",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(this.fps===t)return this;var n=Number(this.frame)/Number(this.fps)*Number(t);return new e(zr(n,i),t)}},{key:"scaleToFps",value:function(t){return this.scaleToTime(new e(0,t))}},{key:"scaleToTime",value:function(e){return Er(this,e)[0]}},{key:"seconds",get:function(){return Number(this.frame)/Number(this.fps)}},{key:"startTime",get:function(){return this}},{key:"subtract",value:function(t){var i=Er(this,t),n=p(i,2),r=n[0],a=n[1].frame;return a>r.frame&&(a-=a-r.frame),new e(r.frame-a,r.fps)}},{key:"subtractFrames",value:function(e){var t=this.copy;return t.frame-=e,t}},{key:"timeRange",get:function(){return G(V.Internal)}},{key:"toString",value:function(){return"[".concat(this.description,"]")}},{key:"withFrame",value:function(e){var t=this.copy;return t.frame=e,t}}]),e}(),Rr=function(e){c(i,e);var t=l(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return h(this,i),e=t.call(this,n,r),v(u(e),"frames",void 0),v(u(e),"isRange",!0),se(a),ae(a),e.frames=a,e}return f(i,[{key:"addFrames",value:function(e){var t=this.copy;return t.frames+=e,t}},{key:"copy",get:function(){return new i(this.frame,this.fps,this.frames)}},{key:"description",get:function(){return"".concat(this.frame,"-").concat(this.frames,"@").concat(this.fps)}},{key:"end",get:function(){return this.frame+this.frames}},{key:"endTime",get:function(){return new Vr(this.end,this.fps)}},{key:"equalsTimeRange",value:function(e){var t=Er(this,e),i=p(t,2),n=i[0],r=i[1];return n.frame===r.frame&&n.frames===r.frames}},{key:"frameTimes",get:function(){var e=this.frames,t=this.frame,i=this.fps;return Array.from({length:e},(function(e,n){return new Vr(t,i)}))}},{key:"includes",value:function(e){return e>=this.frame&&e<=this.end}},{key:"includesTime",value:function(e){var t=Er(this,e),i=p(t,2),n=i[0],r=i[1],a=n,o=a.frame,s=a.end,u=r.frame;return u>=o&&u<s}},{key:"intersection",value:function(e){var t=e.isRange?e.timeRange:new i(e.frame,e.fps),n=Er(t,this),r=p(n,2),a=r[0],o=r[1],s=a.frame,u=a.end,c=a.fps,l=o.frame,h=o.end,f=Math.max(s,l);return new i(f,c,Math.min(u,h)-f)}},{key:"intersects",value:function(e){if(!e.isRange)return this.includesTime(e);var t=Er(e,this),i=p(t,2),n=i[0],r=i[1];return!(n.frame>=r.end)&&n.end>r.frame}},{key:"last",get:function(){return this.frame+this.frames-1}},{key:"lastTime",get:function(){return new Vr(this.last,this.fps)}},{key:"lengthSeconds",get:function(){return Number(this.frames)/Number(this.fps)}},{key:"position",get:function(){return Number(this.frame)/Number(this.frames)}},{key:"positionTime",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=zr((this.frames-this.frame)*e,t);return new Vr(this.frame+i,this.fps)}},{key:"startTime",get:function(){return new Vr(this.frame,this.fps)}},{key:"scale",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(this.fps===e)return this.copy;var n=Number(this.frames)/(Number(this.fps)/Number(e)),r=a(o(i.prototype),"scale",this).call(this,e,t),s=Math.max(1,zr(n,t));return new i(r.frame,r.fps,s)}},{key:"timeRange",get:function(){return this}},{key:"times",get:function(){var e=[this.startTime];return this.frames>1&&e.push(this.endTime),e}},{key:"minEndTime",value:function(e){var t=Er(this,e),i=p(t,2),n=i[0],r=i[1];return n.frames=Math.min(n.frames,r.frame),n}},{key:"withFrame",value:function(e){var t=this.copy;return t.frame=e,t}},{key:"withFrames",value:function(e){var t=this.copy;return t.frames=e,t}}]),i}(Vr),Or=function(){return new Rr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1)},_r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Or(e.frame,e.fps,t)},jr=function(e,t){if(!t)return _r(e);var i=Er(e,t),n=p(i,2),r=n[0],a=n[1];if(a.frame<=r.frame)return G(V.Frame);var o=a.frame-r.frame;return Or(r.frame,r.fps,o)},Nr=function(){return new Vr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)},qr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";se(e),ae(t),le(t);var n=zr(e*t,i);return Nr(n,t)},Br=function(e){return wn(e)&&Sn(e.definition)};function Ur(e){if(!Br(e))throw new Error("expected Tweenable")}var Lr=function(e){return Sn(e)},Gr=function(e){return Br(e)&&e.type===Re};function Hr(e){if(!Gr(e))throw new Error("expected Effect")}var Wr=function(e){return H(e)&&"frameForClipNearFrame"in e};function Jr(e,t){Wr(e)||G(e,"Track",t)}var Kr={label:"Mash",quantize:10,color:$i,gain:.75,buffer:10},Xr={duration:3,label:"Unlabeled",editor:{buffer:10,fps:30,loop:!0,volume:.75,precision:3,autoplay:!1},video:Kr,effect:{label:"Effect"},audio:{label:"Audio"},image:{label:"Image"},audiostream:{label:"Audio Stream"},sequence:{label:"Sequence"},videostream:{label:"Cast",quantize:10,color:$i,gain:.75,buffer:10},mash:Kr,font:{label:"Text",string:"Example Text"},definition:{image:{duration:2},textcontainer:{duration:3},shape:{duration:3},visible:{duration:3},video:{fps:0},videosequence:{pattern:"%.jpg",fps:10,increment:1,begin:1,padding:0},videostream:{duration:10}}},Yr=function(e){return H(e)&&"contentId"in e};function Zr(e,t){Yr(e)||G(e,"Clip",t)}t=e.SelectType.None,I=e.SelectType.Clip,C=e.SelectType.Mash,P=e.SelectType.Track,x=e.SelectType.Container,A=e.SelectType.Content;var $r,Qr=function(){function i(){h(this,i),v(this,"_editor",void 0),v(this,"_focus",e.SelectType.Mash),v(this,"_object",{})}return f(i,[{key:t,get:function(){}},{key:I,get:function(){var e=this._object.clip;if(Yr(e))return e}},{key:C,get:function(){var e=this._object.mash;if(Wn(e))return e}},{key:P,get:function(){var e=this._object,t=e.clip,i=e.track;return Wr(i)?i:Yr(t)?t.track:void 0}},{key:x,get:function(){var e=this._object.clip;if(Yr(e))return e.container}},{key:A,get:function(){var e=this._object.clip;if(Yr(e))return e.content}},{key:"editor",get:function(){return this._editor}},{key:"editor",set:function(e){this._editor=e}},{key:"focus",get:function(){return this._focus}},{key:"focus",set:function(e){this._focus=e}},{key:"get",value:function(e){return this[e]}},{key:"unset",value:function(e){var t=this.object[e];if(t){var i=t.selectables();be(i[0]===t),i.shift(),this.object=this.selectionFromSelectables(i)}}},{key:"set",value:function(e){var t=e.selectType;this.object=v({},t,e)}},{key:"object",get:function(){var e=this;return Object.fromEntries(yt.map((function(t){return[t,e.get(t)]})))}},{key:"object",set:function(t){var i=this.selectionPopulated(t),n=this.object;this.clear(),Object.assign(this._object,i);var r=this.object,a=n.mash,o=n.clip,s=r.mash,u=r.clip;u!==o&&(Yr(u)&&oe(u.trackNumber)&&u.track.mash.clearPreview(),Yr(o)&&oe(o.trackNumber)&&o.track.mash.clearPreview()),Object.assign(this._object,i),this.editor.eventTarget.emit(e.EventType.Selection),s!==a&&(this.editor.eventTarget.emit(e.EventType.Loaded),this.editor.eventTarget.emit(e.EventType.Track),this.editor.eventTarget.emit(e.EventType.Duration))}},{key:"clear",value:function(){var e=this;yt.forEach((function(t){delete e._object[t]}))}},{key:"selectionFromSelectables",value:function(e){return Object.fromEntries(e.map((function(e){return[e.selectType,e]})))}},{key:"selectionPopulated",value:function(e){var t=this.mash,i=(this.object,e.clip),n=e.track,r=e.mash,a=i||n||r||t;return be(a,"target"),this.selectionFromSelectables(a.selectables())}},{key:"selectTypes",get:function(){var t=[],i=this.mash,n=this.object,r=n.clip,a=n.track;return i?(t.push(e.SelectType.Mash),a?(t.push(e.SelectType.Track),Yr(r)?(t.push(e.SelectType.Clip),t.push(e.SelectType.Content),pe(r.containerId)&&t.push(e.SelectType.Container),t):t):t):t}},{key:"selectedItems",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yt,i=this.selectTypes,n=this.object,r=i.filter((function(e){return t.includes(e)})),a=n.clip;return r.flatMap((function(t){var i=n[t];return Tt(t)&&Yr(a)&&(i=a[t]),be(i,t),i.selectedItems(e.editor.actions)}))}}]),i}(),ea=function(){return new Qr},ta=function(e,t){return e.frame-t.frame},ia=function(e,t){return e.index-t.index},na=function(e,t){return e.trackNumber-t.trackNumber};e.DataGroup=void 0,($r=e.DataGroup||(e.DataGroup={})).Color="color",$r.Effects="effects",$r.Opacity="opacity",$r.Point="point",$r.Size="size",$r.Timing="timing";var ra=Object.values(e.DataGroup),aa=function(e){return ra.includes(e)},oa=function(e){return H(e)&&"type"in e&&Mt(e.type)};function sa(e,t){oa(e)||G(e,"Property",t)}var ua=function(t){var i=t.type,n=t.name,r=t.defaultValue,a=s(t,k),o=function(t,i){return X(t)?$(i)?e.DataType.Boolean:ne(i)?e.DataType.Number:e.DataType.String:(Dt(t),t)}(i,r),u=function(e,t){return X(t)?vn(e):t}(o,r),c=m({type:o,defaultValue:u,name:pe(n)?n:o},a);return i===e.DataType.Percent&&(X(c.max)&&(c.max=1),X(c.min)&&(c.min=0),X(c.step)&&(c.step=.01)),c},ca="temporary",la={},ha=function(){var e=[ca];return e.push(Date.now().toString(36)),e.push(Math.random().toString(36).slice(2)),e.join("-")},fa=function(e){var t=[];return t.push(e),la[e]||(la[e]=0),t.push(String(la[e]++)),t.join("-")},da=function(){return fa(ca)},pa=function(e){return e.startsWith(ca)},va="".concat(hi,"container.image").concat(fi),ma="".concat(hi,"container.image.text"),ya=function(e){return H(e)&&"opacity"in e},ga=function(e){return Br(e)&&ht(e.type)};function ka(e){if(!ga(e))throw new Error("expected Container")}var Ta="".concat(hi,"content.image").concat(fi),ba=function(e){return Br(e)&&dt(e.type)};function wa(e,t){ba(e)||G(e,"Content",t)}var Fa=function(e){return Lr(e)&&dt(e.type)};function Sa(e){return function(e){c(i,e);var t=l(i);function i(){var e;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),v(u(e),"type",_e),e}return f(i,[{key:"loadPromise",value:function(e){return Promise.resolve()}}]),i}(e)}var Ia=function(e){return H(e)&&"x"in e&&"y"in e&&ne(e.x)&&ne(e.y)};function Ca(e,t){Ia(e)||G(e,"Point",t)}var Pa=function(e,t){return!!Ia(t)&&e.x===t.x&&e.y===t.y},xa={x:0,y:0},Aa=function(e){return{x:e.x,y:e.y}},Ma=function(e){var t=e.x,i=e.y;return{x:Math.round(t),y:Math.round(i)}},Da=function(e){var t=e.x,i=e.y;return"x=".concat(t,";y=").concat(i)},za=function(e){return hr(e)&&Ia(e)};function Ea(e,t){za(e)||G(e,"Rect",t)}var Va=function(e,t){return!!za(t)&&Pa(e,t)&&dr(e,t)},Ra=m(m({},xa),pr),Oa=function(e,t){var i=t||xa,n=e.width,r=e.height;return{x:i.x,y:i.y,width:n,height:r}},_a=function(e,t){return{x:Math.round((e.width-t.width)/2),y:Math.round((e.height-t.height)/2)}},ja=function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];se(i),se(t);var a=n?t:0;return(e-t+a+(r?t:0))*i-a},Na=function(e,t,i,n){return e+(t-e)/n*i},qa=function(e,t,i,n){K(e),K(t);var r=i/n;return be(un(e),"hex color"),7===e.length||4===e.length?an(fn(cn(e),cn(t),r)):on(hn(ln(e),ln(t),r))},Ba=function(e,t,i,n){return{x:Na(e.x,t.x,i,n),y:Na(e.y,t.y,i,n),width:Na(e.width,t.width,i,n),height:Na(e.height,t.height,i,n)}},Ua=function(e,t){var i=e.width,n=e.height;return!hr(t)||dr(e,t)?{width:i,height:n}:{width:Math.max(i,t.width),height:Math.max(n,t.height)}},La=function(e,t,i,n){Z(e);var r=n?Math.round(e):e;if(!ne(t))return r;var a=n?Math.round(t):t;return r===a?r:"(".concat(r,"+(").concat(a-r,"*").concat(i,"))")},Ga=function(e,t){return"(".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"n","/").concat(e*t,")")},Ha=function(e){if(!H(e))return{};var t=Object.entries(e).filter((function(e){var t=p(e,2),i=(t[0],t[1]);return ne(i)}));return Object.fromEntries(t)},Wa=function(e,t){return m(m({},e),Ha(t))},Ja=function(e,t){return m(m({},e),Ha(t))},Ka=function(e,t){return te(t)?m(m({},e),Ha(t)):e},Xa=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};fr(e),Ea(t);var n=e.width,r=e.height,a=t.x,o=t.y,s=t.width,u=t.height;se(a),se(o),se(s),se(u);var c=kr(e,s,u),l=gr(c);return m(m({},l),{},{x:Math.round(ja(n,l.width,a,i.E,i.W)),y:Math.round(ja(r,l.height,o,i.N,i.S))})},Ya=function(e,t,i){var n=he(t)?t:[t,t],r=p(n,2),a=r[0],o=r[1],s=Tr(e,a),u=Tr(e,o),c=p(i,2),l=c[0],h=c[1],f=l.width,d=l.height,v=h.width,m=h.height,y=kr(s,f,d),g=kr(u,v,m);return[gr(y),gr(g)]},Za=function(e,t,i){var n=he(t)?t:[t,t],r=p(e,2),a=r[0],o=r[1],s=p(n,2),u=s[0],c=s[1],l=p(i,2),h=l[0],f=l[1],d=h.x,v=h.y,m=f.x,y=f.y;return[{x:d*(a.width-u.width),y:v*(a.height-u.height)},{x:m*(o.width-c.width),y:y*(o.height-c.height)}]},$a=function(e,t){return m(m({},e),Pr(e,t))},Qa=function(e,t){return e.map((function(e){return $a(e,t)}))},eo=function(t,i,n,r){if(!r)return t;var a=i.width,o=i.height,s=m({},t);switch(r){case e.Orientation.H:s.width=o*s.height*n/a;break;case e.Orientation.V:s.height=a*s.width/n/o}return s},to=function(e){Ur(e);var t=e.clip,i=t.track.mash.quantize,n=t.timeRange(i),r=e.tweenPoints(n,n);return!Pa.apply(void 0,d(r))},io=function(e,t,i){return Math.min(i,Math.max(t,e))},no=function(e,t,i){var n=e.filter((function(e){return e.input})),r=n.findIndex((function(e){return e.inputId===t}));return oe(r)||console.log("commandFilesInputIndex",t,n),se(r,"commandFilesInputIndex"),r},ro=function(e,t,i){var n=i?"v":"a";return[no(e,t),n].join(":")},ao=function(e){c(i,e);var t=l(i);function i(){var e,n;h(this,i);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];n=t.call.apply(t,[this].concat(a)),v(u(n),"definition",void 0),v(u(n),"_id",void 0),v(u(n),"_label","");var s=a[0];ke(s);var c=s.definition;return c&&(n.definition=c),(e=n.properties).push.apply(e,d(n.definition.properties)),n.propertiesInitialize(s),n}return f(i,[{key:"mediaId",get:function(){return this.definition.id}},{key:"definitionIds",value:function(){return[this.mediaId]}},{key:"id",get:function(){return this._id||(this._id=ha())}},{key:"label",get:function(){return this._label},set:function(e){this._label=e}},{key:"serverPromise",value:function(e){return this.definition.serverPromise(e)}},{key:"toJSON",value:function(){var e=this.mediaId,t=this.type,n=this.label;return m(m({},a(o(i.prototype),"toJSON",this).call(this)),{},{type:t,label:n,mediaId:e})}},{key:"type",get:function(){return this.definition.type}},{key:"unload",value:function(){this.definition.unload()}}]),i}(kn),oo=function(){function t(i){var n=i.name,r=i.value,a=i.dataType,o=i.values;if(h(this,t),v(this,"dataType",e.DataType.String),v(this,"name",""),v(this,"value",""),v(this,"values",void 0),!n)return G(V.Internal);if(this.values=o,this.name=n,X(r)){var s;if(null===(s=this.values)||void 0===s||!s.length)return G(V.Internal);this.value=this.values[0]}else this.value=r;if(a&&At.map(String).includes(a))this.dataType=a;else{var u=!1;u=Array.isArray(this.value)?this.value.every((function(e){return Te(e.value)})):Te(this.value),u&&(this.dataType=e.DataType.Number)}}return f(t,[{key:"toJSON",value:function(){return{name:this.name,value:this.value}}}]),t}(),so={},uo=function(e){return H(e)&&"instanceFromObject"in e};function co(e,t){uo(e)||G(e,"FilterDefinition",t)}var lo,ho=function(e){c(i,e);var t=l(i);function i(e){var n,r,a;h(this,i),a=t.call(this),v(u(a),"parameters",[]),v(u(a),"_parametersDefined",void 0),v(u(a),"_label","");var o=e.definition,s=e.parameters;return co(o),a.definition=o,null!==s&&void 0!==s&&s.length&&(n=a.parameters).push.apply(n,d(s.map((function(e){var t=e.name;if(!e.dataType){var i=a.definition.parameters.find((function(e){return e.name===t}));i&&(e.dataType=i.dataType)}return new oo(e)})))),(r=a.properties).push.apply(r,d(a.definition.properties)),a.propertiesInitialize(e),a}return f(i,[{key:"commandFiles",value:function(e){return this.definition.commandFiles(m(m({},e),{},{filter:this}))}},{key:"commandFilters",value:function(e){return this.definition.commandFilters(m(m({},e),{},{filter:this}))}},{key:"parametersDefined",get:function(){if(this._parametersDefined)return this._parametersDefined;var e=d(this.parameters);return e.push.apply(e,d(this.definition.parameters.filter((function(t){return!e.find((function(e){return e.name===t.name}))})))),this._parametersDefined=e}},{key:"filterSvgs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.definition.filterDefinitionSvgs(m(m({},e),{},{filter:this}))}},{key:"filterSvgFilter",value:function(){var e=this.scalarObject();return this.definition.filterDefinitionSvgFilter(e)}},{key:"label",get:function(){return this._label},set:function(e){this._label=e}},{key:"scalarObject",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i={};return this.parametersDefined.forEach((function(t){var n=t.name,r=t.value;pe(r)&&e.properties.find((function(e){return r===e.name}))||(ne(r)||J(r))&&(i[n]=r)})),this.properties.forEach((function(n){var r=n.tweenable,a=n.name;if(!te(i[a])&&(i[a]=e.value(a),t&&r)){var o="".concat(a).concat(gn);i[o]=e.value(o)}})),i}},{key:"toString",value:function(){return"[Filter ".concat(this.label,"]")}}]),i}(kn),fo=function(){function t(e){h(this,t),v(this,"id",void 0),v(this,"_ffmpegFilter",void 0),v(this,"properties",[]),v(this,"parameters",[]);var i=e.id;ve(i,"id"),this.id=i}return f(t,[{key:"commandFiles",value:function(e){return[]}},{key:"commandFilters",value:function(e){var t=e.filter,i=e.duration,n=e.filterInput;ve(n);var r=[],a=t.scalarObject(!!i);Me(a);var o=this.ffmpegFilter,s={inputs:[n],ffmpegFilter:o,options:a,outputs:[fa(o)]};return r.push(s),r}},{key:"commandFilter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.ffmpegFilter;return{ffmpegFilter:t,options:e,inputs:[],outputs:[fa(t)]}}},{key:"ffmpegFilter",get:function(){return this._ffmpegFilter||(this._ffmpegFilter=this.id.split(".").pop()||this.id)}},{key:"filterDefinitionSvgs",value:function(e){return G(V.Unimplemented)}},{key:"instanceArgs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return m(m(m({},Object.fromEntries(this.properties.map((function(e){return[e.name,e.defaultValue]})))),e),{},{definition:this})}},{key:"instanceFromObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new ho(this.instanceArgs(e))}},{key:"populateParametersFromProperties",value:function(){this.parameters=this.properties.map((function(t){var i=t.name;return new oo({name:i,value:i,dataType:e.DataType.String})}))}},{key:"filterDefinitionSvgFilter",value:function(e){return G(V.Unimplemented)}},{key:"toJSON",value:function(){return{id:this.id}}},{key:"toString",value:function(){return this.id}}]),t}(),po=!1,vo=function(){return lo||(lo=So())},mo=function(e){lo=e},yo=function(e){return"#".concat(e)},go=function(e){return"url(".concat(yo(e),")")},ko=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=globalThis.document.createElementNS(li,"g");return Vo(i,t),To(i,e),i},To=function(e,t){if(hr(t)){var i=t.width,n=t.height;oe(i)&&Vo(e,String(i),"width"),oe(n)&&Vo(e,String(n),"height")}if(Ia(t)){var r=t.x,a=t.y;Vo(e,String(r),"x"),Vo(e,String(a),"y")}},bo=function(e){var t=e.width,i=e.height,n=e.x,r=void 0===n?0:n,a=e.y,o=void 0===a?0:a,s={x:r,y:o},u=[];return u.push(s),u.push({x:r+t,y:o}),u.push({x:r+t,y:o+i}),u.push({x:r,y:o+i}),u.push(s),u},wo=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3?arguments[3]:void 0,r=globalThis.document.createElementNS(li,"polygon"),a=bo(e).map((function(e){return[e.x,e.y].join(",")})).join(" ");return Vo(r,a,"points"),Vo(r,i,"fill"),Ro(r,t),Vo(r,n),r},Fo=function(e,t){wr(t,"svgSetBox");var i=Cr(t),n=i.width,r=i.height;To(e,i),Vo(e,"0 0 ".concat(n," ").concat(r),"viewBox")},So=function(e,t){var i=globalThis.document.createElementNS(li,"svg");return Vo(i,"1.1","version"),Vo(i,li,"xmlns"),Mo(i,t),br(e)?(Fo(i,e),i):i},Io=function(e,t,i){wr(t),i||Vo(e,"none","preserveAspectRatio");var n=m(m({},Ar(t,i)),Aa(t));To(e,n)},Co=function(){var e=globalThis.document.createElementNS(li,"image");return Vo(e,"none","preserveAspectRatio"),e},Po=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"currentColor",i=globalThis.document.createElementNS(li,"path");return Vo(i,e,"d"),Vo(i,t,"fill"),i},xo=function(e,t,i){var n=ha(),r=globalThis.document.createElementNS(li,"mask");return Vo(r,n),br(e)&&Mo(r,wo(e,"",i?"black":"none")),t&&(Vo(t,go(n),"mask"),i&&Vo(t,"luminance","mask-mode")),r},Ao=function(e,t){var i=e.filter,n=s(e,T);ve(i);var r=globalThis.document.createElementNS(li,i);return To(r,t),Object.entries(n).forEach((function(e){var t=p(e,2),i=t[0],n=t[1];Vo(r,String(n),i)})),r},Mo=function(e,t){t&&(he(t)?t:[t]).forEach((function(t){return e.appendChild(t)}))},Do=function(e){var t=globalThis.document.createElementNS(li,"defs");return Mo(t,e),t},zo=function(e,t){var i=globalThis.document.createElementNS(li,"feImage");return pe(e)&&Vo(i,yo(e),"href"),Vo(i,t,"result"),i},Eo=function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"userSpaceOnUse",r=globalThis.document.createElementNS(li,"filter");if(n&&Vo(r,n,"filterUnits"),Vo(r,"sRGB","color-interpolation-filters"),Mo(r,e),t){var a=ha();Vo(r,a),t&&(he(t)?t:[t]).forEach((function(e){Vo(e,go(a),"filter"),Ro(e,"filtered")}))}return To(r,i),r},Vo=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"id";pe(t)&&e.setAttribute(i,t)},Ro=function(e,t){var i;if(t){var n=he(t)?t:t.split(" ");(i=e.classList).add.apply(i,d(n))}},Oo=function(e,t,i){var n=globalThis.document.createElementNS(li,"use");return pe(e)&&Vo(n,yo(e),"href"),Vo(n,i),Ro(n,t),n},_o=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"top left";Vo(e,t,"transform"),Vo(e,i,"transform-origin")},jo=function(e,t){wr(e,"svgTransform.dimensions"),wr(t,"svgTransform.rect");var i=e.width,n=e.height,r=t.width,a=t.height,o=t.x,s=t.y,u=r/i,c=a/n,l=[];if(0===o&&0===s||l.push("translate(".concat(o,",").concat(s,")")),1===u&&1===c||l.push("scale(".concat(u,",").concat(c,")")),Ia(e)){var h=e.x,f=e.y;0===h&&0===f||l.push("translate(".concat(h,",").concat(f,")"))}return l.join(" ")},No=function(e,t,i){_o(e,jo(t,i))},qo=function(e,t){if(!e.hasChildNodes())return Mo(e,t);var i=e.childNodes,n=[];i.forEach((function(e){t.includes(e)||n.push(e)})),n.forEach((function(t){e.removeChild(t)})),t.forEach((function(t){return e.appendChild(t)}))},Bo=function(e){return new Promise((function(t,i){var n=Co(),r=function(){n.removeEventListener("error",a),n.removeEventListener("load",o),lo&&!po&&lo.appendChild(n)},a=function(e){r(),i(e)},o=function(){r(),t(n)};n.addEventListener("error",a,{once:!0}),n.addEventListener("load",o,{once:!0}),lo&&!po&&lo.appendChild(n),Vo(n,e,"href")}))},Uo=function(e,t,i,n){var r=globalThis.document.createElementNS(li,"text");return r.setAttribute("font-family",t),r.setAttribute("font-size",String(i)),r.append(e),_o(r,n),r},Lo=function(e,t){return Bo(e).then((function(e){var i=t.lock,n=s(t,b);return Io(e,n,i),e}))};!function(){var e=globalThis.document;if(e){var t=e.createElement("canvas");t.width=t.height=1;var i=t.getContext("2d");be(i),i.fillRect(0,0,1,1),Bo(t.toDataURL()).then((function(){po=!0}))}}();var Go=function(t){c(n,t);var i=l(n);function n(t){var r;return h(this,n),(r=i.call(this,t)).properties.push(ua({custom:!0,name:"color",type:e.DataType.String,defaultValue:rn})),r.properties.push(ua({custom:!0,name:"similarity",type:e.DataType.Percent,defaultValue:.9,min:.1,step:.01,max:1})),r.properties.push(ua({custom:!0,name:"blend",type:e.DataType.Percent,defaultValue:0,step:.01,max:1})),r.populateParametersFromProperties(),r}return f(n,[{key:"filterDefinitionSvgFilter",value:function(e){var t=e.similarity,i=e.color,n=e.blend;Z(t),Z(n),ve(i);var r=255,a=65025*(1-n),o=cn(i),s=1-t*(o.r/r),u=1-t*(o.g/r),c=1-t*(o.b/r);return[Ao({filter:"feColorMatrix",type:"matrix",values:"1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 ".concat(s," ").concat(u," ").concat(c," -").concat(a," ").concat(a)})]}}]),n}(fo),Ho=function(t){c(n,t);var i=l(n);function n(t){var r;return h(this,n),r=i.call(this,t),v(u(r),"_ffmpegFilter","geq"),r.properties.push(ua({tweenable:!0,custom:!0,name:"color",type:e.DataType.String})),r.populateParametersFromProperties(),r}return f(n,[{key:"commandFilters",value:function(e){var t=[],i=e.filter,n=e.videoRate,r=e.duration,a=e.filterInput;Z(r,"duration"),Z(n,"videoRate");var o=i.value("color");ve(o,"color");var s=a;ve(s,"filterInput");var u="format",c=fa(u),l={inputs:[s],ffmpegFilter:u,options:{pix_fmts:"rgba"},outputs:[c]};t.push(l),s=c;var h=i.value("color".concat(gn))||o;ve(h);var f=o.length>7,d=f?ln(o):cn(o),p=f?ln(h):cn(h),v=f?Yi:Xi,m={},y=r?Ga(n,r,"N"):0;v.forEach((function(e){var t=d[e],i=p[e];m[e]=t===i?t:"".concat(t,"+(").concat(i-t,"*").concat(y,")")})),f||(m.a="alpha(X,Y)");var g=fa("geq"),k={inputs:[s],ffmpegFilter:"geq",options:m,outputs:[g]};return t.push(k),t}}]),n}(fo),Wo=function(t){c(n,t);var i=l(n);function n(t){var r;return h(this,n),r=i.call(this,t),v(u(r),"_ffmpegFilter","color"),r.properties.push(ua({tweenable:!0,name:"color",type:e.DataType.String})),["width","height"].forEach((function(t){r.properties.push(ua({tweenable:!0,name:t,type:e.DataType.Number}))})),r.populateParametersFromProperties(),r}return f(n,[{key:"commandFilters",value:function(e){var t=[],i=e.filter,n=e.videoRate,r=e.duration;le(n,"videoRate");var a=this.ffmpegFilter,o=fa(a),s=i.value("color");ve(s);var u=r?i.value("color".concat(gn)):void 0,c=pe(u)&&s!==u,l=i.scalarObject(!!r);fr(l);var h=l.width,f=l.height,d=!1,p={width:h,height:f},v={width:h,height:f};if(r){var m=l["width".concat(gn)],y=void 0===m?h:m,g=l["height".concat(gn)],k=void 0===g?f:g;Z(y),Z(k),(d=!(h===y&&f===k))&&(v.width=y,v.height=k)}var T=d?Ua(p,v):p,b={inputs:[],ffmpegFilter:a,options:{color:s,rate:n,size:Object.values(T).join("x")},outputs:[o]};if(ce(r)&&(b.options.duration=r),t.push(b),c){var w="fade",F=fa(w),S={inputs:[o],ffmpegFilter:w,options:{type:"out",color:u,duration:r},outputs:[F]};t.push(S),o=F}if(d){var I="scale",C=fa(I),P=Ga(n,r),x={inputs:[o],ffmpegFilter:I,options:{eval:"frame",width:La(p.width,v.width,P),height:La(p.height,v.height,P)},outputs:[C]};t.push(x)}return t}},{key:"filterDefinitionSvgs",value:function(e){var t=e.filter.scalarObject(!1),i=t.width,n=t.height,r=t.color;ve(r);var a=globalThis.document.createElementNS(li,"rect");return a.setAttribute("width",String(i)),a.setAttribute("height",String(n)),a.setAttribute("fill",function(e){var t=String(e);return"0x"===t.slice(0,2)?"#".concat(t.slice(2)):t}(r)),[a]}}]),n}(Ho),Jo=Yi.flatMap((function(e){return Yi.map((function(t){return"".concat(e).concat(t)}))})),Ko=function(t){c(n,t);var i=l(n);function n(t){var r;return h(this,n),r=i.call(this,t),Jo.forEach((function(t){r.properties.push(ua({custom:!0,name:t,type:e.DataType.Number,defaultValue:t[0]===t[1]?1:0,min:0,max:1}))})),r.populateParametersFromProperties(),r}return f(n,[{key:"filterDefinitionSvgFilter",value:function(e){var t={filter:"feColorMatrix",type:"matrix",values:Yi.flatMap((function(t){return[].concat(d(Yi.map((function(i){return Number(e["".concat(t).concat(i)])}))),[0])})).join(" ")};return[Ao(t)]}}]),n}(fo),Xo=function(e){c(i,e);var t=l(i);function i(e){var n;return h(this,i),(n=t.call(this,e)).properties.push(ua({custom:!0,name:"bias",defaultValue:0,min:0,max:100,step:.01})),n.properties.push(ua({custom:!0,name:"matrix",defaultValue:"0 0 0 0 1 0 0 0 0"})),n.properties.push(ua({custom:!0,name:"multiplier",defaultValue:1,min:0,max:100,step:.01})),n.populateParametersFromProperties(),n}return f(i,[{key:"commandFilters",value:function(e){var t=e.filterInput,i=e.filter,n=e.duration;ve(t,"filterInput");var r=[],a=i.scalarObject(!!n);Zo(a);var o=this.ffmpegFilter,s={inputs:[t],ffmpegFilter:o,options:rs(ns(a)),outputs:[fa(o)]};return r.push(s),r}},{key:"filterDefinitionSvgFilter",value:function(e){Zo(e);var t=e.matrix,i=e.bias,n=e.multiplier,r={filter:"feConvolveMatrix",kernelMatrix:String(t),bias:String(i)};return ce(n)&&(r.divisor=String(n)),[Ao(r)]}}]),i}(fo),Yo=function(e){return H(e)&&"matrix"in e&&"bias"in e&&"multiplier"in e};function Zo(e){if(!Yo(e))throw new Error("expected ConvolutionServerFilter")}var $o=function(e){return{combined:e,r:e,g:e,b:e,a:e}},Qo=function(e){return function(e){return{combined:e,r:e,g:e,b:e,a:e}}(String(e))},es=function(e){var t=e.combined;return function(e){return{combined:e,r:e,g:e,b:e,a:e}}((String(t)||"0 0 0 0 1 0 0 0 0").split(",").map((function(e){return parseInt(e.trim())})))},ts=function(e){var t,i,n=e.combined;return $o(null!==(t=i=String(n))&&void 0!==t&&t.length?parseFloat(i.trim()):0)},is=function(e){var t=e.combined;return $o(function(e){if(null===e||void 0===e||!e.length)return 1;if(e.includes("/")){var t=e.split("/").map((function(e){return parseFloat(e.trim())})),i=p(t,2);return i[0]/i[1]}return parseFloat(e.trim())}(String(t)))},ns=function(e){var t=Qo(e.matrix),i=Qo(e.multiplier),n=es(t);return{multiplier:is(i),matrix:n,bias:t.combined?$o(0):ts(Qo(e.bias))}},rs=function(e){var t={};return Yi.map((function(e){return e})).forEach((function(i,n){var r=e.multiplier[i],a=e.matrix[i];t["".concat(n,"m")]=a.join(" "),t["".concat(n,"rdiv")]=r,t["".concat(n,"bias")]=e.bias[i]})),t},as=function(t){c(n,t);var i=l(n);function n(t){var r;return h(this,n),(r=i.call(this,t)).properties.push(ua({custom:!0,name:"width",type:e.DataType.String})),r.properties.push(ua({custom:!0,name:"height",type:e.DataType.String})),r.properties.push(ua({tweenable:!0,custom:!0,name:"x",type:e.DataType.Number,defaultValue:0,min:0,step:1})),r.properties.push(ua({tweenable:!0,custom:!0,name:"y",type:e.DataType.Number,defaultValue:0,min:0,step:1})),r.populateParametersFromProperties(),r}return f(n,[{key:"commandFilters",value:function(e){var t=e.filter,i=e.filterInput,n=e.duration,r=e.videoRate;ve(i);var a=[],o=t.scalarObject(!!n),s={exact:1},u=Ga(r,n);s.x=La(o.x,o["x".concat(gn)],u,!0),s.y=La(o.y,o["y".concat(gn)],u,!0);var c=o.width,l=o.height;xe(c)&&(s.w=c),xe(l)&&(s.h=l);var h=this.ffmpegFilter,f={inputs:[i],ffmpegFilter:h,options:s,outputs:[fa(h)]};return a.push(f),a}}]),n}(fo),os=function(t){c(n,t);var i=l(n);function n(t){var r;return h(this,n),(r=i.call(this,t)).properties.push(ua({tweenable:!0,custom:!0,name:"x",type:e.DataType.Percent,defaultValue:.5})),r.properties.push(ua({tweenable:!0,custom:!0,name:"y",type:e.DataType.Percent,defaultValue:.5})),r.properties.push(ua({custom:!0,name:"format",type:e.DataType.String,defaultValue:"yuv420"})),r.properties.push(ua({custom:!0,name:"alpha",type:e.DataType.String,defaultValue:"straight"})),r.populateParametersFromProperties(),r}return f(n,[{key:"commandFilters",value:function(e){var t=[],i=e.filter,n=e.filterInput,r=e.chainInput,a=e.duration,o=e.videoRate;ve(n,"filterInput"),ve(r,"chainInput");var s=i.scalarObject(!!a),u={},c=s.format,l=s.alpha;pe(c)&&(u.format=c),pe(l)&&(u.alpha=l);var h=Ga(o,a,"(n-1)"),f=La(s.x,s["x".concat(gn)],h,!0),d=La(s.y,s["y".concat(gn)],h,!0),p=0===d;0===f||(u.x=f),p||(u.y=d);var v={inputs:[r,n],ffmpegFilter:"overlay",options:u,outputs:[]};return t.push(v),t}}]),n}(fo),ss=function(t){c(n,t);var i=l(n);function n(t){var r;return h(this,n),(r=i.call(this,t)).properties.push(ua({name:"width",type:e.DataType.Percent,defaultValue:1,max:2})),r.properties.push(ua({name:"height",type:e.DataType.Percent,defaultValue:1,max:2})),r.properties.push(ua({name:"width".concat(gn),type:e.DataType.Percent,defaultValue:1,max:2})),r.properties.push(ua({name:"height".concat(gn),type:e.DataType.Percent,defaultValue:1,max:2})),r.populateParametersFromProperties(),r}return f(n,[{key:"commandFilters",value:function(e){var t=[],i=e.filter,n=e.duration,r=e.filterInput,a=e.videoRate,o=i.scalarObject(!!n),s=o.width,u=o.height,c=o["width".concat(gn)],l=o["height".concat(gn)];ve(r);var h=this.ffmpegFilter,f=Ga(a,n),d={width:La(s,c,f,!0),height:La(u,l,f,!0)};ne(d.width)&&ne(d.height)||(d.eval="frame");var p={inputs:[r],ffmpegFilter:h,options:d,outputs:[fa(h)]};return t.push(p),t}}]),n}(fo),us=function(t){c(n,t);var i=l(n);function n(t){var r;return h(this,n),r=i.call(this,t),v(u(r),"_ffmpegFilter","geq"),r.properties.push(ua({tweenable:!0,custom:!0,name:"opacity",type:e.DataType.Number,defaultValue:1})),r.populateParametersFromProperties(),r}return f(n,[{key:"commandFilters",value:function(e){var t=[],i=e.filterInput,n=e.filter,r=e.duration,a=e.videoRate,o=n.value("opacity"),s=i;Z(o),ve(s,"filterInput");var u={lum:"lum(X,Y)",cb:"cb(X,Y)",cr:"cr(X,Y)",a:"alpha(X,Y)*".concat(o)};if(r){var c=n.value("opacity".concat(gn));if(ne(c)&&o!=c){var l=Ga(a,r,"N"),h=c-o;u.a="alpha(X,Y)*(".concat(o,"+(").concat(h,"*").concat(l,"))")}}var f=this.ffmpegFilter,d={inputs:[s],ffmpegFilter:f,options:u,outputs:[fa(f)]};return t.push(d),t}},{key:"filterDefinitionSvgFilter",value:function(e){var t=e.opacity;Z(t);var i=globalThis.document.createElementNS(li,"feColorMatrix");return i.setAttribute("type","matrix"),Vo(i,"1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 ".concat(t," 0"),"values"),[i]}}]),n}(fo),cs=function(t){c(n,t);var i=l(n);function n(t){var r;return h(this,n),(r=i.call(this,t)).properties.push(ua({custom:!0,name:"sar",type:e.DataType.String,defaultValue:"0"})),r.properties.push(ua({custom:!0,name:"max",type:e.DataType.Number,defaultValue:100})),r.populateParametersFromProperties(),r}return f(n)}(fo),ls=function(t){c(n,t);var i=l(n);function n(t){var r;return h(this,n),(r=i.call(this,t)).properties.push(ua({custom:!0,name:"fps",type:e.DataType.Number})),r.populateParametersFromProperties(),r}return f(n)}(fo),hs=function(t){c(n,t);var i=l(n);function n(t){var r;return h(this,n),(r=i.call(this,t)).properties.push(ua({custom:!0,name:"expr",type:e.DataType.String,defaultValue:"PTS-STARTPTS"})),r.populateParametersFromProperties(),r}return f(n)}(fo),fs=function(e){c(i,e);var t=l(i);function i(){return h(this,i),t.apply(this,arguments)}return f(i,[{key:"commandFilters",value:function(e){var t=[],i=e.chainInput,n=e.filterInput;ve(i,"chainInput"),ve(n,"filterInput");var r=this.ffmpegFilter,a={inputs:[i,n],ffmpegFilter:r,options:{},outputs:[fa(r)]};return t.push(a),t}}]),i}(fo),ds=function(t){c(n,t);var i=l(n);function n(t){var r;return h(this,n),(r=i.call(this,t)).properties.push(ua({custom:!0,name:"start",type:e.DataType.Number,defaultValue:0})),r.populateParametersFromProperties(),r}return f(n)}(fo),ps=function(t){c(n,t);var i=l(n);function n(t){var r;return h(this,n),r=i.call(this,t),v(u(r),"_ffmpegFilter","drawtext"),r.properties.push(ua({custom:!0,type:e.DataType.String,name:"fontfile"})),r.properties.push(ua({custom:!0,type:e.DataType.String,name:"textfile"})),r.properties.push(ua({custom:!0,type:e.DataType.Boolean,name:"stretch"})),r.properties.push(ua({tweenable:!0,custom:!0,type:e.DataType.Number,name:"height"})),r.properties.push(ua({tweenable:!0,custom:!0,type:e.DataType.Number,name:"width"})),r.properties.push(ua({custom:!0,type:e.DataType.Number,name:"intrinsicHeight"})),r.properties.push(ua({custom:!0,type:e.DataType.Number,name:"intrinsicWidth"})),r.properties.push(ua({tweenable:!0,custom:!0,type:e.DataType.Number,name:"x"})),r.properties.push(ua({tweenable:!0,custom:!0,type:e.DataType.Number,name:"y"})),r.properties.push(ua({tweenable:!0,custom:!0,type:e.DataType.String,name:"color"})),r.populateParametersFromProperties(),r}return f(n,[{key:"colorCommandFilter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:en,r=e.width,a=e.height,o="color",s=fa(o),u={color:n,size:"".concat(r,"x").concat(a)};return t&&(u.rate=t),i&&(u.duration=i),{inputs:[],ffmpegFilter:o,options:u,outputs:[s]}}},{key:"commandFilters",value:function(e){var t=[],i=e.filter,n=e.duration,r=e.videoRate,a=e.filterInput,o=i.value("color"),s=i.value("x"),u=i.value("y"),c=i.value("textfile"),l=i.value("fontfile"),h=i.value("height"),f=i.value("width"),d=!!i.value("stretch"),p=i.value("intrinsicWidth"),v=i.value("intrinsicHeight");ve(c),ve(l),Z(h),Z(f),Z(p),Z(v),Z(s),Z(u),ve(o,"color");var y=i.value("x".concat(gn)),g=i.value("y".concat(gn)),k=n?i.value("color".concat(gn)):void 0,T=pe(k)&&o!==k,b=this.ffmpegFilter,w=fa(b),F=T||a?Qi:o,S=$i;a||(S=T?tn:en);var I={width:f,height:h},C=m({},I);if(n){var P=i.value("height".concat(gn))||0,x=i.value("width".concat(gn))||0;ce(x)&&(C.width=x),ce(P)&&(C.height=P)}var A=p/v,M=Ua(I,C),D=Math.round(A*M.height);D>M.width&&(M.width=D);var z=d||!dr(I,C),E={},V={fontsize:M.height,fontfile:l,textfile:c,x:Math.ceil(ne(y)?Math.max(s,y):s),y:Math.ceil(ne(g)?Math.max(u,g):u)},R=Ga(r,n);if(T){var O=o.length>7,_=O?ln(o):cn(o),j=O?ln(k):cn(k),N=(O?Yi:Xi).map((function(e){var t=_[e],i=j[e];return t===i?t:"".concat(t,"+(").concat(i-t,"*").concat(R,")")})).map((function(e){return["eif",e,"x",2].join(":")})).map((function(e){return"%{".concat(e,"}")}));V.fontcolor_expr="#".concat(N.join(""))}else V.fontcolor=F;var q=this.colorCommandFilter(M,r,n,S);t.push(q);var B=di(q.outputs);z&&(E.width=d?La(f,C.width,R,!0):-1,E.height=La(h,C.height,R,!0),ne(E.width)&&ne(E.height)||(E.eval="frame"));var U={inputs:[B],ffmpegFilter:b,options:V,outputs:[w]};if(t.push(U),B=w,!a){var L="format",G=fa(L),H={inputs:[B],ffmpegFilter:L,options:{pix_fmts:"yuva420p"},outputs:[G]};t.push(H),B=G}if(z){var W="scale",J=fa(W),K={inputs:[B],ffmpegFilter:W,options:E,outputs:[J]};t.push(K),B=J}return t}}]),n}(Ho),vs="".concat(hi,"filter."),ms=function(e){var t=e.includes(".")?e:"".concat(vs).concat(e),i=so[t];if(i)return i;throw new Error("NEW FILTER ".concat(e," ").concat(t))},ys=function(e){var t=e.id;return t?ms(t).instanceFromObject(e):G(V.FilterId)},gs=function(e){return ms(e).instanceFromObject({id:e})};function ks(t){return function(t){c(n,t);var i=l(n);function n(){var t;h(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=i.call.apply(i,[this].concat(a)),v(u(t),"_alphamergeFilter",void 0),v(u(t),"_clip",void 0),v(u(t),"_colorFilter",void 0),v(u(t),"container",!1),v(u(t),"_cropFilter",void 0),v(u(t),"hasIntrinsicSizing",!1),v(u(t),"hasIntrinsicTiming",!1),v(u(t),"_overlayFilter",void 0),v(u(t),"_scaleFilter",void 0),v(u(t),"selectType",e.SelectType.None),a[0].container&&(t.container=!0),t}return f(n,[{key:"alphamergeCommandFilters",value:function(e){var t=[],i=e.videoRate,n=e.outputSize,r=e.track,a=e.filterInput;ve(a),le(i),fr(n);var o={videoRate:0,duration:0,filterInput:a,chainInput:"content-".concat(r)},s=this.alphamergeFilter;return t.push.apply(t,d(s.commandFilters(o))),t}},{key:"alphamergeFilter",get:function(){return this._alphamergeFilter||(this._alphamergeFilter=gs("alphamerge"))}},{key:"amixCommandFilters",value:function(e){var t=e.chainInput,i=e.filterInput;ve(t),ve(i);var n=[],r={inputs:[t,i],ffmpegFilter:"amix",options:{normalize:0},outputs:[]};return n.push(r),n}},{key:"canColor",value:function(e){return!1}},{key:"canColorTween",value:function(e){return!1}},{key:"clip",get:function(){return this._clip},set:function(e){this._clip=e}},{key:"clipped",get:function(){return!!this._clip}},{key:"colorBackCommandFilters",value:function(e,t){var i=e.contentColors,n=void 0===i?[]:i,r=e.videoRate,a=e.outputSize,o=e.duration;fr(a);var s=mr(a),u=p(n,2),c=u[0],l=void 0===c?nn:c,h=u[1],f=void 0===h?nn:h,d=t||fa("back"),v=this.colorFilter,m={videoRate:r,duration:o};v.setValue(l,"color"),v.setValue(f,"color".concat(gn)),v.setValue(s.width,"width"),v.setValue(s.height,"height"),v.setValue(s.width,"width".concat(gn)),v.setValue(s.height,"height".concat(gn));var y=v.commandFilters(m);if(dr(s,a))di(y).outputs=[d];else{var g=di(di(y).outputs);ve(g,"crop input");var k={inputs:[g],ffmpegFilter:"crop",options:{w:a.width,h:a.height,exact:1},outputs:[d]};y.push(k)}return y}},{key:"colorFilter",get:function(){return this._colorFilter||(this._colorFilter=gs("color"))}},{key:"commandFilters",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[],r=e.filterInput,a=void 0===r?"":r,o=this.initialCommandFilters(e,t,i);return o.length&&(n.push.apply(n,d(o)),a=di(di(o).outputs)),i?n.push.apply(n,d(this.containerCommandFilters(m(m({},e),{},{filterInput:a}),t))):n.push.apply(n,d(this.contentCommandFilters(m(m({},e),{},{filterInput:a}),t))),n}},{key:"containerColorCommandFilters",value:function(e){var t=[],i=e.contentColors,n=void 0===i?[]:i,r=e.containerRects,a=e.videoRate,o=e.duration;fe(r,"containerRects");var s=p(r,2),u=s[0],c=s[1],l={videoRate:a,duration:o},h=this.colorFilter,f=p(n,2),v=f[0],m=f[1];return h.setValue(v||Qi,"color"),h.setValue(m,"color".concat(gn)),h.setValue(u.width,"width"),h.setValue(u.height,"height"),h.setValue(c.width,"width".concat(gn)),h.setValue(c.height,"height".concat(gn)),t.push.apply(t,d(h.commandFilters(l))),t}},{key:"containerCommandFilters",value:function(e,t){return[]}},{key:"containerFinalCommandFilters",value:function(e){return[]}},{key:"contentCommandFilters",value:function(e,t){return[]}},{key:"copyCommandFilter",value:function(e,t){return{inputs:[e],ffmpegFilter:"copy",options:{},outputs:["".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"content","-").concat(t)]}}},{key:"cropFilter",get:function(){return this._cropFilter||(this._cropFilter=gs("crop"))}},{key:"definitionTime",value:function(e,t){var i=t.fps,n=t.startTime,r=t.endTime,a=e.scaleToFps(i),o=Math.max(Math.min(a.frame,r.frame),n.frame);return a.withFrame(o-n.frame)}},{key:"frames",value:function(e){return Nr(Xr.duration,e).frame}},{key:"fileCommandFiles",value:function(e){var t=this,i=[],n=this.graphFiles(e),r=0;return i.push.apply(i,d(n.map((function(e,i){var n=e.input,a=i&&n?"".concat(t.id,"-").concat(r):t.id,o=m(m({},e),{},{inputId:a});return n&&r++,o})))),i}},{key:"graphFiles",value:function(e){return this.definition.graphFiles(e)}},{key:"initialCommandFilters",value:function(e,t){return G(V.Unimplemented)}},{key:"intrinsicRect",value:function(){return G(V.Unimplemented)}},{key:"intrinsicsKnown",value:function(e){return!0}},{key:"intrinsicGraphFile",value:function(e){var t=e.editing,i=e.size,n=e.duration,r=Or(),a={editing:t,time:r.startTime,clipTime:r,quantize:r.fps,visible:i,audible:n},o=this.graphFiles(a),s=p(o,1)[0];return W(s,"graphFile"),s}},{key:"isDefault",get:function(){return!1}},{key:"loadPromise",value:function(e){return this.definition.loadPromise(e)}},{key:"mutable",value:function(){return!1}},{key:"overlayCommandFilters",value:function(e,t,i){ve(e,"bottomInput"),ve(t,"topInput");var n=[],r={filterInput:t,chainInput:e,videoRate:0,duration:0},a=this.overlayFilter;return i&&a.setValue("yuv420p10","format"),a.setValue(0,"x"),a.setValue(0,"y"),n.push.apply(n,d(a.commandFilters(r))),di(n).outputs=[fa(t)],n}},{key:"overlayFilter",get:function(){return this._overlayFilter||(this._overlayFilter=gs("overlay"))}},{key:"preloadUrls",value:function(e){return[]}},{key:"scaleCommandFilters",value:function(e){var t=e.time,i=e.containerRects,n=e.filterInput,r=e.videoRate,a=n;ve(a,"filterInput"),fe(i,"containerRects");var o=p(i,2),s=o[0],u=o[1];Ea(s),Ea(u);var c=Ie(t)?t.lengthSeconds:0,l=[],h=this.scaleFilter,f={duration:c,videoRate:r,filterInput:a};return h.setValue(s.width,"width"),h.setValue(s.height,"height"),h.setValue(u.width,"width".concat(gn)),h.setValue(u.height,"height".concat(gn)),l.push.apply(l,d(h.commandFilters(f))),l}},{key:"scaleFilter",get:function(){return this._scaleFilter||(this._scaleFilter=gs("scale"))}},{key:"selectables",value:function(){return[this].concat(d(this.clip.selectables()))}},{key:"selectedItems",value:function(t){var i=this,n=[],r=this.container,a=this.clip,o=this.selectType,s=this.definition.id,u=a.timing,c=a.sizing,l=a.track.mash.editor.media,h=r?e.DataType.ContainerId:e.DataType.ContentId,f=a.properties.find((function(e){return e.type===h}));sa(f);var p=f.name,y=v({timing:u,sizing:c},p,s),g=m({},y),k=r?e.Timing.Container:e.Timing.Content,T=r?e.Sizing.Container:e.Sizing.Content,b=u===k,w=c===T;n.push({selectType:o,property:f,value:s,changeHandler:function(i,n){ve(n);var o=m(m({},g),{},v({},p,n));if(b||w){var s=l.fromId(n).type;b&&!ct(s)&&(o.timing=e.Timing.Custom),w&&!st(s)&&(o.sizing=r?e.Sizing.Content:e.Sizing.Container)}var u={type:e.ActionType.ChangeMultiple,property:i,target:a,redoValues:o,undoValues:y};t.create(u)}});var F=this.properties.filter((function(e){return i.selectedProperty(e)}));return F.forEach((function(e){n.push.apply(n,d(i.selectedProperties(t,e)))})),n}},{key:"selectedProperties",value:function(t,i){var n=this,r=[],a=i.name,o=i.tweenable,s=i.type,u=this.selectType,c=this.value(a),l=s===e.DataType.Frame?e.ActionType.ChangeFrame:e.ActionType.Change,h={selectType:u,property:i,value:c,changeHandler:function(e,i){ve(e),t.create({type:l,property:e,target:n,redoValue:i,undoValue:c})}};if(r.push(h),o){var f=[a,gn].join(""),d=this.value(f),p={selectType:u,property:i,value:d,name:f,changeHandler:function(e,i){t.create({property:e,target:n,redoValue:i,undoValue:d})}};r.push(p)}return r}},{key:"selectedProperty",value:function(e){switch(e.name){case"muted":return this.mutable();case"opacity":return this.container}return!0}},{key:"tween",value:function(e,t,i){var n=this.value(e),r=this.value("".concat(e).concat(gn));if(X(r))return n;var a=i.frame,o=i.frames,s=t.frame-a;return ne(n)?(Z(r),Na(n,r,s,o)):(ve(n),ve(r),qa(n,r,s,o))}},{key:"tweenPoints",value:function(e,t){var i=this.tweenValues("x",e,t),n=p(i,2),r=n[0],a=n[1],o=this.tweenValues("y",e,t),s=p(o,2),u=s[0],c=s[1];Z(r),Z(u);var l={x:r,y:u};return[l,Ja(l,{x:a,y:c})]}},{key:"tweenRects",value:function(e,t){var i=this.tweenSizes(e,t),n=p(i,2),r=n[0],a=n[1],o=this.tweenPoints(e,t),s=p(o,2),u=s[0],c=s[1];return[m(m({},u),r),m(m({},c),a)]}},{key:"tweenSizes",value:function(e,t){var i=this.tweenValues("width",e,t),n=p(i,2),r=n[0],a=n[1],o=this.tweenValues("height",e,t),s=p(o,2),u=s[0],c=s[1];Z(r),Z(u);var l={width:r,height:u};return[l,Ka(l,{width:a,height:c})]}},{key:"tweenValues",value:function(e,t,i){var n=[],r=Ie(t);return n.push(this.tween(e,r?t.startTime:t,i)),r&&n.push(this.tween(e,t.endTime,i)),n}},{key:"visibleCommandFiles",value:function(e){var t=m(m({},e),{},{audible:!1,visible:!0});return this.fileCommandFiles(t)}}]),n}(t)}!function(){var e={alphamerge:fs,chromakey:Go,colorchannelmixer:Ko,color:Wo,colorize:Ho,convolution:Xo,crop:as,fps:ls,opacity:us,overlay:os,scale:ss,setpts:hs,setsar:cs,trim:ds,text:ps};Object.entries(e).forEach((function(e){var t=p(e,2),i=t[0],n=t[1],r="".concat(vs).concat(i);so[r]=new n({id:r})}))}();var Ts=function(e){return Sn(e)&&e.type===qe};function bs(e){if(!Ts(e))throw new Error("expected VideoMedia")}var ws=function(e){return wn(e)&&e.definition.type===qe},Fs="decode",Ss="encode",Is="transcode",Cs="protocol",Ps="language",xs="filter",As="resolve",Ms=(v(E={},Fs,{}),v(E,Ss,{}),v(E,xs,{}),v(E,Ps,{}),v(E,Cs,{}),v(E,As,{}),v(E,Is,{}),E),Ds=function(e){return H(e)&&"type"in e&&pe(e.type)};function zs(e,t){Ds(e)||G(e,"Plugin",t)}var Es=function(e){return e.replace(/[^a-z]/g,"")},Vs=function(e,t){var i=Ms[e],n=Es(t),r=i[n];return zs(r,n),r},Rs=function(e,t){var n=Ms[e],r=Es(t);return n[r]?Promise.resolve(n[r]):i(741)("./".concat(e,"-").concat(r)).then((function(){return Vs(e,t)}))},Os=function(e){return Rs(Cs,e).then((function(e){return e}))},_s=function(e){var t=e.endpoint;Ai(t),Ei(t)||(e.endpoint=Ti(t))},js=function(e){var t=e.endpoint;Ai(t);var i=t.pathname;return((void 0===i?"":i).split(".").pop()||"").trim()},Ns=function(e){var t=e.endpoint;Ai(t);var i=t.protocol;return ve(i),i},qs=function(e){var t=e.response;return _n(t)?Promise.resolve({data:t}):(_s(e),Ls(e).then((function(t){return t.promise(e,Ve).then((function(t){return Gs(e,t),t}))})))},Bs=function(e){var t=e.response;return qn(t)?Promise.resolve({data:t}):(_s(e),Ls(e).then((function(t){return t.promise(e,Oe).then((function(t){return Gs(e,t),t}))})))},Us=function(e){var t=e.response;return Rn(t)?Promise.resolve({data:t}):(_s(e),Ls(e).then((function(t){return t.promise(e,_e).then((function(t){return Gs(e,t),t}))})))},Ls=function(e){return Os(Ns(e))},Gs=function(e,t){Ee(t)||(e.response=t.data)},Hs=function(e){var t=e.response;return En(t)?Promise.resolve({data:t}):(_s(e),Ls(e).then((function(t){return t.promise(e,qe).then((function(t){return Gs(e,t),t}))})))},Ws=function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){var t=e.response;if(De(t))return Promise.resolve({data:t})}return _s(e),Ls(e).then((function(t){return t.promise(e,Ue).then((function(t){return Gs(e,t),t}))}))},Js=function(e,t){switch(t){case Ve:return qs(e);case _e:return Us(e);case qe:return Hs(e)}},Ks=function(e,t){return _s(e),Ls(e).then((function(i){return i.promise(e,t)}))};function Xs(t){return function(t){c(n,t);var i=l(n);function n(){var t;h(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];t=i.call.apply(i,[this].concat(a)),v(u(t),"_colorizeFilter",void 0),v(u(t),"colorMaximize",!1),v(u(t),"_div",void 0),v(u(t),"_opacityFilter",void 0),v(u(t),"_svgElement",void 0);var s=a[0];return u(t).container&&(t.addProperties(s,ua({name:"x",type:e.DataType.Percent,defaultValue:.5,group:e.DataGroup.Point,tweenable:!0})),t.addProperties(s,ua({name:"y",type:e.DataType.Percent,defaultValue:.5,group:e.DataGroup.Point,tweenable:!0})),Ot.forEach((function(i){t.addProperties(s,ua({name:"off".concat(i),type:e.DataType.Boolean,group:e.DataGroup.Point}))})),t.addProperties(s,ua({tweenable:!0,name:"opacity",type:e.DataType.Percent,defaultValue:1,group:e.DataGroup.Opacity}))),t}return f(n,[{key:"colorizeFilter",get:function(){return this._colorizeFilter||(this._colorizeFilter=gs("colorize"))}},{key:"colorizeCommandFilters",value:function(e){var t=e.contentColors,i=e.videoRate,n=e.filterInput,r=e.time;ye(t);var a=Ie(r)?r.lengthSeconds:0,o=this.colorizeFilter,s={videoRate:i,duration:a,filterInput:n},u=p(t,2),c=u[0],l=u[1];return o.setValue(c,"color"),o.setValue(l,"color".concat(gn)),o.commandFilters(s)}},{key:"stylesSrcPromise",value:function(e,t){var i=this.type,n=this.definition,r=[];if(i===_e?r.push(i):r.push(Ne,qe),n.preferredTranscoding.apply(n,r).type===Ne)return bs(n),n.loadedImagePromise(t,Cr(e)).then((function(e){return e.src}));var a=n.preferredTranscoding(_e).request;return Us(a).then((function(e){if(Ee(e))return G(e.error);var t=e.data;return On(t),t.src}))}},{key:"stylesPromise",value:function(e,t){return this.stylesSrcPromise(e,t).then((function(t){var i=[];return i.push("mask-image: url(".concat(t,")")),i.push("mask-repeat: no-repeat"),i.push("mask-mode: luminance"),i.push("mask-size: ".concat(e.width,"px ").concat(e.height,"px")),i.push("mask-position: ".concat(e.x,"px ").concat(e.y,"px")),i}))}},{key:"containedVideo",value:function(e,t,i,n,r){var a=this,o=Math.round(Number(e.getAttribute("x"))),s=Math.round(Number(e.getAttribute("y"))),u=Aa(t);u.x-=o,u.y-=s;var c=m(m({},u),Cr(t)),l=!this.definition.isVector;return(l?this.stylesPromise(c,this.definitionTime(n,r)):Promise.resolve([])).then((function(t){var n=[],r=a.div;if(t.push("left: ".concat(o,"px")),t.push("top: ".concat(s,"px")),!l){var u=a.pathElement(c);u.setAttribute("fill",Qi);var h=ha(),f=globalThis.document.createElementNS(li,"clipPath");Vo(f,h),Mo(f,u);var d=So(i);qo(d,[Do([f])]),t.push("clip-path:".concat(go(h))),n.push(d)}return r.setAttribute("style",t.join(";")+";"),qo(r,[e]),n.push(r),n}))}},{key:"previewItemsPromise",value:function(t,i,n,r,a,o){var s=this,u=t.contentPreviewItemPromise(i,r,a,o).then((function(u){if(W(u,"contentItem"),En(u))return be(o===e.Component.Player,"video in player"),s.containedVideo(u,i,n,r,a);var c=s.containerSvgItemPromise(i,r,a,o),l=!s.definition.isVector;return c.then((function(c){var h=[],f=!t.definition.isVector;h.push(c);var d=ha();if(l&&o===e.Component.Player){var p=wo(i,"","transparent",d);p.setAttribute("vector-effect","non-scaling-stroke;"),h.push(p),d=ha()}c.setAttribute("id",d);var v=ko();Mo(v,[wo(i,"","transparent"),u]);var m=[v];Ro(v,"contained");var y=xo(void 0,v,!0);h.push(y);var g=Oo(d);y.appendChild(wo(n,"","black")),y.appendChild(g),l||(c.setAttribute("vector-effect","non-scaling-stroke;"),g.setAttribute("fill",Qi));var k=s.containerSvgFilter(c,n,i,r,a);k?h.push(k):c.removeAttribute("filter");var T=t.contentSvgFilter(u,n,i,r,a);T?h.push(T):u.removeAttribute("filter");var b=(f||l)&&o===e.Component.Player?s.svgElement:So();return qo(b,[Do(h)].concat(m)),To(b,n),[b]}))}));return u}},{key:"containerColorCommandFilters",value:function(e){var t=[],i=e.contentColors,r=e.containerRects,s=e.track;if(!this.colorMaximize)return a(o(n.prototype),"containerColorCommandFilters",this).call(this,e);ye(i);var u=Va.apply(void 0,d(r))?r[0]:Ua.apply(void 0,d(r)),c=m(m({},e),{},{outputSize:u});return t.push.apply(t,d(this.colorBackCommandFilters(c,"content-".concat(s)))),t}},{key:"containerCommandFilters",value:function(e,t){var i=[],n=e.contentColors,r=e.filterInput;return ve(r,"filterInput"),null!==n&&void 0!==n&&n.length||(i.push.apply(i,d(this.alphamergeCommandFilters(m(m({},e),{},{filterInput:r})))),r=di(di(i).outputs)),i.push.apply(i,d(this.containerFinalCommandFilters(m(m({},e),{},{filterInput:r})))),i}},{key:"containerFinalCommandFilters",value:function(e){var t=[],i=e.filterInput;ve(i,"filterInput");var n=this.opacityCommandFilters(e);return n.length&&(t.push.apply(t,d(n)),i=di(di(n).outputs)),t.push.apply(t,d(this.translateCommandFilters(m(m({},e),{},{filterInput:i})))),t}},{key:"containerRects",value:function(e,t){var i=e.size,n=e.time,r=e.timeRange,a=this.lock,o=this.tweenRects(n,r),s=Qa(o,a),u=t.width,c=t.height,l=(u||i.width)/(c||i.height),h=p(s,2),f=h[0],d=h[1],v=eo(f,i,l,a),m=this.directionObject,y=Xa(i,v,m);if(Va(f,d))return[y,y];var g=eo(d,i,l,a),k=Wa(v,g);return[y,Xa(i,k,m)]}},{key:"containerSvgItemPromise",value:function(e,t,i,n){return Promise.resolve(this.pathElement(e))}},{key:"containerSvgFilter",value:function(e,t,i,n,r){var a=this.tweenValues("opacity",n,r),o=p(a,1)[0];if(ue(o)){var s=this.opacityFilter;return s.setValue(o,"opacity"),Eo(s.filterSvgFilter(),e)}}},{key:"directions",get:function(){return qt}},{key:"directionObject",get:function(){var e=this;return Object.fromEntries(Ot.map((function(t){return[t,!!e.value("off".concat(t))]})))}},{key:"div",get:function(){return this._div||(this._div=globalThis.document.createElement("div"))}},{key:"isDefault",get:function(){return this.mediaId===va}},{key:"opacityCommandFilters",value:function(e){var t=e.outputSize,i=e.filterInput,n=e.clipTime,r=e.time,a=e.videoRate;Ce(n);var o=[],s={dimensions:t,filterInput:i,videoRate:a,duration:Ie(r)?r.lengthSeconds:0},u=this.tweenValues("opacity",r,n),c=p(u,2),l=c[0],h=c[1];if(ue(l)||te(h)&&ue(h)){var f=this.opacityFilter;f.setValues({opacity:l,opacityEnd:h}),o.push.apply(o,d(f.commandFilters(s)))}return o}},{key:"opacityFilter",get:function(){return this._opacityFilter||(this._opacityFilter=gs("opacity"))}},{key:"pathElement",value:function(e){return wo(e,"",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none")}},{key:"svgElement",get:function(){return this._svgElement||(this._svgElement=So())}},{key:"translateCommandFilters",value:function(e){var t=[],i=e.outputSize,n=e.time,r=e.containerRects,a=e.chainInput,o=e.filterInput,s=e.videoRate;if(!a)return t;ye(r);var u=p(r,2),c=u[0],l=u[1],h=Ie(n)?n.lengthSeconds:0,f=this.overlayFilter;f.setValue(c.x,"x"),f.setValue(c.y,"y"),h&&(f.setValue(l.x,"x".concat(gn)),f.setValue(l.y,"y".concat(gn)));var v={dimensions:i,filterInput:o,videoRate:s,duration:h,chainInput:a};return t.push.apply(t,d(f.commandFilters(v))),t}}]),n}(t)}var Ys=function(t){c(n,t);var i=l(n);function n(){var t;h(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=i.call.apply(i,[this].concat(a)),v(u(t),"selectType",e.SelectType.None),t}return f(n,[{key:"commandFiles",value:function(e){var t=this,i=[],n=e.videoRate,r=e.time,a=Ie(r)?r.lengthSeconds:0,o=this.definition.filters,s=m(m({},e),{},{videoRate:n,duration:a});return i.push.apply(i,d(o.flatMap((function(e){return t.setFilterValues(e),e.commandFiles(s)})))),i}},{key:"commandFilters",value:function(e){var t=this,i=[],n=e.videoRate,r=e.filterInput,a=e.time;ve(r);var o=Ie(a)?a.lengthSeconds:0,s=this.definition.filters,u={videoRate:n,duration:o,filterInput:r};return i.push.apply(i,d(s.flatMap((function(e){t.setFilterValues(e);var i=e.commandFilters(u);return i.length&&(u.filterInput=di(di(i).outputs)),i})))),i}},{key:"selectables",value:function(){return[this]}},{key:"selectedItems",value:function(t){var i=this;return this.properties.map((function(n){var r=i.value(n.name);return{value:r,selectType:e.SelectType.None,property:n,changeHandler:function(e,n){ve(e);var a={target:i,property:e,redoValue:n,undoValue:r};t.create(a)}}}))}},{key:"setFilterValues",value:function(e){var t=this,i=e.properties.map((function(e){return e.name}));this.properties.map((function(e){return e.name})).filter((function(e){return i.includes(e)})).forEach((function(i){var n=t.properties.find((function(e){return e.name===i}));sa(n);var r=n.tweenable;if(e.setValue(t.value(i),i),r){var a="".concat(i).concat(gn);e.setValue(t.value(a),a)}}))}},{key:"svgFilters",value:function(e,t,i,n){var r=this,a=[],o=this.definition.filters;return a.push.apply(a,d(o.flatMap((function(e){return r.setFilterValues(e),e.filterSvgFilter()})))),a}}]),n}(Xs(ks(ao)));function Zs(t){return function(t){c(n,t);var i=l(n);function n(){var t;h(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(t=i.call.apply(i,[this].concat(a))).properties.push(ua({name:"muted",type:e.DataType.Boolean})),t}return f(n,[{key:"graphFiles",value:function(e){return[]}},{key:"loadPromise",value:function(e){return Promise.resolve()}}]),n}(t)}var $s=function(e){c(i,e);var t=l(i);function i(e){var n;h(this,i),n=t.call(this,e),v(u(n),"kind",""),v(u(n),"purpose","");var r=e.purpose;return r&&(n.purpose=r),Xe(n.type),n}return f(i,[{key:"toJSON",value:function(){var e=this.type,t=this.kind;return m(m({},a(o(i.prototype),"toJSON",this).call(this)),{},{type:e,kind:t})}},{key:"unload",value:function(){delete this.request.response}}]),i}(Tn),Qs=function(e){return new $s(e)},eu=f((function e(t){h(this,e),v(this,"data",void 0),v(this,"type",void 0);var i=t.data,n=t.type;this.type=n,this.data=i})),tu=function(e){return new eu(e)},iu=function(t){c(n,t);var i=l(n);function n(t){var r,a,o;h(this,n),o=i.call(this,t),v(u(o),"file",void 0),v(u(o),"isVector",!1),v(u(o),"transcodings",[]),v(u(o),"properties",[]),v(u(o),"decodings",[]),v(u(o),"serverPath","");var s=t.decodings,c=t.transcodings,l=t.file;l&&(o.file=l),s&&(r=o.decodings).push.apply(r,d(s.map(tu))),c&&(a=o.transcodings).push.apply(a,d(c.map(Qs)));var f=u(o).type;return We(f),o.properties.push(ua({name:"label",type:e.DataType.String,defaultValue:Xr[f].label})),o}return f(n,[{key:"unload",value:function(){throw new Error("Method not implemented.")}},{key:"definitionIcon",value:function(e){}},{key:"findTranscoding",value:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return this.transcodings.find((function(t){return t.type===e&&(!i.length||i.includes(t.kind))}))}},{key:"instanceFromObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new ao(this.instanceArgs(e))}},{key:"instanceArgs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return m(m(m({},Object.fromEntries(this.properties.map((function(e){return[e.name,e.defaultValue]})))),e),{},{definition:this})}},{key:"loadPromise",value:function(e){return G(V.Unimplemented)}},{key:"preferredTranscoding",value:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];for(var r=function(){var t=o[a],i=e.transcodings.find((function(e){return e.type===t}));if(i)return{v:i}},a=0,o=i;a<o.length;a++){var s=r();if("object"===typeof s)return s.v}return this}},{key:"serverPromise",value:function(e){var t=this;if(this.serverPath)return Promise.resolve();var i=this.request;return Ks(i).then((function(e){if(!Ee(e)){var i=e.path;t.serverPath=i}}))}},{key:"toJSON",value:function(){var e=this.label,t=this.decodings,i=this.transcodings;return m(m({},a(o(n.prototype),"toJSON",this).call(this)),{},{label:e,decodings:t,transcodings:i})}}]),n}(Tn);function nu(t){return function(t){c(n,t);var i=l(n);function n(){var t;h(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=i.call.apply(i,[this].concat(a)),v(u(t),"type",_e),t.properties.push(ua({name:"lock",type:e.DataType.String,defaultValue:e.Orientation.H,group:e.DataGroup.Size})),t}return f(n,[{key:"loadPromise",value:function(e){return Promise.resolve()}}]),n}(t)}var ru=function(e){c(i,e);var t=l(i);function i(e){var n,r,a;h(this,i),a=t.call(this,e),v(u(a),"filters",[]),v(u(a),"finalizeFilter",void 0),v(u(a),"initializeFilter",void 0),v(u(a),"type",Re),a.properties.push(ua({name:"label",defaultValue:""}));var o=e.properties,s=e.filters,c=e.initializeFilter,l=e.finalizeFilter;return null!==o&&void 0!==o&&o.length&&(n=a.properties).push.apply(n,d(o.map((function(e){return ua(m(m({},e),{},{custom:!0}))})))),c&&(a.initializeFilter=ys(c)),l&&(a.finalizeFilter=ys(l)),s&&(r=a.filters).push.apply(r,d(s.map((function(e){return ys(e)})))),a}return f(i,[{key:"instanceArgs",value:function(e){var t=a(o(i.prototype),"instanceArgs",this).call(this,e);return t.label||(t.label=this.label),t}},{key:"instanceFromObject",value:function(e){return new Ys(this.instanceArgs(e))}},{key:"toJSON",value:function(){var e=a(o(i.prototype),"toJSON",this).call(this),t=this.properties.filter((function(e){return e.custom}));return t.length&&(e.properties=t),this.filters.length&&(e.filters=this.filters),e}}]),i}(nu(Zs(iu))),au={label:"Blur",type:"effect",id:"com.moviemasher.effect.blur",request:{response:{filters:[{id:"com.moviemasher.filter.convolution",parameters:[{name:"matrix",value:"1,1,1,1,1,1,1,1,1"},{name:"multiplier",value:"0.11"}]}]}}},ou=function(e){return ve(e.id),new ru(m(m({},e),{},{type:Re}))},su=function(e){return An[Re].find((function(t){return t.id===e}))||ou({id:e})},uu=function(e){var t=e.mediaId;return su(void 0===t?"":t).instanceFromObject(e)};Pn[Re]=ou,An[Re].push(ou(au));var cu=function(e){return ba(e)&&lu(e.definition)},lu=function(e){return Sn(e)&&e.type===Ve};function hu(t){return function(t){c(n,t);var i=l(n);function n(){var t,r;h(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];r=i.call.apply(i,[this].concat(o)),v(u(r),"effects",[]);var c=o[0],l=u(r),f=l.isDefaultOrAudio,p=l.container;f||p||(r.addProperties(c,ua({name:"x",type:e.DataType.Percent,defaultValue:.5,group:e.DataGroup.Point,tweenable:!0})),r.addProperties(c,ua({name:"y",type:e.DataType.Percent,defaultValue:.5,group:e.DataGroup.Point,tweenable:!0})),r.addProperties(c,ua({name:"lock",type:e.DataType.String,defaultValue:e.Orientation.H,group:e.DataGroup.Size})));var m=c.effects;return m&&(t=r.effects).push.apply(t,d(m.map(uu))),r}return f(n,[{key:"audibleCommandFiles",value:function(e){var t=m(m({},e),{},{audible:!0,visible:!1});return this.fileCommandFiles(t)}},{key:"audibleCommandFilters",value:function(e){var t=[],i=e.time,n=e.quantize,r=e.commandFiles,a=e.clipTime,o=i.isRange?i.lengthSeconds:0,s=o?Math.min(o,a.lengthSeconds):0,u=this.id,c=ro(r,u,!1),l="atrim",h=fa(l),f={},p=this.definitionTime(i,a).frame;s&&(f.duration=s),p&&(f.start=Nr(p,n).seconds);var v={inputs:[c],ffmpegFilter:l,options:f,outputs:[h]};t.push(v),c=h;var y=1e3*(a.seconds-i.seconds);if(y){var g="adelay",k=fa(g),T={ffmpegFilter:g,options:{delays:y,all:1},inputs:[c],outputs:[k]};t.push(T),c=k}return t.push.apply(t,d(this.amixCommandFilters(m(m({},e),{},{filterInput:c})))),t}},{key:"contentCommandFilters",value:function(e,t){return this.effectsCommandFilters(e)}},{key:"contentPreviewItemPromise",value:function(e,t,i,n){return this.contentSvgItemPromise(e,t,i,n)}},{key:"contentRects",value:function(e){var t=e.containerRects,i=e.time,n=e.timeRange,r=e.loading,a=e.editing,o=he(t)?t:[t,t];if(r&&!this.intrinsicsKnown({editing:a,size:!0}))return o;var s=this.intrinsicRect(a);if(!br(s))return o;var u=this.lock,c=this.tweenRects(i,n),l=Qa(c,u),h=Ya(s,t,l),f=p(h,2),d=f[0],v=f[1],m=Za(h,t,l),y=p(m,2),g=y[0],k=y[1];return[Oa(d,g),Oa(v,k)]}},{key:"contentSvgFilter",value:function(e,t,i,n,r){var a=this.effects;if(!this.isDefaultOrAudio&&a.length){var o=this.effects.flatMap((function(e){return e.svgFilters(t,i,n,r)})),s=Eo(o,e);return Vo(s,"200%","width"),Vo(s,"200%","height"),s}}},{key:"definitionIds",value:function(){return[].concat(d(a(o(n.prototype),"definitionIds",this).call(this)),d(this.effects.flatMap((function(e){return e.definitionIds()}))))}},{key:"effectsCommandFiles",value:function(e){var t=[];return this.container||t.push.apply(t,d(this.effects.flatMap((function(t){return t.commandFiles(e)})))),t}},{key:"effectsCommandFilters",value:function(e){var t=[],i=e.filterInput;ve(i);var n=this.effects;return this.isDefaultOrAudio||t.push.apply(t,d(n.flatMap((function(t){var n=t.commandFilters(m(m({},e),{},{filterInput:i}));return n.length&&(i=di(di(n).outputs)),n})))),t}},{key:"intrinsicRect",value:function(){return Ra}},{key:"isDefault",get:function(){return this.mediaId===Ta}},{key:"isDefaultOrAudio",get:function(){return this.isDefault||cu(this)}},{key:"contentSvgItemPromise",value:function(e,t,i,n){return G(V.Unimplemented)}},{key:"selectedItems",value:function(e){var t=a(o(n.prototype),"selectedItems",this).call(this,e);if(this.isDefaultOrAudio||this.container)return t;var i=this.effects,r=this.selectType,s=e.editor,u={name:"effects",selectType:r,value:i,removeHandler:s.removeEffect.bind(s),moveHandler:s.moveEffect.bind(s),addHandler:s.addEffect.bind(s)};return t.push(u),t}},{key:"selectedProperty",value:function(e){switch(e.name){case"effects":case"lock":case"width":case"height":case"x":case"y":return!this.isDefaultOrAudio}return a(o(n.prototype),"selectedProperty",this).call(this,e)}},{key:"toJSON",value:function(){var e=a(o(n.prototype),"toJSON",this).call(this);return e.effects=this.effects,e}},{key:"visibleCommandFiles",value:function(e){var t=a(o(n.prototype),"visibleCommandFiles",this).call(this,e);return t.push.apply(t,d(this.effectsCommandFiles(e))),t}}]),n}(t)}var fu=function(e){return ba(e)&&"color"in e},du=function(t){c(n,t);var i=l(n);function n(){var t;h(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];t=i.call.apply(i,[this].concat(a)),v(u(t),"_colorFilter",void 0);var s=a[0];return t.addProperties(s,ua({tweenable:!0,name:"color",type:e.DataType.Rgb,defaultValue:t.definition.color,group:e.DataGroup.Color})),t}return f(n,[{key:"colorFilter",get:function(){return this._colorFilter||(this._colorFilter=gs("color"))}},{key:"contentColors",value:function(e,t){var i=this.tweenValues("color",e,t),n=p(i,2),r=n[0],a=n[1];return ve(r),[r,pe(a)?a:r]}},{key:"contentPreviewItemPromise",value:function(e,t,i,n){var r=this.colorFilter,a=this.tweenValues("color",t,i),o=p(a,1)[0],s=e.x,u=e.y,c=e.width,l=e.height;r.setValues({width:c,height:l,color:o});var h=r.filterSvgs(),f=p(h,1)[0];return f.setAttribute("x",String(s)),f.setAttribute("y",String(u)),Promise.resolve(f)}}]),n}(hu(ks(ao))),pu=function(e){c(i,e);var t=l(i);function i(){var e;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var o=r[0];e=t.call(this,o),v(u(e),"color",$i);var s=o.color;return pe(s)&&(e.color=s),e}return f(i,[{key:"definitionIcon",value:function(e){var t={width:512,height:512},i=Tr(t,e,!0),n=m(m({},i),_a(e,i)),r=Po("M136.5 77.7l37 67L32 285.7 216.4 464l152.4-148.6 54.4-11.4L166.4 48l-29.9 29.7zm184 208H114.9l102.8-102.3 102.8 102.3zM423.3 304s-56.7 61.5-56.7 92.1c0 30.7 25.4 55.5 56.7 55.5 31.3 0 56.7-24.9 56.7-55.5S423.3 304 423.3 304z");return No(r,t,n),Promise.resolve(So(e,r))}},{key:"instanceFromObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new du(this.instanceArgs(e))}}]),i}(Sa(Zs(iu))),vu=function(e,t){return e&&t?zr(e/t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"round"):0},mu=function(e){e.preventDefault(),e.stopPropagation()},yu=function(){function t(e){h(this,t),v(this,"args",void 0),v(this,"_rect",void 0),v(this,"_timeRange",void 0),this.args=e}return f(t,[{key:"clip",get:function(){return this.args.clip}},{key:"container",get:function(){return this.clip.container}},{key:"editingSvgItem",value:function(e,t){var i=this.container,n=this.rect,r=i.pathElement(n);return r.setAttribute("vector-effect","non-scaling-stroke"),Ro(r,e),t||r.addEventListener("pointerdown",this.pointerDownHandler()),r}},{key:"editor",get:function(){return this.preview.editor}},{key:"icon",get:function(){return!!this.args.icon}},{key:"pointerDownHandler",value:function(){var t=m({},xa),i=this.editor,n=this.container,r=this.timeRange,a=this.rect,o=this.clip,s=i.rect,u=function(){globalThis.window.removeEventListener("pointermove",h),globalThis.window.removeEventListener("pointermove",l),globalThis.window.removeEventListener("pointerup",c),globalThis.window.removeEventListener("pointerup",f)},c=function(e){mu(e),u(),i.dragging=!1,i.redraw()},l=function(o){var u,c;mu(o);var l=n.offE,h=n.offN,f=n.offS,d=n.offW,p=a.x,m=a.y,y=a.width,g=a.height,k=s.width-y,T=s.height-g,b=0,w=0;l&&(b-=y,k+=y),d&&(k+=y),h&&(w-=g,T+=g),f&&(T+=g);var F=o.clientX,S=o.clientY,I=F-s.x,C=S-s.y,P=t.x-s.x,x=C-(t.y-s.y-m),A=io(I-(P-p),b,b+k),M=io(x,w,w+T),D=to(n),z=r.lastTime,E=i.time.equalsTime(z),V=D&&E,R=V?"x".concat(gn):"x",O=V?"y".concat(gn):"y",_=(v(u={},R,n.value(R)),v(u,O,n.value(O)),u),j=(v(c={},R,k?A/k:_[R]),v(c,O,T?M/T:_[O]),c),N={property:e.DataGroup.Point,target:n,type:e.ActionType.ChangeMultiple,redoValues:j,undoValues:_};i.actions.create(N)},h=function e(a){mu(a);var o=a.clientX,s=a.clientY;if(!Pa({x:o,y:s},t)){if(to(n)){var c=i.time,h=c.closest(r);if(!c.equalsTime(h))return u(),void i.goToTime(h)}i.dragging=!0,globalThis.window.removeEventListener("pointermove",e),globalThis.window.addEventListener("pointermove",l),l(a)}},f=function(e){if(mu(e),e instanceof PointerEvent){var n=e.clientX,r=e.clientY;t.x=n,t.y=r,globalThis.window.addEventListener("pointermove",h),globalThis.window.addEventListener("pointerup",c),i.selection.clip!==o&&i.selection.set(o)}};return f}},{key:"preview",get:function(){return this.args.preview}},{key:"quantize",get:function(){return this.preview.quantize}},{key:"rect",get:function(){return this._rect||this.rectInitialize}},{key:"rectInitialize",get:function(){var e=this.time,t=this.timeRange,i=this.clip,n=this.size;wr(n,"".concat(this.constructor.name,".rectInitialize size"));var r={size:n,time:e,timeRange:t,editing:!0},a=i.rects(r);return be(Va.apply(void 0,d(a))),a[0]}},{key:"size",get:function(){return this.preview.size}},{key:"svgBoundsElement",value:function(e,t,i){var n=this,r=[],a=this.rect,o=this.container.directions,s=a.width,u=a.height,c=a.x,l=a.y,h={x:c-1,y:l-1,width:s,height:2};r.push(wo(h,e)),h.y=l+u-1,r.push(wo(h,e)),h.x=c+s-1,h.height=u,h.width=2,h.y=l,r.push(wo(h,e)),h.x=c-1,r.push(wo(h,e));var f={width:s,height:u};return o.forEach((function(e){var a=n.svgHandlePoint(f,e),o={x:c+a.x,y:l+a.y,width:8,height:8},s=wo(o,[].concat(d(t),[e.toLowerCase()]));r.push(s),i||s.addEventListener("pointerdown",(function(e){n.editor.selection.set(n.clip),mu(e)}))})),r}},{key:"svgHandlePoint",value:function(t,i){var n=t.width,r=t.height,a=m({},xa),o=String(i).split(""),s=p(o,2),u=s[0],c=s[1];jt(u,i);var l=c||u;switch(jt(l),l){case e.Direction.W:a.x=-4;break;case e.Direction.E:a.x=n-4;break;default:a.x=Math.round(n/2)-4}switch(u){case e.Direction.N:a.y=-4;break;case e.Direction.S:a.y=r-4;break;default:a.y=Math.round(r/2)-4}return a}},{key:"time",get:function(){return this.preview.time}},{key:"timeRange",get:function(){return this._timeRange||(this._timeRange=this.clip.timeRange(this.quantize))}}]),t}(),gu=function(){function t(e){h(this,t),v(this,"audible",!1),v(this,"clip",void 0),v(this,"_clips",void 0),v(this,"combine",!1),v(this,"editor",void 0),v(this,"mash",void 0),v(this,"size",void 0),v(this,"selectedClip",void 0),v(this,"streaming",!1),v(this,"_svgItems",void 0),v(this,"time",void 0),v(this,"_trackPreviews",void 0),v(this,"visible",!0);var i=e.selectedClip,n=e.editor,r=e.time,a=e.mash,o=e.clip,s=e.size;this.mash=a,this.size=s||a.imageSize,this.time=r,this.selectedClip=i,this.clip=o,H(n)&&(this.editor=n)}return f(t,[{key:"clips",get:function(){return this._clips||(this._clips=this.clipsInitialize)}},{key:"clipsInitialize",get:function(){var t=this.mash,i=this.time,n=this.clip;return n?[n]:t.clipsInTimeOfType(i,e.AVType.Video).sort(na)}},{key:"duration",get:function(){return this.time.lengthSeconds}},{key:"editing",get:function(){return H(this.editor)}},{key:"intrinsicSizePromise",get:function(){var e=this.clips,t=this.time,i=this.quantize,n={editing:!0,size:!0},r=e.filter((function(e){return!e.intrinsicsKnown(n)})),a={quantize:i,editing:!0,visible:!0,time:t,clipTime:_r(t)},o=r.map((function(e){return a.clipTime=e.timeRange(i),e.loadPromise(a)}));return Promise.all(o).then(ci)}},{key:"previewItemsPromise",get:function(){var t=this;return this._svgItems?Promise.resolve(this._svgItems):this.intrinsicSizePromise.then((function(){var i=t.clips,n=t.size,r=t.time,a=t.clip,o=Promise.resolve([]),s=a?e.Component.Timeline:e.Component.Player;return i.forEach((function(e){o=o.then((function(t){return e.previewItemsPromise(n,r,s).then((function(e){return[].concat(d(t),d(e))}))}))})),o})).then((function(e){return t._svgItems=e.length?t.tupleItems(e):[]}))}},{key:"quantize",get:function(){return this.mash.quantize}},{key:"svgItemsPromise",get:function(){return this.previewItemsPromise}},{key:"trackPreviews",get:function(){return this._trackPreviews||(this._trackPreviews=this.trackPreviewsInitialize)}},{key:"trackPreviewsInitialize",get:function(){var e=this,t=[],i=this.time,n=this.quantize,r=this.clips,a=i.isRange?void 0:i.scale(n);return r.forEach((function(r){var o=r.timeRange(n).scale(i.fps),s=Math.max(0,i.frame-o.frame),u=o.withFrame(s),c={clip:r,preview:e,tweenTime:a,timeRange:u,icon:!!e.clip};t.push(new yu(c))})),t}},{key:"tupleItems",value:function(e){var t=this.size,i=this.editing,n=this.selectedClip,r=this.editor,a=d(e);if(a.forEach((function(e){return Ro(e,"track")})),!i||!e.length)return a;W(r,"editor");var o=r.dragging,s=this.trackPreviews,u=s.find((function(e){return e.clip===n})),c=s.map((function(e){var t=["outline"];return o||e===u||t.push("animate"),e.editingSvgItem(t)})),l=So(t,c);if(Ro(l,["outlines"]),a.push(l),!u)return a;var h=["bounds","back"],f=["line"],p=["handle"],v=So(t,u.svgBoundsElement(f,p,!0));Ro(v,h),h[1]="fore";var m=So(t,u.svgBoundsElement(f,p));return Ro(m,h),a.push(v,m),a}}]),t}(),ku=function(t){c(n,t);var i=l(n);function n(){var t;h(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];t=i.call.apply(i,[this].concat(a)),v(u(t),"_containerObject",{}),v(u(t),"_container",void 0),v(u(t),"_contentObject",{}),v(u(t),"_content",void 0),v(u(t),"_id",void 0),v(u(t),"_label",""),v(u(t),"selectType",e.SelectType.Clip),v(u(t),"_track",void 0),t.properties.push(ua({name:"containerId",type:e.DataType.ContainerId,defaultValue:va})),t.properties.push(ua({name:"contentId",type:e.DataType.ContentId,defaultValue:Ta})),t.properties.push(ua({name:"label",type:e.DataType.String})),t.properties.push(ua({name:"sizing",type:e.DataType.Option,defaultValue:e.Sizing.Content,options:ei})),t.properties.push(ua({name:"timing",type:e.DataType.Option,defaultValue:e.Timing.Content,group:e.DataGroup.Timing,options:$t})),t.properties.push(ua({name:"frame",type:e.DataType.Frame,group:e.DataGroup.Timing,defaultValue:e.Duration.None,min:0,step:1})),t.properties.push(ua({name:"frames",type:e.DataType.Frame,defaultValue:e.Duration.Unknown,min:1,step:1,group:e.DataGroup.Timing}));var s=a[0];t.propertiesInitialize(s);var c=s.container,l=s.content;return c&&(t._containerObject=c),l&&(t._contentObject=l),t}return f(n,[{key:"assureTimingAndSizing",value:function(t,i,n){var r=this.timing,a=this.sizing,o=this.containerId,s=r!==t,u=a!==i;return s||(s=n.hasIntrinsicTiming),u||(u=n.hasIntrinsicSizing),s||(t===e.Timing.Content&&o?this.timing=e.Timing.Container:this.timing=e.Timing.Custom),u||(i===e.Sizing.Content&&o?this.sizing=e.Sizing.Container:this.sizing=e.Sizing.Preview),!(u&&s)}},{key:"audible",get:function(){return this.mutable}},{key:"clipIcon",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.container){var n=this.track,r=n.mash,a=r.quantize,o=r.imageSize;wr(o,"track.mash.imageSize");var s=mr(Tr(o,e,!0));wr(s,"".concat(this.constructor.name,".clipIcon containedSize"));for(var u=s.width+i,c=Math.ceil(e.width/u),l=this.timeRange(a),h=l.startTime,f=[],p=n.mash,v=0,y=0;y<c;y++){var g=h.copy,k=new gu({mash:p,time:g,clip:this,size:s});f.push(k),v+=u,h.frame=l.frame+vu(v,t,"floor")}var T=Promise.resolve([]);return f.forEach((function(e){T=T.then((function(t){return e.svgItemsPromise.then((function(e){return[].concat(d(t),d(e))}))}))})),T.then((function(t){var i=m({},xa),n=So(e);return t.forEach((function(e){To(e,i),Mo(n,e),i.x+=u})),n}))}}},{key:"clipCommandFiles",value:function(e){var t=[],i=e.visible,n=e.quantize,r=e.outputSize,a=e.time,o=this.timeRange(n),s=this.content,u=this.container,c=m(m({},e),{},{clipTime:o});if(i){wr(r,"outputSize"),ka(u);var l={size:r,time:a,timeRange:o,loading:!0},h=this.rects(l),f=fu(s)?s.contentColors(a,o):void 0,p=m(m({},c),{},{outputSize:r,contentColors:f,containerRects:h});if(!f){var v=s.visibleCommandFiles(p);t.push.apply(t,d(v))}var y=u.visibleCommandFiles(p);t.push.apply(t,d(y))}else be(!i,"outputSize && container"),t.push.apply(t,d(this.content.audibleCommandFiles(c)));return t}},{key:"commandFilters",value:function(e){var t=[],i=e.visible,n=e.quantize,r=e.outputSize,a=e.time,o=this.timeRange(n),s=m(m({},e),{},{clipTime:o}),u=this.content,c=this.container;if(!i)return this.content.audibleCommandFilters(s);wr(r,"outputSize"),ka(c);var l={size:r,time:a,timeRange:o},h=this.rects(l);s.containerRects=h;var f={point:!Pa.apply(void 0,d(h)),size:!dr.apply(void 0,d(h))},p=fu(u)?u.contentColors(a,o):void 0,v=me(p);v&&(f.color=p[0]!==p[1],f.canColor=f.color?c.canColorTween(e):c.canColor(e));var y=a.isRange?a.lengthSeconds:0,g=y?Math.min(y,o.lengthSeconds):0,k=m(m({},s),{},{contentColors:p,outputSize:r,containerRects:h,duration:g});return v?f.canColor||(t.push.apply(t,d(c.containerColorCommandFilters(k))),k.filterInput=di(di(t).outputs)):(t.push.apply(t,d(u.commandFilters(k,f))),k.filterInput=di(di(t).outputs)),t.push.apply(t,d(c.commandFilters(k,f,!0))),t}},{key:"container",get:function(){return this._container||this.containerInitialize(this._containerObject)}},{key:"containerInitialize",value:function(t){var i=this.containerId,n=this.track.mash.media,r=i||t.mediaId;if(pe(r)){var a=n.fromId(r),o=m(m({},t),{},{mediaId:r,container:!0}),s=a.instanceFromObject(o);return ka(s),this.assureTimingAndSizing(e.Timing.Container,e.Sizing.Container,s),s.clip=this,this.timing===e.Timing.Container&&this._track&&this.resetTiming(s),this._container=s}}},{key:"content",get:function(){return this._content||this.contentInitialize(this._contentObject)}},{key:"contentInitialize",value:function(t){var i=this.contentId,n=this.track.mash.media,r=i||t.mediaId;ve(r);var a=n.fromId(r),o=m(m({},t),{},{mediaId:r}),s=a.instanceFromObject(o);if(wa(s),this.assureTimingAndSizing(e.Timing.Content,e.Sizing.Content,s)){var u=this.container;u&&this.assureTimingAndSizing(e.Timing.Container,e.Sizing.Container,u)}return s.clip=this,this.timing===e.Timing.Content&&this._track&&this.resetTiming(s),this._content=s}},{key:"definitionIds",value:function(){var e=this.content.definitionIds();return this.container&&e.push.apply(e,d(this.container.definitionIds())),e}},{key:"endFrame",get:function(){return this.frame+this.frames}},{key:"endTime",value:function(e){return Nr(this.endFrame,e)}},{key:"intrinsicsKnown",value:function(e){var t=this.content,i=this.container,n=t.intrinsicsKnown(e);return i&&n&&(n=i.intrinsicsKnown(e)),n}},{key:"intrinsicGraphFiles",value:function(e){var t=this.content,i=this.container,n=[];return t.intrinsicsKnown(e)||n.push(t.intrinsicGraphFile(e)),i&&!i.intrinsicsKnown(e)&&n.push(i.intrinsicGraphFile(e)),n}},{key:"id",get:function(){return this._id||(this._id=ha())}},{key:"label",get:function(){return this._label},set:function(e){this._label=e}},{key:"loadPromise",value:function(e){var t=e.quantize,i=this.content,n=this.container,r=this.frames;ce(r)&&(e.clipTime||(e.clipTime=this.timeRange(t)));var a=[i.loadPromise(e)];return n&&a.push(n.loadPromise(e)),Promise.all(a).then(ci)}},{key:"maxFrames",value:function(e,t){return 0}},{key:"mutable",get:function(){if(this.content.mutable())return!0;var e=this.container;return!!e&&e.mutable()}},{key:"notMuted",get:function(){var e=this.content;if(this.muted)return!1;if(e.mutable()&&!e.muted)return!0;var t=this.container;return!(null!==t&&void 0!==t&&t.mutable())||!t.muted}},{key:"previewItemsPromise",value:function(e,t,i){wr(e,"previewItemsPromise");var n=this.timeRange(this.track.mash.quantize),r=this.container,a=this.content;ka(r);var o={size:e,time:t,timeRange:n,editing:!0},s=this.rects(o);be(Va.apply(void 0,d(s)));var u=p(s,1)[0];return r.previewItemsPromise(a,u,e,t,n,i)}},{key:"rectIntrinsic",value:function(t,i,n){var r=m(m({},t),xa),a=this.sizing;if(a===e.Sizing.Preview)return r;var o=a===e.Sizing.Container?this.container:this.content;Ur(o);var s=o.intrinsicsKnown({editing:n,size:!0});return i&&!s?r:(be(s,"intrinsicsKnown"),o.intrinsicRect(n))}},{key:"rects",value:function(e){var t=e.size,i=e.loading,n=e.editing,r=this.rectIntrinsic(t,i,n),a=this.container;return ka(a),a.containerRects(e,r)}},{key:"resetTiming",value:function(t,i){var n=this.timing,r=this._track;switch(n){case e.Timing.Custom:if(ce(this.frames))break;this.frames=Xr.duration*(i||r.mash.quantize);break;case e.Timing.Container:var a=ga(t)?t:this.container;if(!a)break;this.frames=a.frames(i||r.mash.quantize);break;case e.Timing.Content:var o=ba(t)?t:this.content;if(!o)break;this.frames=o.frames(i||r.mash.quantize)}}},{key:"selectables",value:function(){return[this].concat(d(this.track.selectables()))}},{key:"selectedItems",value:function(t){var i=this,n=[];return this.properties.filter((function(e){return i.selectedProperty(e)})).forEach((function(r){var a=r.name,o="frames"===a||"frame"===a,s=i.value(a);n.push({value:s,selectType:e.SelectType.Clip,property:r,changeHandler:function(n,r){ve(n);var a={property:n,target:i,redoValue:r,undoValue:s,type:o?e.ActionType.ChangeFrame:e.ActionType.Change};t.create(a)}})})),n}},{key:"selectedProperty",value:function(t){var i,n=t.name;switch(t.type){case e.DataType.ContainerId:case e.DataType.ContentId:return!1}switch(n){case"sizing":return!cu(this.content);case"timing":if(this.content.hasIntrinsicTiming)break;return!(null===(i=this.container)||void 0===i||!i.hasIntrinsicSizing);case"frame":return!this.track.dense;case"frames":return this.timing===e.Timing.Custom}return!0}},{key:"serverPromise",value:function(e){var t=this.content,i=this.container,n=[t.serverPromise(e)];return i&&n.push(i.serverPromise(e)),Promise.all(n).then(ci)}},{key:"setValue",value:function(e,t,i){var r,s;switch(a(o(n.prototype),"setValue",this).call(this,e,t,i),t){case"containerId":this._containerObject=(null===(r=this._container)||void 0===r?void 0:r.toJSON())||{},delete this._container;break;case"contentId":this._contentObject=(null===(s=this._content)||void 0===s?void 0:s.toJSON())||{},delete this._content}}},{key:"time",value:function(e){return Nr(this.frame,e)}},{key:"timeRange",value:function(e){var t=this.frame,i=this.frames;return se(t,"timeRange frame"),le(i,"timeRange frames"),Or(this.frame,e,this.frames)}},{key:"timeRangeRelative",value:function(e,t){var i=this.timeRange(t).scale(e.fps),n=Math.max(0,e.frame-i.frame);return e.withFrame(n)}},{key:"toJSON",value:function(){var e=a(o(n.prototype),"toJSON",this).call(this),t=this.container,i=this.content;return e.content=i,e.contentId=i.mediaId,t?(e.container=t,e.containerId=t.mediaId):e.containerId="",e}},{key:"toString",value:function(){return"[Clip ".concat(this.label,"]")}},{key:"track",get:function(){return this._track},set:function(e){this._track=e}},{key:"trackNumber",get:function(){var e=this.track;return e?e.index:-1},set:function(e){e<0&&delete this._track}},{key:"visible",get:function(){return!!this.containerId}}]),n}(kn),Tu=function(t){var i=t.containerId,n=t.contentId,r=X(n)||n===Ta,a=X(i)||i===va;return t.sizing===e.Sizing.Content&&r&&(t.sizing=e.Sizing.Container),t.sizing===e.Sizing.Container&&a&&(t.sizing=e.Sizing.Preview),t.timing===e.Timing.Content&&r&&(t.timing=e.Timing.Container),t.timing===e.Timing.Container&&a&&(t.timing=e.Timing.Custom),new ku(t)},bu=function(t){c(r,t);var i=l(r);function r(t){var n,a;h(this,r),a=i.call(this),v(u(a),"clips",[]),v(u(a),"dense",!1),v(u(a),"_identifier",void 0),v(u(a),"index",0),v(u(a),"_mash",void 0),v(u(a),"selectType",e.SelectType.Track);var o=t.clips,s=t.index,c=t.dense,l=t.mashMedia;return a.mash=l,oe(s)&&(a.index=s),a.dense=te(c)?!!c:!a.index,a.properties.push(ua({name:"dense",defaultValue:!1})),a.propertiesInitialize(t),o&&(n=a.clips).push.apply(n,d(o.map((function(e){var t=m(m({},e),{},{track:u(a)}),i=Tu(t);return i.track=u(a),i})))),a}return f(r,[{key:"addClips",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)||0;this.dense||(t=0);var i=t,n=this.clips.filter((function(n,r){var a=e.includes(n);return i&&a&&r<i&&(t-=1),!a}));n.splice.apply(n,[t,0].concat(d(e))),this.sortClips(n),pi(this.clips,n)}},{key:"assureFrame",value:function(e){var t=e||this.clips,i=!1,n=0,r=[],a=this.dense;return t.forEach((function(e){var t=e.frame;(a?t!==n:r.some((function(e){return e.includes(t)})))&&(i=!0,e.frame=n),n=e.frame+e.frames,a||r.push(e.timeRange(1))})),i}},{key:"assureFrames",value:function(e,t){var i=te(t);(t||this.clips).forEach((function(t){var n=t.frames;ce(n)||(t.resetTiming(void 0,e),!ce(t.frames)&&i&&(t.frames=Math.floor(Xr.duration*e)))}))}},{key:"frameForClipNearFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.dense)return t;var i=this.clips.filter((function(i){return e!==i&&i.endFrame>t}));if(!i.length)return t;var n=e.frame,r=e.endFrame-n,a=t;return i.find((function(e){if(e.frame>=a+r)return!0;a=e.endFrame})),a}},{key:"frames",get:function(){var t=this.clips;if(!t.length)return e.Duration.None;var i,r=n(t);try{for(r.s();!(i=r.n()).done;){var a=i.value.frames;switch(a){case e.Duration.Unknown:case e.Duration.Unlimited:return a}}}catch(s){r.e(s)}finally{r.f()}var o=di(t);return o.frame+o.frames}},{key:"identifier",get:function(){return this._identifier||(this._identifier=fa("track"))}},{key:"mash",get:function(){var e=this._mash;return Jn(e),e},set:function(e){this._mash=e}},{key:"removeClips",value:function(e){var t=this.clips.filter((function(t){return!e.includes(t)}));be(t.length!==this.clips.length),e.forEach((function(e){return e.trackNumber=-1})),this.sortClips(t),pi(this.clips,t)}},{key:"selectables",value:function(){return[this].concat(d(this.mash.selectables()))}},{key:"selectedItems",value:function(t){var i=this;return this.properties.map((function(n){var r=i.value(n.name);return{value:r,property:n,selectType:e.SelectType.Track,changeHandler:function(e,n){ve(e);var a={target:i,property:e,redoValue:n,undoValue:r};t.create(a)}}}))}},{key:"sortClips",value:function(e){var t=e||this.clips,i=this.assureFrame(t);return t.sort(ta),i}},{key:"toJSON",value:function(){var e=a(o(r.prototype),"toJSON",this).call(this);return e.clips=this.clips,e}}]),r}(kn),wu=function(e){return new bu(e)},Fu={instance:wu},Su=function(e){c(i,e);var t=l(i);function i(){return h(this,i),t.apply(this,arguments)}return f(i,[{key:"clips",get:function(){return[]}}]),i}(gu),Iu="".concat(hi,"font").concat(fi),Cu=function(e){return ga(e)&&"string"in e},Pu=function(e){return Sn(e)&&e.type===Oe},xu=function(e){c(i,e);var t=l(i);function i(e){return h(this,i),t.call(this,e)}return f(i)}(Tn),Au=function(e){return new xu(e)},Mu=[Ve,qe],Du=function(e){return ba(e)&&"startOptions"in e},zu=function(e){return Fa(e)&&"audibleSource"in e};function Eu(e,t){zu(e)||G(e,"UpdatableDefinition",t)}var Vu=",";function Ru(e){return function(e){c(i,e);var t=l(i);function i(){var e;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];e=t.call.apply(t,[this].concat(r)),v(u(e),"gain",1),v(u(e),"gainPairs",[]),v(u(e),"hasIntrinsicTiming",!0),v(u(e),"_trimFilter",void 0);var o=r[0].gain;if(te(o))if(J(o))if(o.includes(Vu)){for(var s=o.split(Vu).map((function(e){return parseFloat(e)})),c=s.length/2,l=0;l<c;l+=1)e.gainPairs.push([s[2*l],s[2*l+1]]);e.gain=-1}else e.gain=Number(o);else oe(o)&&(e.gain=o);return e}return f(i,[{key:"definitionTime",value:function(e,t){var n=a(o(i.prototype),"definitionTime",this).call(this,e,t),r=this.startTrim,s=this.endTrim,u=this.definition.duration;le(u);var c=qr(u,t.fps).frame-(r+s),l=n.frame%c;return n.withFrame(l+r).divide(this.speed)}},{key:"frames",value:function(e){var t=this.definition,i=this.startTrim,n=this.endTrim;return t.frames(e)-(i+n)}},{key:"graphFiles",value:function(e){if(!e.audible)return[];if(!this.mutable()||this.muted)return[];var t=this.definition;return[{type:Ve,file:"",definition:t,input:!0}]}},{key:"hasGain",value:function(){if(0===this.gain)return!0;if(oe(this.gain))return!1;if(2!==this.gainPairs.length)return!1;var e=p(this.gainPairs,2),t=e[0],i=e[1];if(2!==t.length)return!1;if(2!==i.length)return!1;if(Math.max.apply(Math,d(t)))return!1;var n=p(i,2),r=n[0],a=n[1];return 1===r&&0===a}},{key:"initialCommandFilters",value:function(e,t){var i=[],n=e.time,r=e.quantize,a=e.commandFiles,o=e.clipTime,s=e.videoRate,u=e.duration,c=this.id,l=ro(a,c,!0);ve(l,"filterInput");var h="trim",f=fa(h),d={};u&&(d.duration=u);var p=this.definitionTime(n,o).frame;p&&(d.start=Nr(p,r).seconds);var v={inputs:[l],ffmpegFilter:h,options:d,outputs:[f]};if(i.push(v),l=f,u){var m="fps",y=fa(m),g={ffmpegFilter:m,options:{fps:s},inputs:[l],outputs:[y]};i.push(g),l=y}var k="setpts",T={ffmpegFilter:k,options:{expr:"PTS-STARTPTS"},inputs:[l],outputs:[fa(k)]};return i.push(T),i}},{key:"intrinsicsKnown",value:function(e){return!!a(o(i.prototype),"intrinsicsKnown",this).call(this,e)&&(!e.duration||ce(this.definition.duration))}},{key:"mutable",value:function(){return this.definition.audio}},{key:"selectedProperty",value:function(e){return"gain"===e.name?this.mutable()&&!this.muted:a(o(i.prototype),"selectedProperty",this).call(this,e)}},{key:"setValue",value:function(e,t,n){if(a(o(i.prototype),"setValue",this).call(this,e,t,n),!n)switch(t){case"startTrim":case"endTrim":case"speed":this.clip.resetTiming(this)}}},{key:"startOptions",value:function(e,t){var i=t.withFrame(this.startTrim).seconds,n=t.seconds-e,r=t.lengthSeconds;return n<0&&(i-=n,r+=n,n=0),{start:n,offset:i,duration:r}}},{key:"toJSON",value:function(){var e=a(o(i.prototype),"toJSON",this).call(this),t=this.speed,n=this.gain;return 1!==t&&(e.speed=t),1!==n&&(e.gain=n),e}},{key:"trimFilter",get:function(){return this._trimFilter||(this._trimFilter=gs("trim"))}}]),i}(e)}var Ou="probe",_u=[Ou],ju=function(e){return _u.includes(e)},Nu=function(e){return H(e)&&"type"in e&&ju(e.type)},qu=function(e){return Nu(e)&&e.type===Ou};function Bu(t){return function(t){c(n,t);var i=l(n);function n(){var t;h(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];t=i.call.apply(i,[this].concat(a)),v(u(t),"_audio",void 0),v(u(t),"audioUrl",""),v(u(t),"_duration",0),v(u(t),"loadedAudio",void 0),v(u(t),"loop",!1);var s=a[0].loop;return s&&(t.loop=s,t.properties.push(ua({name:"loops",defaultValue:1}))),t.properties.push(ua({name:"gain",defaultValue:1,type:e.DataType.Percent,min:0,max:2,step:.01})),t.properties.push(ua({name:"speed",defaultValue:1,type:e.DataType.Percent,min:.1,max:2,step:.1,group:e.DataGroup.Timing})),t.properties.push(ua({name:"startTrim",defaultValue:0,type:e.DataType.Frame,step:1,min:0,group:e.DataGroup.Timing})),t.properties.push(ua({name:"endTrim",defaultValue:0,type:e.DataType.Frame,step:1,min:0,group:e.DataGroup.Timing})),t}return f(n,[{key:"audibleSource",value:function(){var e=this.loadedAudio;if(e)return Gn.createBufferSource(e)}},{key:"audio",get:function(){return X(this._audio)&&(this._audio=this.decodings.some((function(e){var t;return null===(t=e.data)||void 0===t?void 0:t.audible}))),Boolean(this._audio)},set:function(e){this._audio=e}},{key:"duration",get:function(){if(!ce(this._duration)){var e=this.decodings.find((function(e){return e.type===Ou}));if(qu(e)){var t=e.data.duration;ce(t)&&(this._duration=t)}}return this._duration},set:function(e){this._duration=e}},{key:"frames",value:function(t){return this.duration?qr(this.duration,t,"floor").frame:e.Duration.Unknown}},{key:"preloadAudioPromise",get:function(){var e=this;if(this.loadedAudio)return Promise.resolve();var t=this.preferredTranscoding(Ve,qe).request,i=t.response;return _n(i)?(this.loadedAudio=i,Promise.resolve()):qs(t).then((function(t){if(!Ee(t)){var i=t.data;if(!_n(i)){Vn(i);var n=i.src,r=zi(n);return qs({endpoint:r}).then((function(t){if(!Ee(t)){var i=t.data;jn(i),e.loadedAudio=i}}))}e.loadedAudio=i}}))}},{key:"toJSON",value:function(){var e=this.loop;return m(m({},a(o(n.prototype),"toJSON",this).call(this)),{},{loop:e})}}]),n}(t)}var Uu=[_e,qe],Lu=function(e){return ba(e)},Gu=function(e){return Fa(e)};function Hu(t){return function(t){c(n,t);var i=l(n);function n(){var t;h(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];t=i.call.apply(i,[this].concat(a)),v(u(t),"colorMaximize",!0),v(u(t),"hasIntrinsicSizing",!0),v(u(t),"_setsarFilter",void 0);var s=a[0],c=s.container?0:1;return t.addProperties(s,ua({tweenable:!0,name:"width",type:e.DataType.Percent,group:e.DataGroup.Size,defaultValue:1,max:2,min:c})),t.addProperties(s,ua({tweenable:!0,name:"height",type:e.DataType.Percent,group:e.DataGroup.Size,defaultValue:1,max:2,min:c})),t}return f(n,[{key:"containerCommandFilters",value:function(e,t){var i=[],n=e.commandFiles,r=e.containerRects,a=e.filterInput,o=e.videoRate,s=e.track,u=a,c=t.size?Ua.apply(void 0,d(r)):r[0],l=m(m({},e),{},{contentColors:[nn,nn],outputSize:c});i.push.apply(i,d(this.colorBackCommandFilters(l,"container-".concat(s,"-back"))));var h=di(di(i).outputs),f=this.id,p=ro(n,f,!0);i.push.apply(i,d(this.scaleCommandFilters(m(m({},e),{},{filterInput:p})))),u=di(di(i).outputs),t.size&&(ve(u,"overlay input"),i.push.apply(i,d(this.overlayCommandFilters(h,u))),u=di(di(i).outputs));var v={duration:0,videoRate:o};ve(u,"crop input");var y=this.cropFilter;return y.setValue(c.width,"width"),y.setValue(c.height,"height"),y.setValue(0,"x"),y.setValue(0,"y"),i.push.apply(i,d(y.commandFilters(m(m({},v),{},{filterInput:u})))),u=di(di(i).outputs),t.size||(ve(u,"overlay input"),i.push.apply(i,d(this.overlayCommandFilters(h,u))),u=di(di(i).outputs)),ve(u,"alphamerge input"),i.push.apply(i,d(this.alphamergeCommandFilters(m(m({},e),{},{filterInput:u})))),u=di(di(i).outputs),i.push.apply(i,d(this.containerFinalCommandFilters(m(m({},e),{},{filterInput:u})))),i}},{key:"containerSvgItemPromise",value:function(t,i,n,r){return r!==e.Component.Player?this.svgItemForTimelinePromise(t,i,n):this.svgItemForPlayerPromise(t,i,n).then((function(e){return To(e,t),e}))}},{key:"contentCommandFilters",value:function(e,t){var i=[],r=e.containerRects,s=e.visible,u=e.time,c=e.videoRate,l=e.clipTime,h=e.commandFiles,f=e.filterInput,v=e.track;if(!s)return i;Ce(l),ye(r,"containerRects");var y=this.id,g=f||ro(h,y,s),k={containerRects:r,time:u,timeRange:l},T=this.contentRects(k),b=!Va.apply(void 0,d(r)),w=p(T,2),F=w[0],S=w[1],I=Ie(u)?u.lengthSeconds:0,C=b?Ua.apply(void 0,d(r)):r[0],P="content-".concat(v,"-back"),x=m(m({},e),{},{contentColors:[Zi,Zi],outputSize:C});i.push.apply(i,d(this.colorBackCommandFilters(x,P)));var A=m(m({},e),{},{filterInput:g,containerRects:T});i.push.apply(i,d(this.scaleCommandFilters(A))),g=di(di(i).outputs),t.size&&(i.push.apply(i,d(this.overlayCommandFilters(P,g))),g=di(di(i).outputs));var M={duration:I,videoRate:c},D=this.cropFilter;D.setValue(C.width,"width"),D.setValue(C.height,"height"),D.setValue(F.x,"x"),D.setValue(F.y,"y"),D.setValue(S.x,"x".concat(gn)),D.setValue(S.y,"y".concat(gn)),i.push.apply(i,d(D.commandFilters(m(m({},M),{},{filterInput:g})))),g=di(di(i).outputs);var z=this.setsarFilter;return z.setValue("1/1","sar"),i.push.apply(i,d(z.commandFilters(m(m({},M),{},{filterInput:g})))),g=di(di(i).outputs),t.size||(i.push.apply(i,d(this.overlayCommandFilters(P,g,this.definition.alpha))),g=di(di(i).outputs)),i.push.apply(i,d(a(o(n.prototype),"contentCommandFilters",this).call(this,m(m({},e),{},{filterInput:g}),t))),i}},{key:"svgItemForPlayerPromise",value:function(e,t,i){return this.svgItemForTimelinePromise(e,t,i)}},{key:"svgItemForTimelinePromise",value:function(e,t,i){return G(V.Unimplemented)}},{key:"contentSvgItemPromise",value:function(e,t,i,n){be(!this.container);var r=this.itemContentRect(e,t,i);return this.containerSvgItemPromise(r,t,i,n)}},{key:"initialCommandFilters",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[],r=e.filterInput,a=e.track;return i&&(ve(r),n.push(this.copyCommandFilter(r,a))),n}},{key:"intrinsicRect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"previewSize":"sourceSize",t=this.definition[e];return wr(t,e),m(m({},xa),t)}},{key:"intrinsicsKnown",value:function(e){var t=e.editing;if(!e.size)return!0;var i=t?"previewSize":"sourceSize",n=this.definition[i];return br(n)}},{key:"itemContentRect",value:function(e,t,i){var n={containerRects:e,time:t,timeRange:i,editing:!0},r=this.contentRects(n),a=p(r,1)[0],o=a.x,s=a.y,u={x:e.x-o,y:e.y-s};return Oa(a,u)}},{key:"setsarFilter",get:function(){return this._setsarFilter||(this._setsarFilter=gs("setsar"))}}]),n}(t)}function Wu(e){return function(e){c(i,e);var t=l(i);function i(){var e;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];e=t.call.apply(t,[this].concat(r)),v(u(e),"alpha",void 0);var o=r[0];return console.log(e.constructor.name,o),e}return f(i,[{key:"previewSize",get:function(){var e=this.transcodings.find((function(e){return e.request.response}));if(!e)return this.sourceSize;var t=e.request.response;if(br(t)){var i=t.width,n=t.height;return ce(i)&&ce(n)?{width:i,height:n}:void 0}}},{key:"sourceSize",get:function(){var e=this.decodings.find((function(e){return e.type===Ou}));if(qu(e)){var t=e.data,i=t.width,n=t.height;if(!ce(i)||!ce(n))return;return{width:i,height:n}}}}]),i}(e)}var Ju=function(){function e(t){h(this,e),v(this,"buffer",Xr.mash.buffer),v(this,"bufferSource",void 0),v(this,"gain",Xr.mash.gain),v(this,"playing",!1),v(this,"playingClips",[]),v(this,"startedMashAt",0),v(this,"contextSecondsWhenStarted",0);var i=t.buffer,n=t.gain;oe(n)&&(this.gain=n),ce(i)&&(this.buffer=i)}return f(e,[{key:"adjustClipGain",value:function(e,t){var i=this,n=e.timeRange(t);this.clipSources(e).forEach((function(e){i.adjustSourceGain(e,n)}))}},{key:"adjustSourceGain",value:function(e,t){var i=this,n=Gn.getSource(e.id);if(n){var r=n.gainNode;if(0!==this.gain){var a=e.gain;if(oe(a))r.gain.value=this.gain*a;else{var o=Ie(t)?e.startOptions(this.seconds,t):t,s=o.start,u=o.duration;r.gain.cancelScheduledValues(0),e.gainPairs.forEach((function(e){var t=p(e,2),n=t[0],a=t[1];r.gain.linearRampToValueAtTime(i.gain*a,s+n*u)}))}}else r.gain.value=0}}},{key:"bufferClips",value:function(e,t){return!!this.createSources(e,t)&&(this.destroySources(e),!0)}},{key:"clear",value:function(){}},{key:"clipSources",value:function(e){var t=[],i=e.container,n=e.content;return Du(i)&&!i.muted&&t.push(i),Du(n)&&!n.muted&&t.push(n),t}},{key:"createSources",value:function(e,t,i){var n,r=this;if(!this.playing&&!i)return!1;var a=e.filter((function(e){return!r.playingClips.includes(e)}));if(!a.length)return!0;var o=!0;return a.forEach((function(e){var n=r.clipSources(e),a=e.timeRange(t),s=n.filter((function(e){return!Gn.hasSource(e.id)}));o&&(o=s.every((function(e){var t=r.playing?r.seconds:(null===i||void 0===i?void 0:i.seconds)||0,n=e.startOptions(t,a),o=n.start,s=n.duration,u=n.offset;if(oe(o)&&ce(s)){var c=e.definition,l=e.id;Eu(c);var h=c.audibleSource();if(!h)return!!o||(console.log(r.constructor.name,"createSources no audible source",c.label),!1);var f=c.loop;Gn.startAt(l,h,o,s,u,f),r.adjustSourceGain(e,n)}else console.error(r.constructor.name,"createSources",n);return!0})))})),(n=this.playingClips).push.apply(n,d(a)),o}},{key:"destroySources",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];d(this.playingClips).filter((function(e){return!t.includes(e)})).forEach((function(t){e.clipSources(t).forEach((function(e){return Gn.deleteSource(e.id)}))})),this.playingClips=t}},{key:"setGain",value:function(e,t){var i=this;this.gain!==e&&(this.gain=e,this.playing&&this.playingClips.forEach((function(e){return i.adjustClipGain(e,t)})))}},{key:"seconds",get:function(){return Gn.currentTime-this.contextSecondsWhenStarted+this.startedMashAt}},{key:"startContext",value:function(){if(this.bufferSource)return G(V.Internal);if(this.playing)return G(V.Internal);var e=Gn.createBuffer(this.buffer);this.bufferSource=Gn.createBufferSource(e),this.bufferSource.loop=!0,this.bufferSource.connect(Gn.destination),this.bufferSource.start(0)}},{key:"startPlaying",value:function(e,t,i){if(!this.bufferSource)return G(V.Internal);if(this.playing)return G(V.Internal);var n=e.seconds;return this.playing=!0,this.startedMashAt=n,this.contextSecondsWhenStarted=Gn.currentTime,!!this.createSources(t,i,e)||(this.stopPlaying(),!1)}},{key:"stopContext",value:function(){this.bufferSource&&(this.bufferSource.stop(),this.bufferSource.disconnect(Gn.destination),delete this.bufferSource)}},{key:"stopPlaying",value:function(){this.playing&&(this.playing=!1,this.destroySources(),this.startedMashAt=0,this.contextSecondsWhenStarted=0)}}]),e}(),Ku=function(e){return new Ju(e)},Xu=function(t){c(n,t);var i=l(n);function n(t,r){var a,o;h(this,n),o=i.call(this,t),v(u(o),"_editor",void 0),v(u(o),"emitter",void 0),v(u(o),"imageSize",m({},pr)),v(u(o),"_buffer",Xr.mash.buffer),v(u(o),"_bufferTimer",void 0),v(u(o),"_composition",void 0),v(u(o),"drawInterval",void 0),v(u(o),"drawingTime",void 0),v(u(o),"drawnTime",void 0),v(u(o),"_frame",0),v(u(o),"_gain",Xr.mash.gain),v(u(o),"_loadMashContentPromise",void 0),v(u(o),"_loadedMashContent",!1),v(u(o),"loadingPromises",[]),v(u(o),"loop",!1),v(u(o),"_media",void 0),v(u(o),"_paused",!0),v(u(o),"_playing",!1),v(u(o),"_preview",void 0),v(u(o),"quantize",Xr.mash.quantize),v(u(o),"_rendering",""),v(u(o),"encodings",[]),v(u(o),"seekTime",void 0),v(u(o),"selectType",e.SelectType.Mash),v(u(o),"tracks",[]),v(u(o),"type",je);var s=t.encodings;if(hr(r))o.imageSize=r;else if(r){var c=r.loop,l=r.gain,f=r.buffer,p=r.size,y=r.mediaCollection,g=r.emitter,k=r.editor;k&&(o.editor=k),g&&(o.emitter=g),p&&(o.imageSize=p),H(y)&&(o._media=y),$(c)&&(o.loop=c),ne(l)&&(o.gain=l),ce(f)&&(o._buffer=f)}return he(s)&&(a=o.encodings).push.apply(a,d(s.map(Au))),o.properties.push(ua({name:"color",defaultValue:$i,type:e.DataType.Rgb})),o._preview=new Su({mash:u(o),time:Nr()}),o.propertiesInitialize(t),o}return f(n,[{key:"editor",get:function(){return this._editor},set:function(e){this._editor=e}},{key:"addClipToTrack",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,a=he(e)?e:[e],o=this.trackClips(a,i);this.emitIfFramesChange((function(){o.forEach((function(e){var i=p(e,2),a=i[0],o=i[1],s=t.tracks[a];Jr(s,"track"),o.forEach((function(e){var t=e.trackNumber;oe(t)&&t!==a&&e.track.removeClips([e]),oe(r)&&(e.frame=r),e.track=s})),s.assureFrames(t.quantize,o),s.addClips(o,n)}))}))}},{key:"addTrack",value:function(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=m({index:this.tracks.length,mashMedia:this},i),r=wu(n);return this.tracks.push(r),this.tracks.sort(ia),null!==(t=this.emitter)&&void 0!==t&&t.emit(e.EventType.Track),r}},{key:"assureTrack",value:function(){if(!this.tracks.length){var e=wu({dense:!0,mashMedia:this});e.mash=this,this.tracks.push(e)}}},{key:"buffer",get:function(){return this._buffer},set:function(e){le(e,"buffer"),this._buffer!==e&&(this._buffer=e,this._composition&&(this.composition.buffer=e))}},{key:"bufferStart",value:function(){var e=this;this._bufferTimer||(this._bufferTimer=setInterval((function(){if(!e._paused){e.loadPromise({editing:!0,audible:!0});var t=e.clipsAudibleInTime(e.timeToBuffer);e.composition.bufferClips(t,e.quantize)}}),Math.round(1e3*this.buffer/2)))}},{key:"bufferStop",value:function(){this._bufferTimer&&(clearInterval(this._bufferTimer),delete this._bufferTimer)}},{key:"changeTiming",value:function(e,t,i){this.emitIfFramesChange((function(){e.setValue(i,t)}))}},{key:"clearDrawInterval",value:function(){this.drawInterval&&(clearInterval(this.drawInterval),this.drawInterval=void 0)}},{key:"clearPreview",value:function(){delete this._preview}},{key:"clipIntersects",value:function(e,t){return!e.frames||e.timeRange(this.quantize).intersects(t)}},{key:"clips",get:function(){return this.tracks.map((function(e){return e.clips})).flat()}},{key:"clipsAudibleInTime",value:function(e){var t=this.clips.filter((function(e){return e.mutable&&e.notMuted}));return this.filterIntersecting(t,e)}},{key:"clipsInTime",value:function(e){return this.filterIntersecting(this.clips,e)}},{key:"clipsInTimeOfType",value:function(t){switch(arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.AVType.Both){case e.AVType.Both:return this.clipsInTime(t);case e.AVType.Audio:return this.clipsAudibleInTime(t);case e.AVType.Video:return this.clipsVisibleInTime(t)}}},{key:"clipsVisible",get:function(){return this.clips.filter((function(e){return e.container}))}},{key:"clipsVisibleInTime",value:function(e){return this.filterIntersecting(this.clipsVisible,e)}},{key:"compositeVisible",value:function(t){var i;this.drawingTime=t,this.clearPreview(),null===(i=this.emitter)||void 0===i||i.emit(e.EventType.Draw)}},{key:"compositeVisibleRequest",value:function(e){var t=this;"function"==typeof requestAnimationFrame&&requestAnimationFrame((function(){t.compositeVisible(e)}))}},{key:"composition",get:function(){if(!this._composition){var e={buffer:this.buffer,gain:this.gain};this._composition=Ku(e)}return this._composition}},{key:"definitionIds",get:function(){var e=this.clips.flatMap((function(e){return e.definitionIds()}));return d(new Set(e))}},{key:"destroy",value:function(){this.paused=!0,this.clearDrawInterval()}},{key:"draw",value:function(){var e=this.time;this.compositeVisible(e)}},{key:"drawRequest",value:function(){var e=this.time;this.compositeVisibleRequest(e)}},{key:"drawTime",value:function(t){var i,n=t!==this.time;this.drawnTime=t,this.drawRequest(),null===(i=this.emitter)||void 0===i||i.emit(n?e.EventType.Time:e.EventType.Loaded)}},{key:"duration",get:function(){return this.endTime.seconds}},{key:"emitIfFramesChange",value:function(t){var i,n=this.frames;t();var r=this.frames;n!==r&&(null!==(i=this.emitter)&&void 0!==i&&i.emit(e.EventType.Duration),this.frame>r&&this.seekToTime(Nr(r,this.quantize)))}},{key:"endTime",get:function(){return Nr(this.frames,this.quantize)}},{key:"filterIntersecting",value:function(e,t){var i=this,n=t.scale(this.quantize);return e.filter((function(e){return i.clipIntersects(e,n)}))}},{key:"frame",get:function(){return this.time.scale(this.quantize,"floor").frame}},{key:"frames",get:function(){if(this.tracks.length){var t=this.tracks.map((function(e){return e.frames}));return oe(Math.min.apply(Math,d(t)))?Math.max.apply(Math,[0].concat(d(t))):e.Duration.Unknown}return e.Duration.None}},{key:"gain",get:function(){return this._gain},set:function(e){se(e,"gain"),this._gain!==e&&(this._gain=e,this._composition&&this.composition.setGain(e,this.quantize))}},{key:"graphFileOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.time,i=e.audible,n=e.visible,r=e.editing,a=e.streaming,o=t||this.time,s=o.isRange,u=n||!s,c=s&&i,l={editing:r,streaming:a,audible:c,visible:u,time:o,quantize:this.quantize};return be(u||c,"audible || visible"),l}},{key:"handleDrawInterval",value:function(){var t,i=this.composition.seconds,n=this.time.withFrame(this.time.frame);if(i>=this.endTime.seconds)this.loop?this.seekToTime(this.time.withFrame(0)):(this.paused=!0,null===(t=this.emitter)||void 0===t||t.emit(e.EventType.Ended));else if(i>=n.seconds){var r=qr(i,this.time.fps);this.drawTime(r)}}},{key:"loadMashContentPromise",get:function(){var e=this;if(this._loadedMashContent)return Promise.resolve();var t=this._loadMashContentPromise;if(!t){var i=this.request;return this._loadMashContentPromise=Ws(i,!0).then((function(t){var i;if(Ee(t))return G(t.error);var n=t.data,r=n.media,a=n.tracks,o=n.quantize,s=n.color;he(r)&&(i=e.media).define.apply(i,d(r)),ce(o)&&(e.quantize=o),s&&e.setValue(s,"color"),he(a)&&a.forEach((function(t,i){var n=m(m({mashMedia:e,dense:!i},t),{},{index:i}),r=wu(n);r.assureFrames(e.quantize),r.sortClips(),e.tracks.push(r)})),e.assureTrack(),e.tracks.sort(ia),e._loadedMashContent=!0,delete e._loadMashContentPromise}))}return t}},{key:"loadPromise",value:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.loadMashContentPromise.then((function(){i.time||(i.time=t.timeToBuffer);var n=t.graphFileOptions(i),r=n.time,a=n.audible,o=n.visible,s=t.quantize;Se(r);var u=r.scale(t.quantize),c=a&&o?e.AVType.Both:a?e.AVType.Audio:e.AVType.Video,l=t.clipsInTimeOfType(u,c).map((function(e){var t=e.timeRange(s),i=m(m({},n),{},{clipTime:t,quantize:s,time:r});return e.loadPromise(i)})),h=Promise.all(l).then(ci),f=h.then((function(){var e=t.loadingPromises.indexOf(h);if(e<0)return G(V.Internal);t.loadingPromises.splice(e,1)}));return t.loadingPromises.push(h),f}))}},{key:"loading",get:function(){return!!this.loadingPromises.length}},{key:"media",get:function(){return this._media||(this._media=new Dn)}},{key:"paused",get:function(){return this._paused},set:function(t){var i,n=this,r=t||!this.frames;this._paused!==r&&(this._paused=r,r?(this.playing=!1,this.bufferStop(),this._bufferTimer&&(clearInterval(this._bufferTimer),delete this._bufferTimer),this.composition.stopContext(),null===(i=this.emitter)||void 0===i||i.emit(e.EventType.Pause)):(this.composition.startContext(),this.loadPromise({editing:!0,audible:!0,visible:!0}).then((function(){var t;n.bufferStart(),n.playing=!0,null===(t=n.emitter)||void 0===t||t.emit(e.EventType.Play)}))))}},{key:"playing",get:function(){return this._playing},set:function(t){if(this._playing!==t)if(this._playing=t,t){var i,n=this.quantize,r=this.time,a=this.clipsAudibleInTime(this.timeToBuffer);if(!this.composition.startPlaying(r,a,n)){var o=this.clipsAudibleInTime(this.timeToBuffer);if(!this.composition.startPlaying(r,o,n))return void(this._playing=!1)}null!==(i=this.emitter)&&void 0!==i&&i.emit(e.EventType.Playing),this.setDrawInterval()}else this.composition.stopPlaying(),this.clearDrawInterval()}},{key:"preview",value:function(e){return this._preview||(this._preview=this.previewInitialize(e))}},{key:"previewInitialize",value:function(e){return new gu(this.previewArgs(e))}},{key:"previewArgs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.editor,i=null===t||void 0===t?void 0:t.selection.clip,n=Yr(i)?i:void 0,r=this.drawingTime,a=this.time,o=this.quantize;return m({selectedClip:n,time:(r||a).scale(o),mash:this},e)}},{key:"previewItemsPromise",value:function(e){var t={editor:e};return this.preview(t).previewItemsPromise}},{key:"putPromise",value:function(){var e=this.quantize,t=this.clips.flatMap((function(t){var i=t.container;if(Cu(i)&&!i.intrinsicsKnown({editing:!0,size:!0})){var n={editing:!0,visible:!0,quantize:e,time:t.time(e),clipTime:t.timeRange(e)};return i.loadPromise(n)}return[]}));return Promise.all(t).then(ci)}},{key:"removeClipFromTrack",value:function(e){var t=he(e)?e:[e];this.emitIfFramesChange((function(){t.forEach((function(e){e.track.removeClips([e])}))}))}},{key:"removeTrack",value:function(t){var i,n=this,r=oe(t)?t:this.tracks.length-1;se(r),this.emitIfFramesChange((function(){n.tracks.splice(r,1)})),null===(i=this.emitter)||void 0===i||i.emit(e.EventType.Track)}},{key:"restartAfterStop",value:function(t,i,n){var r;t.equalsTime(this.time)&&(n&&(delete this.seekTime,null!==(r=this.emitter)&&void 0!==r&&r.emit(e.EventType.Seeked)),this.drawTime(t),i||(this.playing=!0))}},{key:"reload",value:function(){return this.stopLoadAndDraw()}},{key:"seekToTime",value:function(t){var i,n;return this.seekTime!==t&&(this.seekTime=t,null!==(i=this.emitter)&&void 0!==i&&i.emit(e.EventType.Seeking),null!==(n=this.emitter)&&void 0!==n&&n.emit(e.EventType.Time)),this.stopLoadAndDraw(!0)}},{key:"selectables",value:function(){return[this]}},{key:"selectedItems",value:function(t){var i=this;return this.properties.map((function(n){var r=i.value(n.name),a={value:r,selectType:e.SelectType.Mash,property:n,changeHandler:function(e,n){ve(e);var a={property:e,target:i,redoValue:n,undoValue:r};t.create(a)}};return a}))}},{key:"setDrawInterval",value:function(){var e=this;this.drawInterval||(this.clearDrawInterval(),this.drawInterval=setInterval((function(){e.handleDrawInterval()}),500/this.time.fps))}},{key:"stopLoadAndDraw",value:function(e){var t=this,i=this.time,n=this.paused,r=this.playing;return r&&(this.playing=!1),this.loadPromise({editing:!0,visible:!0,audible:r}).then((function(){t.restartAfterStop(i,n,e)}))}},{key:"time",get:function(){return this.seekTime||this.drawnTime||Nr(this._frame,this.quantize)}},{key:"timeRange",get:function(){var e=this.endTime,t=this.time,i=e.scale(t.fps);return _r(t,i.frame)}},{key:"timeRanges",value:function(t,i){var n=i||this.time,r=this.quantize,a=n.scale(this.quantize,"floor"),o=a.isRange?a.timeRange.endTime:void 0,s=this.clipsInTimeOfType(n,t),u=s.length;if(!u)return[];if(1===u||!a.isRange||t===e.AVType.Audio)return[n];var c=new Set;s.forEach((function(e){c.add(Math.max(e.frame,a.frame)),c.add(Math.min(e.frame+e.frames,o.frame))}));var l=d(c).sort((function(e,t){return e-t})),h=l.shift();return l.map((function(e){var t=Or(h,r,e-h);return h=e,t}))}},{key:"timeToBuffer",get:function(){var e=this.time,t=this.quantize,i=this.buffer;return this.paused?Nr(e.scale(t,"floor").frame,t):jr(e,qr(i+e.seconds,e.fps))}},{key:"toJSON",value:function(){var e=this.encodings,t=this.tracks,i=this.quantize;return this.frame,m(m({},a(o(n.prototype),"toJSON",this).call(this)),{},{encodings:e,tracks:t,quantize:i})}},{key:"trackClips",value:function(e,t){if(oe(t))return[[t,e]];var i=this.tracks.length-e.length;return e.map((function(e){return[i++,[e]]}))}}]),n}(iu),Yu={type:je,id:"",request:{response:{}}},Zu=function(e,t){var i=m({request:{response:{}},type:je},e);return new Xu(i,t)},$u=function(e){return Sn(e)&&e.type===_e},Qu=function(e){return(null===e||void 0===e?void 0:e.split("/").shift())||""},ec=function(e){return En(e)?function(e){var t,i=e.duration,n=e.videoWidth,r=e.clientWidth,a=e.videoHeight,o=e.clientHeight,s=n||r,u=a||o,c=e,l=c.mozHasAudio;return l||(l=Boolean(c.webkitAudioDecodedByteCount)),l||(l=Boolean(null===(t=c.audioTracks)||void 0===t?void 0:t.length)),l||console.log(Object.values(e)),{width:s,height:u,duration:i,audible:l}}(e):Rn(e)?Cr(e):qn(e)?{}:_n(e)?function(e){return{duration:e.duration,audible:!0}}(e):{}},tc=function(e,t){return console.log("filePromises",e,t),e.map((function(e){var t=e.name,i=e.type,n=Qu(i);if(!$e(n))return console.log("filePromises NOT raw type",n,i,e),L(V.ImportType,{value:n});var r=[],a={endpoint:zi(URL.createObjectURL(e))},o={request:a,decodings:r,type:n,label:t,file:e,id:da()},s=n===Ve||n===qe,u=n===_e||n===qe;return Js(a,n).then((function(e){if(console.log("filePromises",a,n,e),Ee(e))return e;var t=e.data,i=ec(t),c={data:i,type:Ou};if(r.push(c),s){var l=i.duration,h=void 0===l?0:l;if(!ce(h))return L(V.ImportDuration,{value:h});i.audible=!0}if(u){var f=Cr(i);if(!br(f))return L(V.ImportSize,{value:xr(f)});o.clientMedia=t}else o.clientMedia=t;return console.log("filePromises",o),{mediaObject:o}}))}))},ic=function(){function t(e){h(this,t),v(this,"actions",void 0),v(this,"autoplay",Xr.editor.autoplay),v(this,"_buffer",Xr.editor.buffer),v(this,"dragging",!1),v(this,"drawTimeout",void 0),v(this,"_editType",void 0),v(this,"editing",void 0),v(this,"eventTarget",new Mr),v(this,"_fps",Xr.editor.fps),v(this,"mashMedia",void 0),v(this,"mashMediaObject",void 0),v(this,"_loop",Xr.editor.loop),v(this,"media",new Dn),v(this,"_muted",!1),v(this,"precision",Xr.editor.precision),v(this,"readOnly",!1),v(this,"_rect",void 0),v(this,"_selection",void 0),v(this,"_volume",Xr.editor.volume);var i=e.autoplay,n=e.precision,r=e.loop,a=e.fps,o=e.volume,s=e.buffer,u=e.baseUrl,c=e.editType,l=e.readOnly,f=e.dimensions,d=e.mash,p=Ia(f)?Aa(f):xa,y=hr(f)?Cr(f):pr;this._rect=m(m({},p),y),vt(c)&&(this._editType=c),l&&(this.readOnly=!0),this.editing=!this.readOnly,$(i)&&(this.autoplay=i),ne(n)&&(this.precision=n),$(r)&&(this._loop=r),ne(a)&&(this._fps=a),ne(o)&&(this._volume=o),ne(s)&&(this._buffer=s),this.actions=new lr(this),ki()||gi(u),d&&this.load(d)}return f(t,[{key:"addClip",value:function(t,i){var n=this,r=i.clip,a=void 0===r?0:r,o=i.track,s=void 0===o?0:o,u=he(t)?t:[t],c=p(u,1)[0];return c?this.assureMash(t).then((function(){var t=n.mashMedia;Jn(t);var i=t.tracks;le(i.length);var r=oe(s),o=r?i[s]:void 0,l=(null===o||void 0===o?void 0:o.clips)||[],h=null===o||void 0===o?void 0:o.dense,f=m(m({},n.selection.object),{},{clip:c}),d=r?0:u.length,p={clips:u,type:e.ActionType.AddClipToTrack,trackIndex:s,redoSelection:f,createTracks:d};if(h){var v=oe(a)?a:l.length;p.insertIndex=v}else if(d)p.redoFrame=oe(a)?a:0;else{Jr(o);var y=oe(a)?a:o.frames;p.redoFrame=o.frameForClipNearFrame(c,y)}return n.actions.create(p),n.loadMashAndDraw()})):Promise.resolve()}},{key:"addEffect",value:function(t,i){var n=this.selection,r=this.actions,a=n.clip,o=n.mash;Jn(o),Zr(a);var s=a.content;wa(s);var u=s.effects,c=oe(i)?i:u.length,l=d(u);l.splice(c,0,t);var h={objects:u,undoObjects:d(u),redoObjects:l,type:e.ActionType.Move};r.create(h),o.draw()}},{key:"addFiles",value:function(t,i){var n=this,r=(this.eventTarget,this.rect),a=Promise.resolve([]);return tc(t,r).forEach((function(e){a=a.then((function(t){return fa("activity"),e.then((function(e){var i=e.mediaObject;return e.error,Fn(i)?t.push(i):console.log(n.constructor.name,"addFiles NOT media object",i),t}))}))})),a.then((function(t){return n.addMedia(t,i).then((function(t){if(t.length){var i=vi(t.map((function(e){return e.type})));n.eventTarget.emit(e.EventType.Added,{definitionTypes:i})}return t}))}))}},{key:"addMedia",value:function(e,t){var i=this,n=he(e)?e:[e];if(!n.length)return Promise.resolve([]);var r=n.map((function(e){return ke(e),i.media.fromObject(e)}));if(!t)return Promise.resolve(r);var a=r.map((function(e){var t=e.id,i=e.type,n={};return e.isVector?n.containerId=t:n.contentId=t,i===Ve&&(n.containerId=""),Tu(n)}));return this.addClip(a,t).then((function(){return r}))}},{key:"addTrack",value:function(){var t={mash:this.mashMedia};this.actions.create({redoSelection:t,type:e.ActionType.AddTrack,createTracks:1})}},{key:"assureMash",value:function(e){var t=this.selection.mash;if(!Wn(t)){var i={label:(he(e)?e[0]:e).content.definition.label,media:[],id:da()};return this.load(i)}return Promise.resolve()}},{key:"buffer",get:function(){return this._buffer},set:function(e){var t=Number(e);if(this._buffer!==t){this._buffer=t;var i=this.mashMedia;i&&(i.buffer=t)}}},{key:"can",value:function(t){var i=this.selection,n=i.track,r=i.clip,a=i.mash;switch(t){case e.MasherAction.Save:return this.actions.canSave;case e.MasherAction.Undo:return this.actions.canUndo;case e.MasherAction.Redo:return this.actions.canRedo;case e.MasherAction.Remove:return!(!r&&!n);case e.MasherAction.Render:return!this.actions.canSave&&!(null===a||void 0===a||!a.id||pa(a.id))}}},{key:"clearActions",value:function(){this.actions.instances.length&&(this.actions=new lr(this),this.eventTarget.emit(e.EventType.Action))}},{key:"clips",get:function(){var e;return(null===(e=this.mashMedia)||void 0===e?void 0:e.clips)||[]}},{key:"create",value:function(){return this.load({id:da()})}},{key:"currentTime",get:function(){var e=this.mashMedia;return e&&e.drawnTime?e.drawnTime.seconds:0}},{key:"define",value:function(e){var t=this;(Array.isArray(e)?e:[e]).forEach((function(e){var i=e.id;if(e.type,ve(i,"define id"),t.media.installed(i))console.warn(t.constructor.name,"define NOT redefining",i);else{var n=xn(e);t.media.install(n)}}))}},{key:"definitions",get:function(){var e=this,t=this.mashMedia;return t?t.definitionIds.map((function(t){return e.media.fromId(t)})):[]}},{key:"definitionsUnsaved",get:function(){return this.definitions.filter((function(e){var t=e.type,i=e.id;return!!et(t)&&pa(i)}))}},{key:"destroy",value:function(){var e=this.mashMedia;e&&(this.paused=!0,e.destroy(),delete this.mashMedia,this.clearActions(),this.selection.clear(),this.media.undefineAll())}},{key:"duration",get:function(){var e;return(null===(e=this.mashMedia)||void 0===e?void 0:e.duration)||0}},{key:"editType",get:function(){return this._editType||(this._editType=qe)}},{key:"endTime",get:function(){var e=this.mashMedia;return e?e.endTime.scale(this.fps,"floor"):Nr()}},{key:"fps",get:function(){var e;return this._fps||(null===(e=this.mashMedia)||void 0===e?void 0:e.quantize)||Xr.editor.fps},set:function(t){var i=Number(t);this._fps!==i&&(this._fps=i,this.eventTarget.emit(e.EventType.Fps),this.time=this.time.scale(this.fps))}},{key:"frame",get:function(){return this.time.frame},set:function(e){this.goToTime(Nr(Number(e),this.fps))}},{key:"frames",get:function(){return this.endTime.frame}},{key:"gain",get:function(){return this.muted?0:this.volume}},{key:"goToTime",value:function(e){var t,i=this.fps,n=this.time.frame,r=(e?e.scaleToFps(i):Nr(0,i)).frame,a=this.endTime.frame-1,o=a<1?0:Math.min(r,a);return e&&n===o?Promise.resolve():(null===(t=this.mashMedia)||void 0===t?void 0:t.seekToTime(Nr(o,i)))||Promise.resolve()}},{key:"handleAction",value:function(t){var i=this,n=this.mashMedia;be(n);var r=t.selection,a=r.mash;if(Wn(a)&&(a.clearPreview(),t instanceof er)){var o=t.property,s=t.target;"gain"===o&&Yr(s)&&a.composition.adjustClipGain(s,a.quantize)}this.selection.object=r,(n.reload()||Promise.resolve()).then((function(){a||i.handleDraw(),i.eventTarget.emit(e.EventType.Action,{action:t})}))}},{key:"handleDraw",value:function(t){var i,n=this;!this.drawTimeout&&(null===(i=this.mashMedia)||void 0===i?void 0:i.loading)&&(this.drawTimeout=setTimeout((function(){n.eventTarget.dispatch(e.EventType.Draw),delete n.drawTimeout}),10))}},{key:"load",value:function(e){return this.mashMediaObject=e,this.loadMashMediaObject()}},{key:"loadMashMediaObject",value:function(){var e=this,t=this.rect,i=this.mashMediaObject;W(i,"mashMediaObject");var n=i.kind;return br(t)||n===Ve?(delete this.mashMediaObject,this.mashMediaObjectLoadPromise(i).then((function(){return e.goToTime().then((function(){var t=e.mashMedia;Wn(t)&&t.clearPreview(),e.autoplay&&(e.paused=!1)}))}))):Promise.resolve()}},{key:"loadMashAndDraw",value:function(){var e=this.mashMedia;Jn(e);var t={editing:!0,visible:!0};return this.paused||(t.audible=!0),e.loadPromise(t).then((function(){e.draw()}))}},{key:"mashMediaFromObject",value:function(e){var t=this.rect,i=this.buffer,n=this.gain,r=this.loop,a=m(m({},e),{},{mediaCollection:this.media,editor:this,emitter:this.eventTarget,size:Cr(t),buffer:i,gain:n,loop:r});return this.destroy(),this.mashMedia=Zu(e,a)}},{key:"mashMediaObjectLoadPromise",value:function(e){var t=this,i=this.mashMediaFromObject(e);return i.loadPromise({editing:!0,visible:!0}).then((function(){t.selection.set(i),t.handleDraw()}))}},{key:"loop",get:function(){return this._loop},set:function(e){var t=!!e;this._loop=t;var i=this.mashMedia;i&&(i.loop=t)}},{key:"move",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(ke(e,"clip"),Yr(e))this.moveClip(e,t);else{Hr(e);var i=t.clip,n=void 0===i?0:i;this.moveEffect(e,n)}}},{key:"moveClip",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Zr(t);var n=i.clip,r=void 0===n?0:n,a=i.track,o=void 0===a?0:a;se(r);var s=this.mashMedia;Jn(s);var u=s.tracks,c=t.trackNumber,l={clip:t,trackIndex:o,undoTrackIndex:c,type:e.ActionType.MoveClip},h=!oe(o);h&&(l.createTracks=1);var f=oe(c)&&u[c].dense,d=oe(o)&&u[o].dense,p=h?-1:u[o].clips.indexOf(t);if(d&&(l.insertIndex=r),f&&(l.undoInsertIndex=p,r<p&&(l.undoInsertIndex+=1)),!d||!f){var v=t.frame,m=(h?0:u[o].frameForClipNearFrame(t,r))-v;if(!m&&o===c)return;l.undoFrame=v,l.redoFrame=v+m}this.actions.create(l)}},{key:"moveEffect",value:function(t,i){var n=this.selection,r=this.actions,a=n.clip,o=n.mash;Zr(a),Jn(o);var s=a.content;wa(s);var u=s.effects,c=u.indexOf(t),l=oe(i)?i:u.length,h=c<l?l-1:l,f=u.filter((function(e){return e!==t}));f.splice(h,0,t);var p={type:e.ActionType.Move,objects:u,undoObjects:d(u),redoObjects:f};r.create(p),o.draw()}},{key:"moveTrack",value:function(){console.debug(this.constructor.name,"moveTrack coming soon...")}},{key:"muted",get:function(){return this._muted},set:function(e){var t=!!e;if(this._muted!==t){this._muted=t;var i=this.mashMedia;i&&(i.gain=this.gain)}}},{key:"pause",value:function(){this.paused=!0}},{key:"paused",get:function(){var e=this.mashMedia;return!e||e.paused},set:function(e){var t=this.mashMedia;t&&(t.paused=e),e&&this.redraw()}},{key:"play",value:function(){this.paused=!1}},{key:"position",get:function(){var e=0;return this.time.frame&&1!==(e=this.time.seconds/this.duration)&&(e=parseFloat(e.toFixed(this.precision))),e},set:function(e){this.goToTime(qr(this.duration*Number(e),this.fps))}},{key:"positionStep",get:function(){return parseFloat("0.".concat("0".repeat(this.precision-1),"1"))}},{key:"rect",get:function(){return this._rect},set:function(t){var i=this;wr(t),Va(this.rect,t)||(this._rect=t,(this.mashMediaObject?this.loadMashMediaObject():Promise.resolve()).then((function(){var n=i.mashMedia,r=i.rect,a=i.eventTarget;n&&(n.imageSize=Cr(r),a.emit(e.EventType.Resize,{rect:t}),i.redraw())})))}},{key:"redo",value:function(){this.actions.canRedo&&this.handleAction(this.actions.redo())}},{key:"redraw",value:function(){var t=this.mashMedia;t&&(t.clearPreview(),this.eventTarget.dispatch(e.EventType.Draw))}},{key:"removeClip",value:function(t){Jn(this.mashMedia);var i=t.track,n=this.selection,r=(n.clip,{redoSelection:s(n,w),clip:t,track:i,index:i.clips.indexOf(t),type:e.ActionType.RemoveClip});this.actions.create(r)}},{key:"removeEffect",value:function(t){var i=this.selection,n=this.actions,r=i.clip,a=i.mash;Zr(r),Jn(a);var o=r.content;wa(o);var s=o.effects,u={type:e.ActionType.Move,objects:s,undoObjects:d(s),redoObjects:s.filter((function(e){return e!==t}))};n.create(u),a.draw()}},{key:"removeTrack",value:function(e){console.debug(this.constructor.name,"removeTrack coming soon...")}},{key:"saved",value:function(t){var i=this;if(t){var n=this.mashMedia;be(n),Object.entries(t).forEach((function(e){var t=p(e,2),r=t[0],a=t[1];n.id===r?n.id=a:i.media.installed(r)?i.media.updateDefinitionId(r,a):console.warn(i.constructor.name,"saved could not find",r)}))}this.actions.save(),this.eventTarget.emit(e.EventType.Action)}},{key:"selection",get:function(){if(this._selection)return this._selection;var e=ea();return e.editor=this,this._selection=e}},{key:"svgElement",get:function(){return vo()},set:function(e){mo(e)}},{key:"previewItems",value:function(e){var t=this.mashMedia,i=this.rect,n=t?t.color:void 0,r=Cr(i),a=So(r,wo(r,"",n)),o=Promise.resolve([a]);if(!t)return o;var s=e&&this.paused?this:void 0;return o.then((function(e){return t.previewItemsPromise(s).then((function(t){return[].concat(d(e),d(t))}))}))}},{key:"time",get:function(){var e;return(null===(e=this.mashMedia)||void 0===e?void 0:e.time)||Nr(0,this.fps)},set:function(e){this.goToTime(e)}},{key:"timeRange",get:function(){var e;return(null===(e=this.mashMedia)||void 0===e?void 0:e.timeRange)||Or(0,this.fps)}},{key:"undo",value:function(){this.actions.canUndo&&this.handleAction(this.actions.undo())}},{key:"unload",value:function(){this.destroy()}},{key:"updateDefinition",value:function(e,t){var i=e.id,n=(e.type,e.id||t.id);ve(n);var r=t||this.media.fromId(i),a=r.id,o=a!==n;console.log(this.constructor.name,"updateDefinition",o,e),o&&(this.media.updateDefinitionId(r.id,n),console.log(this.constructor.name,"updateDefinition called updateDefinitionId",r.id,n),Object.assign(r,e),Sn(r)&&(delete r.request.response,Ts(r)&&delete r.loadedVideo,zu(r)&&delete r.loadedAudio,$u(r)&&delete r.loadedImage));var s=this.mashMedia;return s&&o?(s.tracks.flatMap((function(e){return e.clips})).forEach((function(e){e.containerId===a&&e.setValue(i,"containerId"),e.contentId===a&&e.setValue(i,"contentId")})),this.loadMashAndDraw()):Promise.resolve()}},{key:"volume",get:function(){return this._volume},set:function(t){var i=Number(t);if(this._volume!==i){se(i),this._volume=i,ce(i)&&(this.muted=!1);var n=this.mashMedia;n&&(n.gain=this.gain),this.eventTarget.emit(e.EventType.Volume)}}}]),t}();e.editorSingleton=void 0;var nc=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return m({autoplay:Xr.editor.autoplay,precision:Xr.editor.precision,loop:Xr.editor.loop,fps:Xr.editor.fps,volume:Xr.editor.volume,buffer:Xr.editor.buffer},e)},rc=function(e){return H(e)&&"changeHandler"in e},ac=function(e){c(i,e);var t=l(i);function i(){return h(this,i),t.apply(this,arguments)}return f(i,[{key:"contentPreviewItemPromise",value:function(e,t,i,n){return console.trace(this.constructor.name,"contentPreviewItemPromise"),Promise.resolve(wo(e,"","currentColor"))}},{key:"mutable",value:function(){return!0}}]),i}(Ru(hu(ks(ao)))),oc=function(e){c(i,e);var t=l(i);function i(){var e;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),v(u(e),"type",Ve),e}return f(i,[{key:"instanceFromObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new ac(this.instanceArgs(e))}},{key:"loadPromise",value:function(e){var t=this,i=e.editing;if(!e.audible)return Promise.resolve();if(this.loadedAudio)return Promise.resolve();var n=(i?this.preferredTranscoding(Ve):this).request;return qs(n).then((function(e){if(Ee(e))return G(e.error);var i=e.data;t.loadedAudio=i}))}}]),i}(Bu(Sa(Zs(iu)))),sc=function(e){return e.id?new oc(e):G(V.MediaId)},uc=function(e){return sc({id:e})},cc=function(e){var t=e.mediaId;return(e.definition||uc(t)).instanceFromObject(e)};Pn[Ve]=sc;var lc=function(t){c(n,t);var i=l(n);function n(){var t;h(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];t=i.call.apply(i,[this].concat(a)),v(u(t),"effects",[]),v(u(t),"hasIntrinsicSizing",!0);var s=a[0];return t.addProperties(s,ua({tweenable:!0,name:"width",type:e.DataType.Percent,group:e.DataGroup.Size,defaultValue:1,max:2})),t.addProperties(s,ua({tweenable:!0,name:"height",type:e.DataType.Percent,group:e.DataGroup.Size,defaultValue:1,max:2})),t}return f(n,[{key:"audibleCommandFiles",value:function(e){throw new Error("Method not implemented.")}},{key:"audibleCommandFilters",value:function(e){throw new Error("Method not implemented.")}},{key:"contentPreviewItemPromise",value:function(e,t,i,n){throw new Error("Method not implemented.")}},{key:"contentRects",value:function(e){throw new Error("Method not implemented.")}},{key:"contentSvgFilter",value:function(e,t,i,n,r){throw new Error("Method not implemented.")}},{key:"contentSvgItemPromise",value:function(e,t,i,n){throw new Error("Method not implemented.")}},{key:"effectsCommandFiles",value:function(e){throw new Error("Method not implemented.")}},{key:"svgItemForPlayerPromise",value:function(e,t,i){throw new Error("Method not implemented.")}},{key:"svgItemForTimelinePromise",value:function(e,t,i){throw new Error("Method not implemented.")}},{key:"canColor",value:function(e){return!this.isDefault&&!this.isTweeningColor(e)}},{key:"containerColorCommandFilters",value:function(e){var t=[],i=this.colorFilter,n=this.isDefault,r=e.contentColors,a=e.containerRects,o=e.videoRate,s=e.duration;ye(r,"contentColors");var u=p(a,2),c=u[0],l=u[1],h=p(r,2),f=h[0],v=h[1],m=n?c:Ua.apply(void 0,d(a)),y={videoRate:o,duration:s};i.setValue(f||Qi,"color"),i.setValue(v,"color".concat(gn)),i.setValue(m.width,"width"),i.setValue(m.height,"height");var g=n;return i.setValue(g?l.width:void 0,"width".concat(gn)),i.setValue(g?l.height:void 0,"height".concat(gn)),t.push.apply(t,d(i.commandFilters(y))),t}},{key:"containerCommandFilters",value:function(e,t){var i=[],r=e.contentColors,u=e.commandFiles,c=e.filterInput,l=me(r);if(this.requiresAlpha(e,!!t.size)){ve(c,"container input"),e.contentColors;var h=s(e,F),f=m(m({},h),{},{filterInput:c});i.push.apply(i,d(a(o(n.prototype),"containerCommandFilters",this).call(this,f,t)))}else if(this.isDefault||l){var p=this.id;c||(c=ro(u,p,!0)),ve(c,"final input"),i.push.apply(i,d(this.containerFinalCommandFilters(m(m({},e),{},{filterInput:c}))))}return i}},{key:"initialCommandFilters",value:function(e,t){var i=[],n=(e.contentColors,s(e,S)),r=n.commandFiles,a=n.track,o=n.filterInput,u=n.containerRects,c=n.videoRate,l=o,h=this.requiresAlpha(e,!!t.size),f=this.isDefault,p=t.size?Ua.apply(void 0,d(u)):u[0],v=mr(p),y="content-".concat(a),g="container-".concat(a);if(!t.canColor&&pe(l)&&!f)if(h){var k="format",T=fa(k),b={inputs:[l],ffmpegFilter:k,options:{pix_fmts:"yuv420p"},outputs:[T]};i.push(b),l=T}else if(!dr(v,p)){var w=m(m({},e),{},{contentColors:[nn,nn],outputSize:v});i.push.apply(i,d(this.colorBackCommandFilters(w,"".concat(y,"-back"))));var F=di(di(i).outputs);ve(l,"overlay input"),i.push.apply(i,d(this.overlayCommandFilters(F,l))),l=di(di(i).outputs)}if(i.length?di(i).outputs=[y]:pe(l)&&y!==l&&i.push(this.copyCommandFilter(l,a)),h){var I=this.id,C=ro(r,I,!0);ve(C,"scale input");var P=m(m({},e),{},{contentColors:[nn,nn],outputSize:p});i.push.apply(i,d(this.colorBackCommandFilters(P,"".concat(g,"-back"))));var x=di(di(i).outputs);i.push.apply(i,d(this.scaleCommandFilters(m(m({},e),{},{filterInput:C})))),ve(l=di(di(i).outputs),"overlay input"),i.push.apply(i,d(this.overlayCommandFilters(x,l)));var A={duration:0,videoRate:c};ve(l=di(di(i).outputs),"crop input");var M=this.cropFilter;M.setValue(p.width,"width"),M.setValue(p.height,"height"),M.setValue(0,"x"),M.setValue(0,"y"),i.push.apply(i,d(M.commandFilters(m(m({},A),{},{filterInput:l})))),ve(l=di(di(i).outputs),"format input");var D={inputs:[l],ffmpegFilter:"format",options:{pix_fmts:h?"yuv420p":"yuva420p"},outputs:[g]};i.push(D)}return i}},{key:"intrinsicRect",value:function(){var e=this.definition,t=e.pathHeight,i=e.pathWidth;return m({width:i,height:t},xa)}},{key:"intrinsicsKnown",value:function(e){return!0}},{key:"isTweeningColor",value:function(e){var t=e.contentColors;if(!me(t))return!1;var i=p(t,2);return i[0]!==i[1]}},{key:"isTweeningSize",value:function(e){var t=e.containerRects;return!!me(t)&&!Va.apply(void 0,d(t))}},{key:"loadPromise",value:function(e){return Promise.resolve()}},{key:"pathElement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=this.definition,n=this.intrinsicRect(!0);if(!br(n))return wo(e,"",t);var r=i.path,a=Po(r,"");return No(a,n,e),a}},{key:"requiresAlpha",value:function(e,t){var i=e.contentColors,n=me(i);return this.isDefault?!n&&($(t)?t:this.isTweeningSize(e)):!n||this.isTweeningColor(e)}},{key:"visibleCommandFiles",value:function(t){var i=this.isDefault,n=this.id,r=this.requiresAlpha(t),a=this.isTweeningColor(t);if(i&&!r)return[];var o=this.definition,s=o.path,u=t.contentColors,c=void 0===u?[]:u,l=t.containerRects,h=t.time,f=t.videoRate;ye(l,"containerRects");var d=Ie(h)?h.lengthSeconds:0,v=p(l,2),y=v[0],g=v[1],k=m(m({},xa),Ua(y,g)),T=k.width,b=k.height,w=p(c,1)[0];r?w=Qi:a&&(w=$i);var F="none";i?F=Qi:r&&(F=$i);var S=i?k:this.intrinsicRect(),I=S.width,C=S.height,P='width="'.concat(I,'" height="').concat(C,'"'),x=jo(S,k),A=[];A.push('<svg viewBox="0 0 '.concat(T," ").concat(b,'" xmlns="').concat(li,'">')),A.push("<g ".concat(P,' transform="').concat(x,'" >')),A.push("<rect ".concat(P,' fill="').concat(F,'"/>')),i||A.push('<path d="'.concat(s,'" fill="').concat(w,'"/>')),A.push("</g>"),A.push("</svg>");var M=A.join(""),D={};return d&&(D.loop=1,D.framerate=f,D.t=d),[{type:e.GraphFileType.Svg,file:n,content:M,input:!0,inputId:n,definition:o,options:D}]}}]),n}(Xs(ks(ao))),hc=function(e){c(i,e);var t=l(i);function i(){var e;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var o=r[0];e=t.call(this,o),v(u(e),"isVector",!0),v(u(e),"path",""),v(u(e),"pathHeight",0),v(u(e),"pathWidth",0),v(u(e),"type",_e);var s=o.path,c=o.pathHeight,l=o.pathWidth;return s&&(e.path=s),ce(l)&&(e.pathWidth=l),ce(c)&&(e.pathHeight=c),e}return f(i,[{key:"definitionIcon",value:function(e){var t=this.id,i=this.pathHeight,n=this.pathWidth,r=this.path;if(t===va)return Promise.resolve(So(e,wo(e,"","currentColor")));var a={width:n,height:i};if(br(a)&&pe(r)){var o=Tr(a,e,!0),s=m(m({},o),_a(e,o)),u=Po(r);return No(u,a,s),Promise.resolve(So(e,u))}}},{key:"instanceFromObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new lc(this.instanceArgs(e))}},{key:"toJSON",value:function(){var e=a(o(i.prototype),"toJSON",this).call(this);return this.path&&(e.path=this.path),ce(this.pathHeight)&&(e.pathHeight=this.pathHeight),ce(this.pathWidth)&&(e.pathWidth=this.pathWidth),e}}]),i}(nu(Zs(iu))),fc=function(e,t,i){if(!pe(e)||!ce(i))return Ra;var n=globalThis.document.createElement("canvas").getContext("2d");W(n,"ctx"),n.font="".concat(i,"px ").concat(t);var r=n.measureText(e),a=r.actualBoundingBoxAscent,o=r.actualBoundingBoxDescent,s=r.actualBoundingBoxLeft;return{x:s,y:a,width:s+r.actualBoundingBoxRight,height:a+o}},dc=1e3,pc=function(t){c(n,t);var i=l(n);function n(){var e;h(this,n);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var o=r[0];o.lock||(o.lock=""),e=i.call.apply(i,[this].concat(r)),v(u(e),"_colorFilter",void 0),v(u(e),"hasIntrinsicSizing",!0),v(u(e),"_intrinsicRect",void 0),v(u(e),"_textFilter",void 0),u(e);var s=o.intrinsic;return za(s)&&(e._intrinsicRect=s),e}return f(n,[{key:"canColor",value:function(e){return!0}},{key:"canColorTween",value:function(e){return!0}},{key:"colorFilter",get:function(){return this._colorFilter||(this._colorFilter=gs("color"))}},{key:"initialCommandFilters",value:function(t,i){var n,r=this,a=[],o=t.contentColors,s=void 0===o?[]:o,u=t.outputSize,c=t.track,l=t.filterInput,h=t.containerRects,f=t.videoRate,y=t.commandFiles,g=t.duration,k=l;k&&a.push(this.copyCommandFilter(k,c));var T=p(h,2),b=T[0],w=T[1],F=b.height,S=b.width,I=Ua.apply(void 0,d(h)),C="",P=!!k||i.size;if(P){var x=k?$i:tn,A=m(m({},t),{},{contentColors:[x,x],outputSize:I});a.push.apply(a,d(this.colorBackCommandFilters(A))),C=di(di(a).outputs)}var M=y.find((function(t){return t.inputId===r.id&&t.type===e.GraphFileType.Txt}));be(M,"text file");var D=M.resolved;ve(D,"textfile");var z=y.find((function(e){return e.inputId===r.id&&e.type===Oe}));be(z,"font file");var E=z.resolved;ve(E,"fontfile");var V=this.textFilter,R=this.lock,O=this.intrinsicRect(),_=O.x*(b.width/O.width),j=p(s,2),N=j[0],q=void 0===N?Qi:N,B=j[1];ve(q);var U=O.x*(w.width/O.width),L=dc/O.height,G=Math.round(F*L),H=Math.round(w.height*L),W=(n={x:_,y:0,width:S,height:G,color:q,textfile:D,fontfile:E,stretch:!Vt(R),intrinsicHeight:O.height,intrinsicWidth:O.width},v(n,"x".concat(gn),U),v(n,"y".concat(gn),0),v(n,"color".concat(gn),B),v(n,"height".concat(gn),H),v(n,"width".concat(gn),w.width),n);V.setValues(W);var J={dimensions:u,videoRate:f,duration:g,filterInput:k};if(a.push.apply(a,d(V.commandFilters(J))),P){ve(k=di(di(a).outputs),"overlay filterInput"),a.push.apply(a,d(this.overlayCommandFilters(C,k))),ve(k=di(di(a).outputs),"crop filterInput");var K={duration:0,videoRate:f,filterInput:k},X=this.cropFilter;X.setValue(I.width,"width"),X.setValue(I.height,"height"),X.setValue(0,"x"),X.setValue(0,"y"),a.push.apply(a,d(X.commandFilters(K)))}return a}},{key:"intrinsicRect",value:function(){return this._intrinsicRect||(this._intrinsicRect=this.intrinsicRectInitialize())}},{key:"intrinsicRectInitialize",value:function(){var e=this.definition.family;ve(e);var t=this.string,i=m({width:0,height:1e3},xa);return t?fc(t,e,1e3):i}},{key:"intrinsicsKnown",value:function(e){return!(e.size&&!za(this._intrinsicRect)&&!this.definition.family)}},{key:"loadPromise",value:function(e){return this.definition.loadPromise(e)}},{key:"pathElement",value:function(e){var t=this.string,i=this.definition.family,n=jo(this.intrinsicRect(!0),e);return Uo(t,i,dc,n)}},{key:"setValue",value:function(e,t,i){a(o(n.prototype),"setValue",this).call(this,e,t,i),i||"string"!==t||delete this._intrinsicRect}},{key:"textFilter",get:function(){return this._textFilter||(this._textFilter=gs("text"))}},{key:"toJSON",value:function(){var e=a(o(n.prototype),"toJSON",this).call(this);return e.intrinsic=this.intrinsicRect(!0),e}},{key:"visibleCommandFiles",value:function(t){var i=a(o(n.prototype),"visibleCommandFiles",this).call(this,t),r=this.string,s={definition:this.definition,type:e.GraphFileType.Txt,file:this.id,inputId:this.id,content:r};return i.push(s),i}}]),n}(Xs(ks(ao))),vc=function(t){c(n,t);var i=l(n);function n(t){var r;h(this,n),r=i.call(this,t),v(u(r),"_family",""),v(u(r),"_intrinsicRect",void 0),v(u(r),"isVector",!0),v(u(r),"loadedFont",void 0),v(u(r),"string",""),v(u(r),"type",Oe);var a=t.string,o=t.label;return r.string=a||o||Xr.font.string,r.properties.push(ua({name:"string",custom:!0,type:e.DataType.String,defaultValue:r.string})),r.properties.push(ua({name:"height",tweenable:!0,custom:!0,type:e.DataType.Percent,defaultValue:.3,max:2,group:e.DataGroup.Size})),r.properties.push(ua({name:"width",tweenable:!0,custom:!0,type:e.DataType.Percent,defaultValue:.8,max:2,group:e.DataGroup.Size})),r}return f(n,[{key:"definitionIcon",value:function(e){var t=this;return this.loadFontPromise(this.preferredTranscoding(Oe)).then((function(){var i=t.string,n=t.family;ve(n),ve(i);var r=t.intrinsicRect,a=Tr(r,e,!0),o=m(m({},a),_a(e,a)),s=jo(r,o),u=Uo(t.string,n,1e3,s);return Promise.resolve(So(e,u))}))}},{key:"family",get:function(){if(!this._family){var e=this.loadedFont;if(qn(e)){var t=e.family;pe(t)&&(this._family=t)}}return this._family},set:function(e){this._family=e}},{key:"graphFiles",value:function(e){if(!e.visible)return[];var t=this.request.endpoint;Ai(t);var i=Mi(t);return[{type:Oe,file:i,definition:this}]}},{key:"instanceArgs",value:function(t){var i=t||{};return X(i.lock)&&(i.lock=e.Orientation.V),a(o(n.prototype),"instanceArgs",this).call(this,i)}},{key:"instanceFromObject",value:function(e){return new pc(this.instanceArgs(e))}},{key:"intrinsicRect",get:function(){return this._intrinsicRect||(this._intrinsicRect=this.intrinsicRectInitialize())}},{key:"intrinsicRectInitialize",value:function(){var e=m({width:0,height:1e3},xa),t=this.family,i=this.string;if(!pe(t)||!pe(i))return e;var n=fc(i,t,1e3);return console.log(this.constructor.name,"intrinsicRectInitialize",n),n}},{key:"loadFontPromise",value:function(e){var t=this;if(this.loadedFont)return Promise.resolve(this.loadedFont);var i=e.request;return Bs(i).then((function(e){if(Ee(e))return G(e.error);var i=e.data;return t.family=i.family,t.loadedFont=i,i}))}},{key:"loadPromise",value:function(e){if(this.family)return Promise.resolve();var t=(e.editing?this.findTranscoding(Oe,"woff","woff2"):void 0)||this;return this.loadFontPromise(t).then(ci)}},{key:"toJSON",value:function(){var e=this.string;return m(m({},a(o(n.prototype),"toJSON",this).call(this)),{},{string:e})}}]),n}(nu(Zs(iu))),mc={label:"Butcherman",id:"com.moviemasher.font.butcherman",type:"font",request:{endpoint:{protocol:"https:",hostname:"fonts.googleapis.com",pathname:"/css2",search:"?family=Butcherman"}}},yc={label:"Croissant One",id:"com.moviemasher.font.croissant-one",type:"font",request:{endpoint:{protocol:"https:",hostname:"fonts.googleapis.com",pathname:"/css2",search:"?family=Croissant+One"}}},gc={label:"Germania One",id:"com.moviemasher.font.germania-one",type:"font",request:{endpoint:{protocol:"https:",hostname:"fonts.googleapis.com",pathname:"/css2",search:"?family=Germania+One"}}},kc={label:"Kenia",id:"com.moviemasher.font.kenia",type:"font",request:{endpoint:{protocol:"https:",hostname:"fonts.googleapis.com",pathname:"/css2",search:"?family=Kenia"}}},Tc={label:"Luckiest Guy",id:"com.moviemasher.font.luckiest-guy",type:"font",request:{endpoint:{protocol:"https:",hostname:"fonts.googleapis.com",pathname:"/css2",search:"?family=Luckiest+Guy"}}},bc={label:"Monoton",id:"com.moviemasher.font.monoton",type:"font",request:{endpoint:{protocol:"https:",hostname:"fonts.googleapis.com",pathname:"/css2",search:"?family=Monoton"}}},wc={label:"Oleo Script",id:"com.moviemasher.font.oleo-script",type:"font",request:{endpoint:{protocol:"https:",hostname:"fonts.googleapis.com",pathname:"/css2",search:"?family=Oleo+Script"}}},Fc={label:"Shojumaru",id:"com.moviemasher.font.shojumaru",type:"font",request:{endpoint:{protocol:"https:",hostname:"fonts.googleapis.com",pathname:"/css2",search:"?family=Shojumaru"}}},Sc={label:"Rubik+Dirt",id:"com.moviemasher.font.rubik-dirt",type:"font",request:{endpoint:{protocol:"https:",hostname:"fonts.googleapis.com",pathname:"/css2",search:"?family=Rubik+Dirt"}}},Ic=function(e){var t=An[Oe].find((function(t){return t.id===e}));if(t)return t},Cc=function(e){var t=e.id,i=void 0===t?Iu:t,n=Ic(i);if(n)return n;var r=m(m({},e),{},{type:Oe,id:i});return new vc(r)},Pc=Cc(m({id:Iu},{label:"League Spartan",type:"font",request:{endpoint:{protocol:"https:",hostname:"fonts.googleapis.com",pathname:"/css2",search:"?family=League+Spartan"}}}));Pn[Oe]=Cc,An[Oe].push(Pc,Cc(mc),Cc(yc),Cc(kc),Cc(gc),Cc(Tc),Cc(bc),Cc(wc),Cc(Fc),Cc(Sc));var xc=function(e){c(i,e);var t=l(i);function i(){return h(this,i),t.apply(this,arguments)}return f(i,[{key:"visibleCommandFiles",value:function(e){var t=[],i=e.visible,n=e.time,r=e.videoRate;if(!i)return t;var a=this.graphFiles(e),o=p(a,1)[0],s=Ie(n)?n.lengthSeconds:0,u={loop:1,framerate:r};s&&(u.t=s);var c=this.id,l=m(m({},o),{},{inputId:c,options:u});return t.push(l),t.push.apply(t,d(this.effectsCommandFiles(e))),t}},{key:"graphFiles",value:function(e){var t=e.visible,i=(e.editing,[]);if(!t)return i;var n=this.definition,r=n.request,a=Mi(r.endpoint);a||console.log(this.constructor.name,"graphFiles",r),ve(a);var o={input:!0,type:_e,file:a,definition:n};return i.push(o),i}},{key:"svgItemForTimelinePromise",value:function(e,t,i){var n=this.definition.preferredTranscoding(_e).request;return Us(n).then((function(t){if(Ee(t))return G(t.error);var i=t.data.src,n=m({},e);return Lo(i,n)}))}}]),i}(Hu(hu(Xs(ks(ao))))),Ac=function(e){c(i,e);var t=l(i);function i(){var e;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),v(u(e),"loadedImage",void 0),v(u(e),"type",_e),e}return f(i,[{key:"definitionIcon",value:function(e){var t=this.preferredTranscoding(_e);return Us(t.request).then((function(t){if(Ee(t))return G(t.error);var i=t.data;wr(i);var n=i.width,r=i.height,a=i.src,o=Tr({width:n,height:r},e,!0),s=m({},m(m({},o),_a(e,o)));return Lo(a,s).then((function(t){return So(e,t)}))}))}},{key:"instanceFromObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new xc(this.instanceArgs(e))}},{key:"loadPromise",value:function(e){var t=this,i=e.editing;if(!e.visible)return Promise.resolve();if(this.loadedImage)return Promise.resolve();var n=(i?this.preferredTranscoding(_e):this).request;return Us(n).then((function(e){if(Ee(e))return G(e.error);var i=e.data;t.loadedImage=i}))}}]),i}(Wu(Sa(nu(Zs(iu))))),Mc={label:"Color",type:"image",request:{response:{color:"#FFFFFF"}}},Dc={label:"Rectangle",type:"image",request:{response:{}}},zc=function(e){return ve(e.id,"imageDefinition id"),new Ac(e)},Ec=function(e){return An[_e].find((function(t){return t.id===e}))||zc({id:e})},Vc=function(e){var t=e.mediaId;return(e.definition||Ec(t)).instanceFromObject(e)};Pn[_e]=zc,An[_e].push(new pu(m({id:Ta},Mc)),new hc(m({id:va},Dc)));var Rc=function(e){c(i,e);var t=l(i);function i(){var e;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),v(u(e),"speed",1),e}return f(i,[{key:"visibleCommandFiles",value:function(e){var t=a(o(i.prototype),"visibleCommandFiles",this).call(this,e),n=e.streaming;return e.visible&&n?(t.forEach((function(e){var t=e.options,i=void 0===t?{}:t;i.loop=1,i.re="",e.options=i})),t):t}},{key:"graphFiles",value:function(e){var t=e.time,n=e.clipTime,r=e.editing,s=e.visible,u=this.definitionTime(t,n),c=m(m({},e),{},{time:u}),l=a(o(i.prototype),"graphFiles",this).call(this,c);if(s){var h=this.definition;if(r){var f=h.framesArray(u).map((function(e){return{type:_e,file:"",input:!0,definition:h}}));f.push.apply(f,d(f))}else{var p={type:qe,file:"",definition:h,input:!0};l.push(p)}}return l}},{key:"toJSON",value:function(){var e=a(o(i.prototype),"toJSON",this).call(this);return 1!==this.speed&&(e.speed=this.speed),e}}]),i}(Ru(Hu(hu(Xs(ks(ao)))))),Oc=function(e){c(i,e);var t=l(i);function i(){var e;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var o=r[0];e=t.call(this,o),v(u(e),"begin",Xr.definition.videosequence.begin),v(u(e),"fps",Xr.definition.videosequence.fps),v(u(e),"increment",Xr.definition.videosequence.increment),v(u(e),"padding",void 0),v(u(e),"pattern","%.jpg"),v(u(e),"type",Ne);var s=o.padding,c=o.begin,l=o.fps,f=o.increment,d=o.pattern;if(oe(c)&&(e.begin=c),l&&(e.fps=l),f&&(e.increment=f),d&&(e.pattern=d),s)e.padding=s;else{var p=e.begin+(e.increment*e.framesMax-e.begin);e.padding=String(p).length}return e}return f(i,[{key:"framesArray",value:function(e){var t=this.duration,i=this.fps;return e.durationFrames(t,i)}},{key:"framesMax",get:function(){var e=this.fps,t=this.duration;return Math.floor(e*t)-2}},{key:"instanceFromObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Rc(this.instanceArgs(e))}},{key:"toJSON",value:function(){var e=a(o(i.prototype),"toJSON",this).call(this),t=Xr.definition.videosequence,n=this.pattern,r=this.increment,s=this.begin,u=this.fps,c=this.padding;return n!==t.pattern&&(e.pattern=n),r!==t.increment&&(e.increment=r),s!==t.begin&&(e.begin=s),u!==t.fps&&(e.fps=u),c!==t.padding&&(e.padding=c),e}}]),i}(Bu(Wu(Sa(Zs(iu))))),_c=function(e){return ve(e.id),new Oc(e)},jc=function(e){return _c({id:e})},Nc=function(e){var t=e.mediaId;return(e.definition||jc(t)).instanceFromObject(e)};Pn[Ne]=_c;var qc=function(e){c(i,e);var t=l(i);function i(){var e;h(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),v(u(e),"_foreignElement",void 0),v(u(e),"loadedVideo",void 0),e}return f(i,[{key:"foreignElement",get:function(){var e=this._foreignElement;if(e)return e;var t=globalThis.document.createElementNS(li,"foreignObject");return this._foreignElement=t}},{key:"graphFiles",value:function(e){var t=[],i=e.audible,n=e.visible,r=e.icon,a=this.definition,o=a.request,s=Mi(o.endpoint);if(ve(s),n&&!r){var u={input:!0,type:qe,file:s,definition:a};t.push(u)}if(i&&(!a.duration||this.mutable())&&!this.muted){var c={input:!0,type:Ve,definition:a,file:""};t.push(c)}return t}},{key:"loadPromise",value:function(e){console.log(this.constructor.name,"loadPromise",e);var t=[],i=this.definition,n=i.audio,r=e.visible,a=e.audible;if(n&&a&&t.push(i.preloadAudioPromise),r){var o=i.preferredTranscoding(Ne,qe);if(ji(o)){var s=n&&a&&i.preferredTranscoding(Ve,qe);if(o!==s){var u=o.type,c=o.request;console.log(this.constructor.name,"loadPromise visibleTranscoding",o),u===qe?t.push(Hs(c).then((function(e){if(Ee(e))return G(e.error)}))):t.push(this.sequenceImagesPromise(e))}else console.log(this.constructor.name,"loadPromise",o,"===",s)}else console.log(this.constructor.name,"loadPromise NOT isTranscoding",o)}return Promise.all(t).then(ci)}},{key:"previewVideoPromise",value:function(e){var t=this,i=this.loadedVideo;if(i)return Promise.resolve(i);var n=e.request;return Hs(n).then((function(e){if(Ee(e))return G(e.error);var i=e.data.cloneNode();return t.loadedVideo=i,t.foreignElement.appendChild(i),i}))}},{key:"sequenceImagesPromise",value:function(e){var t=this,i=e.time,n=e.clipTime,r=[];if(i.isRange){Ce(i);var a=i.times.map((function(e){return t.definitionTime(e,n)})),o=p(a,2),s=o[0],u=o[1],c=jr(s,u);r.push.apply(r,d(c.frameTimes))}else r.push(this.definitionTime(i,n));var l=r.map((function(e){return t.definition.loadedImagePromise(e)}));return Promise.all(l).then(ci)}},{key:"sequenceItemPromise",value:function(e,t){return this.definition.loadedImagePromise(t).then((function(t){var i=t.src,n=Tr(Cr(t),Cr(e));return Lo(i,n)}))}},{key:"serverPromise",value:function(e){console.log(this.constructor.name,"serverPromise",e);var t=this.definition.audio;return e.visible||t?this.definition.serverPromise(e):Promise.resolve()}},{key:"svgItemForPlayerPromise",value:function(e,t,i){var n=this.loadedVideo,r=this.definitionTime(t,i);if(n)return Promise.resolve(this.videoForPlayerPromise(e,r));var a=this.definition.previewTranscoding;switch(a.type){case qe:return this.videoItemForPlayerPromise(a,e,r);case Ne:return this.sequenceItemPromise(e,r)}return G(V.Type)}},{key:"svgItemForTimelinePromise",value:function(e,t,i){var n=this.definitionTime(t,i);return this.sequenceItemPromise(e,n)}},{key:"unload",value:function(){delete this._foreignElement,delete this.loadedVideo}},{key:"videoForPlayerPromise",value:function(e,t){var n=this.loadedVideo;Vn(n);var r=i.clientCanMaskVideo;r&&To(this.foreignElement,e),n.currentTime=t.seconds;var a=e.width,o=e.height;return n.width=a,n.height=o,r?this.foreignElement:n}},{key:"videoItemForPlayerPromise",value:function(e,t,i){var n=this;return console.log(this.constructor.name,"videoItemForPlayerPromise",i,e),this.previewVideoPromise(e).then((function(){return n.videoForPlayerPromise(t,i)}))}}],[{key:"clientCanMaskVideo",get:function(){var e=this._clientCanMaskVideo;if($(e))return e;var t=globalThis.navigator.userAgent,i=t.includes("Safari")&&!t.includes("Chrome");return this._clientCanMaskVideo=!i}}]),i}(Ru(Hu(hu(Xs(ks(ao))))));v(qc,"_clientCanMaskVideo",void 0);var Bc=new Map,Uc=function(e,t){console.log("videoImagePromise",e.currentTime);var i=Cr(e),n=br(t)?Tr(i,t):i,r=n.width,a=n.height,o=Lc(n),s=p(o,2),u=s[0];s[1].drawImage(e,0,0,r,a);var c=new Image;return c.src=u.toDataURL(),c.decode().then((function(){return c}))},Lc=function(e){var t=globalThis.document.createElement("canvas"),i=e.width,n=e.height;t.height=n,t.width=i;var r=t.getContext("2d");return be(r),[t,r]},Gc=function(e,t,i){console.log("imageFromVideoPromise",t);var n=new Promise((function(n){if(!function(e,t){var i=t.currentTime;return!i&&!e.frame||!qr(i,e.fps).equalsTime(e)}(t,e))return console.log("imageFromVideoPromise !seekNeeded",t),Bc.delete(e),Uc(e,i);console.log("imageFromVideoPromise seekNeeded",t),e.onseeked=function(){console.log("imageFromVideoPromise onseeked",t),e.onseeked=null,Uc(e,i).then((function(i){console.log("imageFromVideoPromise resolving after videoImagePromise",t),Bc.delete(e),n(i)}))},function(e,t){t.currentTime=e.seconds}(t,e)})),r=Bc.get(e);return Bc.set(e,n),r?(console.log("imageFromVideoPromise replacing promise",t),r.then((function(){return n}))):(console.log("imageFromVideoPromise setting promise",t),n)},Hc=function(e){c(i,e);var t=l(i);function i(e){var n;h(this,i),n=t.call(this,e),v(u(n),"loadedImages",new Map),v(u(n),"loadedVideo",void 0),v(u(n),"pattern","%.jpg"),v(u(n),"type",qe);var r=e.loadedVideo;return r&&(n.loadedVideo=r),n}return f(i,[{key:"definitionIcon",value:function(e){var t=this.previewTranscoding,i=Nr(1);return this.imageFromTranscodingPromise(t,i).then((function(t){wr(t);var i=t.width,n=t.height,r=t.src,a=Tr({width:i,height:n},e,!0),o=m({},m(m({},a),_a(e,a)));return Lo(r,o).then((function(t){return So(e,t)}))}))}},{key:"loadedImage",value:function(e,t){return this.loadedImages.get(this.loadedImageKey(e,t))}},{key:"loadedImageKey",value:function(e,t){var i=e.frame,n=e.fps,r="".concat(i,"@").concat(n);return br(t)?"".concat(r,"-").concat(xr(t)):r}},{key:"imageFromSequencePromise",value:function(e,t,i){throw new Error}},{key:"imageFromTranscodingPromise",value:function(e,t,i){var n=e.type,r=e.request;switch(n){case _e:return Us(r).then((function(e){return Ee(e)?G(e.error):e.data}));case qe:return this.imageFromVideoTranscodingPromise(e,t,i);case Ne:return this.imageFromSequencePromise(e,t,i)}return G(V.Internal)}},{key:"imageFromVideoTranscodingPromise",value:function(e,t,i){var n=this;console.log(this.constructor.name,"imageFromVideoTranscodingPromise",t);var r=this.loadedImage(t,i);return r?Promise.resolve(r):Hs(e.request).then((function(e){if(Ee(e))return G(e.error);var r=e.data,a=n.loadedImageKey(t,i);return Gc(r,t,i).then((function(e){return n.loadedImages.set(a,e),e}))}))}},{key:"instanceFromObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new qc(this.instanceArgs(e))}},{key:"loadedImagePromise",value:function(e,t){console.log(this.constructor.name,"loadedImagePromise",e);var i=this.previewTranscoding;return this.imageFromTranscodingPromise(i,e,t)}},{key:"iconTranscoding",get:function(){return this.preferredTranscoding(_e,Ne,qe)}},{key:"previewTranscoding",get:function(){return this.preferredTranscoding(Ne,qe)}}]),i}(Bu(Wu(Sa(nu(Zs(iu)))))),Wc=function(e){return ve(e.id),new Hc(e)},Jc=function(e){return Wc({id:e})},Kc=function(e){var t=e.mediaId;return(e.definition||Jc(t)).instanceFromObject(e)};Pn[qe]=Wc;var Xc=function(e){return si(e)&&"type"in e&&ju(e.type)},Yc="alpha",Zc="audible",$c="duration",Qc="size",el=[Yc,Zc,$c,Qc],tl=function(e){return H(e)&&"types"in e&&he(e.types)},il=function(e){return Xc(e)&&"options"in e&&tl(e.options)},nl={},rl=function(e){if(e)return nl[e]};e.Action=Kn,e.ActionFactory=cr,e.Actions=lr,e.AddClipToTrackAction=$n,e.AddTrackAction=Zn,e.AlphaProbe=Yc,e.AlphamergeFilter=fs,e.Anchors=qt,e.ApiVersion="5.1.2",e.AudibleContext=Ln,e.AudibleContextInstance=Gn,e.AudibleProbe=Zc,e.AudioClass=ac,e.AudioMediaClass=oc,e.AudioPreviewClass=Ju,e.AudioStreamType="audiostream",e.AudioType=Ve,e.BlobProtocol="blob",e.ChangeAction=er,e.ChangeFramesAction=ir,e.ChangeMultipleAction=ar,e.ChromaKeyFilter=Go,e.ClassButton="button",e.ClassCollapsed="collapsed",e.ClassDisabled="disabled",e.ClassDropping="dropping",e.ClassDroppingAfter="dropping-after",e.ClassDroppingBefore="dropping-before",e.ClassItem="item",e.ClassSelected="selected",e.Clickings=ii,e.ClipClass=ku,e.ClipSelectTypes=kt,e.ColorChannelMixerFilter=Ko,e.ColorContentClass=du,e.ColorContentDefinitionClass=pu,e.ColorFilter=Wo,e.ColorizeFilter=Ho,e.ContainerDefinitionMixin=nu,e.ContainerMixin=Xs,e.ContainerTypes=lt,e.ContentDefinitionMixin=Sa,e.ContentMixin=hu,e.ContentTypes=ft,e.ContextFactory=Hn,e.ConvolutionFilter=Xo,e.CookedTypes=Ye,e.CropFilter=as,e.CssContentType="text/css",e.CssExtension="css",e.DataGroups=ra,e.DataTypes=At,e.DecodeType=Fs,e.DecodingClass=eu,e.DecodingTypes=_u,e.Default=Xr,e.DefaultContainerId=va,e.DefaultContentId=Ta,e.DefaultFontId=Iu,e.Directions=Ot,e.DurationProbe=$c,e.EditTypes=pt,e.EditorClass=ic,e.EditorSelectionClass=Qr,e.EffectClass=Ys,e.EffectMediaClass=ru,e.EffectType=Re,e.Emitter=Mr,e.EmptyMethod=ci,e.EncodeType=Ss,e.EncodingClass=xu,e.EncodingTypes=wt,e.Endpoints=oi,e.ErrorName=V,e.ErrorNames=R,e.EventTypes=Jt,e.ExtJpeg="jpg",e.FileProtocol="file",e.FillTypes=St,e.FilterClass=ho,e.FilterDefinitionClass=fo,e.FilterIdPrefix=vs,e.FilterType=xs,e.Filters=so,e.FontClass=pc,e.FontMediaClass=vc,e.FontType=Oe,e.FpsFilter=ls,e.GraphFileTypes=Ct,e.HttpProtocol="http",e.HttpsProtocol="https",e.IdPrefix=hi,e.IdSuffix=fi,e.ImageClass=xc,e.ImageMediaClass=Ac,e.ImageType=_e,e.JsonExtension="json",e.JsonType=Be,e.LanguageEnglish="en",e.LanguageType=Ps,e.LoadTypes=Qe,e.MashMediaClass=Xu,e.MashType=je,e.MediaBase=iu,e.MediaCollection=Dn,e.MediaDefaults=An,e.MediaFactories=Pn,e.MediaInstanceBase=ao,e.MediaTypes=Ge,e.MoveAction=or,e.MoveClipAction=nr,e.Mp4Extension="mp4",e.NamespaceLink="http://www.w3.org/1999/xlink",e.NamespaceSvg=li,e.NamespaceXhtml="http://www.w3.org/1999/xhtml",e.NonePreview=Su,e.OpacityFilter=us,e.OrderAscending="acending",e.OrderDecending="decending",e.Orientations=Et,e.OverlayFilter=os,e.Parameter=oo,e.Plugins=Ms,e.PngExtension="png",e.PointZero=xa,e.PreviewClass=gu,e.ProbeKinds=el,e.ProbeType=Ou,e.PropertiedClass=kn,e.PropertyTweenSuffix=gn,e.PropertyTypesNumeric=dn,e.ProtocolType=Cs,e.RawTypes=Ze,e.RecordType=Ue,e.RecordsType=Le,e.RectZero=Ra,e.RemoveClipAction=rr,e.RequestableClass=Tn,e.ResolveType=As,e.Resolvers=nl,e.ScaleFilter=ss,e.SelectTypes=yt,e.SequenceClass=Rc,e.SequenceMediaClass=Oc,e.SequenceType=Ne,e.ServerTypes=Yt,e.SetptsFilter=hs,e.SetsarFilter=cs,e.ShapeContainerClass=lc,e.ShapeContainerDefinitionClass=hc,e.SizeIcon=Ir,e.SizeOutput=Fr,e.SizePreview=Sr,e.SizeProbe=Qc,e.SizeZero=pr,e.SizingMediaTypes=ot,e.Sizings=ei,e.StandardErrorName=O,e.TextContainerId=ma,e.TextExtension="txt",e.TextFilter=ps,e.TimeClass=Vr,e.TimeRangeClass=Rr,e.TimingMediaTypes=ut,e.Timings=$t,e.TrackClass=bu,e.TrackFactory=Fu,e.TrackPreviewClass=yu,e.TrackPreviewHandleSize=8,e.TrackPreviewLineSize=2,e.TranscodeType=Is,e.TranscodingClass=$s,e.TranscodingTypes=Je,e.TriggerTypes=Lt,e.TrimFilter=ds,e.TweenableDefinitionMixin=Zs,e.TweenableMixin=ks,e.UpdatableDurationDefinitionMixin=Bu,e.UpdatableDurationMediaTypes=Mu,e.UpdatableDurationMixin=Ru,e.UpdatableSizeDefinitionMixin=Wu,e.UpdatableSizeMediaType=Uu,e.UpdatableSizeMixin=Hu,e.VideoClass=qc,e.VideoMediaClass=Hc,e.VideoStreamType="videostream",e.VideoType=qe,e.actionInstance=ur,e.arrayLast=di,e.arrayReversed=function(e){return d(e).reverse()},e.arraySet=pi,e.arrayUnique=vi,e.assertAboveZero=le,e.assertAction=Yn,e.assertArray=fe,e.assertBoolean=function(e,t){$(e)||G(e,"Boolean",t)},e.assertChangeAction=function(e){if(!tr(e))throw new Error("expected ChangeAction")},e.assertClientAudio=jn,e.assertClientFont=function(e,t){qn(e)||G(e,"ClientFont",t)},e.assertClientImage=On,e.assertClientMedia=function(e,t){Un(e)||G(e,"ClientMedia",t)},e.assertClientVideo=Vn,e.assertClip=Zr,e.assertContainer=ka,e.assertContainerObject=function(e){ya(e)||G(e,"ContainerObject")},e.assertContainerType=function(e,t){ht(e)||G(e,"ContainerType",t)},e.assertContent=wa,e.assertContentType=function(e,t){dt(e)||G(e,"ContentType",t)},e.assertConvolutionServerFilter=Zo,e.assertDataGroup=function(e,t){aa(e)||G(e,"DataGroup",t)},e.assertDataType=Dt,e.assertDecodeOutput=function(e){Xc(e)||G(e,"DecodeOutput")},e.assertDecoding=function(e){Nu(e)||G(e,"Decoding")},e.assertDefined=function(e,t){te(e)||G(e,"Defined",t)},e.assertDirection=jt,e.assertEditType=function(e,t){vt(e)||G(e,"EditType",t)},e.assertEffect=Hr,e.assertEndpoint=Ai,e.assertFilterDefinition=co,e.assertFont=function(e){if(!Cu(e))throw new Error("expected Font")},e.assertFontMedia=function(e){if(!Pu(e))throw new Error("expected FontMedia")},e.assertIdentified=function(e,t){ui(e)||G(e,"Identified",t)},e.assertInteger=ae,e.assertLoadType=tt,e.assertLoaderType=function(e,t){Bn(e)||G(e,"LoaderType",t)},e.assertMashMedia=Jn,e.assertMedia=In,e.assertMediaType=We,e.assertMethod=ee,e.assertMoveAction=function(e,t){sr(e)||G(e,"MoveAction",t)},e.assertNumber=Z,e.assertObject=W,e.assertPlugin=zs,e.assertPoint=Ca,e.assertPopulatedArray=ye,e.assertPopulatedObject=ke,e.assertPopulatedString=ve,e.assertPositive=se,e.assertProbeOptions=function(e){tl(e)||G(e,"ProbeOptions")},e.assertProbeOutput=function(e){il(e)||G(e,"ProbeOutput")},e.assertProbing=function(e){qu(e)||G(e,"Probing")},e.assertProperty=sa,e.assertRect=Ea,e.assertRequest=Oi,e.assertRgb=function(e,t){we(e)||G(e,"Rgb",t)},e.assertSelectType=function(e,t){gt(e)||G(e,"SelectType",t)},e.assertSize=fr,e.assertSizeAboveZero=wr,e.assertString=K,e.assertTime=Se,e.assertTimeRange=Ce,e.assertTrack=Jr,e.assertTranscodingType=Xe,e.assertTrue=be,e.assertTweenable=Ur,e.assertTweenableDefinition=function(e){if(!Lr(e))throw new Error("expected TweenableDefinition")},e.assertTyped=function(e,t){zn(e)||G(e,"Typed",t)},e.assertUpdatableDuration=function(e,t){Du(e)||G(e,"Updatable",t)},e.assertUpdatableDurationDefinition=Eu,e.assertUpdatableSize=function(e){Lu(e)||G(e,"UpdatableSize")},e.assertUpdatableSizeDefinition=function(e){Gu(e)||G(e,"UpdatableSizeDefinition")},e.assertValue=function(e,t){Pe(e)||G(e,"Value",t)},e.assertValueObject=Me,e.assertVideo=function(e){if(!ws(e))throw new Error("expected Video")},e.assertVideoMedia=bs,e.audioDefinition=sc,e.audioDefinitionFromId=uc,e.audioFromId=function(e){return cc({id:e})},e.audioInstance=cc,e.audioPreviewInstance=Ku,e.centerPoint=_a,e.clipInstance=Tu,e.colorBlack=$i,e.colorBlackOpaque=nn,e.colorBlackTransparent=tn,e.colorBlue="#0000FF",e.colorFromRgb=function(e){var t=e.r,i=e.g,n=e.b;return"rgb(".concat(t,",").concat(i,",").concat(n,")")},e.colorGreen=rn,e.colorMixRbg=fn,e.colorMixRbga=hn,e.colorRed="#FF0000",e.colorRgbDifference=function(e){var t=e.r,i=e.g,n=e.b;return m(m({},e),{},{r:255-t,g:255-i,b:255-n})},e.colorRgbKeys=Xi,e.colorRgbToHex=an,e.colorRgbaKeys=Yi,e.colorRgbaToHex=on,e.colorToRgb=cn,e.colorToRgba=ln,e.colorTransparent=Zi,e.colorValid=sn,e.colorValidHex=un,e.colorWhite=Qi,e.colorWhiteOpaque="#FFFFFFFF",e.colorWhiteTransparent=en,e.colorYellow="#FFFF00",e.commandFilesInput=ro,e.commandFilesInputIndex=no,e.decodingInstance=tu,e.editorArgs=nc,e.editorInstance=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.editorSingleton=new ic(nc(t))},e.editorSelectionInstance=ea,e.effectDefinition=ou,e.effectDefinitionFromId=su,e.effectFromId=function(e){return su(e).instanceFromObject()},e.effectInstance=uu,e.encodingInstance=Au,e.endpointAbsolute=Vi,e.endpointFromAbsolute=Di,e.endpointFromUrl=zi,e.endpointIsAbsolute=Ei,e.endpointUrl=Mi,e.error=U,e.errorCaught=function(e){return{error:q(e)}},e.errorMessage=j,e.errorName=B,e.errorObject=N,e.errorObjectCaught=q,e.errorPromise=L,e.errorThrow=G,e.eventStop=mu,e.filePromises=tc,e.filterDefinition=function(e){return ve(e.id),new fo(e)},e.filterDefinitionFromId=ms,e.filterFromId=gs,e.filterInstance=ys,e.fontDefault=Pc,e.fontDefinition=Cc,e.fontDefinitionFromId=function(e){return Cc({id:e})},e.fontFind=Ic,e.idGenerate=fa,e.idGenerateString=ha,e.idIsTemporary=pa,e.idTemporary=da,e.imageDefinition=zc,e.imageDefinitionFromId=Ec,e.imageFromId=function(e){return Vc({id:e})},e.imageFromVideoPromise=Gc,e.imageInstance=Vc,e.isAboveZero=ce,e.isAction=Xn,e.isActionEvent=function(e){return e instanceof CustomEvent&&e.detail},e.isActionInit=function(e){return Xn(e.action)},e.isArray=he,e.isAudio=cu,e.isAudioMedia=lu,e.isBelowOne=ue,e.isBoolean=$,e.isChangeAction=tr,e.isChangeActionObject=Qn,e.isClientAudio=_n,e.isClientFont=qn,e.isClientImage=Rn,e.isClientMedia=Un,e.isClientVideo=En,e.isClip=Yr,e.isClipObject=function(e){return H(e)},e.isClipSelectType=Tt,e.isColorContent=fu,e.isContainer=ga,e.isContainerDefinition=function(e){return Lr(e)&&ht(e.type)},e.isContainerObject=ya,e.isContainerType=ht,e.isContent=ba,e.isContentDefinition=Fa,e.isContentType=dt,e.isConvolutionServerFilter=Yo,e.isCookedType=function(e){return J(e)&&Ye.includes(e)},e.isDataGroup=aa,e.isDataType=Mt,e.isDecodeOutput=Xc,e.isDecoding=Nu,e.isDecodingType=ju,e.isDefined=te,e.isDefiniteError=Ee,e.isDirection=_t,e.isEditType=vt,e.isEffect=Gr,e.isEffectMedia=function(e){return Sn(e)&&e.type===Re},e.isEndpoint=xi,e.isErrorName=_,e.isEventType=function(e){return Jt.includes(e)},e.isFillType=function(e){return St.includes(e)},e.isFilterDefinition=uo,e.isFloat=function(e){return ne(e)&&!re(e)},e.isFont=Cu,e.isFontMedia=Pu,e.isGraphFileType=Pt,e.isIdentified=ui,e.isImage=function(e){return Lu(e)},e.isImageMedia=$u,e.isInteger=re,e.isJsonRecord=De,e.isJsonRecords=ze,e.isLoadType=et,e.isLoaderType=Bn,e.isMashAndMediaObject=function(e){return H(e)&&"media"in e&&he(e.media)},e.isMashMedia=Wn,e.isMedia=Sn,e.isMediaInstance=wn,e.isMediaInstanceObject=function(e){return H(e)&&("mediaId"in e||"definition"in e)},e.isMediaObject=Fn,e.isMediaType=He,e.isMethod=Q,e.isMoveAction=sr,e.isNan=ie,e.isNumber=ne,e.isNumberOrNaN=Y,e.isNumeric=Te,e.isObject=H,e.isOrientation=Vt,e.isOutput=si,e.isPlugin=Ds,e.isPoint=Ia,e.isPopulatedArray=me,e.isPopulatedObject=ge,e.isPopulatedString=pe,e.isPositive=oe,e.isProbeOptions=tl,e.isProbeOutput=il,e.isProbing=qu,e.isPropertied=function(e){return e instanceof kn},e.isProperty=oa,e.isRawMedia=function(e){return Rn(e)||En(e)||_n(e)},e.isRawType=$e,e.isRect=za,e.isRequest=Ri,e.isRequestable=ji,e.isRequestableObject=_i,e.isRgb=we,e.isSelectType=gt,e.isSelectedProperty=rc,e.isShapeContainer=function(e){return ga(e)&&"path"in e},e.isSize=hr,e.isSizingMediaType=st,e.isString=J,e.isTime=Fe,e.isTimeRange=Ie,e.isTimingMediaType=ct,e.isTrack=Wr,e.isTranscodeOutput=function(e){return si(e)&&"type"in e&&Ke(e.type)},e.isTranscoding=bn,e.isTranscodingType=Ke,e.isTriggerType=function(e){return Lt.includes(e)},e.isTrueValue=xe,e.isTweenable=Br,e.isTweenableDefinition=Lr,e.isTyped=zn,e.isUndefined=X,e.isUpdatableDuration=Du,e.isUpdatableDurationDefinition=zu,e.isUpdatableDurationType=function(e){return He(e)&&Mu.includes(e)},e.isUpdatableSize=Lu,e.isUpdatableSizeDefinition=Gu,e.isUpdatableSizeType=function(e){return He(e)&&Uu.includes(e)},e.isValue=Pe,e.isValueObject=Ae,e.isVideo=ws,e.isVideoMedia=Ts,e.mashDefault=Yu,e.mashMedia=Zu,e.mediaDefinition=xn,e.mediaInfo=ec,e.mediaTypeFromMime=Qu,e.pixelToFrame=vu,e.plugin=Vs,e.pluginId=Es,e.pluginPromise=Rs,e.pointCopy=Aa,e.pointNegate=function(e){return{x:-e.x,y:-e.y}},e.pointRound=Ma,e.pointString=Da,e.pointValueString=function(e){var t=e.x,i=e.y;return"".concat(t,",").concat(i)},e.pointsEqual=Pa,e.propertyInstance=ua,e.propertyTypeCoerce=yn,e.propertyTypeDefault=vn,e.propertyTypeIsString=function(t){return t!==e.DataType.Boolean&&!pn(t)},e.propertyTypeValid=mn,e.protocolLoadPromise=Os,e.rectCopy=function(e){return m(m({},Aa(e)),Cr(e))},e.rectFromSize=Oa,e.rectRound=function(e){return m(m({},yr(e)),Ma(e))},e.rectString=function(e){var t=[];return hr(e)&&t.push(xr(e)),Ia(e)&&t.push(Da(e)),t.join(";")},e.rectsEqual=Va,e.rectsFromSizes=function(e,t){var i=t||[xa,xa],n=p(e,2),r=n[0],a=n[1],o=p(i,2),s=o[0],u=o[1];return[Oa(r,s),Oa(a,u)]},e.requestAudioPromise=qs,e.requestExtension=js,e.requestFontPromise=Bs,e.requestImagePromise=Us,e.requestMediaPromise=function(e,t){switch(t){case Ve:case _e:case qe:return Js(e,t);case Oe:return Bs(e)}return L(V.Type)},e.requestPromise=Ks,e.requestProtocol=Ns,e.requestProtocolPromise=Ls,e.requestRawPromise=Js,e.requestRecordPromise=Ws,e.requestRecordsPromise=function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){var t=e.response;if(ze(t))return Promise.resolve({data:t})}return _s(e),Ls(e).then((function(t){return t.promise(e,Le).then((function(t){return Gs(e,t),t}))}))},e.requestVideoPromise=Hs,e.resolverExtension=function(e,t){var i=rl(t);return i?i.extension:js(e)},e.resolverLoad=rl,e.resolverPathPromise=function(e,t){var i=rl(t);return i?i.requestPromise(e).then(Ks):{path:e}},e.resolverPromise=function(e,t,i){var n=rl(t);if(n)return(0,n.requestPromise)(e).then((function(e){return Ks(e,i)}));var r={path:e};return Promise.resolve(r)},e.roundMethod=Dr,e.roundWithMethod=zr,e.selectedPropertiesScalarObject=function(e){return Object.fromEntries(Object.entries(e).map((function(e){return[e[0],e[1].value]})))},e.selectedPropertyObject=function(e,t,i){var n=e.filter((function(e){return!!rc(e)&&e.property.group===t&&e.selectType===i}));return Object.fromEntries(n.map((function(e){var t=e.name,i=e.property.name;return[t||i,e]})))},e.sequenceDefinition=_c,e.sequenceDefinitionFromId=jc,e.sequenceFromId=function(e){return Nc({id:e})},e.sequenceInstance=Nc,e.sizeAboveZero=br,e.sizeCeil=gr,e.sizeCopy=Cr,e.sizeCover=Tr,e.sizeEven=mr,e.sizeFloor=function(e){var t=e.width,i=e.height;return{width:Math.max(2,Math.floor(t)),height:Math.max(2,Math.floor(i))}},e.sizeFromElement=function(e){var t={width:Number(e.getAttribute("width")),height:Number(e.getAttribute("height"))};return wr(t,"sizeFromElement"),t},e.sizeLock=Pr,e.sizeLockNegative=Ar,e.sizeRound=yr,e.sizeScale=kr,e.sizeString=xr,e.sizedEven=vr,e.sizesEqual=dr,e.sortByFrame=ta,e.sortByIndex=ia,e.sortByLabel=function(e,t){return e.label<t.label?-1:e.label>t.label?1:0},e.sortByTrack=na,e.stringFamilySizeRect=fc,e.stringPluralize=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"s";return pe(t)?"".concat(e," ").concat(t).concat(1===e?"":i):t},e.stringSeconds=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=[],n=2,r=3600,a=!1,o=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)||e;return o>=r&&(e>=r?(i.push(String(Math.floor(e/r)).padStart(n,"0")),a=!0,e%=r):i.push("00:")),r=60,(a||o>=r)&&(a&&i.push(":"),e>=r?(i.push(String(Math.floor(e/r)).padStart(n,"0")),a=!0,e%=r):i.push("00:")),r=1,a||o>=r?(a&&i.push(":"),e>=r?(i.push(String(Math.floor(e/r)).padStart(n,"0")),a=!0,e%=r):i.push("00")):i.push("00"),t>1&&(10===t&&(n=1),i.push("."),e?(e=1===n?Math.round(10*e)/10:Math.round(100*e)/100,e=Number(String(e).slice(2)),i.push(String(e).padEnd(n,"0"))):i.push("0".padStart(n,"0"))),i.join("")},e.svgAddClass=Ro,e.svgAppend=Mo,e.svgDefsElement=Do,e.svgDifferenceDefs=function(e,t){var i=ha(),n=Ao({filter:"feBlend",mode:"difference"});Vo(n,i,"in"),Vo(n,"SourceGraphic","in2");var r=zo(e,i),a=Eo([r,n],t,xa);return Vo(a,"100%","width"),Vo(a,"100%","height"),a},e.svgElement=vo,e.svgElementInitialize=mo,e.svgFeImageElement=zo,e.svgFilter=Ao,e.svgFilterElement=Eo,e.svgFunc=function(e,t){var i=globalThis.document.createElementNS(li,e);return Vo(i,t,"tableValues"),Vo(i,"discrete","type"),i},e.svgGroupElement=ko,e.svgId=yo,e.svgImageElement=Co,e.svgImagePromise=Bo,e.svgImagePromiseWithOptions=Lo,e.svgMaskElement=xo,e.svgPathElement=Po,e.svgPatternElement=function(e,t,i){var n=globalThis.document.createElementNS(li,"pattern");return Vo(n,t),Fo(n,e),Vo(n,"userSpaceOnUse","patternUnits"),Mo(n,i),n},e.svgPolygonElement=wo,e.svgRectPoints=bo,e.svgSet=Vo,e.svgSetBox=Fo,e.svgSetChildren=qo,e.svgSetDimensions=To,e.svgSetDimensionsLock=Io,e.svgSetTransform=_o,e.svgSetTransformPoint=function(e,t){Ca(t);var i=t.x,n=t.y;(i||n)&&_o(e,"translate(".concat(i,", ").concat(n,")"))},e.svgSetTransformRects=No,e.svgSvgElement=So,e.svgText=Uo,e.svgTransform=jo,e.svgUrl=go,e.svgUseElement=Oo,e.timeEqualizeRates=Er,e.timeFromArgs=Nr,e.timeFromSeconds=qr,e.timeRangeFromArgs=Or,e.timeRangeFromSeconds=function(){return Or(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)},e.timeRangeFromTime=_r,e.timeRangeFromTimes=jr,e.trackInstance=wu,e.transcodingInstance=Qs,e.tweenColorStep=qa,e.tweenColors=function(e,t,i){ve(e);var n=[e];if(pe(t)&&i>1)for(var r=1;r<i;r++)n.push(qa(e,t,r,i));return n},e.tweenCoverPoints=Za,e.tweenCoverSizes=Ya,e.tweenInputTime=function(e,t,i,n,r){if(n){if(!t)return i?e.startTime:e.lastTime;if(r){if(i)return e.lastTime}else if(!i)return e.startTime}},e.tweenMaxSize=Ua,e.tweenMinMax=io,e.tweenMinSize=function(e,t){var i=e.width,n=e.height;return!hr(t)||dr(e,t)?{width:i,height:n}:{width:Math.min(i,t.width),height:Math.min(n,t.height)}},e.tweenNumberObject=Ha,e.tweenNumberStep=Na,e.tweenOption=La,e.tweenOverPoint=Ja,e.tweenOverRect=Wa,e.tweenOverSize=Ka,e.tweenPad=ja,e.tweenPosition=Ga,e.tweenRectLock=$a,e.tweenRectStep=Ba,e.tweenRects=function(e,t,i){var n=[e];if(t&&i>1)for(var r=1;r<i;r++)n.push(Ba(e,t,r,i));return n},e.tweenRectsLock=Qa,e.tweenScaleSizeRatioLock=eo,e.tweenScaleSizeToRect=Xa,e.tweenableRects=function(e,t){return!!za(t)&&(e.x!==t.x||e.y!==t.y||e.width!==t.width||e.height!==t.height)},e.tweeningPoints=to,e.urlBase=yi,e.urlBaseInitialize=gi,e.urlBaseInitialized=ki,e.urlCombine=Fi,e.urlEndpoint=Ti,e.urlExtension=Pi,e.urlFilename=function(e,t){return"".concat(e,".").concat(Pi(t))},e.urlForEndpoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t&&wi(t))return t;var i=Ii(e),n=i.endsWith("/")?i:i+"/";return wi(n)?new URL(t,n).href:n+t},e.urlFromCss=function(e){var t=d(e.matchAll(/url\(([^)]+)\)(?!.*\1)/g));return di(di(t))},e.urlFromEndpoint=Ii,e.urlHasProtocol=wi,e.urlIsBlob=bi,e.urlIsHttp=function(e){return e.startsWith("http")},e.urlIsObject=function(e){return e.startsWith("object:/")},e.urlOptions=Ci,e.urlOptionsObject=function(e){if(pe(e)){var t=e.split(";").map((function(e){var t=e.split("="),i=p(t,2),n=i[0],r=i[1];return[n,Te(r)?Number(r):r]}));return Object.fromEntries(t)}},e.urlPrependProtocol=function(e,t,i){var n=e.endsWith(":")?e:"".concat(e,":");return t.startsWith(n)&&!i?t:"".concat(n).concat(Ci(i),"/").concat(t)},e.urlProtocol=function(e){var t=e.indexOf(":");return ce(t)?e.slice(0,t+1):""},e.urlResolve=Si,e.videoDefinition=Wc,e.videoDefinitionFromId=Jc,e.videoFromId=function(e){return Kc({id:e})},e.videoInstance=Kc}(t)}}]);
//# sourceMappingURL=133.91c7ea2d.chunk.js.map